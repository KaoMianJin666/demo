import{r as e,z as l,e as a,f as t,w as u,j as i,q as n,b as o,N as d,x as s,y as v,o as r,c as m,g as p,F as c,B as f,u as y,A as h,T as g,U as k,n as w,h as _,i as b,H as C,V,W as D,X as T,Y as x,J as U,Z as I,_ as j,s as S,t as L}from"./lib.5034c038.js";import{D as O,M as E,e as N,H as A,b as H}from"./explosionDiagram.86f65b93.js";import{r as B,_ as F,T as G,g as J,a as q,s as M}from"./index.8c6e66d9.js";const R={__name:"addType",emits:["addType"],setup(s,{expose:v,emit:r}){const m=r,p=e(!1),c=e(null),f=e(null),y=()=>{m("addType",{name:c.value,image:f.value}),p.value=!1},h=e=>{if("image/png"!==e.type)return void d.error("请上传png格式图片");const l=new FileReader;return l.onload=({target:e})=>{f.value=e.result},l.readAsDataURL(e),!1};return v({init:e=>{c.value=null,f.value=null,e&&(c.value=e.name,f.value=e.image),p.value=!0}}),(e,d)=>{const s=l("el-input"),v=l("el-form-item"),r=l("el-button"),m=l("el-upload"),g=l("el-image"),k=l("el-form"),w=l("el-dialog");return a(),t(w,{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=e=>p.value=e),title:"图层管理",width:"400px"},{footer:u((()=>[i(r,{onClick:y},{default:u((()=>[n("保存")])),_:1})])),default:u((()=>[i(k,{"label-width":"100px"},{default:u((()=>[i(v,{label:"类型名称",required:""},{default:u((()=>[i(s,{modelValue:c.value,"onUpdate:modelValue":d[0]||(d[0]=e=>c.value=e)},null,8,["modelValue"])])),_:1}),i(v,{label:"类型图片"},{default:u((()=>[i(m,{class:"upload-demo","before-upload":h,accept:".png","show-file-list":!1,action:""},{default:u((()=>[i(r,{type:"primary"},{default:u((()=>[n("上传图片")])),_:1})])),_:1})])),_:1}),f.value?(a(),t(v,{key:0,label:"图片预览"},{default:u((()=>[i(g,{src:f.value,"preview-src-list":[f.value],style:{width:"100px",height:"100px"}},null,8,["src","preview-src-list"])])),_:1})):o("",!0)])),_:1})])),_:1},8,["modelValue"])}}};function $(e,l){return B.post(`/teai/upload?file_id=${e}`,l)}const z=e=>(S("data-v-f7cd5d2c"),e=e(),L(),e),W={class:"model-editor"},X={class:"handle-area"},Y={class:"handle-btn-area"},Z={class:"model-editor-area"},K={class:"group-list"},P={class:"group-list-title"},Q={class:"change-setting-type-area"},ee=["onClick"],le={key:0,class:"group-list-info"},ae=["onClick"],te={key:0,class:"layer-item-image"},ue=["src"],ie={class:"layer-item-name"},ne={class:"layer-item-handle"},oe={key:0,class:"lora-info"},de={class:"lora-info-item"},se=z((()=>p("div",{class:"lora-info-name"},"静态层",-1))),ve={class:"lora-info-input"},re={class:"lora-info-item"},me=z((()=>p("div",{class:"lora-info-name"},"提示词",-1))),pe={class:"lora-info-input"},ce={key:1,class:"group-list-info"},fe=["onClick"],ye={class:"layer-item-name"},he={class:"layer-item-handle"},ge={key:0,class:"lora-info"},ke={class:"lora-info-item"},we=z((()=>p("div",{class:"lora-info-name"},"静态层",-1))),_e={class:"lora-info-input"},be={class:"lora-info-item"},Ce=z((()=>p("div",{class:"lora-info-name"},"提示词",-1))),Ve={class:"lora-info-input"},De={class:"lora-info-item"},Te=z((()=>p("div",{class:"lora-info-name"},"图层",-1))),xe={class:"lora-info-input"};var Ue=F({__name:"index",setup(S){const L=s(),B=v(),F=e("explosionDiagramDom"),z=e("modelEditorDom"),Ue=e("addTypeDom"),Ie=e(null),je=e(190),Se=e(220),Le=e(1),Oe=e([]),Ee=e(null),Ne=e(null),Ae=e([]),He=e("editor"),Be=e([]),Fe=e([]),Ge=e(""),Je=[{name:"图层管理"},{name:"组管理"}],qe=e(0),Me=e([]),Re=e([]),$e=e([]),ze=e(new Set),We=e(new Set),Xe=()=>{Ie.value.setName(Ge.value)},Ye="editor",Ze="explosion",Ke=Object.keys(O).map((e=>({key:e,value:O[e]}))),Pe=e(O.NOMAL),Qe=e({width:0,height:0}),el=()=>{window.loading=G(),setTimeout((()=>{L.replace("main")}),300)},ll=()=>{Ie.value.setCanvasSize({width:je.value*Le.value,height:Se.value*Le.value}),Qe.value=Ie.value.getCanvasStyle()},al=()=>{Ue.value.init()},tl=e=>{Ne.value=e,Ie.value.setTypeUuid(e),(e=>{ze.value.has(e)?ze.value.delete(e):ze.value.add(e)})(e)},ul=e=>{Ie.value.addType(e).then((e=>{vl(e)}))},il=()=>{Ee.value=Ie.value.changeHandleType(Ee.value===A.HANDLE?A.DRAWING:A.HANDLE)},nl=()=>{F.value.changeExplosionType("CHANGE")},ol=()=>{Be.value=Fe.value.filter((({uuid:e})=>!Ae.value.find((l=>l===e))))},dl=()=>{He.value===Ye?(Ie.value.removeListener(),Ie.value.getAllLayerImage().then((e=>{Fe.value=Object.keys(e).map((l=>Object.assign({uuid:l,imageSrc:e[l].imageBase64},e[l]))).reverse(),ol(),He.value=Ze}))):(He.value=Ye,V((()=>{Ie.value.addListener()})))},sl=()=>{Ie.value.changeDrawType(Pe.value)},vl=(e=null)=>{e=e||Ie.value.getTypeList(),Oe.value=Object.keys(e).map((l=>(Oe.value.length||(Ie.value.setTypeUuid(l),Ne.value=l),{uuid:l,name:e[l].name,image:e[l].image,loraInfo:e[l].loraInfo})))},rl=(...e)=>{Ie.value.bindLora(...e)},ml=()=>{q("prompts").then((e=>{const l=e?e.templates:{};Re.value=Object.keys(l)})),q("statics").then((e=>{const l=e?e.templates:{};$e.value=Object.keys(l)}))},pl=(e,l)=>{const a={viewData:e};Object.keys(e.typeData).forEach((l=>{a[l]={statics:e.typeData[l].loraInfo.statics,prompts:e.typeData[l].loraInfo.prompts}})),Me.value.forEach((e=>{a[e.uuid]=e.loraInfo}));const t=JSON.stringify(a),u=new Blob([t],{type:"application/json"}),i=new File([u],`${Ge.value}.json`,{type:"application/json",lastModified:Date.now()}),n=new FormData;n.append("file",i),M(n,"layouts",Ge.value,l).then((e=>{d.success("保存成功")}))},cl=()=>{Ie.value.getSaveData(!1).then((e=>{let l=0;const a=H(e.preview,Ge.value),t=new FormData;t.append("file",a),delete e.preview,$(Ge.value,t).then((a=>{const t=a;Object.keys(e.typeData).forEach((a=>{const u=e.typeData[a];if(u.imageBase64&&u.imageBase64.includes("data:image/")){const i=H(u.imageBase64,a),n=new FormData;n.append("file",i),$(a,n).then((u=>{e.typeData[a].imageBase64=u,l+=1,l===Object.keys(e.typeData).length&&(pl(e,t),Ie.value.setData(e).then((({typeList:e})=>{vl(e),Pe.value=Ie.value.getDrawType(),Qe.value=Ie.value.getCanvasStyle()})))}))}else l+=1,l===Object.keys(e.typeData).length&&(pl(e,t),Ie.value.setData(e).then((({typeList:e})=>{vl(e),Pe.value=Ie.value.getDrawType(),Qe.value=Ie.value.getCanvasStyle()})))}))}))}))},fl=()=>{Me.value=Ie.value.addGroup()},yl=(e,l)=>{Me.value=Ie.value.updateGroup(e,l)},hl=(e=[])=>{let l=JSON.parse(JSON.stringify(Oe.value));const a=new Set(e);return Me.value.forEach((e=>{const t=new Set(e.layers);l=l.filter((({uuid:e})=>!t.has(e)||a.has(e)))})),l};return r((()=>{ml(),Ie.value=new E(z.value,{width:je.value*Le.value,height:Se.value*Le.value,name:Ge.value}),Ee.value=Ie.value.getHandleType(),Ae.value=Ie.value.hideLayerList,Qe.value=Ie.value.getCanvasStyle(),Ge.value=B.query.file_name||"",Ge.value?(window.loading||(window.loading=G()),J("layouts",Ge.value).then((e=>{Ie.value.setData(e.viewData).then((({typeList:e,groups:l})=>{vl(e),Me.value=l,Qe.value=Ie.value.getCanvasStyle(),window.loading.close(),window.loading=null}))}))):(window.loading||(window.loading=G()),setTimeout((()=>{window.loading.close(),window.loading=null}),300))})),(e,d)=>{const s=l("t-button"),v=l("el-form-item"),r=l("el-input"),V=l("el-input-number"),S=l("el-option"),L=l("el-select"),O=l("el-form"),E=l("el-icon"),A=l("el-scrollbar");return a(),m("div",W,[p("div",X,[p("div",Y,[i(O,{inline:""},{default:u((()=>[i(v,{label:"","label-width":"0"},{default:u((()=>[i(s,{style:{height:"1rem",padding:"0.1rem","line-height":"0.9rem",margin:"0"},type:"text-info",onClick:el},{default:u((()=>[n("返回")])),_:1})])),_:1}),i(v,{label:"模板名称"},{default:u((()=>[i(r,{style:{width:"3rem"},modelValue:Ge.value,"onUpdate:modelValue":d[0]||(d[0]=e=>Ge.value=e),onChange:Xe},null,8,["modelValue"])])),_:1}),i(v,{label:"宽度"},{default:u((()=>[i(V,{style:{width:"3rem"},modelValue:je.value,"onUpdate:modelValue":d[1]||(d[1]=e=>je.value=e),onChange:ll,controls:!1,min:1},null,8,["modelValue"])])),_:1}),i(v,{label:"高度"},{default:u((()=>[i(V,{style:{width:"3rem"},modelValue:Se.value,"onUpdate:modelValue":d[2]||(d[2]=e=>Se.value=e),onChange:ll,controls:!1,min:1},null,8,["modelValue"])])),_:1}),i(v,{label:"绘制模式"},{default:u((()=>[i(L,{style:{width:"3rem"},modelValue:Pe.value,"onUpdate:modelValue":d[3]||(d[3]=e=>Pe.value=e),onChange:sl},{default:u((()=>[(a(!0),m(c,null,f(y(Ke),(e=>(a(),t(S,{key:e.key,value:e.value,label:e.value},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(v,{label:"","label-width":"0"},{default:u((()=>[i(s,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:il},{default:u((()=>[n(h(Ee.value),1)])),_:1})])),_:1}),i(v,{label:"","label-width":"0"},{default:u((()=>[i(s,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:dl},{default:u((()=>[n(h("explosion"===He.value?"编辑器展示":"爆炸图展示"),1)])),_:1})])),_:1}),"explosion"===He.value?(a(),t(v,{key:0,label:"","label-width":"0"},{default:u((()=>[i(s,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:nl},{default:u((()=>[n("切换爆炸图展示模式")])),_:1})])),_:1})):o("",!0),i(v,{label:"","label-width":"0"},{default:u((()=>[i(s,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:cl},{default:u((()=>[n("保存")])),_:1})])),_:1})])),_:1})]),p("div",Z,[g(p("div",{class:"model-editor-info",ref_key:"modelEditorDom",ref:z},null,512),[[k,"editor"===He.value]]),"explosion"===He.value?(a(),t(N,{key:0,explosionStyle:Qe.value,data:Be.value,ref_key:"explosionDiagramDom",ref:F},null,8,["explosionStyle","data"])):o("",!0)])]),p("div",K,[p("div",P,[p("div",Q,[p("div",{class:"component-selected",style:w({left:3.2*qe.value+.05+"rem"})},null,4),(a(),m(c,null,f(Je,((e,l)=>p("div",{class:"component-item",onClick:e=>qe.value=l,key:e.name},h(e.name),9,ee))),64))]),0===qe.value?(a(),t(s,{key:0,type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:al},{default:u((()=>[i(E,null,{default:u((()=>[i(y(D))])),_:1})])),_:1})):o("",!0),1===qe.value?(a(),t(s,{key:1,type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:fl},{default:u((()=>[i(E,null,{default:u((()=>[i(y(D))])),_:1})])),_:1})):o("",!0)]),0===qe.value?(a(),m("div",le,[i(A,null,{default:u((()=>[(a(!0),m(c,null,f(Oe.value,(e=>(a(),m("div",{key:e.uuid},[p("div",{class:_(["layer-item",{selected:Ne.value===e.uuid}]),onClick:l=>tl(e.uuid)},[e.image?(a(),m("div",te,[p("img",{src:e.image.src},null,8,ue)])):o("",!0),p("div",ie,h(e.name),1),p("div",{class:"layer-item-handle",onClick:d[4]||(d[4]=b((()=>{}),["stop"]))},[i(E,{onClick:l=>{return a=e.uuid,Ae.value=Ie.value.hideHandle(a),void ol();var a}},{default:u((()=>[(a(),t(C(Ae.value.find((l=>l===e.uuid))===e.uuid?y(T):y(x))))])),_:2},1032,["onClick"])]),p("div",{class:"layer-item-handle",onClick:d[5]||(d[5]=b((()=>{}),["stop"]))},[i(E,{onClick:l=>{return a=e.uuid,void Ie.value.deleteType(a).then((({typeList:e,groups:l})=>{vl(e),Me.value=l}));var a}},{default:u((()=>[(a(),t(C(y(U))))])),_:2},1032,["onClick"])]),p("div",ne,[i(E,null,{default:u((()=>[(a(),t(C(ze.value.has(e.uuid)?y(I):y(j))))])),_:2},1024)])],10,ae),ze.value.has(e.uuid)?(a(),m("div",oe,[p("div",de,[se,p("div",ve,[i(L,{multiple:"",modelValue:e.loraInfo.statics,"onUpdate:modelValue":l=>e.loraInfo.statics=l,onChange:l=>rl(e.uuid,e.loraInfo.statics,"statics")},{default:u((()=>[(a(!0),m(c,null,f($e.value,(e=>(a(),t(S,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])]),p("div",re,[me,p("div",pe,[i(L,{multiple:"",modelValue:e.loraInfo.prompts,"onUpdate:modelValue":l=>e.loraInfo.prompts=l,onChange:l=>rl(e.uuid,e.loraInfo.prompts,"prompts")},{default:u((()=>[(a(!0),m(c,null,f(Re.value,(e=>(a(),t(S,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])])])):o("",!0)])))),128))])),_:1})])):o("",!0),1===qe.value?(a(),m("div",ce,[i(A,null,{default:u((()=>[(a(!0),m(c,null,f(Me.value,((e,l)=>(a(),m("div",{key:e.uuid},[p("div",{class:"layer-item",onClick:l=>{return a=e.uuid,void(We.value.has(a)?We.value.delete(a):We.value.add(a));var a}},[p("div",ye,h(`组${l+1}`),1),p("div",{class:"layer-item-handle",onClick:d[6]||(d[6]=b((()=>{}),["stop"]))},[i(E,{onClick:l=>{return a=e.uuid,void(Me.value=Ie.value.deleteGroup(a));var a}},{default:u((()=>[(a(),t(C(y(U))))])),_:2},1032,["onClick"])]),p("div",he,[i(E,null,{default:u((()=>[(a(),t(C(We.value.has(e.uuid)?y(I):y(j))))])),_:2},1024)])],8,fe),We.value.has(e.uuid)?(a(),m("div",ge,[p("div",ke,[we,p("div",_e,[i(L,{multiple:"",modelValue:e.loraInfo.statics,"onUpdate:modelValue":l=>e.loraInfo.statics=l,onChange:l=>yl(e.uuid,e)},{default:u((()=>[(a(!0),m(c,null,f($e.value,(e=>(a(),t(S,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])]),p("div",be,[Ce,p("div",Ve,[i(L,{multiple:"",modelValue:e.loraInfo.prompts,"onUpdate:modelValue":l=>e.loraInfo.prompts=l,onChange:l=>yl(e.uuid,e)},{default:u((()=>[(a(!0),m(c,null,f(Re.value,(e=>(a(),t(S,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])]),p("div",De,[Te,p("div",xe,[i(L,{multiple:"",modelValue:e.layers,"onUpdate:modelValue":l=>e.layers=l,onChange:l=>yl(e.uuid,e)},{default:u((()=>[(a(!0),m(c,null,f(hl(e.layers),(e=>(a(),t(S,{key:e.uuid,label:e.name,value:e.uuid},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])])])):o("",!0)])))),128))])),_:1})])):o("",!0)]),i(R,{ref_key:"addTypeDom",ref:Ue,onAddType:ul},null,512)])}}},[["__scopeId","data-v-f7cd5d2c"]]);export{Ue as default};
