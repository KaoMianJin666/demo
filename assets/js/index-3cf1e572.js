import{a as d}from"./axios-f5a5de21.js";import{n as V}from"./index-33347779.js";/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const E=[],H=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),y=Object.assign,p=Array.isArray,v=t=>typeof t=="function",u=t=>typeof t=="string",O=t=>typeof t=="symbol",C=t=>t!==null&&typeof t=="object";let w;const A=()=>w||(w=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});function k(t){if(p(t)){const i={};for(let a=0;a<t.length;a++){const e=t[a],s=u(e)?q(e):k(e);if(s)for(const n in s)i[n]=s[n]}return i}else if(u(t)||C(t))return t}const U=/;(?![^(]*\))/g,j=/:([^]+)/,W=/\/\*[^]*?\*\//g;function q(t){const i={};return t.replace(W,"").split(U).forEach(a=>{if(a){const e=a.split(j);e.length>1&&(i[e[0].trim()]=e[1].trim())}}),i}function D(t){let i="";if(u(t))i=t;else if(p(t))for(let a=0;a<t.length;a++){const e=D(t[a]);e&&(i+=e+" ")}else if(C(t))for(const a in t)t[a]&&(i+=a+" ");return i.trim()}/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(O));function $(t){return T(t)?$(t.__v_raw):!!(t&&t.__v_isReactive)}function T(t){return!!(t&&t.__v_isReadonly)}function I(t){return $(t)||T(t)}function B(t){return!!(t&&t.__v_isRef===!0)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let _=null,G=null;const J=Symbol.for("v-ndc"),K=t=>t.__isSuspense;/*! #__NO_SIDE_EFFECTS__ */function L(t,i){return v(t)?(()=>y({name:t.name},i,{setup:t}))():t}const Y=t=>t.__isTeleport,M=Symbol.for("v-fgt"),Q=Symbol.for("v-txt"),X=Symbol.for("v-cmt"),h=[];let o=null;function R(t=!1){h.push(o=t?null:[])}function Z(){h.pop(),o=h[h.length-1]||null}function tt(t){return t.dynamicChildren=o||E,Z(),o&&o.push(t),t}function P(t,i,a,e,s,n){return tt(g(t,i,a,e,s,n,!0))}function at(t){return t?t.__v_isVNode===!0:!1}const F="__vInternal",N=({key:t})=>t!=null?t:null,f=({ref:t,ref_key:i,ref_for:a})=>(typeof t=="number"&&(t=""+t),t!=null?u(t)||B(t)||v(t)?{i:_,r:t,k:i,f:!!a}:t:null);function g(t,i=null,a=null,e=0,s=null,n=t===M?0:1,c=!1,l=!1){const r={__v_isVNode:!0,__v_skip:!0,type:t,props:i,key:i&&N(i),ref:i&&f(i),scopeId:G,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:e,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:_};return l?(S(r,a),n&128&&t.normalize(r)):a&&(r.shapeFlag|=u(a)?8:16),!c&&o&&(r.patchFlag>0||n&6)&&r.patchFlag!==32&&o.push(r),r}const it=et;function et(t,i=null,a=null,e=0,s=null,n=!1){if((!t||t===J)&&(t=X),at(t)){const l=b(t,i,!0);return a&&S(l,a),!n&&o&&(l.shapeFlag&6?o[o.indexOf(t)]=l:o.push(l)),l.patchFlag|=-2,l}if(rt(t)&&(t=t.__vccOpts),i){i=st(i);let{class:l,style:r}=i;l&&!u(l)&&(i.class=D(l)),C(r)&&(I(r)&&!p(r)&&(r=y({},r)),i.style=k(r))}const c=u(t)?1:K(t)?128:Y(t)?64:C(t)?4:v(t)?2:0;return g(t,i,a,e,s,c,n,!0)}function st(t){return t?I(t)||F in t?y({},t):t:null}function b(t,i,a=!1){const{props:e,ref:s,patchFlag:n,children:c}=t,l=i?lt(e||{},i):e;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:l,key:l&&N(l),ref:i&&i.ref?a&&s?p(s)?s.concat(f(i)):[s,f(i)]:f(i):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:c,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:i&&t.type!==M?n===-1?16:n|16:n,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&b(t.ssContent),ssFallback:t.ssFallback&&b(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function nt(t=" ",i=0){return it(Q,null,t,i)}function S(t,i){let a=0;const{shapeFlag:e}=t;if(i==null)i=null;else if(p(i))a=16;else if(typeof i=="object")if(e&65){const s=i.default;s&&(s._c&&(s._d=!1),S(t,s()),s._c&&(s._d=!0));return}else{a=32;const s=i._;!s&&!(F in i)?i._ctx=_:s===3&&_&&(_.slots._===1?i._=1:(i._=2,t.patchFlag|=1024))}else v(i)?(i={default:i,_ctx:_},a=32):(i=String(i),e&64?(a=16,i=[nt(i)]):a=8);t.children=i,t.shapeFlag|=a}function lt(...t){const i={};for(let a=0;a<t.length;a++){const e=t[a];for(const s in e)if(s==="class")i.class!==e.class&&(i.class=D([i.class,e.class]));else if(s==="style")i.style=k([i.style,e.style]);else if(H(s)){const n=i[s],c=e[s];c&&n!==c&&!(p(n)&&n.includes(c))&&(i[s]=n?[].concat(n,c):c)}else s!==""&&(i[s]=e[s])}return i}{const t=A(),i=(a,e)=>{let s;return(s=t[a])||(s=t[a]=[]),s.push(e),n=>{s.length>1?s.forEach(c=>c(n)):s[0](n)}};i("__VUE_INSTANCE_SETTERS__",a=>a),i("__VUE_SSR_SETTERS__",a=>a)}function rt(t){return v(t)&&"__vccOpts"in t}/*! Element Plus Icons Vue v2.3.1 */var ct=L({name:"Delete",__name:"delete",setup(t){return(i,a)=>(R(),P("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[g("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32zm448-64v-64H416v64zM224 896h576V256H224zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32m192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32"})]))}}),ot=ct,dt=L({name:"Plus",__name:"plus",setup(t){return(i,a)=>(R(),P("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[g("path",{fill:"currentColor",d:"M480 480V128a32 32 0 0 1 64 0v352h352a32 32 0 1 1 0 64H544v352a32 32 0 1 1-64 0V544H128a32 32 0 0 1 0-64z"})]))}}),ut=dt,_t=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"main-body"},[a("div",{staticClass:"left-menu"},[a("div",{staticClass:"left-menu-content"},t._l(t.menuList,function(e,s){return a("div",{key:s,staticClass:"menu-item",class:{selected:t.menuSelectedIndex===s},on:{click:function(n){return t.getMenuInfo(s)}}},[t.editMenuIndex!==s?a("div",{staticClass:"menu-name"},[t._v(t._s(e.name))]):a("div",{staticClass:"menu-name"},[a("el-input",{on:{click:function(n){n.stopPropagation()},keydown:function(n){t.saveMenuChange(n,s)}},model:{value:t.menuList[s].nameText,callback:function(n){t.$set(t.menuList[s],"nameText",n)},expression:"menuList[index].nameText"}})],1),a("div",{staticClass:"menu-handle"})])}),0)]),t.menuSelectedIndex!==null?a("div",{staticClass:"left-sub-menu"},[a("div",{staticClass:"left-sub-menu-content"},[a("el-scrollbar",{staticStyle:{width:"100%",height:"100%"}},[t.menuList[t.menuSelectedIndex].labeled>t.type2PageSize?a("div",{staticClass:"page-area"},[a("el-pagination",{staticClass:"mt-4",staticStyle:{"--el-pagination-button-disabled-bg-color":"#222","--el-pagination-bg-color":"#222","--el-pagination-button-color":"#fff"},attrs:{"page-size":t.type2PageSize,small:"",layout:"prev, pager, next",total:t.menuList[t.menuSelectedIndex].labeled},on:{"current-change":t.currentChange}})],1):t._e(),t._l(t.imageList,function(e,s){return a("div",{key:s,staticClass:"left-sub-menu-item"},[t.subMenuType==="2"?a("div",{staticClass:"left-sub-menu-image",on:{click:function(n){return t.getImageInfo(e)}}},[a("el-image",{staticStyle:{width:"100px",height:"100px",background:"#222"},attrs:{src:`${t.httpRequestUrl}/labels/static/${decodeURIComponent(t.menuList[t.menuSelectedIndex].name)}/${e}`,"preview-src-list":[`${t.httpRequestUrl}/labels/static/${decodeURIComponent(t.menuList[t.menuSelectedIndex].name)}/${e}`],fit:"contain"}})],1):t._e()])})],2)],1)]):t._e(),t.menuSelectedIndex!==null?a("div",{staticClass:"content"},[a("div",{staticClass:"content-image-msg"},[a("el-scrollbar",{staticStyle:{width:"100%",height:"100%"}},[a("div",{staticClass:"content-msg-title"},[t._v(" 数据设置 ")]),a("div",{staticClass:"content-dataset"},[a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 图片分辨率 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 训练图片的分辨率，宽*高，支持非正方形，但必须是64倍数 ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.resolutionW,callback:function(e){t.resolutionW=e},expression:"resolutionW"}}),t._v("  *  "),a("el-input",{attrs:{size:"small"},model:{value:t.resolutionH,callback:function(e){t.resolutionH=e},expression:"resolutionH"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 是否允许动态分辨率 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 自适应图片分辨率，无需指定分辨率，适合图片尺寸不一致的情况 ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.enable_bucket,callback:function(e){t.$set(t.trainData,"enable_bucket",e)},expression:"trainData.enable_bucket"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 动态分辨率范围 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 动态分辨率的最小值和最大值，只训练在该区间范围内的图片 ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.min_bucket_reso,callback:function(e){t.$set(t.trainData,"min_bucket_reso",e)},expression:"trainData.min_bucket_reso"}}),t._v("  -  "),a("el-input",{attrs:{size:"small"},model:{value:t.trainData.max_bucket_reso,callback:function(e){t.$set(t.trainData,"max_bucket_reso",e)},expression:"trainData.max_bucket_reso"}})],1)]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 噪声偏移 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 训练更加亮或者更加暗的图像时使用（如果使用，建议取0.1） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.noise_offset,callback:function(e){t.$set(t.trainData,"noise_offset",e)},expression:"trainData.noise_offset"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 保存数据加载进程 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 快速加载图片（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.persistent_data_loader_workers,callback:function(e){t.$set(t.trainData,"persistent_data_loader_workers",e)},expression:"trainData.persistent_data_loader_workers"}})],1)])])])]),a("div",{staticClass:"content-msg-title"},[t._v(" 训练相关参数 ")]),a("div",{staticClass:"content-dataset"},[a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 测试图片尺寸 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 用于设置每轮测试模型效果图的宽高 ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.sample_width,callback:function(e){t.$set(t.trainData,"sample_width",e)},expression:"trainData.sample_width"}}),t._v("  *  "),a("el-input",{attrs:{size:"small"},model:{value:t.trainData.sample_height,callback:function(e){t.$set(t.trainData,"sample_height",e)},expression:"trainData.sample_height"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 测试prompt ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 用于测试过程中检验模型效果的prompt ")])]),a("el-input",{staticStyle:{"margin-top":"5px"},attrs:{type:"textarea",placeholder:"",rows:3},model:{value:t.trainData.sample_prompts,callback:function(e){t.$set(t.trainData,"sample_prompts",e)},expression:"trainData.sample_prompts"}})],1),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 总训练轮数 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 对该数据集的训练次数，图片数据量越多建议数量越大 ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.max_train_epochs,callback:function(e){t.$set(t.trainData,"max_train_epochs",e)},expression:"trainData.max_train_epochs"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 批量大小 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 每次迭代过程中训练图片的数量，建议在1-4范围内 ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.train_batch_size,callback:function(e){t.$set(t.trainData,"train_batch_size",e)},expression:"trainData.train_batch_size"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 梯度检查点 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 是否启用梯度检查点节省显存（建议采用默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.gradient_checkpointing,callback:function(e){t.$set(t.trainData,"gradient_checkpointing",e)},expression:"trainData.gradient_checkpointing"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 梯度累加步数 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 累加n次梯度后再进行反向传播节省显存（建议采用默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.gradient_accumulation_steps,callback:function(e){t.$set(t.trainData,"gradient_accumulation_steps",e)},expression:"trainData.gradient_accumulation_steps"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 只训练模型 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 是否训练模型（建议采用默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.network_train_unet_only,callback:function(e){t.$set(t.trainData,"network_train_unet_only",e)},expression:"trainData.network_train_unet_only"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 只训练文本编码器 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 是否只训练文本编码器（建议采用默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.network_train_text_encoder_only,callback:function(e){t.$set(t.trainData,"network_train_text_encoder_only",e)},expression:"trainData.network_train_text_encoder_only"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 模型维度 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 训练模型的大小，图片数据越多该数值应该越大，（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.network_dim,callback:function(e){t.$set(t.trainData,"network_dim",e)},expression:"trainData.network_dim"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 模型alpha ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 训练模型的大小，图片数据越多该数值应该越大，（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.network_alpha,callback:function(e){t.$set(t.trainData,"network_alpha",e)},expression:"trainData.network_alpha"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 每N轮保存 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 训练到N轮时自动保存模型和测试效果 ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.save_every_n_epochs,callback:function(e){t.$set(t.trainData,"save_every_n_epochs",e)},expression:"trainData.save_every_n_epochs"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 学习率 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 整体模型的学习率，当批次样本数越高该数值越高（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.learning_rate,callback:function(e){t.$set(t.trainData,"learning_rate",e)},expression:"trainData.learning_rate"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 模型学习率 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 模型的学习率，当批次样本数越高该数值越高（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.unet_lr,callback:function(e){t.$set(t.trainData,"unet_lr",e)},expression:"trainData.unet_lr"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 文本编码器学习率 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 文本编码器的学习率，当批次样本数越高该数值越高（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.text_encoder_lr,callback:function(e){t.$set(t.trainData,"text_encoder_lr",e)},expression:"trainData.text_encoder_lr"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 学习率策略 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 动态调整学习率的策略（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.lr_scheduler,callback:function(e){t.$set(t.trainData,"lr_scheduler",e)},expression:"trainData.lr_scheduler"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 预热步数 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 模型预热学习（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.lr_warmup_steps,callback:function(e){t.$set(t.trainData,"lr_warmup_steps",e)},expression:"trainData.lr_warmup_steps"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 学习率策略循环次数 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 动态调整学习率的策略次数（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.lr_warmup_steps,callback:function(e){t.$set(t.trainData,"lr_warmup_steps",e)},expression:"trainData.lr_warmup_steps"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 优化器 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 优化模型的方法（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.optimizer_type,callback:function(e){t.$set(t.trainData,"optimizer_type",e)},expression:"trainData.optimizer_type"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 优化器参数 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 优化模型的方法（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.use_8bit_adam,callback:function(e){t.$set(t.trainData,"use_8bit_adam",e)},expression:"trainData.use_8bit_adam"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 玄学 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 玄学（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-input",{attrs:{size:"small"},model:{value:t.trainData.clip_skip,callback:function(e){t.$set(t.trainData,"clip_skip",e)},expression:"trainData.clip_skip"}})],1)])]),a("div",{staticClass:"train-box"},[a("div",{staticClass:"train-title"},[t._v(" 低内存模式 ")]),a("div",{staticClass:"train-description"},[a("div",{staticClass:"train-description-text"},[t._v(" 减少内存占用（建议取默认值） ")]),a("div",{staticClass:"train-handle"},[a("el-switch",{staticStyle:{"--el-switch-on-color":"#13ce66"},attrs:{size:"small"},model:{value:t.trainData.lowram,callback:function(e){t.$set(t.trainData,"lowram",e)},expression:"trainData.lowram"}})],1)])])])]),a("div",{staticClass:"train-btn-area"},[a("div",{staticClass:"train-btn"},[t.isTraining?t._e():a("el-button",{attrs:{type:"primary"},on:{click:t.toTrain}},[t._v("开始训练")]),t.isTraining?a("el-button",{attrs:{type:"danger"},on:{click:t.trainStop}},[t._v("终止训练")]):t._e()],1),t.isTraining?a("div",{staticClass:"train-loading"},[a("div",{staticClass:"train-loading-active",style:{right:`${(1-(t.trainList.length?t.trainList.length/t.trainData.max_train_epochs:0))*100}%`}})]):t._e()])],1)]):t._e(),t.menuSelectedIndex!==null?a("div",{staticClass:"prompts-list"},[a("div",{staticClass:"train-list-title"},[t._v(" 训练结果预览 ")]),a("div",{staticClass:"train-list"},[a("el-scrollbar",{staticStyle:{width:"100%",height:"100%"}},[t.isTraining?a("div",{staticClass:"training-steps"},[a("div",{domProps:{innerHTML:t._s(t.trainStepsText||"loading...")}})]):t._e(),t._l(t.trainList,function(e,s){return a("div",{key:s,staticClass:"train-item"},[a("div",{staticClass:"trained-data-msg"},[a("div",{staticClass:"trained-data-name"},[t._v(" 训练轮次: "+t._s(s+1)+" ")]),a("div",{staticClass:"trained-data-name"},[t._v(" 模型名称: "),a("br"),a("el-input",{attrs:{size:"small"},model:{value:e.epoch,callback:function(n){t.$set(e,"epoch",n)},expression:"n.epoch"}})],1),a("div",{staticClass:"trained-data-handle"},[a("el-button",{staticStyle:{padding:"0","margin-top":"5px","font-size":"12px"},attrs:{type:"text",size:"small"},on:{click:function(n){return t.addModel(e)}}},[t._v("添加至模型库")])],1)]),a("div",{staticClass:"train-data-image"},[a("el-image",{staticStyle:{width:"90px",height:"90px",background:"#000"},attrs:{"preview-src-list":[`${t.httpRequestUrl}/train/${e.preview}`],src:`${t.httpRequestUrl}/train/${e.preview}`,fit:"cover"}})],1)])})],2)],1)]):t._e()])},pt=[];const x="https://u248120-87de-6175a03c.westc.gpuhub.com:8443",m="https://u248120-87de-6175a03c.westc.gpuhub.com:8443",mt={train_data_dir:"style_cartoon",network_dim:32,network_alpha:16,resolution:"1024,1024",train_batch_size:1,max_train_epochs:10,save_every_n_epochs:1,network_train_unet_only:!0,network_train_text_encoder_only:!1,noise_offset:"0",learning_rate:"1e-4",unet_lr:"1e-4",text_encoder_lr:"1e-5",lr_scheduler:"cosine_with_restarts",lr_warmup_steps:0,lr_scheduler_num_cycles:1,optimizer_type:"AdamW8bit",use_8bit_adam:!1,gradient_checkpointing:!0,gradient_accumulation_steps:4,output_name:"style_cartoon",enable_bucket:!1,min_bucket_reso:256,max_bucket_reso:1024,persistent_data_loader_workers:!0,clip_skip:2,lowram:!1,sample_width:1024,sample_height:1024,sample_prompts:"Cartoon, flowers, repeating elements, wallpaper, white background"},vt={data(){return{httpRequestUrl:x,editMenuIndex:null,menuSelectedIndex:null,subMenuType:"2",type1Page:1,type1PageSize:10,type2Page:1,type2PageSize:10,menuList:[],imageList:[],trainList:[],trainData:{},resolutionW:1024,resolutionH:1024,isTraining:!1,trainStepsText:null,trainStatus:null}},components:{Plus:ut,Delete:ot},mounted(){this.init()},watch:{resolutionW(){this.trainData.resolution=`${this.resolutionW},${this.resolutionH}`},resolutionH(){this.trainData.resolution=`${this.resolutionW},${this.resolutionH}`}},methods:{init(){this.editMenuIndex=null,this.menuSelectedIndex=null,this.trainData=JSON.parse(JSON.stringify(mt)),this.getMenuList()},getMenuList(){d.get(`${x}/labels/get_datasets`).then(t=>{const{data:i}=t;this.menuList=Object.keys(i).map(a=>Object.assign({name:a,nameText:a},i[a])),this.getTrainInfo()})},getMenuInfo(t,i=0){this.menuSelectedIndex===t&&!i||(this.menuSelectedIndex=t,this.subMenuType="2",this.type1Page=1,this.type2Page=1,this.imageSelected=null,this.getSubMenuInfo(t),this.trainData.train_data_dir=this.menuList[this.menuSelectedIndex].name,this.trainData.output_name=this.menuList[this.menuSelectedIndex].name)},currentChange(t){this.subMenuType==="1"?this.type1Page=t:this.type2Page=t,this.getSubMenuInfo(this.menuSelectedIndex)},getSubMenuInfo(t){this.imageList=[];let i=this.subMenuType==="1"?this.type1Page:this.type2Page;d.post(`${x}/labels/query`,{dataset:this.menuList[t].name,page:i,page_size:this.subMenuType==="1"?this.type1PageSize:this.type2PageSize,label_type:this.subMenuType==="1"?"unlabeled":"labeled"}).then(a=>{this.imageList=a.data,this.getTrainedInfo(),!this.imageList.length&&i>1&&(this.subMenuType==="1"?this.type1Page=this.type1Page-1:this.type2Page=this.type2Page-1,this.getSubMenuInfo(this.menuSelectedIndex))})},getTrainInfo(){d.get(`${m}/train/get_training_info`).then(t=>{const{data:i}=t;if(i.cur_dataset&&(this.menuSelectedIndex===null||i.cur_dataset!==this.menuList[this.menuSelectedIndex].name)){const a=this.menuList.findIndex(e=>i.cur_dataset===e.name);this.trainStatus=i.cur_dataset,this.getMenuInfo(a),this.isTraining=!0,this.trainStepsText=i.cur_info,this.checkTrainFinish()}else this.trainStepsText=i.cur_info,this.trainList=i.epoches,this.menuSelectedIndex!==null&&!i.cur_dataset&&this.trainStatus&&(this.isTraining=!1,this.trainStatus=null,this.getTrainedInfo())})},getTrainedInfo(){d.post(`${m}/train/get_trained_info`,{dataset:this.menuList[this.menuSelectedIndex].name}).then(t=>{const{data:i}=t;this.trainList=i.epoches})},trainStop(){d.post(`${m}/train/stop`).then(t=>{}).catch(()=>{this.isTraining=!1,this.trainStatus=null})},toTrain(){if(!this.trainData.sample_prompts){this.$message.error("请输入prompt后操作");return}this.isTraining=!0,d.post(`${m}/train/train`,this.trainData).then(t=>{const{data:i}=t;i==="开始训练成功，等待训练结束！"?(this.$message.success(i),this.trainStepsText=null,this.trainList=[],this.checkTrainFinish()):this.$message.warning(i)})},checkTrainFinish(){this.isTraining&&(this.getTrainInfo(),setTimeout(()=>{this.isTraining&&this.checkTrainFinish()},5e3))},addModel({epoch:t,safetensors:i}){d.post(`${m}/train/add_model`,{modelname:t,safetensors:i}).then(a=>{this.$message.success("添加成功")})}}},z={};var ht=V(vt,_t,pt,!1,ft,"3963b2d6",null,null);function ft(t){for(let i in z)this[i]=z[i]}const xt=function(){return ht.exports}();export{xt as default};
