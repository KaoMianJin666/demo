var r=Object.defineProperty;var i=Object.getOwnPropertySymbols;var c=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable;var s=(e,n,t)=>n in e?r(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,o=(e,n)=>{for(var t in n||(n={}))c.call(n,t)&&s(e,t,n[t]);if(i)for(var t of i(n))d.call(n,t)&&s(e,t,n[t]);return e};import{m as p,e as l,n as u}from"./index-a3726d03.js";import{k as m}from"./shortcutKey-7f220990.js";import{r as h}from"./request-cda08f35.js";import{O as f}from"./OnEvent-d8bd180e.js";var y=function(){var e=this,n=e.$createElement,t=e._self._c||n;return e.editMode=="edit"?t("div",{staticClass:"v-text",on:{keydown:e.handleKeydown,keyup:e.handleKeyup}},[t("div",{ref:"text",class:{"can-edit":e.canEdit},style:{verticalAlign:e.element.style.verticalAlign},attrs:{contenteditable:e.canEdit,tabindex:"0"},domProps:{innerHTML:e._s(e.element.propValue)},on:{dblclick:e.setEdit,paste:e.clearStyle,mousedown:e.handleMousedown,blur:e.handleBlur,input:e.handleInput}})]):t("div",{staticClass:"v-text preview"},[t("div",{style:{verticalAlign:e.element.style.verticalAlign},domProps:{innerHTML:e._s(e.element.propValue)}})])},_=[];const v={extends:f,props:{propValue:{type:String,required:!0,default:""},request:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}},linkage:{type:Object,default:()=>{}}},data(){return{canEdit:!1,ctrlKey:17,isCtrlDown:!1,cancelRequest:null}},computed:o({},p(["editMode","curComponent"])),created(){this.request&&(this.cancelRequest=h(this.request,this.element,"propValue","string")),l.$on("componentClick",this.onComponentClick)},beforeDestroy(){this.request&&this.cancelRequest(),l.$off("componentClick",this.onComponentClick)},methods:{onComponentClick(){this.curComponent.id!==this.element.id&&(this.canEdit=!1)},handleInput(e){this.$emit("input",this.element,e.target.innerHTML)},handleKeydown(e){this.canEdit&&e.stopPropagation(),e.keyCode==this.ctrlKey?this.isCtrlDown=!0:(this.isCtrlDown&&this.canEdit&&m.includes(e.keyCode)||e.keyCode==46)&&e.stopPropagation()},handleKeyup(e){this.canEdit&&e.stopPropagation(),e.keyCode==this.ctrlKey&&(this.isCtrlDown=!1)},handleMousedown(e){this.canEdit&&e.stopPropagation()},clearStyle(e){e.preventDefault();const t=e.clipboardData.getData("text/plain")||"";t!==""&&document.execCommand("insertText",!1,t),this.$emit("input",this.element,e.target.innerHTML)},handleBlur(e){this.element.propValue=e.target.innerHTML||"&nbsp;",e.target.innerHTML!==""?this.element.propValue=e.target.innerHTML:(this.element.propValue="",this.$nextTick(()=>{this.element.propValue="&nbsp;"})),this.canEdit=!1},setEdit(){this.element.isLock||(this.canEdit=!0,this.selectText(this.$refs.text))},selectText(e){const n=window.getSelection(),t=document.createRange();t.selectNodeContents(e),n.removeAllRanges(),n.addRange(t)}}},a={};var C=u(v,y,_,!1,g,"66b9d9f2",null,null);function g(e){for(let n in a)this[n]=a[n]}const M=function(){return C.exports}();export{M as default};
