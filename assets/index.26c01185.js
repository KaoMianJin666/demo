var e=Object.defineProperty,t=(t,a,s)=>(((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s);import{d as a,C as s,r as n,o as l,c as i,a as o,n as r,b as c,e as d,f as u,w as h,g as m,h as p,i as v,j as g,u as y,E as f,k as w,l as b,m as k,p as E,q as C,s as D,t as x,v as T,x as S,y as I,z as A,A as L,F as _,T as M,B as R,D as O,G as P,H as N,I as U,J as G,K as H,L as j,M as z,N as V,O as B,P as Y,Q as X,R as W,S as F,U as Z,V as $,W as J,X as Q}from"./lib.14f22de1.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const q={},K=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in q)return;q[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),t?new Promise(((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())):e()};const ee=a({id:"public",state:()=>({rootDom:null,colorScheme:null,leftBarShowType:0}),getters:{getRootDom(){return this.rootDom},getColorScheme(){return this.colorScheme},getLeftBarShowType(){return this.leftBarShowType}},actions:{setRootDom(e){this.rootDom=e},setLeftBarShowType(e){this.leftBarShowType=e},setColorScheme(e){return new Promise((t=>{(e=(e=e||localStorage.getItem("colorScheme"))||"dark")&&function(e){switch(e){case"../../assets/style/dark.scss":return K((()=>Promise.resolve({})),["assets/dark.680904c4.css"]);case"../../assets/style/global.scss":return K((()=>Promise.resolve({})),["assets/global.689c2666.css"]);case"../../assets/style/light.scss":return K((()=>Promise.resolve({})),["assets/light.25455dc6.css"]);case"../../assets/style/style.scss":return K((()=>import("./style.0f4827d1.js")),[]);default:return new Promise((function(t,a){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`../../assets/style/${e}.scss`).then((a=>{this.colorScheme&&this.removeTheme(this.colorScheme);const s=document.createElement("style");s.id=`theme-${e}`,s.innerText=a.default,document.head.appendChild(s),this.colorScheme=e,localStorage.setItem("colorScheme",this.colorScheme),document.documentElement.className=this.colorScheme,t()}))}))},removeTheme(e){const t=document.getElementById(`theme-${e}`);t&&t.parentNode.removeChild(t)}}});var te=Object.freeze(Object.defineProperty({__proto__:null,usePublicStore:ee,setupStore:function(e){return ee(e)}},Symbol.toStringTag,{value:"Module"}));const ae="_AICLOTH_CONSOLE_",se="_AICLOTH_CONSOLE__token";function ne(){const e=localStorage.getItem(ae+"USER");return e&&"undefined"!==e?JSON.parse(e):null}function le(e){localStorage.setItem(ae+"USER",JSON.stringify(e))}function ie(){const e=s.get(se);return""!==e||void 0!==e||null!==e?e:null}var oe=(e,t)=>{const a=e.__vccOpts||e;for(const[s,n]of t)a[s]=n;return a};var re=oe({__name:"tMask",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!1},destroy:{type:Function},close:{type:Function}},emits:["close"],setup(e,{expose:t,emit:a}){const s=n(!0),u=n(!1),h=e,m=()=>{h.maskClickHide&&(h.close?h.close():p())},p=()=>{u.value&&(u.value=!1,setTimeout((()=>{s.value=!1,h.destroy&&h.destroy()}),200))},v=()=>{s.value=!0,setTimeout((()=>{u.value=!0}))};return l((()=>{v()})),t({hide:p,show:v}),(e,t)=>s.value?(d(),i("div",{key:0,class:"mask",style:r({backgroundColor:h.bgColor,opacity:Number(u.value)}),onClick:m},[o(e.$slots,"default",{},void 0,!0)],4)):c("",!0)}},[["__scopeId","data-v-1477fffe"]]);const ce=e=>(D("data-v-5bef5db2"),e=e(),x(),e),de=ce((()=>m("div",{class:"logo-area"},"Tart",-1))),ue={class:"input-area"},he={class:"input-area"},me=ce((()=>m("div",{class:"user-agreements-area"}," 用户协议 用户协议 ",-1))),pe={class:"login-btn-area"};var ve=oe({__name:"loginBox",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!0},destroy:{type:Function}},setup(e){const{userStore:t}=ft(),a=e,s=n("tMaskDom"),i=n(null),o=n(null),r=n(!1),c=()=>(r.value=!1,setTimeout((()=>{s.value.hide()}),400),!0),D=()=>{t.handleLogin({username:i.value}).then((()=>{location.reload(),c()}))};return l((()=>{i.value=null,o.value=null,setTimeout((()=>{r.value=!0}),200)})),(e,t)=>(d(),u(re,{ref_key:"tMaskDom",ref:s,bgColor:a.bgColor,maskClickHide:a.maskClickHide,destroy:a.destroy,close:c},{default:h((()=>[m("div",{class:p(["login-box",{animated:r.value}]),onClick:t[2]||(t[2]=v((()=>{}),["stop"]))},[de,m("div",ue,[g(y(f),{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:"login-box-input"},{prepend:h((()=>[m("div",null,[g(y(w),{class:"input-icon"},{default:h((()=>[g(y(b))])),_:1})])])),_:1},8,["modelValue"])]),m("div",he,[g(y(f),{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),class:"login-box-input",type:"password","show-password":""},{prepend:h((()=>[m("div",null,[g(y(w),{class:"input-icon"},{default:h((()=>[g(y(k))])),_:1})])])),_:1},8,["modelValue"])]),me,m("div",pe,[g(y(E),{onClick:D},{default:h((()=>[C("登录")])),_:1})])],2)])),_:1},8,["bgColor","maskClickHide","destroy"]))}},[["__scopeId","data-v-5bef5db2"]]);let ge=!1,ye=null;const fe=e=>{e=Object.assign({maskClickHide:!0},e);const t=ie();return new Promise((a=>{t?a():(e=>{const{publicStore:t}=ft(),a=t.rootDom;let s=document.createElement("div");a.appendChild(s),ge&&(ye&&T(null,s),ge=!1),Object.assign(e,{destroy:()=>{ye&&(T(null,s),a.removeChild(s)),ge=!1}}),ye=g(ve,Object.assign({isShow:!0},e)),T(ye,s),ge=!0})(e)}))};const we=e=>(D("data-v-e3e5d7ac"),e=e(),x(),e),be={class:"nav-bar-body"},ke={class:"logo-area"},Ee=["src"],Ce=we((()=>m("div",{class:"router-link-area"},null,-1))),De={class:"handle-area"},xe={class:"user-phone-no"},Te={class:"user-profile-image"},Se=[we((()=>m("span",null,"退出",-1)))],Ie=[we((()=>m("span",null,"登录",-1)))];var Ae=oe({__name:"navBar",setup(e){const{userStore:t,publicStore:a}=ft();S(),I(),n([]),n("ImageGenerationImage"),n(""),n(!1);const s=n(!1),o=()=>{t.handleLogout().then((()=>{}))};return l((()=>{a.setColorScheme().then((()=>{s.value="dark"===a.colorScheme}))})),(e,a)=>(d(),i("div",be,[m("div",ke,[m("img",{src:y("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAABSCAYAAAD6vuL9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFwmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyNC0wNi0xM1QwMDowMjoyMCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDgtMThUMjI6MTQ6NTQrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDgtMThUMjI6MTQ6NTQrMDg6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTlhYjU5ZGQtMmE4ZC0wZDRlLWEzN2ItZTFmN2E5ZWY0NmQ1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjE4QUY0REY0N0NCOTExRUU5Q0NBRDE2OEQ4QjU4NEZGIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjE3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjI3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiLz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTlhYjU5ZGQtMmE4ZC0wZDRlLWEzN2ItZTFmN2E5ZWY0NmQ1IiBzdEV2dDp3aGVuPSIyMDI0LTA4LTE4VDIyOjE0OjU0KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjUuMyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+pe30uAAABWVJREFUeJztnOFx4zYQhd+mAncQugO7gtAVxK4gSgXWVWC5Al8qoFOBfBXQqUDugE4FdAcvP0COKVgkARALUHN5Mzd3Q/GAp4/c5YJcCiTR/1mDSJYkaxodSP6R2xMADDmRPN6Q2VgxAGarIllk9rcucCQvSD6MALP1lAvgqsCRvCfZOkLr1TBD+K4CHI/zWKgaklcJPecDR5PH9guB2aqYIHyzgONnHmsjQxvqQe0LIAM4khuasEqhhkr5Lxk4mrOsTgTM1oGRw5cWuF9iDm5pA6BUHH9KVwAaKuY/TXC/K47tqg2Amgr5TxPcWlQA2DFy/vsZwPUqADzTlEPF0sF+JnC9bhEh/3mDo1km7WmumLehE69AG5j8Fxa+dCxHaJZJhxOX/nJk/zpedaGuhuTkxYy+5Qi72z0AapjLvK0UC+43AK8A3pXGLwC80CN8R8GxWyYBOCBfPQYAjyJyLSI3AK4BPCrOtYHJfw+zAHkiVGmWSa3jaV6NjFtHCKGXkbELks8Rxp9Sw0H+41So8jMsKwAXTsdIV2+nNorIu4hsANxAN3yfO4CF/aEdqhXyhqWt36Y+FJFXEbkE8Cd0AX6JKhtcqTR5qEqS27mdROQZ5uz7S8uHveEcCuAnOlT7XfhuAVwC+Fvb1DmAAzyq/UH+0wzfswHXawPHal9Enrv89w0KAM8NHHB8tXMB+B0m/0UNX01wH4pjA58AfcL3EmYFslia4H4ojj3UBo7VfgfwBjHyn1URh6ieGHsXOGaoGnrc7ej8tY5jjz+sCTTbzphLsTyy1dDxYbWHv+jgSIejzLSPCXtVdLzbQQNwzF9DJXCth8HthEEtOT+s4ekDfEslcKRHfmG+8HX1d0ED8J7djVoqgutV0S886kjzuurg6s/yqg6u15OrQa48/6UGR+qWB7H8OeU/JgY3NFg6Glxl/mMmcL0qxikPtLQf88fM4HotLQ+0VdECyBlwdUJzDf3Kg6zLN86AyxEeDf3CN0f+K+jSWEhzdJvEBiu6AywT+6vp2pHJPEe35Xrznxs4C+AhkbleDf2Wb98TePIDl+no9tpzPfkvDNzAYOqrG+mX/7QO8DJwiY7uKTX0W75tGRfgcnADc1eRzbmo4Uwvm9IBngbXTXZPj25LrqS6nwG41N9kAXxr7dzQ7+qWI/890AEgl8ObBDc2cO1ibmBwlfmPJjJCNQluThXzX92m1HDi6RbNmrcNHHsRuN7c1gVeRoBPE34OgWMuBter4bofzpz0xvA7QEeslrRAFAjr3XhZMKePSs3BY/SObGB6N54cAd5BuXcthWI23Wzh37v2CP2uJhXF7lYq8Nm7Vs7tLCI7mHcX1FtPY0urzauAOft889+7kp/o0u7I3OCzd+1iascOYB++q5cN7lVpnh2Ag2P+2yn6CNWbvcEGp/2iRZ//ipl9/1XyEKJ3AHf2xiNwicKlwHzr/a+K87vqA4bDtYi8f/l0WA1b21NU+y2thzN0/4GqOS15OW9PnwfSIxOluFnZ0HyhmPOMgdtP/J+a4y8u+y25ROQt0YtmZfe3tv45se0DwDcRuRGRV6dROHPGWfvmulkZopNnXPc9djRnd9v9+8KHE8/sYY2vRsGFiDHujgyq/TucUbUfU4tWDiLykiD/rVJRllyDF23PbrEeqmhr1Uw3K6f0qjo6Ay4OjuPmeNbQq6Hy78epgRtMuGO6TvKWjuVFwPdIC66bNEX5UmkAG3yH9OAGkxeMH741HV8FWOg9H7iBiRj5r2HCH1JeBbiBmZDlW0ulPDbjdT3gOkM++W/P/3/r/IuxktNNP2Vmf+sE14vH+a+lR5+KplYPrleukByTDe4/cYMrGGs5S3oAAAAASUVORK5CYII=")},null,8,Ee),C(" Teart ")]),Ce,m("div",De,[m("div",xe,A(y(t).token?y(t).user:null),1),m("div",{class:"line",style:r({opacity:Number(Boolean(y(t).token))})},null,4),m("div",Te,[y(t).token?(d(),i("img",{key:0,src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})):c("",!0)]),y(t).token?(d(),i("div",{key:0,class:"logout-btn",onClick:o},Se)):c("",!0),y(t).token?c("",!0):(d(),i("div",{key:1,class:"logout-btn",onClick:a[0]||(a[0]=e=>fe())},Ie))])]))}},[["__scopeId","data-v-e3e5d7ac"]]);const Le="bi-arrow-repeat",_e="bi-eye",Me="bi-eye-slash",Re="bi-trash",Oe="bi-x-circle";const Pe={class:"loading-body"},Ne={class:"loading-animation-area"},Ue={class:"rainbow-text"};var Ge=oe({__name:"tToading",setup(e,{expose:t}){const a=n(!1),s=n(!1),o=Array(8).fill("🌿");l((()=>{setTimeout((()=>{document.getElementById("main-inner").style.display="none",a.value=!0,setTimeout((()=>{s.value||(s.value=!0,document.getElementById("main-inner").style.display="block")}),300)}))}));return t({close:()=>(s.value=!1,new Promise((e=>{setTimeout((()=>{a.value=!1,setTimeout((()=>{e()}),300)}),300)})))}),(e,t)=>(d(),u(M,{to:"body"},[m("div",Pe,[m("div",Ne,[m("div",{class:p(["loading-left",{animate:a.value}])},null,2),m("div",{class:p(["loading-top",{animate:a.value}])},null,2),m("div",{class:p(["loading-right",{animate:a.value}])},null,2),m("div",{class:p(["loading-bottom",{animate:a.value}])},null,2)]),m("div",{class:"loading-inner",style:r({opacity:Number(s.value)})},[m("div",Ue,[(d(!0),i(_,null,L(y(o),((e,t)=>(d(),i("span",{key:t,style:r({animationDelay:t/8+"s"})},A(e),5)))),128))])],4)])]))}},[["__scopeId","data-v-641aec5c"]]);const He=e=>{let t=!1,a=null;const{publicStore:s}=ft(),n=s.rootDom;let l=document.createElement("div");return n.appendChild(l),t&&(a&&T(null,l),t=!1),a=g(Ge,e),T(a,l),t=!0,{close:()=>{t&&a&&a.component.exposed.close().then((()=>{T(null,l),n.removeChild(l),a=null,t=!1}))}}};const je={class:"menu-icon"},ze=(e=>(D("data-v-a0c9c448"),e=e(),x(),e))((()=>m("div",{class:"menu-name"},"收起面板",-1))),Ve={class:"menu-all"},Be=["onClick"],Ye={class:"menu-icon"},Xe={class:"menu-name"};var We=oe({__name:"leftBar",setup(e){const{publicStore:t}=ft(),a=I(),s=S(),o=n([]),r=n(null),c=n(0);l((()=>{r.value=a.path,o.value=[{path:"/main",name:"模板仓库",includes:["/main","/modelEditor","/generateImage"],icon:"bi-window-stack"},{path:"/modelMainEditor",name:"编辑模板",includes:["/modelMainEditor"],icon:"bi-pencil-square"},{path:"/promptSetting",name:"参数设置",includes:["/promptSetting"],icon:"bi-sliders"},{path:"/gallery",name:"作品仓库",includes:["/gallery"],icon:"bi-folder2"}]}));const u=(e=[])=>e.findIndex((e=>e===r.value));return(e,n)=>(d(),i("div",{class:p(["left-bar-body",{expand:c.value}])},[m("div",{class:"menu-title",onClick:n[0]||(n[0]=e=>(c.value=Number(!c.value),void t.setLeftBarShowType(c.value)))},[m("div",je,[m("i",{class:p(["bi icon",y("bi-house-door")])},null,2)]),ze]),m("div",Ve,[(d(!0),i(_,null,L(o.value,((e,t)=>(d(),i("div",{class:p(["menu-item",{selected:u(e.includes)>=0}]),key:t,onClick:t=>(({path:e})=>{a.path!==e&&fe().then((()=>{window.loading=He(),setTimeout((()=>{s.replace(e)}),300),r.value=e}))})(e)},[m("div",Ye,[m("i",{class:p(["bi icon",e.icon])},null,2)]),m("div",Xe,A(e.name),1)],10,Be)))),128))])],2))}},[["__scopeId","data-v-a0c9c448"]]);const Fe={class:"home-body"},Ze={id:"main-inner"};var $e=oe({__name:"index",setup(e){const{publicStore:t}=ft(),a=I();return(e,s)=>{const n=R("el-aside"),l=R("router-view"),o=R("el-main"),r=R("el-container");return d(),i("div",Fe,[g(Ae),g(r,{class:"home-child-view"},{default:h((()=>[g(n,{class:"aside"},{default:h((()=>[g(We)])),_:1}),g(o,{class:"main"},{default:h((()=>[m("div",Ze,[(d(),u(l,{key:a.path,class:p({expand:y(t).leftBarShowType})},null,8,["class"]))])])),_:1})])),_:1})])}}},[["__scopeId","data-v-fbb3ea7c"]]);const Je={},Qe=e=>(D("data-v-4b07d3ea"),e=e(),x(),e),qe={class:"cloud-body"},Ke={class:"cloud-info"},et=Qe((()=>m("div",{class:"error-title"}," 404 ",-1))),tt=Qe((()=>m("div",{class:"error-sub-title"}," 未找到当前地址 ",-1)));var at=oe(Je,[["render",function(e,t){const a=R("el-result");return d(),i("div",qe,[m("div",Ke,[g(a,{icon:"error",style:{"--el-result-icon-font-size":"3rem"}},{title:h((()=>[et])),"sub-title":h((()=>[tt])),_:1})])])}],["__scopeId","data-v-4b07d3ea"]]);function st(e){return ht.post(`/teai/query_templates?template_type=${e}`)}function nt(e,t){return ht.post(`/teai/query_template?template_type=${e}&template_name=${t}`)}function lt(e,t,a,s){return ht.post(`/teai/upload_template?template_type=${t}&template_name=${a}&preview=${s}`,e)}function it(e,t){return ht.post(`/teai/delete_template?template_type=${e}&template_name=${t}`)}const ot={class:"main-body"},rt={class:"module-list"};const ct=[{path:"/",name:"home",component:$e,redirect:"/main",children:[{path:"main",name:"main",component:oe({__name:"index",props:["class"],setup(e){const t=e,a=S(),s=n({}),o=()=>{st("layouts").then((e=>{s.value=e.templates}))};return l((()=>{fe().then((()=>{o()})),window.loading||(window.loading=He()),setTimeout((()=>{window.loading.close(),window.loading=null}),300)})),(e,n)=>{const l=R("modelCard"),r=R("el-scrollbar");return d(),i("div",ot,[m("div",rt,[g(r,null,{default:h((()=>[(d(!0),i(_,null,L(Object.keys(s.value),(e=>(d(),u(l,{class:p(t.class),key:e,data:{name:e,preview:s.value[e].preview},onToUpdate:()=>{(({name:e})=>{window.loading=He(),setTimeout((()=>{a.replace({path:"modelEditor",query:{file_name:e}})}),300)})({name:e,preview:s.value[e].preview})},onDeleteItem:()=>{(({name:e})=>{it("layouts",e).then((e=>{o()}))})({name:e})},"need-go-handle":"",onGoHandle:()=>{var t;t=e,window.loading=He(),setTimeout((()=>{a.replace({path:"generateImage",query:{file_name:t}})}),300)}},null,8,["class","data","onToUpdate","onDeleteItem","onGoHandle"])))),128))])),_:1})])])}}},[["__scopeId","data-v-436dcb2a"]])},{path:"modelEditor",name:"modelEditor",component:()=>K((()=>import("./index.edab44df.js")),["assets/index.edab44df.js","assets/lib.14f22de1.js","assets/lib.4ea63656.css"])},{path:"modelMainEditor",name:"modelMainEditor",component:()=>K((()=>import("./index.edab44df.js")),["assets/index.edab44df.js","assets/lib.14f22de1.js","assets/lib.4ea63656.css"])},{path:"generateImage",name:"generateImage",component:()=>K((()=>import("./index.a91db4da.js")),["assets/index.a91db4da.js","assets/lib.14f22de1.js","assets/lib.4ea63656.css"])},{path:"promptSetting",name:"promptSetting",component:()=>K((()=>import("./index.2dbbc587.js")),["assets/index.2dbbc587.js","assets/index.c656abd6.css","assets/lib.14f22de1.js","assets/lib.4ea63656.css"])},{path:"gallery",name:"gallery",component:()=>K((()=>import("./index.4e76bcd1.js")),["assets/index.4e76bcd1.js","assets/index.4b10f6b6.css","assets/lib.14f22de1.js","assets/lib.4ea63656.css"])},{path:"test",name:"test",component:()=>K((()=>import("./index.996546a7.js")),["assets/index.996546a7.js","assets/lib.14f22de1.js","assets/lib.4ea63656.css"])},{path:"404",name:"404",component:at}]}],dt=O({history:P("/"),routes:ct});let ut=[];ct.forEach((e=>{e.children&&e.children.length?ut=ut.concat(e.children.map((t=>`${"/"!==e.path?e.path:""}/${t.path}`))):ut.push(e.path)})),dt.beforeEach(((e,t,a)=>{if(!ut.find((t=>t===e.path))&&"/main"!==e.path)return void a("/404");const s=ie();"/main"!==e.path&&"/404"!==e.path?s?a():a("/main"):a()}));const ht=N.create({baseURL:"https://u248120-a5f1-770998cc.westb.seetacloud.com:8443",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function mt(e){if(!e.response)return U.error({message:"请求超时"}),Promise.reject(e);300===e.response.status&&U.error({message:"文件或文件夹已存在"}),ie();const t=e.response.status,a=e.response.data,{userStore:s}=ft();return 401===t?(U.error({message:"登录失效, 请重新登陆"}),s.handleLogout().then((()=>{setTimeout((()=>{dt.replace("/main")}),1500)}))):400===t||500===t?U.error({message:a.message}):403===t&&U.error({message:"无权限操作"}),Promise.reject(e)}ht.interceptors.request.use((e=>{const t=ie()||"22";return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e}),mt),ht.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),mt);const pt=a({id:"users",state:()=>({user:ne()||"***********",permissions:null,root:localStorage.getItem("root")||"",token:ie()||"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((t,a)=>{var n,l;this.token="TEST TOKEN",this.user=e.username,this.root="TEST ROOT",le(this.user),n=this.token,s.set(se,n,{expires:1}),l=this.root,localStorage.setItem("root",l),t()}))},handleLogout(e=""){return new Promise(((e,t)=>{s.remove(se),localStorage.removeItem(ae+"USER"),this.user=null,this.permissions=null,this.token="",le(null),e(null)}))}}});const vt={"./modules/public.js":te,"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:pt,setupStore:function(e){return pt(e)}},Symbol.toStringTag,{value:"Module"}))},gt=G(),yt={};function ft(){return yt}Object.keys(vt).forEach((e=>{const t=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];yt[`${t}Store`]=vt[e].setupStore(gt)}));const wt={class:"view-body"},bt={__name:"App",setup(e){const{publicStore:t}=ft(),a=n(1920);n(1080);const s=n("rootDom"),o=()=>{const e=document.body.clientWidth;document.body.clientHeight,a.value=e;const t=a.value/50;document.documentElement.style.fontSize=`${t}px`,window.rootFont=t;const s=document.getElementById("theme-main");s&&s.parentNode.removeChild(s)};return l((()=>{document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.addEventListener("wheel",(function(e){(e.altKey||e.ctrlKey)&&(e.preventDefault(),e.stopPropagation())}),{passive:!1}),o(),window.onresize=()=>{o()},t.setRootDom(s.value)})),(e,t)=>{const a=R("RouterView");return d(),i("div",wt,[m("div",{class:"view-body-info",id:"view-body-info",ref_key:"rootDom",ref:s},[g(a,{id:"main-view"})],512)])}}};if("undefined"!=typeof window){let e=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML="",e.insertBefore(t,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const kt={key:0,class:"loading-area"},Et={key:0};var Ct=oe({__name:"tButton",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"Loading"}},setup(e){const t=e,a=n(!1),s=()=>{switch(t.type){case"info":return a.value=!1,"box-info";case"success":return a.value=!1,"box-success";case"error":return a.value=!1,"box-error";case"warn":return a.value=!1,"box-warn";case"text-success":return a.value=!0,"text-success";case"text-info":return a.value=!0,"text-info";case"text-warn":return a.value=!0,"text-warn";case"text-error":return a.value=!0,"text-error";default:return null}},l=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},u=()=>{switch(t.type){case"info":case"text-info":return"background:var(--t-info-hover-color)";case"success":case"text-success":return"background:var(--t-success-hover-color)";case"error":case"text-error":return"background:var(--t-error-hover-color)";case"warn":case"text-warn":return"background:var(--t-warn-hover-color)";default:return null}},h=()=>{const e={type:s(),size:l()};let t="";return Object.keys(e).forEach((a=>{e[a]&&(t+=`${e[a]} `)})),t};return(e,s)=>(d(),i("div",{class:p(`t-btn ${h()}`)},[m("div",{style:r(`opacity: ${Number(!a.value||a.value&&!t.loading)};`)},[o(e.$slots,"default",{},void 0,!0)],4),a.value&&t.loading?(d(),i("div",kt,A(t.loadingText),1)):c("",!0),a.value?c("",!0):(d(),i("div",{key:1,class:p(["hover-area",{loading:t.loading}]),style:r(u())},[t.loading?(d(),i("div",Et,A(t.loadingText),1)):c("",!0)],6))],2))}},[["__scopeId","data-v-071339ed"]]);var Dt=oe({__name:"tTag",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"}},setup(e){const t=e,a=()=>{switch(t.type){case"info":default:return"box-info";case"success":return"box-success";case"error":return"box-error";case"warn":return"box-warn"}},s=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},n=()=>{const e={type:a(),size:s()};let t="";return Object.keys(e).forEach((a=>{e[a]&&(t+=`${e[a]} `)})),t};return(e,t)=>(d(),i("div",{class:p(`t-btn ${n()}`)},[o(e.$slots,"default",{},void 0,!0)],2))}},[["__scopeId","data-v-660ee02c"]]);const xt={class:"model-name"},Tt=(e=>(D("data-v-30180962"),e=e(),x(),e))((()=>m("div",{class:"model-handle-del-area-outer"},[m("div",{class:"model-handle-area"})],-1))),St={class:"model-handle-area-outer"};var It=oe({__name:"modelCard",props:{data:{type:Object,default:()=>({preview:null,name:null})},class:{},needGoHandle:{type:Boolean,default:!1}},emits:["toUpdate","deleteItem","goHandle"],setup(e,{emit:t}){const a=t,s=e,l=n([]),o=n(!0),h=n("imageDom"),g=()=>{l.value=[]};return(e,t)=>{const n=R("el-image");return d(),i("div",{class:p(["module-item",s.class])},[o.value?(d(),u(n,{key:0,ref_key:"imageDom",ref:h,"hide-on-click-modal":"",onClose:g,"preview-src-list":l.value,src:s.data.preview,class:"model-image",fit:"contain"},null,8,["preview-src-list","src"])):c("",!0),m("div",xt,A(s.data.name),1),Tt,m("div",St,[m("div",{class:"model-handle-area",style:r({width:s.needGoHandle?"3.6rem":"2.4rem"})},[m("div",{class:"handle-btn box-error",onClick:t[0]||(t[0]=v((e=>a("deleteItem")),["stop"]))},[m("i",{class:p(["bi icon",y(Re)])},null,2)]),m("div",{class:"handle-btn box-warn",onClick:t[1]||(t[1]=e=>a("toUpdate"))},[m("i",{class:p(["bi icon",y("bi-pencil-square")])},null,2)]),s.needGoHandle?(d(),i("div",{key:0,class:"handle-btn box-main",onClick:t[2]||(t[2]=e=>a("goHandle"))},[m("i",{class:p(["bi icon",y("bi-play")])},null,2)])):c("",!0)],4)])],2)}}},[["__scopeId","data-v-30180962"]]);const At="操作",Lt="绘制",_t={NOMAL:"定位花",AGENT_X:"横向二方连续",AGENT_Y:"纵向二方连续",AGENT_F:"四方连续"},Mt="editor",Rt="explosion",Ot={statics:"静态图层",prompts:"动态图层",colors:"纯色图层",texts:"文本图层"};class Pt{constructor(e,t,a=""){this.name=a,this.uuid=e,this.parentUuid=t,this.isShow=!0,this.children=[]}addChild(e){this.children.push(e)}changeParent(e){this.parentUuid=e}setData(e={}){Object.keys(e).forEach((t=>{this[t]=e[t]}))}hide(){this.isShow=!1}show(){this.isShow=!0}}const Nt={group:class extends Pt{constructor(e,t,a,s={}){super(e,t,a),this.prompts=s.prompts||null,this.statics=s.statics||null,this.colors=s.colors||null,this.texts=s.texts||null,this.type=s.type||null}},layer:class extends Pt{constructor(e,t,a,s={}){super(e,t,a),this.prompts=s.prompts||null,this.statics=s.statics||null,this.colors=s.colors||null,this.texts=s.texts||null,this.image=s.image||null,this.type=s.type||null,this.fontSetting=s.fontSetting||{content:"默认文本",font:"",fontFamily:"",font_color:[255,255,255,1],font_size:16}}},element:class extends Pt{constructor(e,t,a,s={}){super(e,t,a),this.x=s.x,this.y=s.y,this.width=s.width,this.height=s.height,this.image=s.image,this.rotate=s.rotate||0,this.type=s.type||null,this.fontSetting=s.fontSetting||{content:"默认文本",font:"",fontFamily:"",font_color:[255,255,255,1],font_size:16},this.color=s.color||[0,0,0,1],this.virtuallyElements=s.virtuallyElements||[]}}},Ut={group:{parentType:null,childrenType:"layer"},layer:{parentType:"group",childrenType:"element"},element:{parentType:"layer",childrenType:null}};class Gt{constructor(){t(this,"checkHasGroup",(e=>{Object.keys(this.groups).forEach((t=>{const a=this.groups[t],s=new Set(a.children);for(let n of e)s.has(n)&&(a.children=a.children.filter((e=>e!==n)))}))})),this.groups=H({}),this.layers=H({}),this.elements=H({}),this.showMap=H({groups:new Set,layers:new Set}),this.selectedMap=H({group:null,layer:null,element:null})}add(e,t,a,s={},n=null){const l=Nt[e];if(!l)throw new Error(`Unknown type: ${e}`);n=n||j();const i=this[`${e}s`];if("element"===e){const e=this.findParent(t);a=`${e.name}-${e.children.length+1}`,s=Object.assign(s,{image:e.image,type:e.type})}if(i[n]=new l(n,t,a,s),t){const e=this.findParent(t);e&&e.addChild(n)}return"layer"===e&&"colors"===s.type&&(this.add("element",n,""),this.reDraw()),n}setData(e,t,a={}){if(this[`${e}s`][t].setData(a),"layer"===e&&a.image){this.findData(e,t).children.forEach((e=>{this.setData("element",e,{image:a.image})}))}}delete(e,t){const a=this.findData(e,t);if(!a)return;const s=a.children;s.length&&s.forEach((t=>{this.delete(Ut[e].childrenType,t)}));const n=this[`${e}s`];if(a.parentUuid){const s=this.findParent(a.parentUuid,`${Ut[e].parentType}s`);s.children=s.children.filter((e=>e!==t))}delete n[t],this.selectedMap[e]===t&&this.selectedMap[e],this.reDraw()}handleIsShow(e,t,a="show"){const s=this.findData(e,t);if(!s)return;const n=s.children;if(n.length?n.forEach((t=>{this.handleIsShow(Ut[e].childrenType,t,a)})):s[a](),s.parentUuid){const t=this.findData(Ut[e].parentType,s.parentUuid);t.children.every((t=>this.findData(e,t).isShow===("show"===a)))?t[a]():t.show()}this.reDraw()}findParent(e,t=""){for(const a of t?[t]:["groups","layers","elements"]){const t=this[a];if(t[e])return t[e]}return null}findData(e,t){return this[`${e}s`][t]}handleShowMap(e,t){this.showMap[`${e}s`].has(t)?this.showMap[`${e}s`].delete(t):this.showMap[`${e}s`].add(t)}isShowMapShow(e,t){return this.showMap[`${e}s`].has(t)}changeSelected(e){let t=0;for(let a in e){a=Number(a);const s=e[a],n=Object.keys(Ut)[a];0===a?this.selectedMap[n]=s:this.selectedMap[n]!==s&&s?(t+=1,this.selectedMap[n]=s):0!==t&&(this.selectedMap[n]=null)}this.reDraw()}isSelected(e,t){return this.selectedMap[e]===t}bindGroup(e,t=null){const a=e.concat(t?this.groups[t].children:[]),s=this.bindGroupCheck(a),n=Object.assign({texts:[],statics:[],prompts:[],colors:[]},{[s.type]:s.typesInfo});s&&(this.checkHasGroup(e),t||(t=this.add("group",null,`组-${Object.keys(this.groups).length+1}`,n)),e.forEach((e=>{this.groups[t].addChild(e),this.layers[e].changeParent(t)})))}bindGroupCheck(e){let t=new Set,a=new Set,s=!0;return e.forEach(((e,n)=>{t.add(this.layers[e].type);const l=this.layers[e],i=l.type,o=new Set(l[i]);if(0===n)a=o;else{if(o.size!=o.size)return void(s=!1);for(let e of a)o.has(e)||(s=!1)}})),!([...t].length>1)&&(!!s&&{type:[...t][0],typesInfo:[...a]})}clearAllData(){this.groups={},this.layers={},this.elements={},this.showMap={groups:new Set,layers:new Set},this.selectedMap={group:null,layer:null,element:null}}getData(){return{groups:this.groups,layers:this.layers,elements:this.elements}}}class Ht{constructor(){this.listeners={}}addListener(e,t,a){e.addEventListener(t,a);const s=j();return this.listeners[s]={element:e,eventType:t,listener:a},s}removeListenersByEventType(e){const{listeners:t}=this;Object.keys(t).filter((a=>t[a].eventType=e)).forEach((e=>{this.removeListenter(e)}))}removeAllListeners(){for(var e in this.listeners)this.removeListenter(e);this.listeners={}}removeListenter(e){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener),delete this.listeners[e]}}const jt="edit",zt="generate",Vt={EFFECT:"效果调节",UPLOAD:"上传替换",TEXT_EDIT:"文本编辑",LAYER_EDIT:"图层编辑",GENERATE:"AI图生图",REPEAT:"重新生成",ELEMENT_DELETE:"删除元素",LAYER_DELETE:"删除图层",GROUP_DELETE:"删除组"};class Bt{constructor(e=jt){this.handelType=e,this.x=0,this.y=0,this.layerType=null,this.isShow=!1,this.dom=null,this.bindDom=null,this.isHasImage=!1}setHandle({uuid:e,type:t},{x:a,y:s},n,l=!1,i=document.body){return this.close(),this.bindDom=i,this.isHasImage=l,new Promise((l=>{this.x=a,this.y=s,this.handleUuid=e,this.elementType=t,this.layerType=n,this.createDom().then((e=>{l(e)}))}))}close(){this.isShow=!1,this.x=0,this.y=0,this.layerType=null,this.dom&&(this.bindDom.removeChild(this.dom),document.documentElement.onClick=()=>{},this.dom=null)}createDom(){return new Promise((e=>{const t=document.createElement("div");t.className="editor-contextmenu-view",this.bindDom.appendChild(t),this.dom=t,document.documentElement.onclick=this.close.bind(this),this.createList().then((t=>{e(t)}))}))}createList(){const e=this.getHandleList(this.type,this.elementType),{x:t,y:a,dom:s,bindDom:n}=this,l=(1.2*e.length-.2)*window.rootFont,i=n.getBoundingClientRect();let o=a+l>i.bottom?i.bottom-l-i.top:a-i.top;return s.style.top=`${o}px`,s.style.left=t-i.left+"px",new Promise((t=>{e.forEach((e=>{this.createItem(e).then((e=>{t(e)}))})),setTimeout((()=>{this.dom.style.height=1.2*e.length-.2+"rem"}))}))}createItem({name:e,icon:t,type:a="button"}){const{handleUuid:s}=this;return new Promise((n=>{const l=document.createElement("div");l.className="editor-contextmenu-item";const i=document.createElement("i");i.className="editor-contextmenu-item-icon",i.className=`editor-contextmenu-item-icon bi ${t}`;const o=document.createElement("div");if(o.className="editor-contextmenu-item-name",o.innerText=e,l.appendChild(i),l.appendChild(o),"upload"===a){const t=document.createElement("input");t.type="file",l.appendChild(t),t.onclick=e=>{e.stopPropagation()},t.onchange=t=>{t.stopPropagation();const{target:a}=t;n({file:a.files[0],handleUuid:s,name:e}),this.close()}}else l.onclick=t=>{t.stopPropagation(),n({handleUuid:s,name:e}),this.close()};this.dom.appendChild(l)}))}getHandleList(e=jt){let t=[];e=e||this.handelType;const{isHasImage:a,elementType:s,layerType:n}=this;switch(n){case"element":switch(e){case jt:if(t=a?[{name:Vt.EFFECT,icon:"bi-sliders",type:"button"},{name:Vt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Vt.GENERATE,icon:"bi-stars",type:"button"},{name:Vt.REPEAT,icon:Le},{name:Vt.ELEMENT_DELETE,icon:Re,type:"button"}]:[{name:Vt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Vt.REPEAT,icon:Le},{name:Vt.ELEMENT_DELETE,icon:Re,type:"button"}],"texts"===s){const e=t.findIndex((({name:e})=>e===Vt.UPLOAD));t.splice(e,1,{name:Vt.TEXT_EDIT,icon:"bi-pencil-square",type:"button"})}break;case zt:t=a?[{name:Vt.EFFECT,icon:"bi-sliders",type:"button"},{name:Vt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Vt.GENERATE,icon:"bi-stars",type:"button"},{name:Vt.REPEAT,icon:Le},{name:Vt.ELEMENT_DELETE,icon:Re,type:"button"}]:[{name:Vt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Vt.REPEAT,icon:Le},{name:Vt.ELEMENT_DELETE,icon:Re,type:"button"}]}break;case"layer":t=[{name:Vt.LAYER_EDIT,icon:"bi-pencil-square",type:"button"},{name:Vt.LAYER_DELETE,icon:Re,type:"button"}];break;case"group":t=[{name:Vt.GROUP_DELETE,icon:Re,type:"button"}]}return t}}function Yt(e,t,a){const s=e.split(";base64,"),n=s[0].split(":")[1],l=atob(s[1]);let i=l.length;const o=new Uint8Array(i);for(;i--;)o[i]=l.charCodeAt(i);const r=Xt(e,t,a);return new File([r],`${t}${c=a||n,{"image/jpeg":".jpg","image/png":".png","image/gif":".gif","application/pdf":".pdf"}[c]||".bin"}`,{type:a||n,lastModified:Date.now()});var c}function Xt(e,t,a){const s=e.split(";base64,"),n=s[0].split(":")[1],l=atob(s[1]);let i=l.length;const o=new Uint8Array(i);for(;i--;)o[i]=l.charCodeAt(i);return new Blob([o],{type:a||n})}function Wt(e){return new Promise((t=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{t(a)},a.src=e}))}function Ft(e){return new Promise((t=>{(function(e){return new Promise((t=>{const a=new FileReader;a.onload=({target:e})=>{t(e.result)},a.readAsDataURL(e)}))})(e).then((e=>{Wt(e).then((e=>{t(e)}))}))}))}function Zt(e){return new Promise((t=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{t(a)},a.onerror=()=>[t(null)],a.src=e}))}function $t(e,t){const a=JSON.stringify(e),s=new Blob([a],{type:"application/json"});return new File([s],`${t}.json`,{type:"application/json",lastModified:Date.now()})}function Jt(e){const t=e.match(/\d+/g);return t?t.map(Number):[]}function Qt(e){return`rgba(${e.join(",")})`}const qt="编辑器",Kt="操作",ea="绘制",ta="定位花",aa="横向二方连续",sa="纵向二方连续",na="四方连续",la={outerWidth:100,innerWidth:20};class ia{constructor(){this.rootFont=H(window.rootFont),this.realWidth=H(2048),this.realHeight=H(2048),this.name=H(""),this.canvasOuterDom=H(null),this.canvasDom=H(null),this.ctx=H(null),this.zoomRatio=H(1),this.handleState=H(Kt),this.listeners=new Ht,this.startX=H(0),this.startY=H(0),this.isDrawing=H(!1),this.moveType=H(null),this.drawType=H(ta),this.handleController=H(null);const e=new Image;this.rotateImage=null,this.viewType="editor",e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAiJJREFUWAntWO1xwjAMZYSO0FEYgRE6AhuUDWADGKEblA3oBnQDRnj1y0kXoTp2bMf90YvvOH9Elp+eJEdhs1nbysDKQB8GALwA2Ib+BOAG4IGxcfwpz3Z9EExoFWDvDtAILT66h2XueZ1Qu8wygH0EGNm6hsMvAA7yI6tc841A35ZB47QAOLrTCGBHRp3o05SAJATs9uOTUOsEwNloJ2PFcSVAyaC2cyuuYb9jjslQHUfc69hsY1KsVosJLunOOYxIklGXtv2cfb9kxFp1Cftq5rxy0a3XEvtyw4N5vBa0LZ55kmCq/+CNyM4BKHvXrHClgFzmBFnGorNucfbUHnfOVtezfYgJXrRDywo3CEjCaCyeZqsy1Hdzr4IxZ910Ldub19l8q7Ja4wIho/mKZHvEJSKrsoFdeXZF9KWW5N09HBmVk5LJYEoOP6JKGhazAKnbxEESHY1pwBLdahJy2sWSTXrvTYHs4m5DTjoh3evHg+wCTrynZ+UTciIe05ZFHTdv0RUj80o4qZrVqkWLBA/buPfunyXnEri9wbHS1lYeQkycpBUNDyXeNSm7ElEMU24MW7B2K0ZqwPmSP5+5xadUbpAbQt3K2LtUqspvk0znPwdJ94g7+e8DZW3ry1wA9m1PEwCsIfXDnZ+pBKW1nopzXveRlOdtlBAg1l0KYKonMILvdjOM6MxISnb9m8OyxfFXAMRndPHfAjMY1+HKwL9n4AeVBVerk24KcAAAAABJRU5ErkJggg==",this.handleLocked=!1,e.onload=()=>{this.rotateImage=e},this.position={left:0,top:0}}init(e,t={},a=qt){return new Promise((s=>{this.canvasOuterDom=e,this.name=t.name||null,this.realWidth=t.width||2048,this.realHeight=t.height||2048,this.viewType="editor",this.drawType=t.drawType||ta,this.position={left:0,top:0},this.getCanvasSize().then((e=>{this.canvasDom=document.createElement("canvas"),this.canvasDom.style.position="absolute",this.canvasDom.style.margin="auto",this.canvasDom.style.left=`${this.position.left}px`,this.canvasDom.style.top=`${this.position.top}px`,this.canvasDom.style.right="0",this.canvasDom.style.bottom="0",this.canvasDom.style.border="solid 0.05rem var(--t-main-color)",this.canvasDom.style.backgroundColor="var(--t-main-sub-color)",this.canvasDom.style.width=`${e.width}px`,this.canvasDom.style.height=`${e.height}px`,this.canvasDom.width=e.width,this.canvasDom.height=e.height,this.zoomRatio=e.zoomRatio,this.canvasOuterDom.focus(),this.canvasOuterDom.appendChild(this.canvasDom),this.ctx=this.canvasDom.getContext("2d"),this.handleController=new Bt(a),this.bindCanvasHandleListener(),s()}))}))}bindMainMove(){this.listeners.addListener(this.canvasDom,"mousedown",(e=>{this.handle("mousedown",e)})),this.listeners.addListener(this.canvasDom,"mousemove",(e=>{this.handle("mousemove",e)})),this.listeners.addListener(this.canvasDom,"mouseup",(e=>{this.handle("mouseup",e)})),this.listeners.addListener(this.canvasDom,"mouseleave",(e=>{this.handle("mouseleave",e)}))}unBindMove(){this.listeners.removeListenersByEventType("mousedown"),this.listeners.removeListenersByEventType("mousemove"),this.listeners.removeListenersByEventType("mouseup"),this.listeners.removeListenersByEventType("mouseleave")}bindHandleMove(){this.listeners.addListener(this.canvasOuterDom,"mousedown",(e=>{this.handle("mousedown",e)})),this.listeners.addListener(this.canvasOuterDom,"mousemove",(e=>{this.handle("mousemove",e)})),this.listeners.addListener(this.canvasOuterDom,"mouseup",(e=>{this.handle("mouseup",e)}))}bindCanvasHandleListener(){this.bindMainMove(),this.listeners.addListener(this.canvasDom,"click",(e=>{this.handle("selected",e)})),this.listeners.addListener(this.canvasDom,"contextmenu",(e=>{this.handle("contextmenu",e)})),this.listeners.addListener(this.canvasOuterDom,"keydown",(e=>{this.handle("keydown",e)})),this.listeners.addListener(this.canvasOuterDom,"keyup",(e=>{this.handle("keyup",e)})),this.listeners.addListener(this.canvasOuterDom,"wheel",(e=>{const t={width:this.canvasDom.width,height:this.canvasDom.height,zoomRatio:this.zoomRatio};e.deltaY>0?(t.zoomRatio=Math.round(t.zoomRatio/11*10*1e4)/1e4,t.width=Math.round(t.width/11*10),t.height=Math.round(t.height/11*10)):(t.zoomRatio=Math.round(11*t.zoomRatio/10*1e4)/1e4,t.width=Math.round(11*t.width/10),t.height=Math.round(11*t.height/10)),this.zoomRatio=t.zoomRatio,this.canvasDom.style.width=`${t.width}px`,this.canvasDom.style.height=`${t.height}px`,this.canvasDom.width=t.width,this.canvasDom.height=t.height,this.reDraw()}))}async resize(){const e=await this.getCanvasSize();this.canvasDom.style.width=`${e.width}px`,this.canvasDom.style.height=`${e.height}px`,this.canvasDom.width=e.width,this.canvasDom.height=e.height,this.zoomRatio=e.zoomRatio}lockHandle(e){"Space"===e.code&&(this.handleLocked=!0,this.canvasDom.className="canvas-key-down",this.unBindMove(),this.bindHandleMove())}unlockHandle(e){"Space"===e.code&&(this.handleLocked=!1,this.canvasDom.className="",this.unBindMove(),this.bindMainMove())}getCanvasSize(){const{realWidth:e,realHeight:t}=this,a=this.canvasOuterDom.getBoundingClientRect();return new Promise((s=>{if(a.width||a.height){const n=this.getZoomRatio(a.width,a.height,e,t);s(n)}else{const a=new ResizeObserver((n=>{for(let l of n){const{width:n,height:i}=l.contentRect;if(n&&i){const l=this.getZoomRatio(n,i,e,t);s(l),a.disconnect()}}}));a.observe(this.canvasOuterDom)}}))}getZoomRatio(e,t,a,s){let n=1;return e/t<a/s?(t=t*a/e,n=e/a,e=a):(e=e*s/t,n=t/s,t=s),{width:a*n,height:s*n,zoomRatio:n}}destory(){this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.name="",this.handleState=null,this.canvasOuterDom=null,this.canvasDom=null,this.ctx=null}getData(){return{name:this.name,realWidth:this.realWidth,realHeight:this.realHeight,drawType:this.drawType}}setData({name:e,realWidth:t,realHeight:a,drawType:s},n="init"){this.name=e,this.drawType=s,t!==this.realWidth||a!==this.realHeight?"edit"===n?z.confirm("修改尺寸将会清空所有元素，是否继续","警告",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((()=>{this.realWidth=t,this.realHeight=a,this.clearAllData(),this.resize()})):(this.realWidth=t,this.realHeight=a,this.clearAllData(),this.resize()):this.reDraw()}changeHandleType(e){this.handleState=e}handle(e,t){const{handleState:a,handleLocked:s,startX:n,startY:l,zoomRatio:i}=this;if(s){const{pageX:a,pageY:s}=t;switch(e){case"keyup":this.unlockHandle(t);break;case"mousedown":this.canvasDom.className="canvas-key-down-mousedown",this.isDrawing=!0,this.startX=a,this.startY=s;break;case"mousemove":if(!this.isDrawing)return;this.position.left+=a-n,this.position.top+=s-l,this.startX=a,this.startY=s,this.canvasDom.style.left=`${this.position.left}px`,this.canvasDom.style.top=`${this.position.top}px`;break;case"mouseup":this.canvasDom.className="canvas-key-down",this.isDrawing=!1}}else switch(a){case Kt:this.handleEvent(e,t);break;case ea:this.drawingEvent(e,t)}}handleEvent(e,t){switch(e){case"mousedown":if(0!==t.button)return;this.handleController.close(),this.checkMove(t);break;case"click":this.handleController.close();break;case"mousemove":this.moving(t);break;case"mouseup":case"mouseleave":this.finishMove(t);break;case"contextmenu":this.checkContextMenu(t);break;case"selected":this.handleController.close(),this.selectedElement(t);break;case"keydown":this.lockHandle(t)}}drawingEvent(e,t){switch(this.handleController.close(),e){case"mousedown":if(0!==t.button)return;this.toDraw(t);break;case"click":case"contextmenu":case"selected":break;case"mousemove":this.drawMove(t);break;case"mouseup":case"mouseleave":this.finishDraw(t);break;case"keydown":this.lockHandle(t)}}startDraw(e){const{offsetX:t,offsetY:a}=e;this.startX=t,this.startY=a,this.isDrawing=!0}drawMove(e){if(!this.isDrawing)return;const t=this.getDrawingArea(e);this.reDraw(t)}finishDraw(e){if(!this.isDrawing)return;this.isDrawing=!1;const t=this.getDrawingArea(e);this.sendElement(t)}startMove(e,t){const{offsetX:a,offsetY:s}=e;this.startX=a,this.startY=s,this.isDrawing=!0,this.moveType=t}moving(e){if(!this.isDrawing)return;const{moveType:t,startX:a,startY:s,zoomRatio:n}=this,{offsetX:l,offsetY:i}=e,o=(l-this.startX)/n,r=(i-this.startY)/n;this.startX=l,this.startY=i;const c=[a/n,s/n];this.setElementMovingData({xFloat:o,yFloat:r,rotateFloat:c,moveType:t})}finishMove(){this.isDrawing&&(this.isDrawing=!1,this.moveType=null,this.moveEnd())}contextMenu(e,t){this.handleController.setHandle(t,{x:e.pageX,y:e.pageY},"element",Boolean(t.image),this.canvasOuterDom).then((e=>{this.contextmenuCallBack(e)}))}contextmenuCallBack(e){switch(e.name){case Vt.EFFECT:break;case Vt.UPLOAD:this.selectedElement,Ft(e.file).then((t=>{this.changeElementImage(e.handleUuid,t)}));break;case Vt.GENERATE:this.toImageGenerateView(e.handleUuid);break;case Vt.REPEAT:this.generateElement(e.handleUuid);break;case Vt.DELETE:this.deleteElement(e.handleUuid);break;case Vt.TEXT_EDIT:this.toTextEdit(e.handleUuid)}}getDrawingArea(e){const{offsetX:t,offsetY:a}=e,{startX:s,startY:n,zoomRatio:l}=this;let i=s>t?{startX:t,finishX:s}:{startX:s,finishX:t},o=n>a?{startY:a,finishY:n}:{startY:n,finishY:a};return{x:i.startX/l,y:o.startY/l,width:(i.finishX-i.startX)/l,height:(o.finishY-o.startY)/l}}clearAll(){const{ctx:e,canvasDom:t}=this;e.beginPath(),e.clearRect(0,0,t.width,t.height),e.closePath()}drawItem({x:e,y:t,width:a,height:s,rotate:n,image:l}){const{ctx:i,zoomRatio:o}=this;(a||s)&&(e*=o,t*=o,a*=o,s*=o,i.beginPath(),i.save(),i.lineWidth=2,i.fillStyle="#222",i.translate(e+a/2,t+s/2),n&&i.rotate(n),l?i.drawImage(l,-a/2,-s/2,a,s):(i.rect(-a/2,-s/2,a,s),i.stroke(),i.fill()),n&&i.rotate(-n),i.translate(-(e+a/2),-(t+s/2)),i.restore(),i.closePath())}drawFullScreen(e){const{ctx:t,canvasDom:a}=this,{width:s,height:n}=a;t.beginPath(),t.save(),t.fillStyle=Qt(e),t.fillRect(0,0,s,n),t.restore(),t.closePath()}drawTextItem({x:e,y:t,width:a,height:s,rotate:n,fontSetting:l}){const{content:i,font_color:o,font_size:r,fontFamily:c}=l,{ctx:d,zoomRatio:u}=this;e*=u,t*=u,a*=u,s*=u,d.beginPath(),d.save(),d.translate(e+a/2,t+s/2),n&&d.rotate(n),d.font=`${r*u}px ${c}`,d.fillStyle=Qt(o);const h=d.measureText(i).width;d.fillText(i,-h/2,r*u/2),d.stroke(),n&&d.rotate(-n),d.translate(-(e+a/2),-(t+s/2)),d.restore(),d.closePath()}selectedElement(e){this.toSelectedElement(e)}checkIsInItem({x:e,y:t,width:a,height:s,rotate:n=0},l){const{offsetX:i,offsetY:o}=l,{ctx:r,zoomRatio:c}=this;e*=c,t*=c,a*=c,s*=c,r.beginPath(),r.save(),r.translate(e+a/2,t+s/2),n&&r.rotate(n),r.rect(-a/2,-s/2,a,s),r.translate(-(e+a/2),-(t+s/2)),n&&r.rotate(-n);let d=!!r.isPointInPath(i,o)&&"main";return r.restore(),r.closePath(),d}drawHandleArea({x:e,y:t,width:a,height:s,rotate:n,type:l,fontSetting:i}){const{zoomRatio:o,ctx:r}=this;e*=o,t*=o;const c=10,d=10,u=[[0-(a*=o)/2,-10-(s*=o)/2,a,2],[a+5+5-a/2-1,0-s/2,2,s],[-10-a/2,0-s/2,2,s],[0-a/2,s+5+5-s/2-1,a,2]];[[-15-a/2,-15-s/2],[+a+5-a/2,-15-s/2],[+a+5-a/2,+s+5-s/2],[-15-a/2,+s+5-s/2]].forEach((l=>{this.drawHandlePoint(l,{x:e,y:t,width:a,height:s,rotate:n},d)})),u.forEach((l=>{this.drawHandleLine(l,{x:e,y:t,width:a,height:s,rotate:n})})),this.drawRotateArea({x:e,y:t,width:a,height:s,rotate:n},c)}drawRotateArea({x:e,y:t,width:a,height:s,rotate:n},l){const{rotateImage:i,ctx:o}=this;o.beginPath(),o.save(),o.translate(e+a/2,t+s/2),n&&o.rotate(n),o.drawImage(i,-10,-s/2-2*l-20,20,20),o.translate(-(e+a/2),-(t+s/2)),n&&o.rotate(-n),o.translate(-(e+a/2),-(t+s/2)),o.restore(),o.closePath()}drawHandlePoint([e,t],a,s){const{ctx:n}=this;n.beginPath(),n.save(),n.fillStyle="#fff",n.translate(a.x+a.width/2,a.y+a.height/2),a.rotate&&n.rotate(a.rotate),n.rect(e,t,s,s),n.translate(-(a.x+a.width/2),-(a.y+a.height/2)),a.rotate&&n.rotate(-a.rotate),n.fill(),n.restore(),n.closePath()}drawHandleLine([e,t,a,s],n){const{ctx:l}=this;l.beginPath(),l.save(),l.fillStyle="#fff",l.translate(n.x+n.width/2,n.y+n.height/2),n.rotate&&l.rotate(n.rotate),l.rect(e,t,a,s),l.translate(-(n.x+n.width/2),-(n.y+n.height/2)),n.rotate&&l.rotate(-n.rotate),l.fill(),l.restore(),l.closePath()}checkIsInHandleArea({x:e,y:t,width:a,height:s,rotate:n,type:l},i){const{zoomRatio:o}=this;e*=o,t*=o;const r=10,c=10,d=[[-15-(a*=o)/2,-15-(s*=o)/2,"left-top"],[+a+5-a/2,-15-s/2,"right-top"],[+a+5-a/2,+s+5-s/2,"right-bottom"],[-15-a/2,+s+5-s/2,"left-bottom"]],u=[[0-a/2,-10-s/2,a,2,"top"],[a+5+5-a/2-1,0-s/2,2,s,"right"],[-10-a/2,0-s/2-1,2,s,"left"],[0-a/2,s+5+5-s/2,a,2,"bottom"]];let h=!1;if(h=this.checkIsInRotateArea({x:e,y:t,width:a,height:s,rotate:n},r,i),h||"texts"===l)return h;for(let m of d)if(h=this.checkIsInHanlePoint(m,{x:e,y:t,width:a,height:s,rotate:n},c,i),h)break;if(h)return h;for(let m of u)if(h=this.checkIsInHanleLine(m,{x:e,y:t,width:a,height:s,rotate:n},i),h)break;return h}checkIsInHanlePoint([e,t,a],s,n,{offsetX:l,offsetY:i}){const{ctx:o}=this;o.beginPath(),o.save(),o.fillStyle="#fff",o.translate(s.x+s.width/2,s.y+s.height/2),s.rotate&&o.rotate(s.rotate),o.rect(e,t,n,n),o.translate(-(s.x+s.width/2),-(s.y+s.height/2)),s.rotate&&o.rotate(-s.rotate);let r=!!o.isPointInPath(l,i)&&a;return o.restore(),o.closePath(),r}checkIsInHanleLine([e,t,a,s,n],l,{offsetX:i,offsetY:o}){const{ctx:r}=this;r.beginPath(),r.save(),r.fillStyle="#fff",r.translate(l.x+l.width/2,l.y+l.height/2),l.rotate&&r.rotate(l.rotate),r.rect(e,t,a,s),r.translate(-(l.x+l.width/2),-(l.y+l.height/2)),l.rotate&&r.rotate(-l.rotate);let c=!!r.isPointInPath(i,o)&&n;return r.restore(),r.closePath(),c}checkIsInRotateArea({x:e,y:t,width:a,height:s,rotate:n},l,{offsetX:i,offsetY:o}){const{ctx:r}=this;r.beginPath(),r.save(),r.translate(e+a/2,t+s/2),n&&r.rotate(n),r.rect(-10,-s/2-2*l-20,20,20),r.translate(-(e+a/2),-(t+s/2)),n&&r.rotate(-n),r.translate(-(e+a/2),-(t+s/2)),r.restore();let c=!!r.isPointInPath(i,o)&&"rotate";return r.closePath(),c}getData(){return{realWidth:this.realWidth,realHeight:this.realHeight,name:this.name,drawType:this.drawType}}getRealCanvas(){const{realWidth:e,realHeight:t}=this;this.canvasDom.width=e,this.canvasDom.height=t,this.zoomRatio=1}setViewType(e){this.viewType=e,"editor"===e&&(this.resize(),this.reDraw())}getTextWidth({content:e,fontFamily:t,font_size:a}){const{ctx:s}=this;s.beginPath(),s.save(),s.font=`${a}px ${t}`;var n=s.measureText(e).width;return s.restore(),s.closePath(),n}drawMeshLine(){const{canvasDom:e,zoomRatio:t}=this,{width:a,height:s}=e,{outerWidth:n}=la,l=Math.ceil(a/t/n),i=Math.ceil(s/t/n),o={x:new Array(l),y:new Array(i)};this.drawMeshLineItem(o)}drawMeshLineItem(e){const{ctx:t,canvasDom:a,zoomRatio:s}=this,{outerWidth:n}=la,{width:l,height:i}=a,{x:o,y:r}=e;for(let c=0;c<o.length;c++)t.beginPath(),t.save(),t.strokeStyle="#404040",t.moveTo(c*n*s,0),t.lineTo(c*n*s,i),t.stroke(),t.restore(),t.closePath(),this.drawMeshMin(c*n*s,0,0);for(let c=0;c<r.length;c++)t.beginPath(),t.save(),t.strokeStyle="#404040",t.moveTo(0,c*n*s),t.lineTo(l,c*n*s),t.stroke(),t.restore(),t.closePath(),this.drawMeshMin(0,c*n*s,1)}drawMeshMin(e,t,a=0){const{ctx:s,canvasDom:n,zoomRatio:l}=this,{width:i,height:o}=n,{innerWidth:r,outerWidth:c}=la,d=Math.ceil(c/r);for(let u=0;u<d;u++)if(0!==u){switch(s.beginPath(),s.save(),s.strokeStyle="#343434",a){case 0:s.moveTo(e+u*r*l,0),s.lineTo(e+u*r*l,o);break;case 1:s.moveTo(0,t+u*r*l),s.lineTo(i,t+u*r*l)}s.stroke(),s.restore(),s.closePath()}}}const oa=(e,t=0,a=0,s=[])=>{const n=e[t];return new Promise((l=>{var i;(i=n,ht.post(`/teai/query_task?task_id=${i}`)).then((n=>{"error"===n.status?(a=0,t+=1,s.push("")):"processing"===n.status?++a>=30&&(a=0,t+=1,s.push("")):(a=0,t+=1,s.push(n)),((e,t)=>t===e.length)(e,t)?l(s):setTimeout((()=>{l(oa(e,t,a,s))}),2e3)}))}))};class ra{constructor(){t(this,"getGenerateResult",((e,t=0,a=0,s=[])=>oa(e,0,0,[]))),this.name=null}getGenrateTaskId(e,t){return new Promise((a=>{(function(e,t,a=1){return ht.post(`/teai/generate?layout_name=${e}&layer_name=${t}&num_images=${a}`)})(this.name,e,t).then((e=>{a(e)}))}))}getGroupTaskResult(e=[],t=0,a={}){const s=e[t],{children:n}=s;return new Promise((l=>{this.getGenrateTaskId(s.uuid,n.length).then((s=>{this.getGenerateResult(s).then((s=>{n.forEach(((e,t)=>{a[e]=s[t]})),++t===e.length?l(a):l(this.getGroupTaskResult(e,t,a))}))}))}))}getLayerTaskResult(e){const{uuid:t}=e;return new Promise((e=>{this.getGenrateTaskId(t,1).then((a=>{this.getGenerateResult(a).then((([a])=>{e({[t]:a})}))}))}))}getElementTaskResult(e,t,a=0){return new Promise((a=>{this.getGenrateTaskId(t,1).then((t=>{this.getGenerateResult(t).then((([t])=>{a({[e]:t})}))}))}))}setName(e){this.name=e}}function ca(e,t){return ht.post(`/teai/upload?file_id=${e}`,t)}function da(e){return/^data:image\/\w+;base64,/.test(e)}function ua(e){return new Promise((t=>{const a=function(e){return`font-${e.split("/")[e.split("/").length-1].split(".")[0]}`}(e);let s=document.getElementById(a)||document.createElement("style");if(s.id)return void t(a);s.id=a;const n=new V(a);s.innerText=`@font-face {\n      font-family: ${a};\n      src: url('${e}');\n    }`,document.head.appendChild(s),n.load().then((()=>{t(a)}),(e=>{}))}))}function ha(e){let t=-1;ma||(ma=function(){const e=new Int32Array(256);for(let t=0;t<256;t++){let a=t;for(let e=0;e<8;e++)a=1&a?3988292384^a>>>1:a>>>1;e[t]=a}return e}());for(let a=0;a<e.length;a++)t=ma[255&(t^e[a])]^t>>>8;return-1^t}let ma;const pa="image/png",va="image/jpeg",ga="p".charCodeAt(0),ya="H".charCodeAt(0),fa="Y".charCodeAt(0),wa="s".charCodeAt(0);function ba(e,t){const a=e.split(","),s=a[0],n=a[1];let l,i,o=!1;if(-1!==s.indexOf(pa)){l=pa;const e=function(e){let t=e.indexOf("AAlwSFlz");-1===t&&(t=e.indexOf("AAAJcEhZ"));-1===t&&(t=e.indexOf("AAAACXBI"));return t}(n);e>=0?(i=4*Math.ceil((e+28)/3),o=!0):i=44}-1!==s.indexOf(va)&&(l=va,i=24);const r=n.substring(0,i),c=n.substring(i),d=atob(r),u=new Uint8Array(d.length);for(let m=0;m<u.length;m++)u[m]=d.charCodeAt(m);const h=function(e,t,a,s){if(a===va)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(a===pa){const a=new Uint8Array(13);t*=39.3701,a[0]=ga,a[1]=ya,a[2]=fa,a[3]=wa,a[4]=t>>>24,a[5]=t>>>16,a[6]=t>>>8,a[7]=255&t,a[8]=a[4],a[9]=a[5],a[10]=a[6],a[11]=a[7],a[12]=1;const n=ha(a),l=new Uint8Array(4);if(l[0]=n>>>24,l[1]=n>>>16,l[2]=n>>>8,l[3]=255&n,s){const t=function(e){for(let t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===ga&&e[t-2]===ya&&e[t-1]===fa&&e[t]===wa)return t-3}(e);return e.set(a,t),e.set(l,t+13),e}{const t=new Uint8Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=9;const s=new Uint8Array(54);return s.set(e,0),s.set(t,33),s.set(a,37),s.set(l,50),s}}}(u,t,l,o);return[s,",",btoa(String.fromCharCode(...h)),c].join("")}function ka(e,t,a,s=0,n=0){const l=[[-e/2,-t/2],[e/2,-t/2],[e/2,t/2],[-e/2,t/2]].map((([e,t])=>{const l=Math.cos(a),i=Math.sin(a);return[s+(e*l-t*i),n+(e*i+t*l)]}));let i=1/0,o=-1/0,r=1/0,c=-1/0;return l.forEach((([e,t])=>{i=Math.min(i,e),o=Math.max(o,e),r=Math.min(r,t),c=Math.max(c,t)})),{width:o-i,height:c-r}}function Ea([e,t],[a,s]){return e>0&&e<a&&t>0&&t<s}const Ca=new class{constructor(){this.dataController=H(new Gt),this.canvasController=H(new ia),this.generationController=H(new ra),this.dataController.reDraw=this.reDraw.bind(this),this.canvasController.clearAllData=this.clearAllData.bind(this),this.canvasController.reDraw=this.reDraw.bind(this),this.canvasController.toDraw=this.toDraw.bind(this),this.canvasController.sendElement=this.sendElement.bind(this),this.canvasController.toSelectedElement=this.toSelectedElement.bind(this),this.canvasController.checkMove=this.checkMove.bind(this),this.canvasController.setElementMovingData=this.setElementMovingData.bind(this),this.canvasController.moveEnd=this.moveEnd.bind(this),this.canvasController.checkContextMenu=this.checkContextMenu.bind(this),this.canvasController.changeElementImage=this.changeElementImage.bind(this),this.canvasController.toImageGenerateView=this.toImageGenerateView.bind(this),this.canvasController.reGenerateElement=this.reGenerateElement.bind(this),this.canvasController.deleteElement=this.deleteElement.bind(this),this.canvasController.generateElement=this.generateElement.bind(this),this.canvasController.toImageGenerateView=this.toImageGenerateView.bind(this),this.canvasController.getLayerImage=this.getLayerImage.bind(this),this.canvasController.toTextEdit=this.toTextEdit.bind(this),this.movedElementUuid=null}save(){return new Promise((e=>{const t=He();this.getSaveData().then((({jsonFile:a,preview:s,code:n,message:l})=>{if(200===n){const n=new FormData;n.append("file",a),lt(n,"layouts",a.name.replace(".json",""),s).then((a=>{U.success("保存成功"),t.close(),e()}))}else t.close(),U.error(l)}))}))}async getSaveData(){const e=this.canvasController.getData(),t=this.dataController.getData(),a=JSON.parse(JSON.stringify(t));if(!e.name)return{code:500,message:"请设置文件名称后操作"};const s=j(),n=new Map;for(let c in a)for(let e in t[c])if(t[c][e].image&&da(t[c][e].image.src))if(n.get(t[c][e].image.src)){const s=n.get(t[c][e].image.src);await this.setImage(c,e,s),a[c][e].image=s}else{const s=Yt(t[c][e].image.src,e),l=new FormData;l.append("file",s);const i=await this.saveImage(e,l);n.set([t[c][e].image.src,i]),await this.setImage(c,e,i),a[c][e].image=i}else t[c][e].image&&t[c][e].image.src?a[c][e].image=t[c][e].image.src:a[c][e].image=null;const l=Yt(this.getCanvasImage(),s),i=new FormData;i.append("file",l);const o=await this.saveImage(s,i),r={viewData:e,layerData:a};for(let c in t){if("elements"===c)break;for(let e in t[c])Object.assign(r,{[e]:{prompts:t[c][e].prompts,statics:t[c][e].statics,colors:t[c][e].colors,texts:t[c][e].texts}})}return{jsonFile:$t(r,e.name),preview:o,code:200}}saveImage(e,t){return new Promise((a=>{ca(e,t).then((e=>{a(e)}))}))}setImage(e,t,a){return new Promise((s=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{this.dataController[e][t].setData({image:n}),s()},n.onerror=()=>{s()},n.src=a}))}clearAllData(){this.dataController.clearAllData(),this.reDraw()}reDraw(e=null){const t=this.dataController.elements,a=this.dataController.groups,s=this.dataController.layers,n=new Set;Object.keys(t).forEach((e=>{this.recomputationPosition(t[e])})),Object.keys(a).forEach((e=>{a[e].children.forEach((e=>{s[e].children.forEach((e=>{t[e].isShow&&n.add(e)}))}))})),Object.keys(s).forEach((e=>{s[e].children.forEach((e=>{t[e].isShow&&n.add(e)}))}));const l=[...n].map((e=>t[e]));e&&(e.image=this.dataController.findData("layer",this.dataController.selectedMap.layer).image,l.push(e)),this.canvasController.clearAll(),this.canvasController.drawMeshLine(),l.forEach((e=>{this.drawItem(e)}));const i=this.dataController.selectedMap.element;if(i&&t[i].isShow){this.canvasController.drawHandleArea(t[i]);const{virtuallyElements:e}=t[i];e&&e.length&&e.forEach((e=>{const[a,s]=e,{width:n,height:l,rotate:o,image:r}=t[i],c={x:a,y:s,width:n,height:l,rotate:o,image:r};this.canvasController.drawHandleArea(c)}))}}drawItem(e){const{virtuallyElements:t,type:a,color:s}=e;switch(a){case"colors":this.canvasController.drawFullScreen(s);break;case"texts":this.canvasController.drawTextItem(e),t&&t.length&&t.forEach((t=>{const[a,s]=t,{width:n,height:l,rotate:i,fontSetting:o}=e,r={x:a,y:s,width:n,height:l,rotate:i,fontSetting:o};this.canvasController.drawTextItem(r)}));break;default:this.canvasController.drawItem(e),t&&t.length&&t.forEach((t=>{const[a,s]=t,{width:n,height:l,rotate:i,image:o}=e,r={x:a,y:s,width:n,height:l,rotate:i,image:o};this.canvasController.drawItem(r)}))}}sendElement(e){const t=this.dataController.selectedMap.layer,a=this.dataController.findData("layer",t),{type:s}=a;if("texts"===s){const t=JSON.parse(JSON.stringify(a.fontSetting)),s=xa.getTextWidth(t);e=Object.assign(e,{x:e.x+e.width/2-s/2,y:e.y+e.height/2-t.font_size/2,width:s,height:t.font_size,fontSetting:t})}this.dataController.add("element",t,null,e),this.reDraw()}toDraw(e){const t=this.dataController.selectedMap.layer;if(!t)return;"texts"!==this.dataController.findData("layer",t).type&&this.canvasController.startDraw(e)}checkClickIsIn(e,t=!0){const a=this.dataController.elements,s=this.dataController.groups,n=this.dataController.layers,l=this.dataController.findData("element",this.dataController.selectedMap.element);let i=null;if(l&&t){if(this.canvasController.checkIsInItem(l,e))return{handleType:"main",data:l};if(i=this.canvasController.checkIsInHandleArea(l,e),i)return{handleType:i,data:l};const{virtuallyElements:t}=l;if(t&&t.length)for(let a of t){const[t,s]=a,{width:n,height:o,rotate:r,image:c,type:d}=l,u={x:t,y:s,width:n,height:o,rotate:r,image:c,type:d};if(i=this.canvasController.checkIsInHandleArea(u,e),i)return{handleType:i,data:l}}}const o=new Set;Object.keys(s).forEach((e=>{s[e].children.forEach((e=>{n[e].children.forEach((e=>{a[e].isShow&&o.add(e)}))}))})),Object.keys(n).forEach((e=>{n[e].children.forEach((e=>{a[e].isShow&&o.add(e)}))}));const r=[...o].map((e=>a[e])).reverse();for(let c of r){const{virtuallyElements:t,type:a}=c;if("colors"===a)return{handleType:"main",data:c};const s=this.canvasController.checkIsInItem(c,e);if(t&&t.length)for(let n of t){const[t,a]=n,{width:s,height:l,rotate:o,image:r}=c,d={x:t,y:a,width:s,height:l,rotate:o,image:r};if(i=this.canvasController.checkIsInItem(d,e),i)return{handleType:"main",data:c}}if(s)return i="main",{handleType:i,data:c}}return{handleType:null,data:null}}toSelectedElement(e){const{data:t}=this.checkClickIsIn(e,!1);if(!t)return this.dataController.selectedMap={group:null,layer:null,element:null},void this.reDraw();const a=this.dataController.findData("layer",t.parentUuid),s=a?this.dataController.findData("group",a.parentUuid):null,n=[s?s.uuid:null,a.uuid||null,t.uuid];this.dataController.changeSelected(n),this.reDraw()}checkMove(e){const t=this.checkClickIsIn(e),a=t.data,s=t.handleType;a&&a.uuid===this.dataController.selectedMap.element&&(this.movedElementUuid=a.uuid,this.canvasController.startMove(e,s))}checkContextMenu(e){const t=this.checkClickIsIn(e),a=t.data,s=t.handleType;a&&"main"===s&&this.canvasController.contextMenu(e,a)}setElementMovingData({xFloat:e,yFloat:t,rotateFloat:a,moveType:s}){const n=this.dataController.elements[this.movedElementUuid];switch(s){case"main":this.mainMove(n,e,t);break;case"left-top":this.leftTopMove(n,e,t);break;case"top":this.topMove(n,e,t);break;case"right-top":this.rightTopMove(n,e,t);break;case"right":this.rightMove(n,e,t);break;case"right-bottom":this.rightBottomMove(n,e,t);break;case"bottom":this.bottomMove(n,e,t);break;case"left-bottom":this.leftBottomMove(n,e,t);break;case"left":this.leftMove(n,e,t);break;case"rotate":this.rotateMove(n,e,t,a)}this.reDraw()}moveEnd(e){this.movedElementUuid=null}mainMove(e,t,a){e.setData({x:e.x+t,y:e.y+a}),this.recomputationPosition(e)}leftTopMove(e,t,a){let{width:s,height:n,x:l,y:i}=e;s-t<0||(s-=t,l+=t),n-a<0||(n-=a,i+=a),e.setData({x:l,y:i,width:s,height:n})}topMove(e,t,a){let{height:s,y:n}=e;s-a<0||(s-=a,n+=a),e.setData({y:n,height:s})}rightTopMove(e,t,a){let{width:s,height:n,y:l}=e;s+t<0||(s+=t),n-a<0||(n-=a,l+=a),e.setData({width:s,height:n,y:l})}rightMove(e,t,a){let{width:s}=e;s+t<0||(s+=t),e.setData({width:s})}rightBottomMove(e,t,a){let{width:s,height:n}=e;s+t<0||(s+=t),n+a<0||(n+=a),e.setData({width:s,height:n})}bottomMove(e,t,a){let{height:s}=e;s+a<0||(s+=a),e.setData({height:s})}leftBottomMove(e,t,a){let{width:s,height:n,x:l}=e;s-t<0||(s-=t,l+=t),n+a<0||(n+=a),e.setData({width:s,height:n,x:l})}leftMove(e,t,a){let{width:s,x:n}=e;s-t<0||(s-=t,n+=t),e.setData({x:n,width:s})}rotateMove(e,t,a,s){const{x:n,y:l,width:i,height:o,rotate:r}=e;let c=function([e,t],[a,s],[n,l]){const i=a-e,o=s-t,r=n-e,c=l-t;let d=(i*r+o*c)/(Math.sqrt(i*i+o*o)*Math.sqrt(r*r+c*c));if(isNaN(d))return 0;let u=Math.acos(d);return i*c-o*r<0&&(u=-u),isNaN(u)?Math.PI/1800:Number(u.toFixed(2))}([n+i/2,l+o/2],s,[s[0]+t,s[1]+a]);e.setData({rotate:r+c})}recomputationPosition(e){const{drawType:t}=this.canvasController,{realWidth:a,realHeight:s}=this.canvasController;switch(t){case ta:e.virtuallyElements=[],this.recomputationMainPosition(a,s,e);break;case aa:e.virtuallyElements=[],this.recomputationAgentXPosition(width,e),this.recomputationMainPosition(a,s,e);break;case sa:e.virtuallyElements=[],this.recomputationAgentYPosition(height,e),this.recomputationMainPosition(a,s,e);break;case na:e.virtuallyElements=[],this.recomputationAgentFPosition(a,s,e),this.recomputationMainPosition(a,s,e)}}recomputationMainPosition(e,t,a){const{virtuallyElements:s,x:n,y:l,width:i,height:o}=a;let r=JSON.parse(JSON.stringify(s));r.length&&(Ea([n+i/2,l+o/2],[e,t])||r.forEach(((s,c)=>{const[d,u]=s;Ea([d+i/2,u+o/2],[e,t])&&(r[c]=[n,l],a.setData({x:d,y:u,virtuallyElements:r}))})))}recomputationAgentXPosition(e,t){const{x:a,y:s,virtuallyElements:n,width:l,height:i,rotate:o}=t;let r=l;o&&(r=ka(l,i,o).width),a+l/2+r/2>e?n.push([a-e,s]):a+l/2-r/2<0&&n.push([e+a,s]),t.setData({virtuallyElements:n})}recomputationAgentYPosition(e,t){const{x:a,y:s,virtuallyElements:n,width:l,height:i,rotate:o}=t;let r=i;o&&(r=ka(l,i,o).height),s+i/2+r/2>e?n.push([a,s-e]):s+i/2-r/2<0&&n.push([a,e+s]),t.setData({virtuallyElements:n})}recomputationAgentFPosition(e,t,a){this.recomputationAgentXPosition(e,a),this.recomputationAgentYPosition(t,a);const{virtuallyElements:s,x:n,drawY:l,width:i,height:o}=a;2===s.length&&(n===s[0][0]?s.push([s[1][0],s[0][1]]):s.push([s[0][0],s[1][1]])),a.setData({virtuallyElements:s})}deleteElement(e){this.dataController.delete("element",e),this.reDraw()}reGenerateElement(e){}toImageGenerateView(e){}changeElementImage(e,t){this.dataController.elements[e].setData({image:t}),this.reDraw()}getCanvasImage(){this.canvasController.getRealCanvas();const e=this.dataController.elements,t=this.dataController.groups,a=this.dataController.layers,s=new Set;Object.keys(e).forEach((t=>{this.recomputationPosition(e[t])})),Object.keys(t).forEach((n=>{t[n].children.forEach((t=>{a[t].children.forEach((t=>{e[t].isShow&&s.add(t)}))}))})),Object.keys(a).forEach((t=>{a[t].children.forEach((t=>{e[t].isShow&&s.add(t)}))}));const n=[...s].map((t=>e[t]));this.canvasController.clearAll(),n.forEach((e=>{this.drawItem(e)}));const l=ba(this.canvasController.canvasDom.toDataURL("image/png"),300);return this.canvasController.resize().then((()=>{this.reDraw()})),l}async generateAll(){const e=He(),t=Object.keys(this.dataController.groups).map((e=>this.dataController.groups[e])),a=this.dataController.layers,s=Object.keys(a).filter((e=>!this.dataController.layers[e].parentUuid)).map((e=>this.dataController.layers[e]));if(t.length){const e=await this.generationController.getGroupTaskResult(t);for(let t in e){const a=this.dataController.findData("layer",t),{type:s}=a;switch(s){case"texts":this.setResultText(a,e[t].result);break;case"colors":this.setResultColor(a,e[t].result);break;default:await this.setResultImage(a,e[t].result)}}}if(s.length){for(let e of s){const t=await this.generationController.getLayerTaskResult(e),{uuid:a,type:s}=e;switch(s){case"texts":this.setResultText(e,t[a].result);break;case"colors":this.setResultColor(e,t[a].result);break;default:await this.setResultImage(e,t[a].result)}}this.reDraw(),e.close(),U.success("生成完成")}}async setResultImage(e,t){const{uuid:a}=e,s=await Zt(t);this.dataController.layers[a].setData({image:s}),e.children.forEach((e=>{this.dataController.elements[e].setData({image:s})}))}async setResultText(e,t){const a=t,s=await ua(a.font);a.fontFamily=s,e.setData({fontSetting:a}),e.children.forEach((e=>{const t=this.dataController.elements[e],s={fontSetting:a,width:this.canvasController.getTextWidth(a),height:a.font_size};t.setData(s)}))}setResultColor(e,t){e.children.forEach((e=>{this.dataController.elements[e].setData({color:t})}))}async generateGroup(e){const t=He(),a=this.dataController.findData("group",e),s=await this.generationController.getGroupTaskResult([a]);for(let n in s){const e=this.dataController.findData("layer",n),{type:t}=e;switch(t){case"texts":this.setResultText(e,s[n].result);break;case"colors":this.setResultColor(e,s[n].result);break;default:await this.setResultImage(e,s[n].result)}}this.reDraw(),t.close()}async generateLayer(e){const t=He(),a=this.dataController.findData("layer",e),{uuid:s}=a,n=await this.generationController.getLayerTaskResult(a),{type:l}=a;switch(l){case"texts":this.setResultText(a,n[s].result);break;case"colors":this.setResultColor(a,n[s].result);break;default:await this.setResultImage(a,n[s].result)}this.reDraw(),t.close()}async generateElement(e){const t=this.dataController.findData("element",e),a=this.dataController.findData("layer",t.parentUuid),s=He(),{type:n}=a,l=await this.generationController.getElementTaskResult(e,a.uuid);switch(n){case"texts":const t=l[e].result,a=await ua(t.font);t.fontFamily=a;const s={fontSetting:t,width:this.canvasController.getTextWidth(t),height:t.font_size};this.dataController.findData("element",e).setData(s);break;case"colors":this.dataController.findData("element",e).setData({color:l[e].result});break;default:const n=await Zt(l[e].result);this.dataController.findData("element",e).setData({image:n})}this.reDraw(),s.close()}toImageGenerateView(e){const t=this.dataController.findData("element",e),{image:a,uuid:s}=t;this.toImageGenerateView({image:a.src,uuid:s})}async getLayerImage(){this.canvasController.getRealCanvas();const e=this.dataController.elements,t=this.dataController.groups,a=this.dataController.layers,s=new Set;Object.keys(e).forEach((t=>{this.recomputationPosition(e[t])})),Object.keys(t).forEach((e=>{t[e].children.forEach((e=>{a[e].isShow&&s.add(e)}))})),Object.keys(a).forEach((e=>{a[e].children.forEach((t=>{a[e].isShow&&s.add(e)}))}));const n=[];return[...s].map((e=>a[e])).forEach((t=>{this.canvasController.clearAll(),t.children.forEach((t=>{const a=e[t];this.drawItem(a)})),n.push({name:t.name,uuid:t.uuid,image:this.canvasController.canvasDom.toDataURL("image/png")})})),"editor"===this.canvasController.viewType&&await this.canvasController.resize(),this.reDraw(),n}toTextEdit(e){const t=this.dataController.findData("element",e);this.toTextEditView(t)}},Da=H(Ca.dataController),xa=H(Ca.canvasController);const Ta={class:"editor-layers-title"},Sa={class:"list-outer"},Ia=["onContextmenu","onDrop","onClick"],Aa={class:"group-name"},La=["onClick"],_a={class:"group-handle-area"},Ma=["onClick"],Ra=["onClick"],Oa=["onClick"],Pa=["onClick","onContextmenu","onDrop","draggable","onDragstart"],Na={class:"layer-name"},Ua=["onClick"],Ga={class:"layer-handle-area"},Ha=["onClick"],ja=["onClick"],za=["onClick"],Va=["onContextmenu","onClick"],Ba={class:"element-name"},Ya={class:"element-handle-area"},Xa=["onClick"],Wa=["onClick"],Fa=["onClick"],Za=["onClick","onDrop","onContextmenu","draggable","onDragstart"],$a={class:"layer-name"},Ja=["onClick"],Qa={class:"layer-handle-area"},qa=["onClick"],Ka=["onClick"],es=["onClick"],ts=["onContextmenu","onClick"],as={class:"element-name"},ss={class:"element-handle-area"},ns=["onClick"],ls=["onClick"],is=["onClick"];var os=oe({__name:"editorLayers",props:{viewType:{type:String,default:"编辑器"},typeList:{type:Array,default:()=>[]},groupList:{type:Array,default:()=>[]},editorType:{}},emits:["toLayerInfo","setSelectedLayer","deleteGroup","deleteLayer","deleteElement","setGroup","hideLayer","reGenerateGroup","reGenerateLayer","reGenerateElement","setDiagramImage"],setup(e,{expose:t,emit:a}){let s=n(Da);const l=n(Ca),o=n(xa),r=e,u=a;n(new Set),n(new Set);const f=n({groupUuid:null,layerUuid:null,elementUuid:null});n({groupUuid:new Set,layerUuid:new Set,elementUuid:new Set});const w=n(null),b=(...e)=>{u("toLayerInfo",...e)},k=(e,t)=>{t.dataTransfer.setData("text/plain",e)},E=(e,t,a)=>{a.preventDefault();const n=a.dataTransfer.getData("text/plain");"group"===t?s.value.bindGroup([n],e):s.value.bindGroup([n,e])},D=(...e)=>{l.value.generateLayer(...e)},x=(...e)=>{l.value.generateElement(...e)},T=(e,t,a)=>{const n=s.value.findData(e,t),{pageX:l,pageY:i}=a;o.value.handleController.setHandle(n,{x:l,y:i},e,Boolean(n.image),w.value).then((a=>{const{name:l}=a;switch(e){case"element":o.value.contextmenuCallBack(a);break;case"layer":switch(l){case Vt.LAYER_DELETE:s.value.delete(e,t);break;case Vt.LAYER_EDIT:b(n)}break;case"group":if(l===Vt.GROUP_DELETE)s.value.delete(e,t)}}))};return t({setSelectedElement:e=>{const t=r.typeList.find((t=>new Set(Object.keys(t.layerInfo)).has(e))),a=t?t.uuid:null,s=r.groupList.find((e=>new Set(e.layers).has(a))),n=s?s.uuid:null;((e,t,a)=>{f.value.elementUuid!==e&&(a&&(f.value.groupUuid=a),t&&(f.value.layerUuid=t,u("setSelectedLayer",t,e)),f.value.elementUuid=e)})(e,a,n)}}),(e,t)=>{const a=R("el-scrollbar");return d(),i("div",{class:"editor-layers",ref_key:"editorLayersDom",ref:w},[m("div",Ta,[C(" 图层 "),m("i",{class:p(["pointer icon bi",y("bi-plus")]),onClick:t[0]||(t[0]=e=>b())},null,2)]),m("div",Sa,[g(a,null,{default:h((()=>[(d(!0),i(_,null,L(Object.keys(y(s).groups),(e=>(d(),i("div",{class:"group-list",key:e},[m("div",{class:p(["group-title",{selected:y(s).isSelected("group",e)}]),onDragover:t[1]||(t[1]=v((()=>{}),["prevent"])),onContextmenu:t=>T("group",e,t),onDrop:t=>E(e,"group",t),onClick:t=>y(s).changeSelected([e,null,null])},[m("div",Aa,[m("div",{class:p(["icon bi",`${y("bi-caret-right")} ${y(s).isShowMapShow("group",e)?"selected":""}`]),onClick:v((()=>{y(s).handleShowMap("group",e)}),["stop"])},null,10,La),C(" "+A(y(s).groups[e].name),1)]),m("div",_a,[m("div",{class:p(["pointer icon bi",y(Le)]),onClick:v((t=>((...e)=>{l.value.generateGroup(...e)})(e)),["stop"])},null,10,Ma),m("div",{class:p(["pointer icon bi",y(s).groups[e].isShow?y(_e):y(Me)]),onClick:v((()=>{y(s).handleIsShow("group",e,y(s).groups[e].isShow?"hide":"show"),u("setDiagramImage")}),["stop"])},null,10,Ra),"edit"===r.editorType?(d(),i("div",{key:0,class:p(["pointer icon bi",y(Oe)]),onClick:v((t=>y(s).delete("group",e)),["stop"])},null,10,Oa)):c("",!0)])],42,Ia),y(s).isShowMapShow("group",e)?(d(!0),i(_,{key:0},L(y(s).groups[e].children,(a=>(d(),i("div",{class:"layer-list",key:a},[m("div",{class:p(["layer-title",{selected:y(s).isSelected("layer",a)}]),onClick:t=>y(s).changeSelected([e,a,null]),onDragover:t[2]||(t[2]=v((()=>{}),["prevent"])),onContextmenu:e=>T("layer",a,e),onDrop:t=>E(e,"group",t),draggable:"edit"===r.editorType,onDragstart:e=>k(a,e)},[m("div",Na,[m("div",{class:p(["icon bi",`${y("bi-caret-right")} ${y(s).isShowMapShow("layer",a)?"selected":""}`]),onClick:v((()=>{y(s).handleShowMap("layer",a)}),["stop"])},null,10,Ua),C(" "+A(y(s).layers[a].name),1)]),m("div",Ga,[m("div",{class:p(["pointer icon bi",y(Le)]),onClick:v((e=>D(a)),["stop"])},null,10,Ha),m("div",{class:p(["pointer icon bi",y(s).layers[a].isShow?y(_e):y(Me)]),onClick:v((()=>{y(s).handleIsShow("layer",a,y(s).layers[a].isShow?"hide":"show"),u("setDiagramImage")}),["stop"])},null,10,ja),"edit"===r.editorType?(d(),i("div",{key:0,class:p(["pointer icon bi",y(Oe)]),onClick:v((e=>y(s).delete("layer",a)),["stop"])},null,10,za)):c("",!0)])],42,Pa),y(s).isShowMapShow("layer",a)?(d(!0),i(_,{key:0},L(y(s).layers[a].children,(t=>(d(),i("div",{class:"element-item",key:t},[m("div",{class:p(["element-title",{selected:y(s).isSelected("element",t)}]),onContextmenu:e=>T("element",t,e),onClick:n=>y(s).changeSelected([e,a,t])},[m("div",Ba,A(y(s).elements[t].name),1),m("div",Ya,[m("div",{class:p(["pointer icon bi",y(Le)]),onClick:v((e=>x(t)),["stop"])},null,10,Xa),m("div",{class:p(["pointer icon bi",y(s).elements[t].isShow?y(_e):y(Me)]),onClick:v((()=>{y(s).handleIsShow("element",t,y(s).elements[t].isShow?"hide":"show"),u("setDiagramImage")}),["stop"])},null,10,Wa),"edit"===r.editorType?(d(),i("div",{key:0,class:p(["pointer icon bi",y(Oe)]),onClick:v((e=>y(s).delete("element",t)),["stop"])},null,10,Fa)):c("",!0)])],42,Va)])))),128)):c("",!0)])))),128)):c("",!0)])))),128)),(d(!0),i(_,null,L(Object.keys(y(s).layers),(e=>(d(),i(_,null,[y(s).layers[e].parentUuid?c("",!0):(d(),i("div",{class:"layer-list",key:e},[m("div",{class:p(["layer-title",{selected:y(s).isSelected("layer",e)}]),onClick:t=>y(s).changeSelected([null,e,null]),onDragover:t[3]||(t[3]=v((()=>{}),["prevent"])),onDrop:t=>E(e,"layer",t),onContextmenu:t=>T("layer",e,t),draggable:"edit"===r.editorType,onDragstart:t=>k(e,t)},[m("div",$a,[m("div",{class:p(["icon bi",`${y("bi-caret-right")} ${y(s).isShowMapShow("layer",e)?"selected":""}`]),onClick:v((()=>{y(s).handleShowMap("layer",e)}),["stop"])},null,10,Ja),C(" "+A(y(s).layers[e].name),1)]),m("div",Qa,[m("div",{class:p(["pointer icon bi",y(Le)]),onClick:v((t=>D(e)),["stop"])},null,10,qa),m("div",{class:p(["pointer icon bi",y(s).layers[e].isShow?y(_e):y(Me)]),onClick:v((()=>{y(s).handleIsShow("layer",e,y(s).layers[e].isShow?"hide":"show"),u("setDiagramImage")}),["stop"])},null,10,Ka),"edit"===r.editorType?(d(),i("div",{key:0,class:p(["pointer icon bi",y(Oe)]),onClick:v((t=>y(s).delete("layer",e)),["stop"])},null,10,es)):c("",!0)])],42,Za),y(s).isShowMapShow("layer",e)?(d(!0),i(_,{key:0},L(y(s).layers[e].children,(t=>(d(),i("div",{class:"element-item",key:t},[m("div",{class:p(["element-title",{selected:y(s).isSelected("element",t)}]),onContextmenu:e=>T("element",t,e),onClick:a=>y(s).changeSelected([null,e,t])},[m("div",as,A(y(s).elements[t].name),1),m("div",ss,[m("div",{class:p(["pointer icon bi",y(Le)]),onClick:v((e=>x(t)),["stop"])},null,10,ns),m("div",{class:p(["pointer icon bi",y(s).elements[t].isShow?y(_e):y(Me)]),onClick:v((()=>{y(s).handleIsShow("element",t,y(s).elements[t].isShow?"hide":"show"),u("setDiagramImage")}),["stop"])},null,10,ls),"edit"===r.editorType?(d(),i("div",{key:0,class:p(["pointer icon bi",y(Oe)]),onClick:v((e=>y(s).delete("element",t)),["stop"])},null,10,is)):c("",!0)])],42,ts)])))),128)):c("",!0)]))],64)))),256))])),_:1})])],512)}}},[["__scopeId","data-v-adcc345e"]]);const rs={class:"menu-icon"},cs=["src"],ds=(e=>(D("data-v-2203e8e2"),e=e(),x(),e))((()=>m("div",{class:"menu-name"},null,-1))),us={class:"menu-all"},hs=["onClick"],ms={class:"menu-icon"},ps={class:"menu-name"};var vs=oe({__name:"editorHandle",props:["editorType"],emits:["changeHandleType","exportImage","changeViewType","toGenrateGroup","save"],setup(e,{emit:t}){const{publicStore:a}=ft(),s=n(xa),o=n(Ca),r=I();S();const c=n([]),u=n(null),v=n(0),f=n(0),w=e,b=t,k=()=>{const e=E(),t=C();return[].concat(e,t)},E=()=>s.value.handleState===At&&"edit"===w.editorType?[{name:"绘制模式",icon:"bi-grid",click(){s.value.changeHandleType(Lt)}}]:s.value.handleState===Lt?[{name:"操作模式",icon:"bi-bounding-box-circles",click(){s.value.changeHandleType(At)}}]:[],C=()=>{let e=[{name:"下载图片",icon:"bi-download",click(){const e=Xt(o.value.getCanvasImage()),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="下载.png",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}},{name:"上传模板",icon:"bi-cloud-arrow-up",click(){o.value.save()}},{name:"效果调节",icon:"bi-sliders",click(){}},{name:"测试生成",icon:f.value?Le:"bi-play",click(){f.value++,o.value.save().then((()=>{U.success("开始生成"),o.value.generateAll()}))}},{name:"分层展示",icon:"bi-layers",click(){b("changeViewType")}}];return"edit"===w.editorType&&(e=e.concat([{name:"画板设置",icon:"bi-gear",click(){b("toCanvasSetting")}}])),e};return l((()=>{u.value=r.path,c.value=[]})),(e,t)=>{const s=R("el-icon");return d(),i("div",{class:p(["left-bar-body",{expand:v.value}])},[m("div",{class:"menu-title",onClick:t[0]||(t[0]=e=>(v.value=Number(!v.value),void a.setLeftBarShowType(v.value)))},[m("div",rs,[g(s,{class:"icon"},{default:h((()=>[m("img",{src:y("/assets/menu.2082884d.svg")},null,8,cs)])),_:1})]),ds]),m("div",us,[(d(!0),i(_,null,L(k(),((e,t)=>(d(),i("div",{class:"menu-item",key:t,onClick:t=>e.click()},[m("div",ms,[m("i",{class:p(["bi icon",e.icon])},null,2)]),m("div",ps,A(e.name),1)],8,hs)))),128))])],2)}}},[["__scopeId","data-v-2203e8e2"]]);const gs=e=>(D("data-v-de25702e"),e=e(),x(),e),ys={class:"editor-draw-board-setting-box"},fs={class:"editor-draw-board-setting-title"},ws={class:"editor-draw-board-setting-handle-area"},bs={class:"setting-item"},ks=gs((()=>m("div",{class:"setting-item-label"},"模板名称",-1))),Es={class:"setting-item-value"},Cs={class:"setting-item"},Ds=gs((()=>m("div",{class:"setting-item-label"},"画布尺寸",-1))),xs={class:"setting-item-value"},Ts=gs((()=>m("div",{class:"center-icon"},"*",-1))),Ss={class:"setting-item"},Is=gs((()=>m("div",{class:"setting-item-label"},"绘制方式",-1))),As={class:"setting-item-value"};var Ls=oe({__name:"editorDrawBoardSetting",props:["editorType"],setup(e,{expose:t}){const a=I(),s=e,l="/modelMainEditor"===a.path,o=n(!1);n(null);const r=n({}),c=n(xa),v=()=>{o.value=!1};return t({show:e=>{o.value?v():(r.value=xa.getData(),o.value=!0)}}),(e,t)=>{const a=R("el-input"),n=R("el-input-number"),f=R("el-option"),w=R("el-select");return d(),i("div",{class:p(["editor-draw-board-setting",{show:o.value}])},[m("div",ys,[m("div",fs,[C(" 画板设置 "),m("div",ws,[m("div",{class:"editor-draw-board-setting-handle",onClick:t[0]||(t[0]=e=>v())},[m("i",{class:p(`bi ${y("bi-arrow-left-circle")}`)},null,2)]),m("div",{class:"editor-draw-board-setting-handle",onClick:t[1]||(t[1]=e=>(o.value=!1,void c.value.setData(r.value,"edit")))},[m("i",{class:p(`bi ${y("bi-save")}`)},null,2)])])]),m("div",bs,[ks,m("div",Es,[g(a,{modelValue:r.value.name,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.name=e),disabled:"edit"!==s.editorType||!l},null,8,["modelValue","disabled"])])]),m("div",Cs,[Ds,m("div",xs,[g(n,{disabled:"edit"!==s.editorType,modelValue:r.value.realWidth,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.realWidth=e),controls:!1},null,8,["disabled","modelValue"]),Ts,g(n,{disabled:"edit"!==s.editorType,modelValue:r.value.realHeight,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.realHeight=e),controls:!1},null,8,["disabled","modelValue"])])]),m("div",Ss,[Is,m("div",As,[g(w,{modelValue:r.value.drawType,"onUpdate:modelValue":t[5]||(t[5]=e=>r.value.drawType=e),disabled:"edit"!==s.editorType},{default:h((()=>[(d(!0),i(_,null,L(Object.keys(y(_t)),(e=>(d(),u(f,{key:e,value:y(_t)[e],label:y(_t)[e]},null,8,["value","label"])))),128))])),_:1},8,["modelValue","disabled"])])])])],2)}}},[["__scopeId","data-v-de25702e"]]);const _s=e=>(D("data-v-a6e2f8e4"),e=e(),x(),e),Ms={class:"editor-layer-setting-box"},Rs={class:"editor-layer-setting-title"},Os={class:"editor-layer-setting-handle-area"},Ps={class:"setting-value-box"},Ns={key:0,class:"setting-item"},Us=_s((()=>m("div",{class:"setting-item-label"},"图层名称",-1))),Gs={class:"setting-item-value"},Hs={class:"setting-item"},js=_s((()=>m("div",{class:"setting-item-label"},"图层类型",-1))),zs={class:"setting-item-value"},Vs={key:1,class:"setting-item"},Bs=_s((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Ys={class:"setting-item-value"},Xs={key:2,class:"setting-item"},Ws=_s((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Fs={class:"setting-item-value"},Zs={key:3,class:"setting-item"},$s=_s((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Js={class:"setting-item-value"},Qs={key:4,class:"setting-item"},qs=_s((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Ks={class:"setting-item-value"},en={key:5,class:"setting-item"},tn=_s((()=>m("div",{class:"setting-item-label"},"图片",-1))),an={class:"setting-item-value"};var sn=oe({__name:"editorLayerSetting",props:{staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]}},emits:["save"],setup(e,{expose:t,emit:a}){const s=n(Da),l=e,o=n(!1),f=n(null),w=n([]),b=n([]),k=n([]),E=n([]),D=n(null),x=n(null),T=n(null),S=n("layer"),I=n(null),M=()=>{o.value=!1},O=()=>{x.value=null,T.value=null},P=e=>{if("image/png"!==e.type)return void U.error("请上传png格式图片");const t=new FileReader;return t.onload=({target:e})=>{const t=new Image;t.src=e.result,t.onload=()=>{T.value=t,x.value=e.result}},t.readAsDataURL(e),!1};return t({show:(e=null)=>{o.value?M():(o.value=!0,f.value=e?e.name:"",w.value=e?e.statics:[],b.value=e?e.prompts:[],E.value=e?e.texts:[],k.value=e?e.colors:[],D.value=e?e.uuid:null,T.value=e?e.image:null,I.value=e?e.type:null,x.value=T.value?T.value.src:null)}}),(e,t)=>{const a=R("el-input"),n=R("el-option"),N=R("el-select"),G=R("el-button"),H=R("el-image"),j=R("el-upload"),z=R("el-scrollbar");return d(),i("div",{class:p(["editor-layer-setting",{show:o.value}]),style:r({height:"layer"===S.value?"9.3rem":"7rem"})},[m("div",Ms,[m("div",Rs,[C(A("layer"===S.value?"图层":"组")+"设置 ",1),m("div",Os,[m("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>M())},[m("i",{class:p(`bi ${y("bi-arrow-left-circle")}`)},null,2)]),m("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>(()=>{if(f.value||"layer"!==S.value)if(I.value)if(w.value.length||b.value.length||k.value.length||E.value.length)if(o.value=!1,D.value){const e=s.value.findData("layer",D.value),{children:t}=e,a={prompts:b.value,statics:w.value,colors:k.value,texts:E.value,image:T.value,type:I.value};e.setData(a),t.forEach((e=>{s.value.findData("element",e).setData(a)})),s.value.reDraw()}else s.value.add("layer",null,f.value,{prompts:b.value,statics:w.value,colors:k.value,texts:E.value,image:T.value,type:I.value});else U.error("请选择模板后操作");else U.error("请选择图层类型后操作");else U.error("请输入图层名称后保存")})())},[m("i",{class:p(`bi ${y("bi-save")}`)},null,2)])])]),m("div",Ps,[g(z,null,{default:h((()=>["layer"===S.value?(d(),i("div",Ns,[Us,m("div",Gs,[g(a,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e)},null,8,["modelValue"])])])):c("",!0),m("div",Hs,[js,m("div",zs,[g(N,{modelValue:I.value,"onUpdate:modelValue":t[3]||(t[3]=e=>I.value=e),onChange:t[4]||(t[4]=e=>(w.value=[],k.value=[],E.value=[],b.value=[],x.value=null,void(T.value=null)))},{default:h((()=>[(d(!0),i(_,null,L(Object.keys(y(Ot)),(e=>(d(),u(n,{key:e,label:y(Ot)[e],value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),"statics"===I.value?(d(),i("div",Vs,[Bs,m("div",Ys,[g(N,{multiple:"",modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=e=>w.value=e)},{default:h((()=>[(d(!0),i(_,null,L(l.staticsList,(e=>(d(),u(n,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):c("",!0),"prompts"===I.value?(d(),i("div",Xs,[Ws,m("div",Fs,[g(N,{multiple:"",modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=e=>b.value=e)},{default:h((()=>[(d(!0),i(_,null,L(l.promptsList,(e=>(d(),u(n,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):c("",!0),"colors"===I.value?(d(),i("div",Zs,[$s,m("div",Js,[g(N,{multiple:"",modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=e=>k.value=e)},{default:h((()=>[(d(!0),i(_,null,L(l.colorsList,(e=>(d(),u(n,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):c("",!0),"texts"===I.value?(d(),i("div",Qs,[qs,m("div",Ks,[g(N,{multiple:"",modelValue:E.value,"onUpdate:modelValue":t[8]||(t[8]=e=>E.value=e)},{default:h((()=>[(d(!0),i(_,null,L(l.textsList,(e=>(d(),u(n,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):c("",!0),"statics"===I.value||"prompts"===I.value?(d(),i("div",en,[tn,m("div",an,[g(j,{style:{width:"100%"},"before-upload":P,accept:".png","show-file-list":!1,action:""},{default:h((()=>[x.value?c("",!0):(d(),u(G,{key:0,style:{width:"6.8rem",height:"3.5rem",padding:"0"}},{default:h((()=>[C("上传图片")])),_:1})),x.value?(d(),u(G,{key:1,style:{width:"6.8rem",height:"3.5rem",padding:"0",position:"relative"}},{default:h((()=>[g(H,{fit:"cover",style:{width:"6.8rem",height:"3.5rem"},src:x.value},null,8,["src"]),m("div",{class:"remove-image-btn",onClick:v(O,["stop"])},[m("div",{class:p(["bi",y(Oe)])},null,2)])])),_:1})):c("",!0)])),_:1})])])):c("",!0)])),_:1})])])],6)}}},[["__scopeId","data-v-a6e2f8e4"]]);var nn=oe({},[["render",function(e,t){return d(),i("div")}]]);const ln={class:"image-like"},on={class:"slider-area"},rn=(e=>(D("data-v-1e1c29d1"),e=e(),x(),e))((()=>m("div",{class:"slider-name"},"相似度",-1))),cn={class:"slider-handle"},dn={class:"image-area"},un={class:"image-item"},hn=["src"],mn={class:"image-item"},pn=["src"];var vn=oe({__name:"imageLike",props:{imageUrl:{type:String,default:""}},emits:["setNewImageUrl"],setup(e,{emit:t}){const a=e,s=t,l=n(50),o=n(null),r=()=>{const e=He();(function(e,t){return ht.post(`/teai/img2img?image_url=${e}&similarity=${t}`)})(a.imageUrl,l.value/100).then((t=>{oa(t).then((t=>{t.length&&(e.close(),o.value=t[0].result,s("setNewImageUrl",o.value))}))}))};return(e,t)=>{const s=R("el-slider");return d(),i("div",ln,[m("div",on,[rn,m("div",cn,[g(s,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),min:0,max:100},null,8,["modelValue"])]),m("div",{class:"slider-btn-area"},[m("div",{onClick:r},"生成")])]),m("div",dn,[m("div",un,[m("img",{src:a.imageUrl},null,8,hn)]),m("div",mn,[m("img",{src:o.value},null,8,pn)])])])}}},[["__scopeId","data-v-1e1c29d1"]]);var gn=oe({},[["render",function(e,t){return d(),i("div")}]]);const yn={key:0,class:"image-generate-outer"},fn={class:"image-generate"},wn={class:"image-generate-setting-handle-area"},bn={class:"change-setting-type-area"},kn=["onClick"],En={class:"handle-btn-area"},Cn={class:"image-generate-setting-component-area"};var Dn=oe({__name:"imageGenerate",emits:["replaceImage"],setup(e,{expose:t,emit:a}){const s=[{name:"相似生成",component:vn},{name:"融合图像",component:nn},{name:"文本控制",component:gn}],l=n(0),o=n(Da),h=n(Ca),p=n(!1),v=n(null),g=n(null),y=n(null),f=n("element"),w=e=>{y.value=e};return t({init:(e,t="element")=>{if(da(e.image)){const a=Yt(e.image,`element_${e.uuid}`),s=new FormData;s.append("file",a),ca(`element_${e.uuid}`,s).then((a=>{v.value=a,g.value=e.uuid,f.value=t,y.value=null,p.value=!0}))}else v.value=e.image,g.value=e.uuid,f.value=t,y.value=null,p.value=!0}}),(e,t)=>p.value?(d(),i("div",yn,[m("div",fn,[m("div",wn,[m("div",bn,[m("div",{class:"component-selected",style:r({left:3.2*l.value+.05+"rem"})},null,4),(d(),i(_,null,L(s,((e,t)=>m("div",{class:"component-item",onClick:e=>l.value=t,key:e.name},A(e.name),9,kn))),64))]),m("div",En,[m("div",{class:"handle-btn",onClick:t[0]||(t[0]=e=>(async()=>{p.value=!1;const e=await Wt(y.value);o.value.findData(f.value,g.value).setData({image:e}),h.value.reDraw()})())},"替换"),m("div",{class:"handle-btn",onClick:t[1]||(t[1]=e=>{p.value=!1})},"关闭")])]),m("div",Cn,[p.value?(d(),u(B(s[l.value].component),{key:0,imageUrl:v.value,onSetNewImageUrl:w,ref:"componentDom"},null,40,["imageUrl"])):c("",!0)])])])):c("",!0)}},[["__scopeId","data-v-33ee638b"]]);const xn=e=>(D("data-v-1d64581d"),e=e(),x(),e),Tn={key:0,class:"editor-text-setting-outer"},Sn={class:"editor-text-setting-box"},In={class:"editor-text-setting-title"},An=xn((()=>m("div",{class:"editor-text-setting-content"}," 编辑文本 ",-1))),Ln={class:"editor-text-setting-close-area"},_n={class:"editor-text-setting-inner"},Mn={class:"editor-text-setting"},Rn=xn((()=>m("div",{class:"editor-text-setting-name"}," 文本内容 ",-1))),On={class:"editor-text-setting-value"},Pn={class:"editor-text-setting"},Nn=xn((()=>m("div",{class:"editor-text-setting-name"}," 文本颜色 ",-1))),Un={class:"editor-text-setting-value"},Gn={class:"editor-text-setting"},Hn=xn((()=>m("div",{class:"editor-text-setting-name"}," 文本字号 ",-1))),jn={class:"editor-text-setting-value"};var zn=oe({__name:"editorTextSetting",setup(e,{expose:t}){const a=n(!1),s=n(Da),l=n(null),o=n({}),r=()=>{a.value=!1};return t({init:e=>{const{fontSetting:t}=e;l.value=e.uuid,a.value=!0;const s=JSON.parse(JSON.stringify(t));s.font_color=Qt(s.font_color),o.value=s}}),(e,t)=>{const n=R("el-input"),u=R("el-color-picker"),h=R("el-input-number");return a.value?(d(),i("div",Tn,[m("div",Sn,[m("div",In,[An,m("div",Ln,[m("div",{onClick:t[0]||(t[0]=e=>(()=>{const e=s.value.findData("element",l.value),t=JSON.parse(JSON.stringify(o.value));t.font_color=Jt(t.font_color);const a=xa.getTextWidth(t);e.setData({x:e.x+e.width/2-a/2,width:a,height:t.font_size,fontSetting:t}),s.value.reDraw(),r()})())}," 保存 "),m("div",{onClick:t[1]||(t[1]=e=>r())}," 关闭 ")])]),m("div",_n,[m("div",Mn,[Rn,m("div",On,[g(n,{modelValue:o.value.content,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.content=e)},null,8,["modelValue"])])]),m("div",Pn,[Nn,m("div",Un,[g(u,{style:{width:"100%"},"color-format":"rgba","show-alpha":"",modelValue:o.value.font_color,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.font_color=e)},null,8,["modelValue"])])]),m("div",Gn,[Hn,m("div",jn,[g(h,{controls:!1,modelValue:o.value.font_size,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.font_size=e)},null,8,["modelValue"]),C(" px ")])])])])])):c("",!0)}}},[["__scopeId","data-v-1d64581d"]]);const Vn=["onClick"],Bn={key:0,class:"explosion-line-1"},Yn={class:"explosion-prompt-item"},Xn={class:"explosion-item-name"},Wn={class:"explosion-prompt-edit-btn"},Fn={key:0,class:"explosion-prompt-info"},Zn={key:1,class:"explosion-prompt-info"},$n={class:"explosion-diagram-item"},Jn={key:0,class:"explosion-name"},Qn=["onClick"],qn={class:"explosion-image"},Kn=["src"];var el=oe({__name:"explosionDiagram",props:{data:{type:Array,default:()=>[]},widthPrompt:{type:Boolean,default:()=>!1},explosionStyle:{type:Object,default:()=>({width:"5rem",height:"7rem"})}},setup(e,{expose:t}){const a=e,s=n(null),o=n(null),u=n(null),f=n(null),w=n(null),b=n(""),k={COMMENCE:"commence",INCORPORATION:"incorporation"},E=n(k.INCORPORATION),D=e=>{k.hasOwnProperty(e)||"CHANGE"===e?(o.value=null,"CHANGE"===e?E.value===k.COMMENCE?E.value=k.INCORPORATION:E.value=k.COMMENCE:E.value=k[e]):U.error("非法参数")},x=e=>E.value===k.COMMENCE?Object.assign({left:2*e-a.data.length+"rem",top:-.5*e+.5+"rem",zIndex:a.data.length-e-1},a.explosionStyle):Object.assign({left:"0rem",top:"0rem",transform:"skewY(0deg)",zIndex:a.data.length-e-1,backgroundColor:e===a.data.length-1?"var(--t-sub-color)":"transparent"},a.explosionStyle),T=e=>u.value===e?{hiding:!0}:f.value===e?{showing:!0}:s.value===e?{show:!0}:s.value!==e?{hide:!0}:void 0;return l((()=>{a.data.length&&(s.value=0),setTimeout((()=>{D("COMMENCE")}))})),t({changeExplosionType:D}),(t,n)=>{const l=R("el-icon"),S=R("t-button");return d(),i("div",{class:"explosion-diagram-body",style:r({paddingTop:(E.value,k.COMMENCE,0)+"rem"})},[m("div",{class:"explosion-all",style:r(a.explosionStyle)},[(d(!0),i(_,null,L(a.data,((t,I)=>(d(),i(_,null,[o.value===I||E.value===k.COMMENCE||!o.value&&0!==o.value&&E.value===k.INCORPORATION?(d(),i("div",{class:p(["explosion-item",{selected:E.value===k.COMMENCE&&s.value===I}]),key:t.uuid,onClick:e=>(e=>new Promise((t=>{E.value===k.COMMENCE&&s.value!==e?(w.value=null,null!==s.value&&(u.value=s.value),f.value=e,setTimeout((()=>{s.value=f.value,f.value=null})),setTimeout((()=>{u.value=null,t()}),200)):t()})))(I),style:r(x(I))},[E.value===k.COMMENCE||null!==o.value?(d(),i("div",{key:0,class:p(["explosion-diagram-handle-area",Object.assign(T(I),{nomal:null!==o.value})])},[e.widthPrompt?(d(),i("div",Bn)):c("",!0),e.widthPrompt?(d(),i("div",{key:1,class:"explosion-line-2",style:r({width:1.5*(E.value===k.COMMENCE||null===o.value?a.data.length-I:1)+"rem"})},null,4)):c("",!0),e.widthPrompt?(d(),i("div",{key:2,class:"explosion-prompt-area",style:r({left:1.5*(E.value===k.COMMENCE||null===o.value?a.data.length-I:1)+1+"rem"})},[m("div",Yn,[m("div",Xn,[C(A(t.name)+" ",1),m("div",Wn,[g(l,{class:"explosion-prompt-edit-item",onClick:v((e=>(e=>{b.value=a.data[e].prompt,w.value=e})(I)),["stop"])},{default:h((()=>[g(y(Y))])),_:2},1032,["onClick"])])]),w.value!==I?(d(),i("div",Fn,A(t.prompt),1)):c("",!0),w.value===I?(d(),i("div",Zn,[X(m("textarea",{"onUpdate:modelValue":n[0]||(n[0]=e=>b.value=e)},null,512),[[W,b.value]])])):c("",!0),m("div",{class:"explosion-prompt-save-handle-area",style:r({height:w.value===I?"0.8rem":"0rem"})},[g(S,{type:"info",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"},onClick:n[1]||(n[1]=e=>w.value=null)},{default:h((()=>[C("取消")])),_:1}),g(S,{type:"success",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"}},{default:h((()=>[C("生成")])),_:1})],4)])],4)):c("",!0)],2)):c("",!0),m("div",$n,[E.value===k.COMMENCE?(d(),i("div",Jn,A(t.name),1)):c("",!0),null!==o.value||E.value===k.COMMENCE?(d(),i("div",{key:1,class:"show-explosion-item-handle-btn",onClick:v((e=>(e=>{null===o.value&&E.value===k.COMMENCE?(D("INCORPORATION"),o.value=e):null!==o.value&&(D("COMMENCE"),o.value=null),s.value=e})(I)),["stop"]),style:r({top:(E.value===k.COMMENCE?"1.2":"0.2")+"rem"})},A(null!==o.value?"隐藏":"展示"),13,Qn)):c("",!0),m("div",qn,[m("img",{src:t.image},null,8,Kn)])])],14,Vn)):c("",!0)],64)))),256))],4)],4)}}},[["__scopeId","data-v-ae7efb16"]]);const tl={class:"model-draw-board"},al={key:0,class:"model-draw-area"},sl={class:"model-handle-area"};var nl=oe({__name:"modelDrawBoard",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]},layerData:{},editorType:{}},emits:["setTypeList","setGroupList","setSelectedElement","layerData"],setup(e,{expose:t,emit:a}){const s=e,o=a,r=n(null),u=n(null),h=n(null),p=n(null),v=n(null),f=n(null),w=n(null);n("editor");const b=n([]),k=n({width:0,height:0}),E=n(null),C=n(xa),D=n(Da),x=n(Ca);n(Object.assign({name:s.setting.name},s.setting.canvasData));const T=n(null),S=()=>{k.value={width:C.value.realWidth*C.value.zoomRatio*.8+"px",height:C.value.realHeight*C.value.zoomRatio*.8+"px"},C.value.viewType===Mt?(C.value.setViewType(Rt),I()):(p.value.changeExplosionType("INCORPORATION"),C.value.setViewType(Mt),I())},I=async()=>{b.value=await x.value.getLayerImage()},A=e=>{T.value=E.value.changeHandleType(e)},L=()=>{u.value.show()},_=()=>{E.value.exportImage()},M=e=>{w.value.init(e)},R=async()=>{const e=["groups","layers","elements"];for(let t of e)for(let e in s.layerData[t]){const a=s.layerData[t][e];if(a.image){const e=await Zt(a.image);a.image=e}if("texts"===a.type&&a.fontSetting&&a.fontSetting.font){const e=await ua(a.fontSetting.font);a.fontSetting.fontFamily=e}D.value.add(t.slice(0,-1),a.parentUuid,a.name,a,e)}},O=(e=null)=>{e=e||E.value.setTypeList();const t=Object.keys(e).map((t=>({uuid:t,name:e[t].name,image:e[t].image,loraInfo:e[t].loraInfo,layerInfo:e[t].layerInfo})));o("setTypeList",t)},P=e=>{o("setGroupList",e)},N=(...e)=>{v.value.init(...e)},U=(e,t,a)=>{const s=He();Zt(e).then((e=>{E.value.elementsList[t].setImage(e),E.value.reDraw(),s.close()}))},G=e=>{const{uuid:t}=e;delete e.uuid,t||E.value.addType({name:e.name,prompts:e.prompts,statics:e.statics,image:e.image}).then((e=>{O(e)}))},H=()=>{D.value.clearAllData(),x.value.toTextEditView=M,x.value.toImageGenerateView=N,x.value.generationController.setName(s.setting.name),C.value.init(r.value,s.setting,s.editorType).then((()=>{R().then((()=>{x.value.reDraw()}))}))};return l((()=>{H()})),t({toSettingLayer:(...e)=>{h.value.show(...e)},setSelectedLayer:(...e)=>{E.value.setTypeUuid(...e)},deleteGroup:e=>{E.value.deleteGroup(e)},deleteLayer:e=>{E.value.deleteType(e).then((({typeList:e,groups:t})=>{P(t),O(e)}))},deleteElement:e=>{E.value.deleteElement(e),O(typeList)},setGroup:e=>{const{layerUuids:t,groupUuid:a}=e;if(a){if(1===t.length&&a){const e=E.value.getGroupItem(a).layers.concat(t),s=E.value.updateGroup(a,{layers:[...new Set(e)]});P(s)}}else f.value.show(null,"group",e)},hideLayer:e=>{E.value.setHideLayer(e),new Promise((e=>{E.value.getAllLayerImage().then((t=>{b.value=Object.keys(t).map((e=>Object.assign({uuid:e,imageSrc:t[e].imageBase64},t[e]))).reverse(),e()}))}))},setDiagramImage:I}),(e,t)=>(d(),i("div",tl,[X(m("div",{class:"model-draw-area",ref_key:"modelEditorDom",ref:r,tabindex:"0"},null,512),[[F,"editor"===y(xa).viewType]]),"explosion"===y(xa).viewType?(d(),i("div",al,[g(el,{explosionStyle:k.value,data:b.value,ref_key:"explosionDiagramDom",ref:p},null,8,["explosionStyle","data"])])):c("",!0),m("div",sl,[g(vs,{handleType:T.value,onToCanvasSetting:L,onChangeHandleType:A,onExportImage:_,onChangeViewType:S,onToGenrateGroup:e.toGenrateGroup,editorType:s.editorType},null,8,["handleType","onToGenrateGroup","editorType"])]),g(Ls,{ref_key:"editorDrawBoardSettingDom",ref:u,editorType:s.editorType,onSave:e.canvasResize},null,8,["editorType","onSave"]),g(sn,{ref_key:"editorLayerSettingDom",ref:h,staticsList:s.staticsList,promptsList:s.promptsList,colorsList:s.colorsList,textsList:s.textsList,onSave:G,onSaveGroup:e.saveGroup},null,8,["staticsList","promptsList","colorsList","textsList","onSaveGroup"]),g(Dn,{onReplaceImage:U,ref_key:"imageGenerateDom",ref:v},null,512),g(zn,{ref_key:"editorTextSettingDom",ref:w},null,512)]))}},[["__scopeId","data-v-9b575128"]]);const ll={class:"model-editor"};var il={tButton:Ct,tTag:Dt,tMask:re,modelCard:It,modelEditor:oe({__name:"index",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]},layerData:{},editorType:{}},setup(e){n(Da);const t=e,a=n(null),s=n(null),l=n([]),o=n([]),r=e=>{l.value=e},c=(...e)=>{a.value.setSelectedLayer(...e)},u=e=>{o.value=e},h=(...e)=>{a.value.toSettingLayer(...e)},m=e=>{a.value.deleteGroup(e)},p=e=>{a.value.deleteLayer(e)},v=e=>{a.value.deleteElement(e)},y=e=>{a.value.setGroup(e)},f=e=>{a.value.hideLayer(e)},w=(...e)=>{a.value.reGenerateGroup(...e)},b=(...e)=>{a.value.reGenerateLayer(...e)},k=(...e)=>{a.value.reGenerateElement(...e)},E=(...e)=>{s.value.setSelectedElement(...e)},C=()=>{a.value.setDiagramImage()};return(e,n)=>(d(),i("div",ll,[g(nl,{staticsList:t.staticsList,promptsList:t.promptsList,colorsList:t.colorsList,textsList:t.textsList,ref_key:"modelDrawBoardDom",ref:a,onSetTypeList:r,onSetGroupList:u,onSetSelectedElement:E,setting:t.setting,editorType:t.editorType,layerData:t.layerData},null,8,["staticsList","promptsList","colorsList","textsList","setting","editorType","layerData"]),g(os,{ref_key:"editorLayersDom",ref:s,typeList:l.value,groupList:o.value,onToLayerInfo:h,onSetSelectedLayer:c,onDeleteGroup:m,onDeleteLayer:p,onDeleteElement:v,onSetGroup:y,onHideLayer:f,onReGenerateGroup:w,onReGenerateLayer:b,onReGenerateElement:k,onSetDiagramImage:C,editorType:t.editorType},null,8,["typeList","groupList","editorType"])]))}},[["__scopeId","data-v-a26723b0"]])};const ol=Z(bt);ol.use(G()),ol.use(dt),ol.use($,{locale:J}),ol.use(Q,{Options:{url:"data-source",inline:!0,button:!0,transition:!0}}),Object.keys(il).forEach((e=>{ol.component(e,il[e])})),ol.mount("#app");export{He as T,oe as _,nt as a,Qt as b,fe as c,it as d,Da as e,st as g,Jt as r,lt as s};
