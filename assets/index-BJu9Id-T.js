import{T as e}from"./TLoading-1V5YRPnT.js";import{r as a,x as t,J as l,o as n,j as s,k as r,m as o,n as i,p as d,w as u,F as c,A as p,u as v,B as y,D as m,y as g,H as _,I as k,C as f,L as w,R as b,S as h,v as j,E as x}from"./lib-CKDAqxUM.js";import{a as D,r as S,j as C}from"./file-BA4XvZMH.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{u as O,r as J}from"./index-CKTHfneF.js";import{s as I,u as E,a as N}from"./promptSetting-DLGAHKTX.js";import{n as T}from"./index-ozdrtwfE.js";/* empty css                                                                 */const q={class:"resoure-data-body"},z={class:"data-area"},R={class:"name"},F={class:"data-content-area"},L={class:"data-content-box"},P={key:1,class:"data-content-colors"},$={class:"data-content-colors-info"},A={class:"data-image-area"},B=["src"],H=U({__name:"resourceData",props:["type","data"],emits:["review"],setup(e,{expose:f,emit:w}){const b=e,h=w,j=a({});t(b,"data");const x=b.type,C=()=>{h("review",j.value.cloud_folder,j.value.colors)};l(j,(()=>{C()}),{deep:!0}),l(j.value.colors,(()=>{C()}));const U={prompts:[{name:"资源描述",type:"string",key:"description"},{name:"关键词语",type:"arr",key:"keywords"},{name:"触发词语",type:"string",key:"trigger"},{name:"资源权重",type:"string",key:"server_type"},{name:"资源地址",type:"string",key:"cloud_folder"},{name:"预览图地址",type:"string",key:"preview"},{name:"lora",type:"string",key:"lora"}],statics:[{name:"资源描述",type:"string",key:"description"},{name:"关键词语",type:"arr",key:"keywords"},{name:"资源文件夹",type:"string",key:"cloud_folder"},{name:"预览图地址",type:"string",key:"preview"}],texts:[{name:"资源描述",type:"string",key:"description"},{name:"关键词语",type:"arr",key:"keywords"},{name:"字体地址",type:"string",key:"font"},{name:"资源路径",type:"string",key:"cloud_folder"},{name:"字体大小",type:"string",key:"font_size"},{name:"字体颜色",type:"color",key:"font_color"}],colors:[{name:"资源描述",type:"string",key:"description"},{name:"关键词语",type:"arr",key:"keywords"},{name:"调色板",type:"colors",key:"colors"}]};return n((()=>{U[x].forEach((({key:e,type:a})=>{"arr"===a?j.value[e]=b.data[e]?b.data[e].join(","):"":"string"===a?j.value[e]=b.data[e]:"color"===a?j.value[e]=D(b.data[e]):"colors"===a&&(b.data[e]&&(j.value[e]=b.data[e].map((e=>({color:D(e.color),description:e.description})))),j.value[e]&&j.value[e].length||(j.value[e]=[{color:"rgba(0,0,0,0)",description:""}]))})),j.value.resource_name=b.data.resource_name,j.value.preview=b.data.preview})),f({getSaveData:()=>{let e={};return U[x].forEach((({key:a,type:t})=>{"arr"===t?e[a]=j.value[a].split(","):"string"===t?e[a]=j.value[a]:"color"===t?e[a]=S(j.value[a]):"colors"===t&&(e[a]=j.value[a].map((e=>({color:S(e.color),description:e.description}))))})),e.resource_name=j.value.resource_name,e.preview=j.value.preview,e}}),(e,a)=>{const t=s("n-input"),l=s("n-color-picker"),n=s("n-button"),f=s("n-scrollbar");return r(),o("div",q,[i("div",z,[i("div",R,[d(t,{style:{"--n-padding-left":"0px !important","--n-font-size":"0.833rem !important"},placeholder:"请输入名称",class:"data-content-input editor-setting-input",value:j.value.resource_name,"onUpdate:value":a[0]||(a[0]=e=>j.value.resource_name=e)},null,8,["value"])]),i("div",F,[i("div",L,[d(f,null,{default:u((()=>[(r(!0),o(c,null,p(U[v(x)],(e=>(r(),o("div",{class:"data-content-item",key:e.name},[i("label",null,y(e.name),1),"color"===e.type?(r(),m(l,{key:0,value:j.value[e.key],"onUpdate:value":a=>j.value[e.key]=a},null,8,["value","onUpdate:value"])):"colors"===e.type?(r(),o("div",P,[i("div",$,[(r(!0),o(c,null,p(j.value[e.key],((s,i)=>(r(),o("div",{class:"data-content-colors-item",key:i},[d(l,{modes:["rgb"],"render-label":()=>"",value:j.value[e.key][i].color,"onUpdate:value":a=>j.value[e.key][i].color=a,style:{width:"0.9rem",color:"transparent","margin-right":"0.2rem"}},null,8,["value","onUpdate:value"]),d(t,{class:"data-content-input editor-setting-input",style:{flex:"1"},value:j.value[e.key][i].description,"onUpdate:value":a=>j.value[e.key][i].description=a},null,8,["value","onUpdate:value"]),i===j.value[e.key].length-1?(r(),m(n,{key:0,strong:"",secondary:"",type:"success",style:{width:"1rem","margin-left":"0.5rem"},onClick:a=>j.value[e.key].push({color:"rgba(255,255,255,1)",description:""})},{default:u((()=>a[1]||(a[1]=[g("+")]))),_:2},1032,["onClick"])):_("",!0)])))),128))])])):(r(),m(t,{key:2,class:"data-content-input editor-setting-input",value:j.value[e.key],"onUpdate:value":[a=>j.value[e.key]=a,C]},null,8,["value","onUpdate:value"]))])))),128))])),_:1})])])]),i("div",A,["colors"!==v(x)?(r(),o("img",{key:0,src:j.value.preview},null,8,B)):(r(),o("div",{key:1,class:"color-view",style:k({backgroundColor:j.value.colors&&j.value.colors[0]?j.value.colors[0].color:"rgba(0,0,0,0)"})},null,4))])])}}},[["__scopeId","data-v-cae7e734"]]),G=U({__name:"dataCard",props:{data:{type:Object,default:()=>({preview:null,name:null})},type:{default:"image"}},setup(e){const{publicStore:l}=O(),n=t(l,"isCarryOut"),i=e,d=a([]),u=a(!0),c=a("imageDom"),p=()=>{d.value=[]};return(a,t)=>{const l=s("n-image");return r(),o("div",{class:f(["data-item",{expand:!n.value}])},[u.value&&"image"===e.type?(r(),m(l,{key:0,ref_key:"imageDom",ref:c,width:"100%","object-fit":"cover","preview-disabled":"",onClose:p,"preview-src-list":d.value,src:i.data.preview,class:"model-image",fit:"contain"},null,8,["preview-src-list","src"])):_("",!0),"color"===e.type?(r(),o("div",{key:1,class:"color-view",style:k({backgroundColor:e.data.preview})},null,4)):_("",!0)],2)}}},[["__scopeId","data-v-930bc3ba"]]);const K={class:"image-card"},M={class:"image-area"},Q={class:"prompts cn"},V={class:"prompts en"},W=U({__name:"imagePreview",props:["to"],setup(e,{expose:t}){w();const l=a(!1),n=a(null),o=w(),c=a(null),p=a(null);const g=async e=>{try{await async function(){try{const e=await navigator.permissions.query({name:"clipboard-write"});return"granted"===e.state||"prompt"===e.state}catch(e){return!1}}(),await navigator.clipboard.writeText(e),o.success("复制成功")}catch(a){o.error(`复制失败: ${String(a)}`)}};return t({init:e=>{n.value=e.file_path,c.value=e.prompt_cn,p.value=e.prompt_en,l.value=!0}}),(e,a)=>{const t=s("n-image"),o=s("n-button"),_=s("n-modal");return r(),m(_,{show:l.value,"onUpdate:show":a[2]||(a[2]=e=>l.value=e),"auto-focus":!0},{default:u((()=>[i("div",K,[i("div",M,[d(t,{src:n.value,width:"100%",class:"image","object-fit":"cover","preview-disabled":""},null,8,["src"])]),i("div",Q,[d(o,{text:"",class:"copy-btn",onClick:a[0]||(a[0]=e=>g(c.value))},{default:u((()=>[i("i",{class:f(["bi",v(T)])},null,2)])),_:1}),i("div",null,[a[3]||(a[3]=i("label",null,"中文prompt",-1)),i("span",null,y(c.value),1)])]),i("div",V,[d(o,{text:"",class:"copy-btn",onClick:a[1]||(a[1]=e=>g(p.value))},{default:u((()=>[i("i",{class:f(["bi",v(T)])},null,2)])),_:1}),i("div",null,[a[4]||(a[4]=i("label",null,"英文prompt",-1)),i("span",null,y(p.value),1)])])])])),_:1},8,["show"])}}},[["__scopeId","data-v-e8cd0623"]]),X={class:"resoure-data-body"},Y={class:"resoure-data-title"},Z={class:"data-area"},ee={class:"name"},ae={class:"data-content-area"},te={class:"data-content-box"},le={class:"data-image-area"},ne=["src"],se={class:"json-input"},re={class:"json-code"},oe=U({__name:"resourceJsonData",props:["type","data"],setup(e,{expose:l}){const m=w();b.registerLanguage("json",h);const g=e,_=t(g,"data"),k=g.type;a('{\n  "a":12346,\n  "b":"text"\n}');const f={designs:[{name:"预览图地址",type:"string",key:"preview"}]};return n((()=>{f[k].forEach((({key:e,type:a})=>{"string"===a&&(_.value[e]=g.data[e])})),_.value.preview=g.data.preview})),l({getSaveData:()=>{let e=null;try{e=JSON.parse(JSON.stringify(_.value)),e.data=JSON.parse(e.data)}catch(a){throw m.error("json格式错误"),new Error("json格式错误")}return e}}),(e,a)=>{const t=s("n-input"),l=s("n-scrollbar"),n=s("n-code"),m=s("n-config-provider");return r(),o("div",X,[i("div",Y,[i("div",Z,[i("div",ee,[d(t,{style:{"--n-padding-left":"0px !important","--n-font-size":"0.833rem !important"},placeholder:"请输入名称",class:"data-content-input editor-setting-input",value:_.value.resource_name,"onUpdate:value":a[0]||(a[0]=e=>_.value.resource_name=e)},null,8,["value"])]),i("div",ae,[i("div",te,[d(l,null,{default:u((()=>[(r(!0),o(c,null,p(f[v(k)],(a=>(r(),o("div",{class:"data-content-item",key:a.name},[i("label",null,y(a.name),1),d(t,{class:"data-content-input editor-setting-input",value:_.value[a.key],"onUpdate:value":[e=>_.value[a.key]=e,e.review]},null,8,["value","onUpdate:value"])])))),128))])),_:1})])])]),i("div",le,[i("img",{src:_.value.preview},null,8,ne)])]),i("div",se,[d(t,{rows:10,type:"textarea",value:_.value.data,"onUpdate:value":a[1]||(a[1]=e=>_.value.data=e)},null,8,["value"])]),i("div",re,[d(m,{hljs:v(b)},{default:u((()=>[d(n,{"show-line-numbers":"",code:_.value.data,language:"json"},null,8,["code"])])),_:1},8,["hljs"])])])}}},[["__scopeId","data-v-dc6ea4c0"]]),ie={class:"resoure-data-body"},de={class:"json-input"},ue={class:"json-code"},ce=U({__name:"demandJsonData",props:["type","data"],setup(e,{expose:l}){const n=w();b.registerLanguage("json",h);const c=e,p=t(c,"data");c.type,a('{\n  "a":12346,\n  "b":"text"\n}');return l({getSaveData:()=>{let e=null;try{e=JSON.parse(p.value.data)}catch(a){throw n.error("json格式错误"),new Error("json格式错误")}return e}}),(e,a)=>{const t=s("n-input"),l=s("n-code"),n=s("n-config-provider");return r(),o("div",ie,[i("div",de,[d(t,{rows:10,type:"textarea",value:p.value.data,"onUpdate:value":a[0]||(a[0]=e=>p.value.data=e)},null,8,["value"])]),i("div",ue,[d(n,{hljs:v(b)},{default:u((()=>[d(l,{"show-line-numbers":"",code:p.value.data,language:"json"},null,8,["code"])])),_:1},8,["hljs"])])])}}},[["__scopeId","data-v-bffe53cb"]]);function pe(e){return J.post("/oplus/query_cloud_folder",e)}const ve={class:"resoure-info-body"},ye={class:"resoure-info-title"},me={class:"data-area"},ge={key:3,class:"empty-block"},_e=U({__name:"index",setup(t){const l=w();j();const g=x(),k=g.query.type,f={prompts:"动态资源",statics:"静态资源",texts:"文字资源",colors:"调色板资源",designs:"设计理念",demand:"需求分析"},b=a(null),h=a(null),D=a(null),S=a(null);let U=g.query.id;const O=a({}),T=a({}),q=a({}),z=()=>{let e=null;"designs"!==k?(e=h.value.getSaveData(),e=Object.assign(e,q.value)):e=D.value.getSaveData(),e.resource_type=k;const a=C("designs"!==k?e:e.data,e.resource_name),t=new FormData;t.append("file",a),I(e,t).then((e=>{200===e.code&&l.success("保存成功")}))},R=()=>{let e=null;if("demand"===k){e=S.value.getSaveData();const a=C(e,"update"),t=new FormData;t.append("file",a),function({artwork_id:e},a){return J.post(`/oplus/update_demand?artwork_id=${e}`,a,{headers:{"Content-Type":"multipart/form-data"}})}({artwork_id:U},t).then((e=>{200===e.code&&l.success("保存成功")}))}else{"designs"!==k?(e=h.value.getSaveData(),e=Object.assign(q.value,e)):(e=D.value.getSaveData(),e=Object.assign(q.value,e)),e.resource_id=U,e.resource_type=k;const a=C("designs"!==k?e:e.data,e.resource_name),t=new FormData;t.append("file",a),E(e,t).then((e=>{200===e.code&&l.success("保存成功")}))}},F=()=>{var e;U&&("demand"===k?(e={artwork_id:U},J.post("/oplus/query_demand",e)).then((e=>{T.value={data:JSON.stringify(e.data,null,2)}})):N(U).then((e=>{if(200===e.code){if("designs"===k)T.value={preview:e.info.preview,data:JSON.stringify(e.data,null,2)};else{const a=e.data;a.preview=e.info.preview,T.value=a}q.value=e.info,T.value.resource_name=e.info.resource_name,e.data.cloud_folder&&pe({folder_path:e.data.cloud_folder,page:1,page_size:1e5}).then((e=>{O.value=e.data}))}})))},L=(e,a)=>{e&&pe({folder_path:e,page:1,page_size:1e5}).then((e=>{O.value=e.data})),a&&(O.value=a)};return n((()=>{F(),window.loading||(window.loading=e()),setTimeout((()=>{window.loading&&(window.loading.close(),window.loading=null)}),300)})),(e,a)=>{const t=s("n-scrollbar");return r(),o("div",ve,[i("div",ye,[i("div",null,[i("label",{onClick:a[0]||(a[0]=e=>{window.history.back()})},y(f[v(k)]),1)]),i("div",{class:"save-btn",onClick:a[1]||(a[1]=e=>{U?R():z()})},"保存资料")]),i("div",me,[d(t,null,{default:u((()=>["demand"===v(k)?(r(),m(ce,{key:0,ref_key:"demandJsonDataRef",ref:S,type:v(k),data:T.value},null,8,["type","data"])):_("",!0),"designs"===v(k)?(r(),m(oe,{key:1,ref_key:"resourceJsonDataRef",ref:D,type:v(k),data:T.value},null,8,["type","data"])):_("",!0),"designs"===v(k)||"demand"===v(k)||!Object.keys(T.value).length&&v(U)?_("",!0):(r(),m(H,{key:2,ref_key:"resourceDataRef",ref:h,type:v(k),data:T.value,onReview:L},null,8,["type","data"])),"designs"!==v(k)?(r(),o("div",ge)):_("",!0),"designs"!==v(k)&&"colors"!==v(k)&&"demand"!==v(k)?(r(!0),o(c,{key:4},p(O.value,(e=>(r(),m(G,{key:e.template_id,onClick:a=>{return t=e,void b.value.init(t);var t},data:{name:e.template_name,preview:e.thumbnail}},null,8,["onClick","data"])))),128)):_("",!0),"colors"===v(k)?(r(!0),o(c,{key:5},p(O.value,((e,a)=>(r(),m(G,{key:a,type:"color",data:{name:e.description,preview:e.color}},null,8,["data"])))),128)):_("",!0)])),_:1})]),d(W,{ref_key:"imagePreviewDom",ref:b},null,512)])}}},[["__scopeId","data-v-faea6bdd"]]);export{_e as default};
