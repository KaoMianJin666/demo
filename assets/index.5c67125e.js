var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{d as s,C as a,r as i,o as l,c as n,a as o,n as r,b as d,e as u,f as h,w as c,g as m,h as p,i as v,j as y,u as g,E as f,k as w,l as b,m as k,p as T,q as L,s as E,t as S,v as C,x as _,y as x,z as I,F as P,A as D,B as O,D as U,G as M,H as A,I as G,J as N,K as j,L as R,M as H,N as B,O as $,P as Y,Q as X,R as V,S as W,T as z,U as F,V as J,W as q,X as K,Y as Z,Z as Q,_ as ee,$ as te,a0 as se,a1 as ae,a2 as ie}from"./lib.a58a7bed.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const le={},ne=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in le)return;le[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())):e()};const oe=s({id:"public",state:()=>({rootDom:null,colorScheme:null,leftBarShowType:0}),getters:{getRootDom(){return this.rootDom},getColorScheme(){return this.colorScheme},getLeftBarShowType(){return this.leftBarShowType}},actions:{setRootDom(e){this.rootDom=e},setLeftBarShowType(e){this.leftBarShowType=e},setColorScheme(e){return new Promise((t=>{(e=(e=e||localStorage.getItem("colorScheme"))||"light")&&function(e){switch(e){case"../../assets/style/dark.scss":return ne((()=>Promise.resolve({})),["assets/dark.f70622eb.css"]);case"../../assets/style/global.scss":return ne((()=>Promise.resolve({})),["assets/global.13cfefb9.css"]);case"../../assets/style/light.scss":return ne((()=>Promise.resolve({})),["assets/light.25455dc6.css"]);case"../../assets/style/style.scss":return ne((()=>import("./style.0f4827d1.js")),[]);default:return new Promise((function(t,s){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`../../assets/style/${e}.scss`).then((s=>{this.colorScheme&&this.removeTheme(this.colorScheme);const a=document.createElement("style");a.id=`theme-${e}`,a.innerText=s.default,document.head.appendChild(a),this.colorScheme=e,localStorage.setItem("colorScheme",this.colorScheme),document.documentElement.className=this.colorScheme,t()}))}))},removeTheme(e){const t=document.getElementById(`theme-${e}`);t&&t.parentNode.removeChild(t)}}});var re=Object.freeze(Object.defineProperty({__proto__:null,usePublicStore:oe,setupStore:function(e){return oe(e)}},Symbol.toStringTag,{value:"Module"}));const de="_AICLOTH_CONSOLE_",ue="_AICLOTH_CONSOLE__token";function he(){const e=localStorage.getItem(de+"USER");return e&&"undefined"!==e?JSON.parse(e):null}function ce(e){localStorage.setItem(de+"USER",JSON.stringify(e))}function me(){const e=a.get(ue);return""!==e||void 0!==e||null!==e?e:null}var pe=(e,t)=>{const s=e.__vccOpts||e;for(const[a,i]of t)s[a]=i;return s};var ve=pe({__name:"tMask",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!1},destroy:{type:Function},close:{type:Function}},emits:["close"],setup(e,{expose:t,emit:s}){const a=i(!0),h=i(!1),c=e,m=()=>{c.maskClickHide&&(c.close?c.close():p())},p=()=>{h.value&&(h.value=!1,setTimeout((()=>{a.value=!1,c.destroy&&c.destroy()}),200))},v=()=>{a.value=!0,setTimeout((()=>{h.value=!0}))};return l((()=>{v()})),t({hide:p,show:v}),(e,t)=>a.value?(u(),n("div",{key:0,class:"mask",style:r({backgroundColor:c.bgColor,opacity:Number(h.value)}),onClick:m},[o(e.$slots,"default",{},void 0,!0)],4)):d("",!0)}},[["__scopeId","data-v-1477fffe"]]);const ye=e=>(E("data-v-5bef5db2"),e=e(),S(),e),ge=ye((()=>m("div",{class:"logo-area"},"Tart",-1))),fe={class:"input-area"},we={class:"input-area"},be=ye((()=>m("div",{class:"user-agreements-area"}," 用户协议 用户协议 ",-1))),ke={class:"login-btn-area"};var Te=pe({__name:"loginBox",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!0},destroy:{type:Function}},setup(e){const{userStore:t}=wt(),s=e,a=i("tMaskDom"),n=i(null),o=i(null),r=i(!1),d=()=>(r.value=!1,setTimeout((()=>{a.value.hide()}),400),!0),E=()=>{t.handleLogin({username:n.value}).then((()=>{location.reload(),d()}))};return l((()=>{n.value=null,o.value=null,setTimeout((()=>{r.value=!0}),200)})),(e,t)=>(u(),h(ve,{ref_key:"tMaskDom",ref:a,bgColor:s.bgColor,maskClickHide:s.maskClickHide,destroy:s.destroy,close:d},{default:c((()=>[m("div",{class:p(["login-box",{animated:r.value}]),onClick:t[2]||(t[2]=v((()=>{}),["stop"]))},[ge,m("div",fe,[y(g(f),{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),class:"login-box-input"},{prepend:c((()=>[m("div",null,[y(g(w),{class:"input-icon"},{default:c((()=>[y(g(b))])),_:1})])])),_:1},8,["modelValue"])]),m("div",we,[y(g(f),{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),class:"login-box-input",type:"password","show-password":""},{prepend:c((()=>[m("div",null,[y(g(w),{class:"input-icon"},{default:c((()=>[y(g(k))])),_:1})])])),_:1},8,["modelValue"])]),be,m("div",ke,[y(g(T),{onClick:E},{default:c((()=>[L("登录")])),_:1})])],2)])),_:1},8,["bgColor","maskClickHide","destroy"]))}},[["__scopeId","data-v-5bef5db2"]]);let Le=!1,Ee=null;const Se=e=>{e=Object.assign({maskClickHide:!0},e);const t=me();return new Promise((s=>{t?s():(e=>{const{publicStore:t}=wt(),s=t.rootDom;let a=document.createElement("div");s.appendChild(a),Le&&(Ee&&C(null,a),Le=!1),Object.assign(e,{destroy:()=>{Ee&&(C(null,a),s.removeChild(a)),Le=!1}}),Ee=y(Te,Object.assign({isShow:!0},e)),C(Ee,a),Le=!0})(e)}))};const Ce=e=>(E("data-v-175c64ed"),e=e(),S(),e),_e={class:"nav-bar-body"},xe=Ce((()=>m("div",{class:"logo-area"}," Teart ",-1))),Ie=Ce((()=>m("div",{class:"router-link-area"},null,-1))),Pe={class:"handle-area"},De={class:"user-phone-no"},Oe={class:"user-profile-image"},Ue=[Ce((()=>m("span",null,"退出",-1)))],Me=[Ce((()=>m("span",null,"登录",-1)))];var Ae=pe({__name:"navBar",setup(e){const{userStore:t,publicStore:s}=wt();_(),x(),i([]),i("ImageGenerationImage"),i(""),i(!1);const a=i(!1),o=()=>{t.handleLogout().then((()=>{}))};return l((()=>{s.setColorScheme().then((()=>{a.value="dark"===s.colorScheme}))})),(e,s)=>(u(),n("div",_e,[xe,Ie,m("div",Pe,[m("div",De,I(g(t).token?g(t).user:null),1),m("div",{class:"line",style:r({opacity:Number(Boolean(g(t).token))})},null,4),m("div",Oe,[g(t).token?(u(),n("img",{key:0,src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})):d("",!0)]),g(t).token?(u(),n("div",{key:0,class:"logout-btn",onClick:o},Ue)):d("",!0),g(t).token?d("",!0):(u(),n("div",{key:1,class:"logout-btn",onClick:s[0]||(s[0]=e=>Se())},Me))])]))}},[["__scopeId","data-v-175c64ed"]]);const Ge={class:"loading-body"},Ne={class:"loading-animation-area"},je={class:"rainbow-text"};var Re=pe({__name:"tToading",setup(e,{expose:t}){const s=i(!1),a=i(!1),o=Array(8).fill("🌿");l((()=>{setTimeout((()=>{document.getElementById("main-inner").style.display="none",s.value=!0,setTimeout((()=>{a.value||(a.value=!0,document.getElementById("main-inner").style.display="block")}),300)}))}));return t({close:()=>(a.value=!1,new Promise((e=>{setTimeout((()=>{s.value=!1,setTimeout((()=>{e()}),300)}),300)})))}),(e,t)=>(u(),n("div",Ge,[m("div",Ne,[m("div",{class:p(["loading-left",{animate:s.value}])},null,2),m("div",{class:p(["loading-top",{animate:s.value}])},null,2),m("div",{class:p(["loading-right",{animate:s.value}])},null,2),m("div",{class:p(["loading-bottom",{animate:s.value}])},null,2)]),m("div",{class:"loading-inner",style:r({opacity:Number(a.value)})},[m("div",je,[(u(!0),n(P,null,D(g(o),((e,t)=>(u(),n("span",{key:t,style:r({animationDelay:t/8+"s"})},I(e),5)))),128))])],4)]))}},[["__scopeId","data-v-9910698c"]]);const He=e=>{let t=!1,s=null;const{publicStore:a}=wt(),i=a.rootDom;let l=document.createElement("div");return i.appendChild(l),t&&(s&&C(null,l),t=!1),s=y(Re,e),C(s,l),t=!0,{close:()=>{t&&s&&s.component.setupState.close().then((()=>{C(null,l),i.removeChild(l),s=null,t=!1}))}}};const Be={class:"menu-icon"},$e=(e=>(E("data-v-4ed28d5c"),e=e(),S(),e))((()=>m("div",{class:"menu-name"},"收起面板",-1))),Ye={class:"menu-all"},Xe=["onClick"],Ve={class:"menu-icon"},We={class:"menu-name"};var ze=pe({__name:"leftBar",setup(e){const{publicStore:t}=wt(),s=x(),a=_(),o=i([]),r=i(null),d=i(0);l((()=>{r.value=s.path,o.value=[{path:"/main",name:"模板仓库",includes:["/main","/modelEditor","/generateImage"],icon:O},{path:"/modelMainEditor",name:"模板编辑",includes:["/modelMainEditor"],icon:U},{path:"/promptSetting",name:"参数设置",includes:["/promptSetting"],icon:M},{path:"/gallery",name:"作品仓库",includes:["/gallery"],icon:A}]}));const v=(e=[])=>e.findIndex((e=>e===r.value));return(e,i)=>{const l=G("el-icon");return u(),n("div",{class:p(["left-bar-body",{expand:d.value}])},[m("div",{class:"menu-title",onClick:i[0]||(i[0]=e=>(d.value=Number(!d.value),void t.setLeftBarShowType(d.value)))},[m("div",Be,[y(l,{class:"icon"},{default:c((()=>[(u(),h(N(g(j))))])),_:1})]),$e]),m("div",Ye,[(u(!0),n(P,null,D(o.value,((e,t)=>(u(),n("div",{class:p(["menu-item",{selected:v(e.includes)>=0}]),key:t,onClick:t=>(({path:e})=>{s.path!==e&&Se().then((()=>{window.loading=He(),setTimeout((()=>{a.replace(e)}),300),r.value=e}))})(e)},[m("div",Ve,[y(l,{class:"icon"},{default:c((()=>[(u(),h(N(e.icon)))])),_:2},1024)]),m("div",We,I(e.name),1)],10,Xe)))),128))])],2)}}},[["__scopeId","data-v-4ed28d5c"]]);const Fe={class:"home-body"},Je={id:"main-inner"};var qe=pe({__name:"index",setup(e){const{publicStore:t}=wt(),s=x();return(e,a)=>{const i=G("el-aside"),l=G("router-view"),o=G("el-main"),r=G("el-container");return u(),n("div",Fe,[y(Ae),y(r,{class:"home-child-view"},{default:c((()=>[y(i,{class:"aside"},{default:c((()=>[y(ze)])),_:1}),y(o,{class:"main"},{default:c((()=>[m("div",Je,[(u(),h(l,{key:s.path,class:p({expand:g(t).leftBarShowType})},null,8,["class"]))])])),_:1})])),_:1})])}}},[["__scopeId","data-v-fbb3ea7c"]]);const Ke={},Ze=e=>(E("data-v-4b07d3ea"),e=e(),S(),e),Qe={class:"cloud-body"},et={class:"cloud-info"},tt=Ze((()=>m("div",{class:"error-title"}," 404 ",-1))),st=Ze((()=>m("div",{class:"error-sub-title"}," 未找到当前地址 ",-1)));var at=pe(Ke,[["render",function(e,t){const s=G("el-result");return u(),n("div",Qe,[m("div",et,[y(s,{icon:"error",style:{"--el-result-icon-font-size":"3rem"}},{title:c((()=>[tt])),"sub-title":c((()=>[st])),_:1})])])}],["__scopeId","data-v-4b07d3ea"]]);function it(e){return mt.post(`/teai/query_templates?template_type=${e}`)}function lt(e,t){return mt.post(`/teai/query_template?template_type=${e}&template_name=${t}`)}function nt(e,t,s,a){return mt.post(`/teai/upload_template?template_type=${t}&template_name=${s}&preview=${a}`,e)}function ot(e,t){return mt.post(`/teai/delete_template?template_type=${e}&template_name=${t}`)}const rt={class:"main-body"},dt={class:"module-list"};const ut=[{path:"/",name:"home",component:qe,redirect:"/main",children:[{path:"main",name:"main",component:pe({__name:"index",props:["class"],setup(e){const t=e,s=_(),a=i({}),o=()=>{it("layouts").then((e=>{a.value=e.templates}))};return l((()=>{Se().then((()=>{o()})),window.loading||(window.loading=He()),setTimeout((()=>{window.loading.close(),window.loading=null}),300)})),(e,i)=>{const l=G("modelCard"),r=G("el-scrollbar");return u(),n("div",rt,[m("div",dt,[y(r,null,{default:c((()=>[(u(!0),n(P,null,D(Object.keys(a.value),(e=>(u(),h(l,{class:p(t.class),key:e,data:{name:e,preview:a.value[e].preview},onToUpdate:()=>{(({name:e})=>{window.loading=He(),setTimeout((()=>{s.replace({path:"modelEditor",query:{file_name:e}})}),300)})({name:e,preview:a.value[e].preview})},onDeleteItem:()=>{(({name:e})=>{ot("layouts",e).then((e=>{o()}))})({name:e})},"need-go-handle":"",onGoHandle:()=>{var t;t=e,window.loading=He(),setTimeout((()=>{s.replace({path:"generateImage",query:{file_name:t}})}),300)}},null,8,["class","data","onToUpdate","onDeleteItem","onGoHandle"])))),128))])),_:1})])])}}},[["__scopeId","data-v-273e28f5"]])},{path:"modelEditor",name:"modelEditor",component:()=>ne((()=>import("./index.ff791322.js")),["assets/index.ff791322.js","assets/lib.a58a7bed.js","assets/lib.4ea63656.css"])},{path:"modelMainEditor",name:"modelMainEditor",component:()=>ne((()=>import("./index.ff791322.js")),["assets/index.ff791322.js","assets/lib.a58a7bed.js","assets/lib.4ea63656.css"])},{path:"generateImage",name:"generateImage",component:()=>ne((()=>import("./index.d38b03e2.js")),["assets/index.d38b03e2.js","assets/lib.a58a7bed.js","assets/lib.4ea63656.css"])},{path:"promptSetting",name:"promptSetting",component:()=>ne((()=>import("./index.0e496070.js")),["assets/index.0e496070.js","assets/index.0d758d31.css","assets/lib.a58a7bed.js","assets/lib.4ea63656.css"])},{path:"gallery",name:"gallery",component:()=>ne((()=>import("./index.6bec93cd.js")),["assets/index.6bec93cd.js","assets/index.70a821be.css","assets/lib.a58a7bed.js","assets/lib.4ea63656.css"])},{path:"404",name:"404",component:at}]}],ht=R({history:H("/"),routes:ut});let ct=[];ut.forEach((e=>{e.children&&e.children.length?ct=ct.concat(e.children.map((t=>`${"/"!==e.path?e.path:""}/${t.path}`))):ct.push(e.path)})),ht.beforeEach(((e,t,s)=>{if(!ct.find((t=>t===e.path))&&"/main"!==e.path)return void s("/404");const a=me();"/main"!==e.path&&"/404"!==e.path?a?s():s("/main"):s()}));const mt=B.create({baseURL:"https://u248120-a5f1-770998cc.westb.seetacloud.com:8443",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function pt(e){if(!e.response)return $.error({message:"请求超时"}),Promise.reject(e);300===e.response.status&&$.error({message:"文件或文件夹已存在"}),me();const t=e.response.status,s=e.response.data,{userStore:a}=wt();return 401===t?($.error({message:"登录失效, 请重新登陆"}),a.handleLogout().then((()=>{setTimeout((()=>{ht.replace("/main")}),1500)}))):400===t||500===t?$.error({message:s.message}):403===t&&$.error({message:"无权限操作"}),Promise.reject(e)}mt.interceptors.request.use((e=>{const t=me()||"22";return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e}),pt),mt.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),pt);const vt=s({id:"users",state:()=>({user:he()||"***********",permissions:null,root:localStorage.getItem("root")||"",token:me()||"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((t,s)=>{var i,l;this.token="TEST TOKEN",this.user=e.username,this.root="TEST ROOT",ce(this.user),i=this.token,a.set(ue,i,{expires:1}),l=this.root,localStorage.setItem("root",l),t()}))},handleLogout(e=""){return new Promise(((e,t)=>{a.remove(ue),localStorage.removeItem(de+"USER"),this.user=null,this.permissions=null,this.token="",ce(null),e(null)}))}}});const yt={"./modules/public.js":re,"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:vt,setupStore:function(e){return vt(e)}},Symbol.toStringTag,{value:"Module"}))},gt=Y(),ft={};function wt(){return ft}Object.keys(yt).forEach((e=>{const t=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];ft[`${t}Store`]=yt[e].setupStore(gt)}));const bt={class:"view-body"},kt={__name:"App",setup(e){const{publicStore:t}=wt(),s=i(1920);i(1080);const a=i("rootDom"),o=()=>{const e=document.body.clientWidth;document.body.clientHeight,s.value=e;const t=s.value/50;document.documentElement.style.fontSize=`${t}px`,window.rootFont=t;const a=document.getElementById("theme-main");a&&a.parentNode.removeChild(a)};return l((()=>{document.addEventListener("contextmenu",(function(e){e.preventDefault()})),o(),window.onresize=()=>{o()},t.setRootDom(a.value)})),(e,t)=>{const s=G("RouterView");return u(),n("div",bt,[m("div",{class:"view-body-info",id:"view-body-info",ref_key:"rootDom",ref:a},[y(s,{id:"main-view"})],512)])}}};if("undefined"!=typeof window){let e=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML="",e.insertBefore(t,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const Tt={key:0,class:"loading-area"},Lt={key:0};var Et=pe({__name:"tButton",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"Loading"}},setup(e){const t=e,s=i(!1),a=()=>{switch(t.type){case"info":return s.value=!1,"box-info";case"success":return s.value=!1,"box-success";case"error":return s.value=!1,"box-error";case"warn":return s.value=!1,"box-warn";case"text-success":return s.value=!0,"text-success";case"text-info":return s.value=!0,"text-info";case"text-warn":return s.value=!0,"text-warn";case"text-error":return s.value=!0,"text-error";default:return null}},l=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},h=()=>{switch(t.type){case"info":case"text-info":return"background:var(--t-info-hover-color)";case"success":case"text-success":return"background:var(--t-success-hover-color)";case"error":case"text-error":return"background:var(--t-error-hover-color)";case"warn":case"text-warn":return"background:var(--t-warn-hover-color)";default:return null}},c=()=>{const e={type:a(),size:l()};let t="";return Object.keys(e).forEach((s=>{e[s]&&(t+=`${e[s]} `)})),t};return(e,a)=>(u(),n("div",{class:p(`t-btn ${c()}`)},[m("div",{style:r(`opacity: ${Number(!s.value||s.value&&!t.loading)};`)},[o(e.$slots,"default",{},void 0,!0)],4),s.value&&t.loading?(u(),n("div",Tt,I(t.loadingText),1)):d("",!0),s.value?d("",!0):(u(),n("div",{key:1,class:p(["hover-area",{loading:t.loading}]),style:r(h())},[t.loading?(u(),n("div",Lt,I(t.loadingText),1)):d("",!0)],6))],2))}},[["__scopeId","data-v-071339ed"]]);var St=pe({__name:"tTag",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"}},setup(e){const t=e,s=()=>{switch(t.type){case"info":default:return"box-info";case"success":return"box-success";case"error":return"box-error";case"warn":return"box-warn"}},a=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},i=()=>{const e={type:s(),size:a()};let t="";return Object.keys(e).forEach((s=>{e[s]&&(t+=`${e[s]} `)})),t};return(e,t)=>(u(),n("div",{class:p(`t-btn ${i()}`)},[o(e.$slots,"default",{},void 0,!0)],2))}},[["__scopeId","data-v-660ee02c"]]);const Ct={class:"model-name"},_t={class:"model-handle-del-area-outer"},xt={class:"model-handle-area"},It={class:"model-handle-area-outer"};var Pt=pe({__name:"modelCard",props:{data:{type:Object,default:()=>({preview:null,name:null})},class:{},needGoHandle:{type:Boolean,default:!1}},emits:["toUpdate","deleteItem","goHandle"],setup(e,{emit:t}){const s=t,a=e,l=i([]),o=i(!0),f=i("imageDom"),w=()=>{a.data.preview&&f.value&&f.value.$el&&(o.value=!1,l.value=[a.data.preview],o.value=!0,X((()=>{const e=f.value.$el.getElementsByTagName("img")[0];e&&e.click()})))},b=()=>{l.value=[]};return(e,t)=>{const i=G("el-image"),k=G("el-icon");return u(),n("div",{class:p(["module-item",a.class])},[o.value?(u(),h(i,{key:0,ref_key:"imageDom",ref:f,"hide-on-click-modal":"",onClose:b,"preview-src-list":l.value,src:a.data.preview,class:"model-image",fit:"contain"},null,8,["preview-src-list","src"])):d("",!0),m("div",Ct,I(a.data.name),1),m("div",_t,[m("div",xt,[m("div",{class:"handle-btn",onClick:v(w,["stop"])},[y(k,null,{default:c((()=>[y(g(V))])),_:1})]),m("div",{class:"handle-btn",onClick:t[0]||(t[0]=v((e=>s("deleteItem")),["stop"]))},[y(k,null,{default:c((()=>[y(g(W))])),_:1})])])]),m("div",It,[m("div",{class:"model-handle-area",style:r({width:a.needGoHandle?"2.4rem":"1rem"})},[m("div",{class:"handle-btn box-warn",onClick:t[1]||(t[1]=e=>s("toUpdate"))},[y(k,null,{default:c((()=>[y(g(U))])),_:1})]),a.needGoHandle?(u(),n("div",{key:0,class:"handle-btn box-main",onClick:t[2]||(t[2]=e=>s("goHandle"))},[y(k,null,{default:c((()=>[y(g(z))])),_:1})])):d("",!0)],4)])],2)}}},[["__scopeId","data-v-4cd4a46f"]]);const Dt="start",Ot="finish",Ut={HANDLE:"操作",DRAWING:"绘制"},Mt={NOMAL:"定位花",AGENT_X:"横向二方连续",AGENT_Y:"纵向二方连续",AGENT_F:"四方连续"},At="编辑器",Gt="效果调节",Nt="上传替换",jt="AI图生图",Rt="重新生成",Ht="删除元素",Bt="editor",$t="explosion";const Yt="bi-arrow-repeat",Xt="bi-eye",Vt="bi-eye-slash",Wt="bi-x-circle";const zt={class:"editor-layers"},Ft={class:"editor-layers-title"},Jt=["onDrop","onClick"],qt={class:"group-name"},Kt={class:"group-handle-area"},Zt=["onClick"],Qt=["onClick"],es=["onClick"],ts=["onClick","onDrop","draggable","onDragstart"],ss={class:"layer-name"},as={class:"layer-handle-area"},is=["onClick"],ls=["onClick"],ns=["onClick"],os=["onClick"],rs={class:"element-name"},ds={class:"element-handle-area"},us=["onClick"],hs=["onClick"],cs=["onClick"],ms=["onClick","onDrop","draggable","onDragstart"],ps={class:"layer-name"},vs={class:"layer-handle-area"},ys=["onClick"],gs=["onClick"],fs=["onClick"],ws=["onClick"],bs={class:"element-name"},ks={class:"element-handle-area"},Ts=["onClick"],Ls=["onClick"],Es=["onClick"];var Ss=pe({__name:"editorLayers",props:{viewType:{type:String,default:At},typeList:{type:Array,default:()=>[]},groupList:{type:Array,default:()=>[]},editorType:{}},emits:["toLayerInfo","setSelectedLayer","deleteGroup","deleteLayer","deleteElement","setGroup","hideLayer","reGenerateGroup","reGenerateLayer","reGenerateElement"],setup(e,{emit:t}){const s=e,a=t,l=i(new Set),o=i(new Set),r=i({groupUuid:null,layerUuid:null,elementUuid:null}),h=i({groupUuid:new Set,layerUuid:new Set,elementUuid:new Set}),c=e=>l.value.has(e),y=e=>o.value.has(e),f=(e,t)=>{t&&(r.value.groupUuid=t),r.value.layerUuid!==e&&(r.value.elementUuid=null),r.value.layerUuid=e,a("setSelectedLayer",e),o.value.has(e)?o.value.delete(e):o.value.add(e)},w=()=>{const e=new Set,t=new Set;return s.groupList.forEach((t=>{t.layers.forEach((t=>{e.add(t)}))})),s.typeList.forEach((s=>{e.has(s.uuid)||t.add(s)})),[...t]},b=e=>s.typeList.find((t=>t.uuid===e)),k=(e,t,s)=>{s&&(r.value.groupUuid=s),t&&(r.value.layerUuid=t,a("setSelectedLayer",t)),r.value.elementUuid=e},T=e=>{a("deleteLayer",e)},E=e=>{a("deleteElement",e)},S=(e,t=1)=>{const s=Object.keys(b(e).layerInfo);h.value.layerUuid.has(e)?(h.value.layerUuid.delete(e),s.forEach((e=>{h.value.elementUuid.has(e)||h.value.elementUuid.add(e),C(e,0)}))):(h.value.layerUuid.add(e),s.forEach((e=>{h.value.elementUuid.has(e)&&h.value.elementUuid.delete(e),C(e,0)}))),1===t&&a("hideLayer",h.value)},C=(e,t=1)=>{h.value.elementUuid.has(e)?h.value.elementUuid.delete(e):h.value.elementUuid.add(e),1===t&&a("hideLayer",h.value)},_=(e,t)=>{t.dataTransfer.setData("text/plain",e)},x=(e,t,s)=>{s.preventDefault();const a=s.dataTransfer.getData("text/plain");"group"===t?O([a],e):O([a,e])},O=(e=[],t=null)=>{a("setGroup",{layerUuids:e,groupUuid:t})},U=(...e)=>{a("reGenerateLayer",...e)},M=(...e)=>{a("reGenerateElement",...e)};return(e,t)=>(u(),n("div",zt,[m("div",Ft,[L(" 图层 "),m("i",{class:p(["pointer icon bi",g("bi-plus")]),onClick:t[0]||(t[0]=e=>((...e)=>{a("toLayerInfo",...e)})())},null,2)]),(u(!0),n(P,null,D(s.groupList,((e,i)=>(u(),n("div",{class:"group-list",key:e.uuid},[m("div",{class:p(["group-title",{selected:r.value.groupUuid===e.uuid}]),onDragover:t[1]||(t[1]=v((()=>{}),["prevent"])),onDrop:t=>x(e.uuid,"group",t),onClick:t=>{return s=e.uuid,r.value.groupUuid!==s&&(r.value.layerUuid=null,r.value.elementUuid=null),r.value.groupUuid=s,void(l.value.has(s)?l.value.delete(s):l.value.add(s));var s}},[m("div",qt,[m("div",{class:p(["icon bi",`${g("bi-caret-right")} ${c(e.uuid)?"selected":""}`])},null,2),L(" 组"+I(i+1),1)]),m("div",Kt,[m("div",{class:p(["pointer icon bi",g(Yt)]),onClick:v((t=>((...e)=>{a("reGenerateGroup",...e)})(e)),["stop"])},null,10,Zt),m("div",{class:p(["pointer icon bi",h.value.groupUuid.has(e.uuid)?g(Vt):g(Xt)]),onClick:v((t=>{return s=e.uuid,i=e.layers,h.value.groupUuid.has(s)?(h.value.groupUuid.delete(s),i.forEach((e=>{h.value.layerUuid.has(e)||h.value.layerUuid.add(e),S(e,0)}))):(h.value.groupUuid.add(s),i.forEach((e=>{h.value.layerUuid.has(e)&&h.value.layerUuid.delete(e),S(e,0)}))),void a("hideLayer",h.value);var s,i}),["stop"])},null,10,Qt),"edit"===s.editorType?(u(),n("div",{key:0,class:p(["pointer icon bi",g(Wt)]),onClick:v((t=>{return s=e.uuid,void a("deleteGroup",s);var s}),["stop"])},null,10,es)):d("",!0)])],42,Jt),c(e.uuid)?(u(!0),n(P,{key:0},D(e.layers,(a=>(u(),n("div",{class:"layer-list",key:a},[m("div",{class:p(["layer-title",{selected:r.value.layerUuid===a}]),onClick:t=>f(a,e.uuid),onDragover:t[2]||(t[2]=v((()=>{}),["prevent"])),onDrop:t=>x(e.uuid,"group",t),draggable:"edit"===s.editorType,onDragstart:e=>_(a,e)},[m("div",ss,[m("div",{class:p(["icon bi",`${g("bi-caret-right")} ${y(a)?"selected":""}`])},null,2),L(" "+I(b(a).name),1)]),m("div",as,[m("div",{class:p(["pointer icon bi",g(Yt)]),onClick:v((e=>U(b(a))),["stop"])},null,10,is),m("div",{class:p(["pointer icon bi",h.value.layerUuid.has(a)?g(Vt):g(Xt)]),onClick:v((e=>S(a)),["stop"])},null,10,ls),"edit"===s.editorType?(u(),n("div",{key:0,class:p(["pointer icon bi",g(Wt)]),onClick:v((e=>T(a)),["stop"])},null,10,ns)):d("",!0)])],42,ts),y(a)?(u(!0),n(P,{key:0},D(Object.keys(b(a).layerInfo),(t=>(u(),n("div",{class:"element-item",key:t},[m("div",{class:p(["element-title",{selected:r.value.elementUuid===t}]),onClick:s=>k(t,a,e.uuid)},[m("div",rs,I(b(a).layerInfo[t]),1),m("div",ds,[m("div",{class:p(["pointer icon bi",g(Yt)]),onClick:v((e=>M(t)),["stop"])},null,10,us),m("div",{class:p(["pointer icon bi",h.value.elementUuid.has(t)?g(Vt):g(Xt)]),onClick:v((e=>C(t)),["stop"])},null,10,hs),"edit"===s.editorType?(u(),n("div",{key:0,class:p(["pointer icon bi",g(Wt)]),onClick:v((e=>E(t)),["stop"])},null,10,cs)):d("",!0)])],10,os)])))),128)):d("",!0)])))),128)):d("",!0)])))),128)),(u(!0),n(P,null,D(w(),(e=>(u(),n("div",{class:"layer-list",key:e.uuid},[m("div",{class:p(["layer-title",{selected:r.value.layerUuid===e.uuid}]),onClick:t=>f(e.uuid),onDragover:t[3]||(t[3]=v((()=>{}),["prevent"])),onDrop:t=>x(e.uuid,"layer",t),draggable:"edit"===s.editorType,onDragstart:t=>_(e.uuid,t)},[m("div",ps,[m("div",{class:p(["icon bi",`${g("bi-caret-right")} ${y(e.uuid)?"selected":""}`])},null,2),L(" "+I(e.name),1)]),m("div",vs,[m("div",{class:p(["pointer icon bi",g(Yt)]),onClick:v((t=>U(e)),["stop"])},null,10,ys),m("div",{class:p(["pointer icon bi",h.value.layerUuid.has(e.uuid)?g(Vt):g(Xt)]),onClick:v((t=>S(e.uuid)),["stop"])},null,10,gs),"edit"===s.editorType?(u(),n("div",{key:0,class:p(["pointer icon bi",g(Wt)]),onClick:v((t=>T(e.uuid)),["stop"])},null,10,fs)):d("",!0)])],42,ms),y(e.uuid)?(u(!0),n(P,{key:0},D(Object.keys(b(e.uuid).layerInfo),(t=>(u(),n("div",{class:"element-item",key:t},[m("div",{class:p(["element-title",{selected:r.value.elementUuid===t}]),onClick:s=>k(t,e.uuid)},[m("div",bs,I(b(e.uuid).layerInfo[t]),1),m("div",ks,[m("div",{class:p(["pointer icon bi",g(Yt)]),onClick:v((e=>M(t)),["stop"])},null,10,Ts),m("div",{class:p(["pointer icon bi",h.value.elementUuid.has(t)?g(Vt):g(Xt)]),onClick:v((e=>C(t)),["stop"])},null,10,Ls),"edit"===s.editorType?(u(),n("div",{key:0,class:p(["pointer icon bi",g(Wt)]),onClick:v((e=>E(t)),["stop"])},null,10,Es)):d("",!0)])],10,ws)])))),128)):d("",!0)])))),128))]))}},[["__scopeId","data-v-8534eef8"]]);class Cs{constructor(){this.listeners={}}addListener(e,t,s){e.addEventListener(t,s);const a=F();return this.listeners[a]={element:e,eventType:t,listener:s},a}removeListenersByEventType(e){const{listeners:t}=this;Object.keys(t).filter((s=>t[s].eventType=e)).forEach((e=>{this.removeListenter(e)}))}removeAllListeners(){for(var e in this.listeners)this.removeListenter(e);this.listeners={}}removeListenter(e){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener),delete this.listeners[e]}}class _s{constructor(){this.typeList={}}add({name:e,image:t,prompts:s,statics:a}){const i=F();return new Promise((l=>{if(t){const n=new Image;n.src=t,n.crossOrigin="Anonymous",n.onload=()=>{this.typeList[i]={name:e,image:n,imageBase64:t,layerInfo:{},maxLength:0,loraInfo:{prompts:s,statics:a}},l(this.typeList)}}else this.typeList[i]={name:e,image:null,imageBase64:null,layerInfo:{},maxLength:0,loraInfo:{prompts:s,statics:a}},l(this.typeList)}))}delete(e){return new Promise(((t,s)=>{try{delete this.typeList[e],t(this.typeList)}catch(a){s()}}))}edit(e,t){return new Promise((s=>{this.typeList[e]=t,s(this.typeList)}))}changeImage(e,t){return new Promise((s=>{const a=new Image;a.src=t,a.crossOrigin="Anonymous",a.onload=()=>{this.typeList[e].image=a,s(a)}}))}get(e){return this.typeList[e]}getAll(){return this.typeList}bindElement(e,{elementUuid:t,elementName:s}){return new Promise((a=>{this.typeList[e].maxLength+=1,this.typeList[e].layerInfo[t]=s}))}unBindElement(e,{elementUuid:t}){return new Promise(((s,a)=>{try{delete this.typeList[e].layerInfo[t],s(this.typeList)}catch(i){a()}}))}getByElement(e){const t=this.getUuidByElement(e);return this.get(t)}getUuidByElement(e){const{typeList:t}=this;return Object.keys(t).find((s=>new Set(Object.keys(t[s].layerInfo)).has(e)))}getSaveData(){let e=JSON.parse(JSON.stringify(this.typeList));return Object.keys(e).forEach((t=>{delete e[t].image})),e}setData(e){return this.typeList=e,new Promise((t=>{let s=0;const a=Object.keys(e);a.forEach((i=>{if(e[i].imageBase64){const l=new Image;l.src=e[i].imageBase64,l.crossOrigin="Anonymous",l.onload=()=>{s++,this.typeList[i].image=l,s===a.length&&t(this.typeList)}}else s++,s===a.length&&t(this.typeList)}))}))}bindLora(e,t,s="prompts"){this.typeList[e].loraInfo[s]=t}}class xs{constructor(){this.groupList={}}add(){const e=F();return this.groupList[e]={loraInfo:{prompts:[],statics:[]},layers:[]},{uuid:e,groups:this.getAll()}}update(e,t){return delete(t=JSON.parse(JSON.stringify(t))).uuid,t.layers&&Object.keys(this.groupList).forEach((e=>{const s=new Set(this.groupList[e].layers);t.layers.forEach((e=>{s.has(e)&&s.delete(e)})),this.groupList[e].layers=[...s]})),this.groupList[e]=Object.assign(this.groupList[e],t),this.getAll()}get(e){return this.groupList[e]}getAll(){return Object.keys(this.groupList).map((e=>Object.assign({uuid:e},this.groupList[e])))}delete(e){return delete this.groupList[e],this.getAll()}getSaveData(){return this.groupList}setData(e){this.groupList=e}deleteLayer(e){const{groupList:t}=this;return Object.keys(t).forEach((s=>{const a=new Set(t[s].layers);a.has(e)&&(a.delete(e),this.groupList[s].layers=[...a])})),this.getAll()}}class Is{constructor(e=At){this.type=e,this.x=0,this.y=0,this.handleType=null,this.isShow=!1,this.dom=null,this.bindDom=null}setHandle(e,{x:t,y:s},a,i=document.body){return this.bindDom=i,new Promise((i=>{this.close(),this.x=t,this.y=s,this.handleUuid=e,this.handleType=a,this.createDom().then((e=>{i(e)}))}))}close(){this.isShow=!1,this.x=0,this.y=0,this.handleType=null,this.dom&&(this.bindDom.removeChild(this.dom),this.dom=null)}createDom(){return new Promise((e=>{const t=document.createElement("div");t.className="editor-contextmenu-view",this.bindDom.appendChild(t),this.dom=t,this.createList().then((t=>{e(t)}))}))}createList(){const e=this.getHandleList(this.type),{x:t,y:s,dom:a,bindDom:i}=this,l=(1.2*e.length-.2)*window.rootFont,n=i.getBoundingClientRect();let o=s+l>n.bottom?n.bottom-l-n.top:s-n.top;return a.style.top=`${o}px`,a.style.left=t-n.left+"px",new Promise((t=>{e.forEach((e=>{this.createItem(e).then((e=>{t(e)}))})),setTimeout((()=>{this.dom.style.height=1.2*e.length-.2+"rem"}))}))}createItem({name:e,icon:t,type:s="button"}){return new Promise((a=>{const i=document.createElement("div");i.className="editor-contextmenu-item";const l=document.createElement("i");l.className="editor-contextmenu-item-icon",l.className=`editor-contextmenu-item-icon bi ${t}`;const n=document.createElement("div");if(n.className="editor-contextmenu-item-name",n.innerText=e,i.appendChild(l),i.appendChild(n),"upload"===s){const t=document.createElement("input");t.type="file",i.appendChild(t),t.onchange=({target:t})=>{a({file:t.files[0],name:e}),this.close()}}else i.onclick=()=>{a({name:e}),this.close()};this.dom.appendChild(i)}))}getHandleList(e=At){let t=[];if(e===At)t=[{name:Gt,icon:"bi-sliders",type:"button"},{name:Nt,icon:"bi-upload",type:"upload"},{name:jt,icon:"bi-stars",type:"button"},{name:Rt,icon:Yt},{name:Ht,icon:"bi-trash",type:"button"}];return t}}function Ps(e,t,s,a=0,i=0){const l=[[-e/2,-t/2],[e/2,-t/2],[e/2,t/2],[-e/2,t/2]].map((([e,t])=>{const l=Math.cos(s),n=Math.sin(s);return[a+(e*l-t*n),i+(e*n+t*l)]}));let n=1/0,o=-1/0,r=1/0,d=-1/0;return l.forEach((([e,t])=>{n=Math.min(n,e),o=Math.max(o,e),r=Math.min(r,t),d=Math.max(d,t)})),{width:o-n,height:d-r}}function Ds([e,t],[s,a]){return e>0&&e<s&&t>0&&t<a}class Os{constructor(e,t,s,{x:a,y:i},l,n){this.uuid=F(),this.ctx=e,this.typeUuid=t,this.width=0,this.height=0,this.x=a,this.y=i,this.drawX=0,this.drawY=0,this.rotate=0,this.image=s,this.drawType=l,this.status=Dt,this.handleType=null,this.handleSetting={},this.virtuallyElements=[],this.name=n,this.draw()}setImage(e){this.image=e}setName(e){this.name=e}setElementPosition(e){const{x:t,y:s}=e;this.x=t,this.y=s,this.width=e.width||this.width,this.height=e.height||this.height}setElementSize({newX:e,newY:t}){const{x:s,y:a}=this;let i=s>e?{startX:e,finishX:s}:{startX:s,finishX:e},l=a>t?{startY:t,finishY:a}:{startY:a,finishY:t};const{startX:n,finishX:o}=i,{startY:r,finishY:d}=l;this.drawX=n,this.drawY=r,this.width=o-n,this.height=d-r}finishSetting(){this.status=Ot,this.x=this.drawX,this.y=this.drawY}draw(){const{virtuallyElements:e,drawX:t,drawY:s}=this;this.drawItem(t,s),e.forEach((([e,t])=>{this.drawItem(e,t)}))}drawItem(e,t){const{ctx:s,width:a,height:i,image:l,rotate:n}=this;(a||i)&&(s.beginPath(),s.save(),s.lineWidth=2,s.fillStyle="#222",s.translate(e+a/2,t+i/2),n&&s.rotate(n),l?s.drawImage(l,-a/2,-i/2,a,i):(s.rect(-a/2,-i/2,a,i),s.stroke(),s.fill()),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath())}checkPointIsIn({clickX:e,clickY:t}){const{virtuallyElements:s,drawX:a,drawY:i}=this;let l=!1;if(l=this.checkPointIsInItem({clickX:e,clickY:t},a,i),l)return l;for(let n of s){const[s,a]=n;if(l=this.checkPointIsInItem({clickX:e,clickY:t},s,a),l)break}return l}checkPointIsInItem({clickX:e,clickY:t},s,a){const{ctx:i,width:l,height:n,rotate:o}=this;i.beginPath(),i.save(),i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.rect(-l/2,-n/2,l,n),i.translate(-(s+l/2),-(a+n/2)),o&&i.rotate(-o);let r=!!i.isPointInPath(e,t)&&"main";return i.restore(),i.closePath(),r}checkHandle({handleX:e,handleY:t}){const{virtuallyElements:s,drawX:a,drawY:i}=this;if(this.checkHandleItem({handleX:e,handleY:t},a,i),this.handleType)return this.handleType;for(let l of s){const[s,a]=l;if(this.checkHandleItem({handleX:e,handleY:t},s,a),this.handleType)break}return this.handleType}checkHandleItem({handleX:e,handleY:t},s,a){const{ctx:i,width:l,height:n,rotate:o}=this;i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.moveTo(5,-n/2-35),i.arc(0,-n/2-35,5,0,2*Math.PI),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2));let r=i.isPointInPath(e,t);return r&&(this.handleType="rotate"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.moveTo(-l/2-5,-n/2-10),i.arc(-l/2-10,-n/2-10,5,0,2*Math.PI),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="left-top"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.moveTo(l/2+15,-n/2-10),i.arc(l/2+10,-n/2-10,5,0,2*Math.PI),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="right-top"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.moveTo(l/2+15,n/2+10),i.arc(l/2+10,n/2+10,5,0,2*Math.PI),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="right-bottom"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.moveTo(-l/2-5,n/2+10),i.arc(-l/2-10,n/2+10,5,0,2*Math.PI),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="left-bottom"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.rect(-l/2-5,-n/2-12,l+10,5),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="top"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.rect(l/2+8,-n/2-5,5,n+10),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="right"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.rect(-l/2-5,n/2+8,l+10,5),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="bottom"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.rect(-l/2-12,-n/2-5,5,n+10),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),r=i.isPointInPath(e,t),r&&(this.handleType="left"),i.restore(),i.closePath(),i.beginPath(),i.save(),i.lineWidth=2,i.strokeStyle="#fff",i.translate(s+l/2,a+n/2),o&&i.rotate(o),i.moveTo(0,-n/2-17.5),i.lineTo(0,-n/2-35),o&&i.rotate(-o),i.translate(-(s+l/2),-(a+n/2)),i.restore(),i.closePath(),r=this.checkPointIsIn({clickX:e,clickY:t}),r&&(this.handleType="main"),this.handleType}drawHandleArea(){const{virtuallyElements:e,drawX:t,drawY:s}=this;this.drawHandleAreaItem(t,s),e.forEach((([e,t])=>{this.drawHandleAreaItem(e,t)}))}drawHandleAreaItem(e,t){const{ctx:s,width:a,height:i,image:l,rotate:n,name:o}=this;s.font="12px Arial",s.fillStyle="#fff",s.textBaseline="middle",s.textAlign="center";const r=s.measureText(o),d=Math.round(r.width);s.beginPath(),s.save(),s.lineWidth=2,s.strokeStyle="#fff",s.fillStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(5,-i/2-35),s.arc(0,-i/2-35,5,0,2*Math.PI),s.fill(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.fillStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(-a/2-5,-i/2-10),s.fillRect(-a/2-15,-i/2-15,10,10),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.fillStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.fillRect(a/2+5,-i/2-15,10,10),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.fillStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(a/2+15,i/2+10),s.fillRect(a/2+5,i/2+5,10,10),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.fillStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(-a/2-5,i/2+10),s.fillRect(-a/2-15,i/2+5,10,10),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.strokeStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(-a/2,-i/2-10),s.lineTo(-d/2-5,-i/2-10),s.moveTo(d/2+5,-i/2-10),s.lineTo(a/2,-i/2-10),s.stroke(),s.fillText(o,0,-i/2-9),s.lineWidth=1,s.rect(-d/2-5,-i/2-17.5,d+10,15),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.strokeStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(a/2+10,-i/2),s.lineTo(a/2+10,i/2),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.strokeStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(-a/2,i/2+10),s.lineTo(a/2,i/2+10),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.strokeStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(-a/2-10,-i/2),s.lineTo(-a/2-10,i/2),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath(),s.beginPath(),s.save(),s.lineWidth=2,s.strokeStyle="#fff",s.translate(e+a/2,t+i/2),n&&s.rotate(n),s.moveTo(0,-i/2-17.5),s.lineTo(0,-i/2-35),s.stroke(),n&&s.rotate(-n),s.translate(-(e+a/2),-(t+i/2)),s.restore(),s.closePath()}getUuid(){return this.uuid}clearHandleType(){this.handleType=null}handleStart({x:e,y:t}){this.handleSetting={x:e,y:t}}handleMove({x:e,y:t}){switch(this.handleType){case"main":this.mainMove(e,t);break;case"left-top":this.leftTopMove(e,t);break;case"top":this.topMove(e,t);break;case"right-top":this.rightTopMove(e,t);break;case"right":this.rightMove(e,t);break;case"right-bottom":this.rightBottomMove(e,t);break;case"bottom":this.bottomMove(e,t);break;case"left-bottom":this.leftBottomMove(e,t);break;case"left":this.leftMove(e,t);break;case"rotate":this.rotateMove(e,t)}}handleEnd({x:e,y:t}){this.handleMove({x:e,y:t}),this.x=this.drawX,this.y=this.drawY,this.clearHandleType()}mainMove(e,t){const{x:s,y:a}=this.handleSetting,i=s-e,l=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.drawX-=i,this.drawY-=l}leftTopMove(e,t){const{x:s,y:a,rotate:i}=this.handleSetting;let l=s-e,n=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.width+l<0||(this.width+=l,this.drawX-=l),this.height+n<0||(this.height+=n,this.drawY-=n)}topMove(e,t){const{x:s,y:a}=this.handleSetting,i=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.height+i<0||(this.height+=i,this.drawY-=i)}rightTopMove(e,t){const{x:s,y:a}=this.handleSetting,i=s-e,l=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.width-i<0||(this.width-=i),this.height+l<0||(this.height+=l,this.drawY-=l)}rightMove(e,t){const{x:s,y:a}=this.handleSetting,i=s-e;this.handleSetting.x=e,this.handleSetting.y=t,this.width-i<0||(this.width-=i)}rightBottomMove(e,t){const{x:s,y:a}=this.handleSetting,i=s-e,l=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.width-i<0||(this.width-=i),this.height-l<0||(this.height-=l)}bottomMove(e,t){const{x:s,y:a}=this.handleSetting,i=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.height-i<0||(this.height-=i)}leftBottomMove(e,t){const{x:s,y:a}=this.handleSetting,i=s-e,l=a-t;this.handleSetting.x=e,this.handleSetting.y=t,this.width+i<0||(this.width+=i,this.drawX-=i),this.height-l<0||(this.height-=l)}leftMove(e,t){const{x:s,y:a}=this.handleSetting,i=s-e;this.handleSetting.x=e,this.handleSetting.y=t,this.width+i<0||(this.width+=i,this.drawX-=i)}rotateMove(e,t){const{x:s,y:a}=this.handleSetting;this.handleSetting.x=e,this.handleSetting.y=t;let i=function([e,t],[s,a],[i,l]){const n=s-e,o=a-t,r=i-e,d=l-t;let u=(n*r+o*d)/(Math.sqrt(n*n+o*o)*Math.sqrt(r*r+d*d));if(isNaN(u))return 0;let h=Math.acos(u);return n*d-o*r<0&&(h=-h),isNaN(h)?Math.PI/1800:Number(h.toFixed(2))}([this.x+this.width/2,this.y+this.height/2],[s,a],[e,t]);this.rotate+=i}getSaveData(){return{width:this.width,height:this.height,x:this.x,y:this.y,rotate:this.rotate,uuid:this.uuid,typeUuid:this.typeUuid}}setData(e,t){const{uuid:s,image:a,width:i,height:l,x:n,y:o,rotate:r,typeUuid:d}=e;this.uuid=s,this.image=a,this.width=i*t,this.height=l*t,this.x=n*t,this.drawX=n*t,this.y=o*t,this.drawY=o*t,this.rotate=r,this.typeUuid=d,this.status=Ot}setDrawType(e,t,s){this.drawType=e,this.recomputationPosition({width:t,height:s})}recomputationPosition({width:e,height:t}){const{drawType:s}=this;switch(s){case Mt.NOMAL:this.virtuallyElements=[],this.recomputationMainPosition(e,t);break;case Mt.AGENT_X:this.virtuallyElements=[],this.recomputationAgentXPosition(e),this.recomputationMainPosition(e,t);break;case Mt.AGENT_Y:this.virtuallyElements=[],this.recomputationAgentYPosition(t),this.recomputationMainPosition(e,t);break;case Mt.AGENT_F:this.virtuallyElements=[],this.recomputationAgentFPosition(e,t),this.recomputationMainPosition(e,t)}}recomputationMainPosition(e,t){const{virtuallyElements:s,drawX:a,drawY:i,width:l,height:n}=this;s.length&&(Ds([a+l/2,i+n/2],[e,t])||JSON.parse(JSON.stringify(s)).forEach(((s,a)=>{const[i,o]=s;Ds([i+l/2,o+n/2],[e,t])&&(this.virtuallyElements[a]=[this.drawX,this.drawY],this.drawX=i,this.drawY=o)})))}recomputationAgentXPosition(e){const{drawX:t,drawY:s,width:a,height:i,rotate:l}=this;let n=a;l&&(n=Ps(a,i,l).width),t+a/2+n/2>e?this.virtuallyElements.push([t-e,s]):t+a/2-n/2<0&&this.virtuallyElements.push([e+t,s])}recomputationAgentYPosition(e){const{drawX:t,drawY:s,width:a,height:i,rotate:l}=this;let n=i;l&&(n=Ps(a,i,l).height),s+i/2+n/2>e?this.virtuallyElements.push([t,s-e]):s+i/2-n/2<0&&this.virtuallyElements.push([t,e+s])}recomputationAgentFPosition(e,t){this.recomputationAgentXPosition(e),this.recomputationAgentYPosition(t);const{virtuallyElements:s,drawX:a,drawY:i,width:l,height:n}=this;2===s.length&&(a===s[0][0]?this.virtuallyElements.push([s[1][0],s[0][1]]):this.virtuallyElements.push([s[0][0],s[1][1]]))}resize(e){this.width*=e,this.height*=e,this.x*=e,this.drawX*=e,this.y*=e,this.drawY*=e}}function Us(e){return new Promise((t=>{(function(e){return new Promise((t=>{const s=new FileReader;s.onload=({target:e})=>{t(e.result)},s.readAsDataURL(e)}))})(e).then((e=>{(function(e){return new Promise((t=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{t(s)},s.src=e}))})(e).then((e=>{t(e)}))}))}))}function Ms(e,t){const s=Object.keys(e).some((s=>e[s]===t));return s||$.error("非法value"),s}class As extends class{constructor(){t(this,"getGenerateResult",((e,t=0,s=0,a=[])=>{const i=e[t];return new Promise((l=>{var n;(n=i,mt.post(`/teai/query_task?task_id=${n}`)).then((i=>{"error"===i?(s=0,t+=1,a.push("")):"processing"===i?++s>=30&&(s=0,t+=1,a.push("")):(s=0,t+=1,a.push(i)),t===e.length?l(a):setTimeout((()=>{l(this.getGenerateResult(e,t,s,a))}),2e3)}))}))})),this.name=null}getGenrateTaskId(e,t){return new Promise((s=>{(function(e,t,s=1){return mt.post(`/teai/generate?layout_name=${e}&layer_name=${t}&num_images=${s}`)})(this.name,e,t).then((e=>{s(e)}))}))}getGroupTaskResult(e=[],t=0,s={}){const a=e[t],{layers:i}=a;return new Promise((l=>{this.getGenrateTaskId(a.uuid,i.length).then((a=>{this.getGenerateResult(a).then((a=>{i.forEach(((e,t)=>{s[e]=a[t]})),++t===e.length?l(s):l(this.getGroupTaskResult(e,t,s))}))}))}))}getLayerTaskResult(e){const{uuid:t}=e;return new Promise((e=>{this.getGenrateTaskId(t,1).then((s=>{this.getGenerateResult(s).then((([s])=>{e({[t]:s})}))}))}))}getElementTaskResult(e,t,s=0){return new Promise((s=>{this.getGenrateTaskId(t,1).then((t=>{this.getGenerateResult(t).then((([t])=>{s({[e]:t})}))}))}))}}{constructor(e,{width:t,height:s,name:a},i=At){super(),this.canvasOuterDom=e,this.funcMap={},this.width=t,this.height=s,this.rootFont=window.rootFont,this.realWidth=t,this.realHeight=s,this.name=a,this.proportion=1,this.editorType=i,this.editorTypeController=new _s,this.editorGroupController=new xs,this.editorHandleController=new Is(i),this.listeners=new Cs,this.handleType=Ut.HANDLE,this.elementsList={},this.selectedElement=null,this.hideMap={groupUuid:new Set,layerUuid:new Set,elementUuid:new Set},this.drawType=Mt.NOMAL,this.initCanvas(),this.addListener()}bindFunction(e,t){this.funcMap[e]=t}addListener(){this.bindCanvasHandleListener(),this.listeners.addListener(window,"resize",(()=>{this.windowResize()}))}bindCanvasHandleListener(){this.listeners.addListener(this.canvas,"mousedown",(e=>{this.mousedown(e)})),this.listeners.addListener(this.canvas,"mousemove",(e=>{this.mousemove(e)})),this.listeners.addListener(this.canvas,"mouseup",(e=>{this.mouseup(e)})),this.listeners.addListener(this.canvas,"mouseleave",(e=>{this.mouseup(e)})),this.listeners.addListener(this.canvas,"dblclick",(e=>{this.mouseclick(e)})),this.listeners.addListener(this.canvas,"contextmenu",(e=>{this.contextmenu(e)}))}removeListener(){this.listeners.removeAllListeners()}initCanvas(){const{canvasOuterDom:e}=this;this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.margin="auto",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.borderRight="solid 0.05rem var(--t-main-color)",this.canvas.style.backgroundColor="var(--t-main-sub-color)",e.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.setCanvasSize(this)}setCanvasSize({width:e,height:t,name:s}){const{canvasOuterDom:a}=this,i=a.getBoundingClientRect();let l=i.width||this.width,n=i.height||this.height;this.realWidth=e,this.realHeight=t,this.name=s,e/t>l/n?(t=t*l/e,this.proportion=e/l,e=l):(e=e*n/t,this.proportion=t/n,t=n),this.canvas.width=e,this.canvas.height=t,this.canvas.style.width=e/window.rootFont+"rem",this.canvas.style.height=t/window.rootFont+"rem",this.width=e,this.height=t,this.initDraw()}mousedown(e){if(0!==e.button)return;this.editorHandleController.close();const{offsetX:t,offsetY:s}=e;if(this.handleType===Ut.DRAWING){if(!this.typeUuid)return $.error("请选择图层后操作"),this.handleType;const e=this.editorTypeController.get(this.typeUuid),a=`${e.name}-${e.maxLength+1}`;let i=new Os(this.ctx,this.typeUuid,e.image,{x:t,y:s},this.drawType,a);const l=i.getUuid();this.elementsList[l]=i,this.editorTypeController.bindElement(this.typeUuid,{elementUuid:l,elementName:a})}else if(this.handleType===Ut.HANDLE&&this.selectedElement){this.elementsList[this.selectedElement].checkHandle({handleX:t,handleY:s})&&this.elementsList[this.selectedElement].handleStart({x:t,y:s})}}mousemove(e){const{offsetX:t,offsetY:s}=e,a=Object.keys(this.elementsList);this.handleType===Ut.DRAWING?a.length&&"start"===this.elementsList[a[a.length-1]].status&&(this.elementsList[a[a.length-1]].setElementSize({newX:t,newY:s}),this.reDraw()):this.handleType===Ut.HANDLE&&this.selectedElement&&this.elementsList[this.selectedElement].handleType&&(this.elementsList[this.selectedElement].handleMove({x:t,y:s}),this.reDraw())}mouseup(e){const{offsetX:t,offsetY:s}=e,a=Object.keys(this.elementsList);this.handleType===Ut.DRAWING?a.length&&"start"===this.elementsList[a[a.length-1]].status&&(this.elementsList[a[a.length-1]].setElementSize({newX:t,newY:s}),this.elementsList[a[a.length-1]].finishSetting(),this.funcMap.setTypeList&&this.funcMap.setTypeList(this.editorTypeController.getAll()),this.reDraw()):(this.handleType=Ut.HANDLE)&&this.selectedElement&&this.elementsList[this.selectedElement].handleType&&this.elementsList[this.selectedElement].handleEnd({x:t,y:s})}mouseclick(e){const{offsetX:t,offsetY:s}=e;if(!(this.handleType!==Ut.HANDLE||this.selectedElement&&this.elementsList[this.selectedElement].handleType)){const e=this.editorTypeController.getAll(),a=Object.keys(e).reverse();let i=this.hideMap.layerUuid,l=a.map((t=>{if(i.has(t))return[];return Object.keys(e[t].layerInfo)})).flat();this.selectedElement=null;for(let n of l){if(this.hideMap.elementUuid.has(n))break;if(this.elementsList[n].checkPointIsIn({clickX:t,clickY:s})){this.selectedElement=n;break}}this.reDraw()}}contextmenu(e){const{offsetX:t,offsetY:s}=e;if(!(this.handleType!==Ut.HANDLE||this.selectedElement&&this.elementsList[this.selectedElement].handleType)){const a=this.editorTypeController.getAll(),i=Object.keys(a).reverse();let l=this.hideMap.layerUuid,n=i.map((e=>{if(l.has(e))return[];return Object.keys(a[e].layerInfo)})).flat();this.selectedElement=null;for(let e of n)if(this.elementsList[e].checkPointIsIn({clickX:t,clickY:s})){this.selectedElement=e;break}this.reDraw(),this.selectedElement?this.editorHandleController.setHandle(this.selectedElement,{x:e.pageX,y:e.pageY},"element",this.canvasOuterDom).then((e=>{this.contextmenuCallBack(e)})):this.editorHandleController.close()}}contextmenuCallBack(e){switch(e.name){case Gt:break;case Nt:const t=this.selectedElement;Us(e.file).then((e=>{this.elementsList[t].setImage(e),this.reDraw()}));break;case jt:break;case Rt:this.reGenerateElement();break;case Ht:this.deleteElement()}}deleteElement(e=null){e=e||this.selectedElement;const t=this.elementsList[e];this.editorTypeController.unBindElement(t.typeUuid,{elementUuid:e}),delete this.elementsList[e],e===this.selectedElement&&(this.selectedElement=null),this.reDraw()}draw(){const{width:e,height:t}=this;let s=this.hideMap.layerUuid;const a=this.editorTypeController.getAll();Object.keys(a).forEach((i=>{s.has(i)||Object.keys(a[i].layerInfo).forEach((s=>{this.elementsList[s].recomputationPosition({width:e,height:t}),this.hideMap.elementUuid.has(s)||this.elementsList[s].draw()}))})),this.selectedElement&&this.elementsList[this.selectedElement].drawHandleArea()}reDraw(){const{ctx:e,width:t,height:s}=this;e.clearRect(0,0,t,s),this.draw()}initDraw(){this.reDraw()}addType(e){return new Promise((t=>{this.editorTypeController.add(e).then((e=>{t(e)}))}))}getAllType(){return this.editorTypeController.getAll()}getAllLayerImage(){return new Promise((e=>{const t=this.editorTypeController.getAll(),s=this.selectedElement;this.selectedElement=null;const a=Object.keys(t),i=new Set(JSON.parse(JSON.stringify([...this.hideMap.layerUuid])));this.getLayerImageItem(a,i).then((t=>{this.hideMap.layerUuid=i,this.selectedElement=s,this.reDraw(),e(t)}))}))}getLayerImageItem(e,t,s=0,a={}){return new Promise((i=>{if(!e.length)return void i(a);const l=e[s];if(t.has(l))return void(++s===e.length?i(a):i(this.getLayerImageItem(e,t,s,a)));let n=new Set(JSON.parse(JSON.stringify(e)));n.delete(l),this.hideMap.layerUuid=n,this.reDraw(),a[l]={name:this.editorTypeController.get(l).name,imageBase64:this.canvas.toDataURL()},++s===e.length?i(a):i(this.getLayerImageItem(e,t,s,a))}))}changeHandleType(e){return Ms(Ut,e)?Object.keys(this.editorTypeController.getAll()).length?(this.selectedElement=null,this.handleType=e,this.reDraw(),this.handleType):($.error("请设置类型后操作"),this.handleType):this.handleType}getHandleType(){return this.handleType}setTypeUuid(e){this.typeUuid=e}setName(e){this.name=e}getSaveData(e=!0,t=!1){const{canvas:s}=this;return new Promise((a=>{const i={elementData:Object.keys(this.elementsList).map((e=>this.elementsList[e].getSaveData())),typeData:this.editorTypeController.getSaveData(),canvasData:{width:this.realWidth,height:this.realHeight,drawType:this.drawType,name:this.name,proportion:this.proportion},groupData:this.editorGroupController.getSaveData()};if(!e){const e=s.toDataURL("image/png");return i.preview=e,void a(i)}let l="";if(t){const e=J.lib.WordArray.random(16),t="TEART_SECRET_KEY";l=J.AES.encrypt(JSON.stringify(i),J.enc.Utf8.parse(t),{iv:e}).toString(),l=`${e},${l}`}else l=JSON.stringify(i,null,2);const n=new Blob([l],{type:t?"application/teart-model":"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=`${F()}.${t?"trt":"json"}`,document.body.appendChild(r),r.click()}))}setData({elementData:e,typeData:t,canvasData:s,groupData:a}){return new Promise((i=>{this.setCanvasSize(s);const l=s.proportion/this.proportion;this.drawType=s.drawType,this.hideMap={groupUuid:new Set,layerUuid:new Set,elementUuid:new Set},this.handleType=Ut.HANDLE,this.selectedElement=null,this.editorGroupController.setData(a);const n=this.editorGroupController.getAll();this.editorTypeController.setData(t).then((t=>{this.elementsList={},e.forEach((e=>{const{typeUuid:s}=e;e.image=t[s].image;const a=new Os(this.ctx,s,null,{x:0,y:0},this.drawType);a.setData(e,l);const i=a.getUuid();this.elementsList[i]=a})),this.reDraw(),i({typeList:t,groups:n})}))}))}getCanvasStyle(){return{width:.85*this.width+"px",height:.85*this.height+"px"}}changeDrawType(e){Ms(Mt,e)&&(this.drawType=e,Object.keys(this.elementsList).forEach((t=>{this.elementsList[t].setDrawType(e,this.width,this.height)})),this.reDraw())}getDrawType(){return this.drawType}getTypeList(){return this.editorTypeController.getAll()}bindLora(...e){this.editorTypeController.bindLora(...e)}changeImage(e,t){return new Promise((s=>{this.editorTypeController.changeImage(e,t).then((t=>{const a=this.editorTypeController.get(e).layerInfo;Object.keys(a).forEach((e=>{this.elementsList[e].setImage(t)})),this.reDraw(),s()}))}))}windowResize(){const e=window.rootFont/this.rootFont;this.rootFont=window.rootFont,this.canvas.width*=e,this.canvas.height*=e,this.width=this.canvas.width,this.height=this.canvas.height,Object.keys(this.elementsList).forEach((t=>{this.elementsList[t].resize(e)})),this.reDraw()}exportImage(){const{realWidth:e,realHeight:t,width:s,height:a}=this,i=e/s,l=this.selectedElement;this.selectedElement=null;const n=He();this.canvas.width=e,this.canvas.height=t,this.width=this.canvas.width,this.height=this.canvas.height,Object.keys(this.elementsList).forEach((e=>{this.elementsList[e].resize(i)})),this.reDraw(),this.selectedElement=l;const o=function(e,t,s){const a=e.split(";base64,"),i=a[0].split(":")[1],l=atob(a[1]);let n=l.length;const o=new Uint8Array(n);for(;n--;)o[n]=l.charCodeAt(n);return new Blob([o],{type:s||i})}(this.canvas.toDataURL("image/png"),this.name),r=URL.createObjectURL(o),d=document.createElement("a");d.href=r,d.download=`${this.name}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(r),setTimeout((()=>{this.width=s,this.height=a,this.canvas.width=s,this.canvas.height=a,Object.keys(this.elementsList).forEach((e=>{this.elementsList[e].resize(1/i)})),this.reDraw(),n.close()}),600)}addGroup(){return this.editorGroupController.add()}getGroupItem(e){return this.editorGroupController.get(e)}getAllGroup(){return this.editorGroupController.getAll()}updateGroup(e,t){return this.editorGroupController.update(e,t)}deleteGroup(e){return this.editorGroupController.delete(e)}deleteType(e){return new Promise((t=>{const{layerInfo:s}=this.editorTypeController.get(e);Object.keys(s).forEach((e=>{e===this.selectedElement&&(this.selectedElement=null),delete this.elementsList[e]})),this.reDraw(),this.editorTypeController.delete(e).then((s=>{const a=this.editorGroupController.deleteLayer(e);t({typeList:s,groups:a})}))}))}setHideLayer(e){this.hideMap=e,this.reDraw()}reGenerateGroup(e){const t=He();this.getGroupTaskResult([e]).then((e=>{const s=[];Object.keys(e).forEach((t=>{s.push(new Promise((s=>{this.changeImage(t,e[t]).then((()=>{s()}))})))})),Promise.all(s).then((()=>{t.close()}))}))}reGenerateLayer(e){const t=He(),{uuid:s}=e;this.getLayerTaskResult(e).then((e=>{this.changeImage(s,e[s]).then((()=>{t.close()}))}))}reGenerateElement(e=this.selectedElement){const t=He(),s=this.editorTypeController.getUuidByElement(e);this.getElementTaskResult(e,s).then((s=>{var a;(a=s[e],new Promise((e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{e(t)},t.src=a}))).then((s=>{this.elementsList[e].setImage(s),this.reDraw(),t.close()}))}))}}const Gs={class:"menu-icon"},Ns=["src"],js=(e=>(E("data-v-63a97bac"),e=e(),S(),e))((()=>m("div",{class:"menu-name"},null,-1))),Rs={class:"menu-all"},Hs=["onClick"],Bs={class:"menu-icon"},$s={class:"menu-name"};var Ys=pe({__name:"editorHandle",props:["handleType","editorType"],emits:["changeHandleType","exportImage","changeViewType","toGenrateGroup","save"],setup(e,{emit:t}){const{publicStore:s}=wt(),a=x();_();const o=i([]),r=i(null),d=i(0),h=i(0),v=e,f=t,w=()=>{const e=b(),t=k();return[].concat(e,t)},b=()=>v.handleType===Ut.HANDLE&&"edit"===v.editorType?[{name:"绘制模式",icon:"bi-grid",click(){f("changeHandleType",Ut.DRAWING)}}]:v.handleType===Ut.DRAWING?[{name:"操作模式",icon:"bi-bounding-box-circles",click(){f("changeHandleType",Ut.HANDLE)}}]:[],k=()=>{let e=[{name:"下载图片",icon:"bi-download",click(){f("exportImage")}},{name:"上传模板",icon:"bi-cloud-arrow-up",click(){f("save")}},{name:"效果调节",icon:"bi-sliders",click(){}},{name:"测试生成",icon:h.value?Yt:"bi-play",click(){h.value++,f("toGenrateGroup")}},{name:"分层展示",icon:"bi-layers",click(){f("changeViewType")}}];return"edit"===v.editorType&&(e=e.concat([{name:"画板设置",icon:"bi-gear",click(){f("toCanvasSetting")}}])),e};return l((()=>{r.value=a.path,o.value=[]})),(e,t)=>{const a=G("el-icon");return u(),n("div",{class:p(["left-bar-body",{expand:d.value}])},[m("div",{class:"menu-title",onClick:t[0]||(t[0]=e=>(d.value=Number(!d.value),void s.setLeftBarShowType(d.value)))},[m("div",Gs,[y(a,{class:"icon"},{default:c((()=>[m("img",{src:g("/assets/menu.2082884d.svg")},null,8,Ns)])),_:1})]),js]),m("div",Rs,[(u(!0),n(P,null,D(w(),((e,t)=>(u(),n("div",{class:"menu-item",key:t,onClick:t=>e.click()},[m("div",Bs,[m("i",{class:p(["bi icon",e.icon])},null,2)]),m("div",$s,I(e.name),1)],8,Hs)))),128))])],2)}}},[["__scopeId","data-v-63a97bac"]]);const Xs=e=>(E("data-v-048d8d3c"),e=e(),S(),e),Vs={class:"editor-draw-board-setting-box"},Ws={class:"editor-draw-board-setting-title"},zs={class:"editor-draw-board-setting-handle-area"},Fs={class:"setting-item"},Js=Xs((()=>m("div",{class:"setting-item-label"},"模板名称",-1))),qs={class:"setting-item-value"},Ks={class:"setting-item"},Zs=Xs((()=>m("div",{class:"setting-item-label"},"画布尺寸",-1))),Qs={class:"setting-item-value"},ea=Xs((()=>m("div",{class:"center-icon"},"*",-1)));var ta=pe({__name:"editorDrawBoardSetting",emits:["save"],setup(e,{expose:t,emit:s}){const a=s,l=i(!1),o=i(null),r=i(1140),d=i(1080),h=()=>{l.value=!1};return t({show:e=>{l.value?h():(l.value=!0,o.value=e.name,r.value=e.width,d.value=e.height)}}),(e,t)=>{const s=G("el-input"),i=G("el-input-number");return u(),n("div",{class:p(["editor-draw-board-setting",{show:l.value}])},[m("div",Vs,[m("div",Ws,[L(" 画板设置 "),m("div",zs,[m("div",{class:"editor-draw-board-setting-handle",onClick:t[0]||(t[0]=e=>h())},[m("i",{class:p(`bi ${g("bi-arrow-left-circle")}`)},null,2)]),m("div",{class:"editor-draw-board-setting-handle",onClick:t[1]||(t[1]=e=>(l.value=!1,void a("save",{name:o.value,height:d.value,width:r.value})))},[m("i",{class:p(`bi ${g("bi-save")}`)},null,2)])])]),m("div",Fs,[Js,m("div",qs,[y(s,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e)},null,8,["modelValue"])])]),m("div",Ks,[Zs,m("div",Qs,[y(i,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value=e),controls:!1},null,8,["modelValue"]),ea,y(i,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value=e),controls:!1},null,8,["modelValue"])])])])],2)}}},[["__scopeId","data-v-048d8d3c"]]);const sa=e=>(E("data-v-2e10ab9b"),e=e(),S(),e),aa={class:"editor-layer-setting-box"},ia={class:"editor-layer-setting-title"},la={class:"editor-layer-setting-handle-area"},na={class:"setting-value-box"},oa={key:0,class:"setting-item"},ra=sa((()=>m("div",{class:"setting-item-label"},"图层名称",-1))),da={class:"setting-item-value"},ua={class:"setting-item"},ha=sa((()=>m("div",{class:"setting-item-label"},"statics",-1))),ca={class:"setting-item-value"},ma={class:"setting-item"},pa=sa((()=>m("div",{class:"setting-item-label"},"prompts",-1))),va={class:"setting-item-value"},ya={key:1,class:"setting-item"},ga=sa((()=>m("div",{class:"setting-item-label"},"图片",-1))),fa={class:"setting-item-value"};var wa=pe({__name:"editorLayerSetting",props:{staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]}},emits:["save"],setup(e,{expose:t,emit:s}){const a=e,l=s,o=i(!1),f=i(null),w=i([]),b=i([]),k=i(null),T=i(null),E=i("layer"),S=i(null),C=()=>{o.value=!1},_=e=>{if("image/png"!==e.type)return void $.error("请上传png格式图片");const t=new FileReader;return t.onload=({target:e})=>{T.value=e.result},t.readAsDataURL(e),!1};return t({show:(e=null,t="layer",s)=>{o.value?C():(o.value=!0,f.value=e?e.name:"",w.value=e?e.statics:[],b.value=e?e.prompts:[],k.value=e?e.uuid:null,T.value=e?e.image:null,E.value=t,S.value=s)}}),(e,t)=>{const s=G("el-input"),i=G("el-option"),x=G("el-select"),O=G("el-button"),U=G("el-image"),M=G("el-upload"),A=G("el-scrollbar");return u(),n("div",{class:p(["editor-layer-setting",{show:o.value}]),style:r({height:"layer"===E.value?"9.3rem":"7rem"})},[m("div",aa,[m("div",ia,[L(I("layer"===E.value?"图层":"组")+"设置 ",1),m("div",la,[m("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>C())},[m("i",{class:p(`bi ${g("bi-arrow-left-circle")}`)},null,2)]),m("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>{f.value||"layer"!==E.value?w.value.length||b.value.length?(o.value=!1,"layer"===E.value?l("save",{name:f.value,prompts:b.value,statics:w.value,uuid:k.value,image:T.value}):l("saveGroup",{prompts:b.value,statics:w.value,uuid:k.value,otherData:S.value})):$.error("请选择statics或prompts后操作"):$.error("请输入图层名称后保存")})},[m("i",{class:p(`bi ${g("bi-save")}`)},null,2)])])]),m("div",na,[y(A,null,{default:c((()=>["layer"===E.value?(u(),n("div",oa,[ra,m("div",da,[y(s,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e)},null,8,["modelValue"])])])):d("",!0),m("div",ua,[ha,m("div",ca,[y(x,{multiple:"",modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e)},{default:c((()=>[(u(!0),n(P,null,D(a.staticsList,(e=>(u(),h(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),m("div",ma,[pa,m("div",va,[y(x,{multiple:"",modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value=e)},{default:c((()=>[(u(!0),n(P,null,D(a.promptsList,(e=>(u(),h(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),"layer"===E.value?(u(),n("div",ya,[ga,m("div",fa,[y(M,{class:"upload-demo","before-upload":_,accept:".png","show-file-list":!1,action:""},{default:c((()=>[T.value?d("",!0):(u(),h(O,{key:0,style:{width:"3.5rem",height:"3.5rem",padding:"0"}},{default:c((()=>[L("上传图片")])),_:1})),T.value?(u(),h(O,{key:1,style:{width:"3.5rem",height:"3.5rem",padding:"0",position:"relative"}},{default:c((()=>[y(U,{src:T.value},null,8,["src"]),m("div",{class:"remove-image-btn",onClick:t[5]||(t[5]=v((e=>T.value=null),["stop"]))},[m("div",{class:p(["bi",g(Wt)])},null,2)])])),_:1})):d("",!0)])),_:1})])])):d("",!0)])),_:1})])])],6)}}},[["__scopeId","data-v-2e10ab9b"]]);const ba=["onClick"],ka={key:0,class:"explosion-line-1"},Ta={class:"explosion-prompt-item"},La={class:"explosion-item-name"},Ea={class:"explosion-prompt-edit-btn"},Sa={key:0,class:"explosion-prompt-info"},Ca={key:1,class:"explosion-prompt-info"},_a={class:"explosion-diagram-item"},xa={key:0,class:"explosion-name"},Ia=["onClick"],Pa={class:"explosion-image"},Da=["src"];var Oa=pe({__name:"explosionDiagram",props:{data:{type:Array,default:()=>[]},widthPrompt:{type:Boolean,default:()=>!1},explosionStyle:{type:Object,default:()=>({width:"5rem",height:"7rem"})}},setup(e,{expose:t}){const s=e,a=i(null),o=i(null),h=i(null),f=i(null),w=i(null),b=i(""),k={COMMENCE:"commence",INCORPORATION:"incorporation"},T=i(k.INCORPORATION),E=e=>{k.hasOwnProperty(e)||"CHANGE"===e?(o.value=null,"CHANGE"===e?T.value===k.COMMENCE?T.value=k.INCORPORATION:T.value=k.COMMENCE:T.value=k[e]):$.error("非法参数")},S=e=>T.value===k.COMMENCE?Object.assign({left:2*e-s.data.length+"rem",top:-.5*e+"rem",zIndex:s.data.length-e-1},s.explosionStyle):Object.assign({left:"0rem",top:"0rem",transform:"skewY(0deg)",zIndex:s.data.length-e-1,backgroundColor:e===s.data.length-1?"var(--t-sub-color)":"transparent"},s.explosionStyle),C=e=>h.value===e?{hiding:!0}:f.value===e?{showing:!0}:a.value===e?{show:!0}:a.value!==e?{hide:!0}:void 0;return l((()=>{s.data.length&&(a.value=0),setTimeout((()=>{E("COMMENCE")}))})),t({changeExplosionType:E}),(t,i)=>{const l=G("el-icon"),_=G("t-button");return u(),n("div",{class:"explosion-diagram-body",style:r({paddingTop:(T.value===k.COMMENCE?.5*s.data.length:0)+"rem"})},[m("div",{class:"explosion-all",style:r(s.explosionStyle)},[(u(!0),n(P,null,D(s.data,((t,x)=>(u(),n(P,null,[o.value===x||T.value===k.COMMENCE||!o.value&&0!==o.value&&T.value===k.INCORPORATION?(u(),n("div",{class:p(["explosion-item",{selected:T.value===k.COMMENCE&&a.value===x}]),key:t.uuid,onClick:e=>(e=>new Promise((t=>{T.value===k.COMMENCE&&a.value!==e?(w.value=null,null!==a.value&&(h.value=a.value),f.value=e,setTimeout((()=>{a.value=f.value,f.value=null})),setTimeout((()=>{h.value=null,t()}),200)):t()})))(x),style:r(S(x))},[T.value===k.COMMENCE||null!==o.value?(u(),n("div",{key:0,class:p(["explosion-diagram-handle-area",Object.assign(C(x),{nomal:null!==o.value})])},[e.widthPrompt?(u(),n("div",ka)):d("",!0),e.widthPrompt?(u(),n("div",{key:1,class:"explosion-line-2",style:r({width:1.5*(T.value===k.COMMENCE||null===o.value?s.data.length-x:1)+"rem"})},null,4)):d("",!0),e.widthPrompt?(u(),n("div",{key:2,class:"explosion-prompt-area",style:r({left:1.5*(T.value===k.COMMENCE||null===o.value?s.data.length-x:1)+1+"rem"})},[m("div",Ta,[m("div",La,[L(I(t.name)+" ",1),m("div",Ea,[y(l,{class:"explosion-prompt-edit-item",onClick:v((e=>(e=>{b.value=s.data[e].prompt,w.value=e})(x)),["stop"])},{default:c((()=>[y(g(q))])),_:2},1032,["onClick"])])]),w.value!==x?(u(),n("div",Sa,I(t.prompt),1)):d("",!0),w.value===x?(u(),n("div",Ca,[K(m("textarea",{"onUpdate:modelValue":i[0]||(i[0]=e=>b.value=e)},null,512),[[Z,b.value]])])):d("",!0),m("div",{class:"explosion-prompt-save-handle-area",style:r({height:w.value===x?"0.8rem":"0rem"})},[y(_,{type:"info",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"},onClick:i[1]||(i[1]=e=>w.value=null)},{default:c((()=>[L("取消")])),_:1}),y(_,{type:"success",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"}},{default:c((()=>[L("生成")])),_:1})],4)])],4)):d("",!0)],2)):d("",!0),m("div",_a,[T.value===k.COMMENCE?(u(),n("div",xa,I(t.name),1)):d("",!0),null!==o.value||T.value===k.COMMENCE?(u(),n("div",{key:1,class:"show-explosion-item-handle-btn",onClick:v((e=>(e=>{null===o.value&&T.value===k.COMMENCE?(E("INCORPORATION"),o.value=e):null!==o.value&&(E("COMMENCE"),o.value=null),a.value=e})(x)),["stop"]),style:r({top:(T.value===k.COMMENCE?"1.2":"0.2")+"rem"})},I(null!==o.value?"隐藏":"展示"),13,Ia)):d("",!0),m("div",Pa,[m("img",{src:t.imageSrc},null,8,Da)])])],14,ba)):d("",!0)],64)))),256))],4)],4)}}},[["__scopeId","data-v-42b63f96"]]);function Ua(e,t){return mt.post(`/teai/upload?file_id=${e}`,t)}const Ma={class:"model-draw-board"},Aa={key:0,class:"model-draw-area"},Ga={class:"model-handle-area"};var Na=pe({__name:"modelDrawBoard",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},editorType:{}},emits:["setTypeList","setGroupList"],setup(e,{expose:t,emit:s}){const a=e,o=s,r=i(null),h=i(null),c=i(null),p=i(null),v=i("editor"),g=i([]),f=i({width:0,height:0}),w=i(null),b=i(Object.assign({name:a.setting.name},a.setting.canvasData)),k=i(null),T=({name:e,width:t,height:s,dpi:a=1})=>({name:e,width:t*(a=a||1),height:s*a}),L=()=>{v.value===Bt?(w.value.removeListener(),E().then((()=>{v.value=$t}))):(p.value.changeExplosionType("INCORPORATION"),v.value=Bt,X((()=>{w.value.addListener()})))},E=()=>new Promise((e=>{w.value.getAllLayerImage().then((t=>{g.value=Object.keys(t).map((e=>Object.assign({uuid:e,imageSrc:t[e].imageBase64},t[e]))).reverse(),e()}))})),S=e=>{k.value=w.value.changeHandleType(e)},C=()=>{h.value.show(T(b.value))},_=()=>{w.value.exportImage()},x=()=>{w.value=new As(r.value,T(b.value)),w.value.bindFunction("setTypeList",P),a.setting.canvasData.name?w.value.setData(a.setting).then((e=>{(({typeList:e,groups:t})=>{P(e),D(t)})(e),k.value=w.value.getHandleType(),f.value=w.value.getCanvasStyle()})):(k.value=w.value.getHandleType(),f.value=w.value.getCanvasStyle())},I=e=>{b.value.name=e.name,b.value.height=e.height,b.value.width=e.width,w.value.setCanvasSize(T(e)),f.value=w.value.getCanvasStyle()},P=(e=null)=>{e=e||w.value.setTypeList();const t=Object.keys(e).map((t=>({uuid:t,name:e[t].name,image:e[t].image,loraInfo:e[t].loraInfo,layerInfo:e[t].layerInfo})));o("setTypeList",t)},D=e=>{o("setGroupList",e)},O=e=>{const{uuid:t}=e;delete e.uuid,t||w.value.addType({name:e.name,prompts:e.prompts,statics:e.statics,image:e.image}).then((e=>{P(e)}))},U=()=>{(()=>{const e=new ResizeObserver((e=>{for(let t of e){const{width:e,height:s}=t.contentRect;e&&s&&(w.value||x())}}));e.observe(r.value),ee((()=>{e.disconnect()}))})()},M=e=>{const{otherData:t,uuid:s,prompts:a,statics:i}=e,{layerUuids:l}=t;if(!s&&2===l.length){const e=w.value.addGroup().uuid,t=w.value.updateGroup(e,{layers:l,loraInfo:{prompts:a,statics:i}});D(t)}},A=()=>{G()},G=()=>{w.value.getSaveData(!1).then((e=>{let t=0;const s=base64ToFile(e.preview,b.value.name),a=new FormData;a.append("file",s),delete e.preview,Ua(b.value.name,a).then((s=>{const a=s;Object.keys(e.typeData).forEach((s=>{const i=e.typeData[s];if(i.imageBase64&&i.imageBase64.includes("data:image/")){const l=base64ToFile(i.imageBase64,s),n=new FormData;n.append("file",l),Ua(s,n).then((i=>{e.typeData[s].imageBase64=i,t+=1,t===Object.keys(e.typeData).length&&(N(e,a),w.value.setData(e).then((({typeList:e})=>{P(e),drawType.value=w.value.getDrawType(),f.value=w.value.getCanvasStyle()})))}))}else t+=1,t===Object.keys(e.typeData).length&&(N(e,a),w.value.setData(e).then((({typeList:e})=>{P(e),drawType.value=w.value.getDrawType(),f.value=w.value.getCanvasStyle()})))}))}))}))},N=(e,t)=>{const s={viewData:e};Object.keys(e.typeData).forEach((t=>{s[t]={statics:e.typeData[t].loraInfo.statics,prompts:e.typeData[t].loraInfo.prompts}})),groupList.value.forEach((e=>{s[e.uuid]=e.loraInfo}));const a=JSON.stringify(s),i=new Blob([a],{type:"application/json"}),l=new File([i],`${name.value}.json`,{type:"application/json",lastModified:Date.now()}),n=new FormData;n.append("file",l),nt(n,TEMPLATE_TYPE,name.value,t).then((e=>{ElMessage.success("保存成功")}))};l((()=>{U()}));const j=()=>{const e=He(),t=w.value.getAllGroup();w.value.getGroupTaskResult(t).then((t=>{Object.keys(t).forEach((s=>{w.value.changeImage(s,t[s]).then((()=>{e.close()}))}))}))};return t({toSettingLayer:(...e)=>{c.value.show(...e)},setSelectedLayer:e=>{w.value.setTypeUuid(e)},deleteGroup:e=>{w.value.deleteGroup(e)},deleteLayer:e=>{w.value.deleteType(e).then((({typeList:e,groups:t})=>{D(t),P(e)}))},deleteElement:e=>{w.value.deleteElement(e),P(typeList)},setGroup:e=>{const{layerUuids:t,groupUuid:s}=e;if(s){if(1===t.length&&s){const e=w.value.getGroupItem(s).layers.concat(t),a=w.value.updateGroup(s,{layers:[...new Set(e)]});D(a)}}else c.value.show(null,"group",e)},hideLayer:e=>{w.value.setHideLayer(e),E()},reGenerateGroup:(...e)=>{w.value.reGenerateGroup(...e)},reGenerateLayer:(...e)=>{w.value.reGenerateLayer(...e)},reGenerateElement:(...e)=>{w.value.reGenerateElement(...e)}}),(e,t)=>(u(),n("div",Ma,[K(m("div",{class:"model-draw-area",ref_key:"modelEditorDom",ref:r},null,512),[[Q,"editor"===v.value]]),"explosion"===v.value?(u(),n("div",Aa,[y(Oa,{explosionStyle:f.value,data:g.value,ref_key:"explosionDiagramDom",ref:p},null,8,["explosionStyle","data"])])):d("",!0),m("div",Ga,[y(Ys,{handleType:k.value,onToCanvasSetting:C,onChangeHandleType:S,onExportImage:_,onChangeViewType:L,onToGenrateGroup:j,onSave:A,editorType:a.editorType},null,8,["handleType","editorType"])]),y(ta,{ref_key:"editorDrawBoardSettingDom",ref:h,onSave:I},null,512),y(wa,{ref_key:"editorLayerSettingDom",ref:c,staticsList:a.staticsList,promptsList:a.promptsList,onSave:O,onSaveGroup:M},null,8,["staticsList","promptsList"])]))}},[["__scopeId","data-v-4f2f8293"]]);const ja={class:"model-editor"};var Ra={tButton:Et,tTag:St,tMask:ve,modelCard:Pt,modelEditor:pe({__name:"index",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},editorType:{}},setup(e){const t=e,s=i(null),a=i([]),l=i([]),o=e=>{a.value=e},r=e=>{s.value.setSelectedLayer(e)},d=e=>{l.value=e},h=(...e)=>{s.value.toSettingLayer(...e)},c=e=>{s.value.deleteGroup(e)},m=e=>{s.value.deleteLayer(e)},p=e=>{s.value.deleteElement(e)},v=e=>{s.value.setGroup(e)},g=e=>{s.value.hideLayer(e)},f=(...e)=>{s.value.reGenerateGroup(...e)},w=(...e)=>{s.value.reGenerateLayer(...e)},b=(...e)=>{s.value.reGenerateElement(...e)};return(e,i)=>(u(),n("div",ja,[y(Na,{staticsList:t.staticsList,promptsList:t.promptsList,ref_key:"modelDrawBoardDom",ref:s,onSetTypeList:o,onSetGroupList:d,setting:t.setting,editorType:t.editorType},null,8,["staticsList","promptsList","setting","editorType"]),y(Ss,{typeList:a.value,groupList:l.value,onToLayerInfo:h,onSetSelectedLayer:r,onDeleteGroup:c,onDeleteLayer:m,onDeleteElement:p,onSetGroup:v,onHideLayer:g,onReGenerateGroup:f,onReGenerateLayer:w,onReGenerateElement:b,editorType:t.editorType},null,8,["typeList","groupList","editorType"])]))}},[["__scopeId","data-v-78d19b06"]])};const Ha=te(kt);Ha.use(Y()),Ha.use(ht),Ha.use(se,{locale:ae}),Ha.use(ie,{Options:{url:"data-source",inline:!0,button:!0,transition:!0}}),Object.keys(Ra).forEach((e=>{Ha.component(e,Ra[e])})),Ha.mount("#app");export{He as T,pe as _,lt as a,Se as c,ot as d,it as g,nt as s};
