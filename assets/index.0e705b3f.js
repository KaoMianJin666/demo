import{r as e,o as t,c as a,u as i,a as s,b as l,d as n,e as r,f as o,g as h,h as d,w as c,F as u,i as m,j as g,t as v,p,k as f,l as A,m as w,E as y,n as D,q as b,s as I,v as L,x,y as k,z as C,A as S,B as Y,C as M,D as P,G as R,H as V,I as X,J as T,K as E,L as W,M as U,N as j}from"./lib.6c1a984f.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var F=(e,t)=>{const a=e.__vccOpts||e;for(const[i,s]of t)a[i]=s;return a};var N=F({},[["render",function(i,s){const l=e("RouterView");return t(),a(l,{id:"main-view"})}]]);const O=e=>(p("data-v-d559f7de"),e=e(),f(),e),_={class:"nav-bar-body"},Z={class:"logo-area"},Q=["src"],G={class:"router-link-area"},H={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},q=[O((()=>o("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),O((()=>o("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],z=O((()=>o("div",{class:"user-phone-no"}," 188 8888 8888 ",-1))),B=O((()=>o("div",{class:"line"},null,-1))),J=O((()=>o("div",{class:"logout-btn"},[o("span",null,"退出")],-1)));var K=F({__name:"navBar",setup(a){const p=i(),f=s(),A=[{name:"图生图",path:"ImageGenerationImage"},{name:"Ai换脸",path:"swapFace"},{name:"局部修改",path:"partialModifications"}];let w=l("1");const y=e=>{p.push(A[Number(e)].path)};return n((()=>{w.value=String(A.findIndex((e=>e.path===f.name)))})),(a,i)=>{const s=e("el-menu-item"),l=e("el-menu");return t(),r("div",_,[o("div",Z,[o("img",{src:h("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVQAAABSCAYAAAALvCwcAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ4IDc5LjE2NDAzNiwgMjAxOS8wOC8xMy0wMTowNjo1NyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjM3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxOEFGNERGMTdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOEFGNERGMjdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgnCosYAAA7KSURBVHja7F3t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")},null,8,Q)]),o("div",G,[d(l,{"background-color":"#22335D","text-color":"#ffffff","default-active":h(w),class:"el-menu-demo",mode:"horizontal",onSelect:y},{default:c((()=>[(t(),r(u,null,m(A,((e,a)=>d(s,{key:a,index:String(a)},{default:c((()=>[(t(),r("svg",H,q)),g(" "+v(e.name),1)])),_:2},1032,["index"]))),64))])),_:1},8,["default-active"])]),o("div",{class:"handle-area"},[z,B,o("div",{class:"user-profile-image"},[o("img",{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})]),J])])}}},[["__scopeId","data-v-d559f7de"]]);const $={class:"home-body"},ee={class:"home-child-view"};var te=F({__name:"index",setup:a=>(a,i)=>{const s=e("router-view");return t(),r("div",$,[d(K),o("div",ee,[d(s)])])}},[["__scopeId","data-v-f24c8a92"]]);const ae=e=>(p("data-v-0eca47cb"),e=e(),f(),e),ie={class:"main-body"},se={class:"image-area"},le=ae((()=>o("div",{class:"main-title"},"参考图",-1))),ne={class:"image-all"},re={class:"image-item upload-image-area"},oe={class:"upload-text-tips"},he=ae((()=>o("div",{class:"upload-text"},"点击上传",-1))),de={class:"other-images"},ce={class:"other-images-view-box"},ue={class:"del-btn"},me={class:"image-handl-area"},ge=ae((()=>o("label",null,"权重",-1))),ve=ae((()=>o("div",{class:"main-title"},null,-1))),pe={class:"bottom-area"},fe={class:"handle-area"},Ae=ae((()=>o("div",{class:"main-title"},"正向提示词",-1))),we={class:"handle-item"},ye=ae((()=>o("div",{class:"main-title"},"负向提示词",-1))),De={class:"handle-item"},be={class:"handle-item"},Ie={class:"handle-min"},Le=ae((()=>o("div",{class:"main-title"},"风格",-1))),xe={class:"handle-min"},ke=ae((()=>o("div",{class:"main-title"},"相似度",-1))),Ce={class:"handle-min-slider"},Se={class:"handle-min"},Ye=ae((()=>o("div",{class:"main-title"},"宽度",-1))),Me={class:"handle-min"},Pe=ae((()=>o("div",{class:"main-title"},"高度",-1))),Re=ae((()=>o("div",{class:"main-title"},"线稿参考图",-1))),Ve={class:"handle-item bg"},Xe={class:"line-draft-image-area"},Te={class:"upload-image-area-other"},Ee=["src"],We={key:1,class:"upload-text-tips"},Ue=ae((()=>o("div",{class:"upload-text"},"点击上传",-1))),je={class:"image-handl-area"},Fe=ae((()=>o("label",null,"权重",-1))),Ne={class:"generate-btn"},Oe={class:"review-area"},_e="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var Ze=F({__name:"index",setup(i){const s=l([]),v=l(null),p=l(null),f=l([]),k=l(null),C=l(70),S=l(""),Y=l(""),M=l(1024),P=l(1024),R=l(70),V=l(""),X=e=>{const t=new FileReader;return t.onload=({target:t})=>{s.value.length>=5||s.value.push({file:e,url:t.result,weight:100})},t.readAsDataURL(e),!1},T=e=>{v.value=e;const t=new FileReader;return t.onload=({target:e})=>{p.value=e.result},t.readAsDataURL(e),!1},E=()=>{v.value=null,p.value=null},W=()=>{if(!s.value.length)return y.error("请至少上传一张参考图"),!1;if(!k.value)return y.error("请选择风格后操作"),!1;const e=(()=>{const e=new FormData;return e.append("base_model",k.value),v.value&&(e.append("lineart",v.value||""),e.append("lineart_weight",C.value/100)),e.append("positive_prompt",S.value),e.append("negative_prompt",Y.value),e.append("ref_num",R.value/100),e.append("width",M.value),e.append("reheight",P.value),s.value.forEach((({weight:t,file:a})=>{e.append("weights",t/100),e.append("files",a)})),e})(),t=D.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${_e}/img2img/gen`,e).then((e=>{t.close(),V.value=`${_e}/img2img/${e.data}`})).catch((e=>{t.close(),e.response&&413===e.response.status&&y.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{w.get(`${_e}/img2img/base_models`).then((e=>{Object.keys(e.data).forEach((t=>{f.value.push({name:t,value:e.data[t]})}))}))})),(i,l)=>{const n=e("el-icon"),v=e("el-upload"),w=e("el-image"),y=e("el-slider"),D=e("el-scrollbar"),U=e("el-input"),j=e("el-option"),F=e("el-select"),N=e("el-input-number"),O=e("el-button");return t(),r("div",ie,[o("div",se,[le,o("div",ne,[o("div",re,[d(v,{class:"avatar-uploader",drag:"",multiple:"",limit:5,disabled:s.value.length>=5,action:"","show-file-list":!1,"before-upload":X},{default:c((()=>[o("div",oe,[d(n,{class:"avatar-uploader-icon"},{default:c((()=>[d(h(I))])),_:1}),he])])),_:1},8,["disabled"])]),o("div",de,[d(D,null,{default:c((()=>[o("div",ce,[(t(!0),r(u,null,m(s.value,((e,a)=>(t(),r("div",{class:"image-item",key:a},[d(w,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),o("div",ue,[d(n,{style:{color:"red"},onClick:e=>(e=>{s.value.splice(e,1)})(a)},{default:c((()=>[d(h(L))])),_:2},1032,["onClick"])]),o("div",me,[ge,d(y,{modelValue:e.weight,"onUpdate:modelValue":t=>e.weight=t,style:{width:"calc(100% - 50px)"},min:0,max:100,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])])),_:1})])])]),ve,o("div",pe,[o("div",fe,[d(D,null,{default:c((()=>[Ae,o("div",we,[d(U,{type:"textarea",modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value=e),maxlength:"255"},null,8,["modelValue"])]),ye,o("div",De,[d(U,{type:"textarea",modelValue:Y.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Y.value=e),maxlength:"255"},null,8,["modelValue"])]),o("div",be,[o("div",Ie,[Le,d(F,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=e=>k.value=e)},{default:c((()=>[(t(!0),r(u,null,m(f.value,(e=>(t(),a(j,{key:e.name,value:e.value,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),o("div",xe,[ke,o("div",Ce,[d(y,{modelValue:R.value,"onUpdate:modelValue":l[3]||(l[3]=e=>R.value=e)},null,8,["modelValue"])])]),o("div",Se,[Ye,d(N,{style:{width:"100%"},modelValue:M.value,"onUpdate:modelValue":l[4]||(l[4]=e=>M.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])]),o("div",Me,[Pe,d(N,{style:{width:"100%"},modelValue:P.value,"onUpdate:modelValue":l[5]||(l[5]=e=>P.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])])]),Re,o("div",Ve,[o("div",Xe,[o("div",Te,[d(v,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":T},{default:c((()=>[p.value?(t(),r("div",{key:0,class:"upload-image-del-area",onClick:l[7]||(l[7]=b((()=>{}),["stop"]))},[o("img",{src:p.value,class:"avatar"},null,8,Ee),o("div",{class:"upload-image-del-btn-area",onClick:l[6]||(l[6]=b((()=>{}),["stop"]))},[o("div",{class:"upload-image-del-btn",onClick:b(E,["stop"])},[d(n,null,{default:c((()=>[d(h(x))])),_:1})])])])):(t(),r("div",We,[d(n,{class:"avatar-uploader-icon"},{default:c((()=>[d(h(I))])),_:1}),Ue]))])),_:1})]),o("div",je,[Fe,d(y,{style:{width:"calc(100% - 50px)"},disabled:!p.value,modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=e=>C.value=e),min:0,max:100,size:"small"},null,8,["disabled","modelValue"])])])])])),_:1}),o("div",Ne,[d(O,{style:{width:"100%"},type:"primary",onClick:l[9]||(l[9]=e=>W())},{default:c((()=>[g("生成")])),_:1})])]),o("div",Oe,[V.value?(t(),a(w,{key:0,fit:"scale-down",src:V.value,"preview-src-list":[V.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):A("",!0)])])])}}},[["__scopeId","data-v-0eca47cb"]]);function Qe(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],i=atob(t[1]);let s=i.length;const l=new Uint8Array(s);for(;s--;)l[s]=i.charCodeAt(s);return new Blob([l],{type:a})}class Ge{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,t){const{canvasDom:a}=this;switch(this.clearHandle(),e){case"selectionArea":a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(a,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"clearArea":a.style.cursor="none",this.addListener(a,"mousedown",(e=>{this.clearAreaStart(e,t)})),this.addListener(a,"mouseup",(e=>{this.clearAreaFinish(e,t)})),this.addListener(a,"mousemove",(e=>{this.clearAreaMoving(e,t)}));break;default:this.clearHandle()}}clearAreaStart(e,t){const{offsetX:a,offsetY:i}=e,{clearSetting:s}=this,{radius:l}=s;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:l,handleX:a,handleY:i,type:"clearArea",clearType:t,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:t,offsetY:a}=e,{ctx:i,clearSetting:s}=this,{radius:l}=s;i.beginPath(),i.arc(t,a,l,0,2*Math.PI),i.stroke(),i.closePath()}clearAreaMoving(e){const{offsetX:t,offsetY:a}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:t,offsetY:a,radius:s}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:t,canvasDom:a}=this,{width:i,height:s}=a;this.handleList=[],t.beginPath(),t.clearRect(0,0,i,s),t.closePath();const l=new Image;l.src=e,l.onload=()=>{this.initImageData(l),this.drawImage()}}initImageData(e){const{canvasDom:t}=this,{width:a,height:i}=t,s=e.width,l=e.height,n={image:e,x:0,y:0,height:0,width:0};if(l>i||s>a)if(l/i>s/a){const e=i/l;n.height=i,n.width=e*s,n.y=0,n.x=a/2-n.width/2}else{const e=a/s;n.width=a,n.height=e*l,n.x=0,n.y=i/2-n.height/2}else if(l>s){const e=i/a;n.height=i,n.width=i/e,n.y=0,n.x=a/2-n.width/2}else{const e=a/i;n.width=a,n.height=a/e,n.y=i/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:t,y:a,width:i,height:s}=this.imageData,{ctx:l}=this;e&&(l.beginPath(),l.drawImage(e,t,a,i,s),l.closePath())}reDraw(){const{ctx:e,canvasDom:t,imageData:a}=this,{image:i}=a,{width:s,height:l}=t;e.beginPath(),e.clearRect(0,0,s,l),e.closePath(),i&&(this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((t=>{let{type:a}=t;if("selectionArea"===a){let{handleX:a,handleY:i,offsetX:s,offsetY:l,status:n}=t;e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const r=a>s?s:a,o=i>l?l:i,h=a>s?a-s:s-a,d=i>l?i-l:l-i;if((!h||!d)&&n)return;e.rect(r,o,h,d),e.stroke(),e.closePath()}if("clearArea"===a){let{clearType:a,dataList:i,offsetX:s,offsetY:l,radius:n}=t;"arc"==a&&(e.beginPath(),e.globalCompositeOperation="xor",e.moveTo(s+n,l+n),e.arc(s,l,n,0,2*Math.PI),i.forEach((t=>{e.moveTo(t.offsetX+t.radius,t.offsetY+t.radius),e.arc(t.offsetX,t.offsetY,t.radius,0,2*Math.PI)})),e.fill(),e.closePath())}})))}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((t,a)=>{let{type:i}=t;if("selectionArea"===i){const{handleX:i,handleY:s,offsetX:l,offsetY:n,status:r,imageData:o}=t,h=this.canvasDom.width,d=this.canvasDom.height,c=this.imageData.width;this.imageData.height;const u=h===c?d/e.height:h/e.width;if(r&&!o){const r=document.createElement("canvas");r.width=h/u,r.height=d/u;const o=r.getContext("2d"),c=i>l?l:i,m=s>n?n:s,g=i>l?i-l:l-i,v=s>n?s-n:n-s;if(o.beginPath(),o.drawImage(e,this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),o.clearRect(Math.round(c/u),Math.round(m/u),Math.round(g/u),Math.round(v/u)),o.closePath(),!g||!v)return;const p=o.getImageData(this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/u),f.height=Math.round(this.imageData.height/u);f.getContext("2d").putImageData(p,0,0);const A=Qe(f.toDataURL("image/png"));t.imageData=new File([A],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}if("clearArea"===i){const{clearType:i,dataList:s,offsetX:l,offsetY:n,radius:r,status:o,imageData:h}=t,d=this.canvasDom.width,c=this.canvasDom.height,u=this.imageData.width;this.imageData.height;const m=d===u?c/e.height:d/e.width;if(o&&!h&&"arc"==i){const i=document.createElement("canvas");i.width=d/m,i.height=c/m;const o=i.getContext("2d");o.beginPath(),o.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),o.closePath(),o.beginPath(),o.globalCompositeOperation="xor",o.moveTo((l+r)/m,(n+r)/m),o.arc(l,n,r,0,2*Math.PI),s.forEach((e=>{o.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),o.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),o.fill(),o.closePath();const h=o.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),u=document.createElement("canvas");u.width=Math.round(this.imageData.width/m),u.height=Math.round(this.imageData.height/m);u.getContext("2d").putImageData(h,0,0);const g=Qe(u.toDataURL("image/png"));t.imageData=new File([g],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}}))}addListener(e,t,a){e.addEventListener(t,a);var i=t+"_"+a.toString();this.listeners[i]={element:e,eventType:t,listener:a}}removeAllListeners(){for(var e in this.listeners){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:t}=this,{width:a,height:i}=t;e.beginPath(),e.clearRect(0,0,a,i),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const He=e=>(p("data-v-061b6b3e"),e=e(),f(),e),qe={class:"main-body"},ze={class:"image-area"},Be=He((()=>o("div",{class:"main-title"},"模特照片",-1))),Je={class:"image-all"},Ke={class:"image-item upload-image-area"},$e={class:"upload-text-tips"},et=He((()=>o("div",{class:"upload-text"},"点击上传",-1))),tt={class:"other-images"},at={class:"other-images-view-box"},it={class:"del-btn"},st=He((()=>o("div",{class:"main-title"},null,-1))),lt={class:"bottom-area"},nt={class:"handle-area"},rt=He((()=>o("div",{class:"main-title"},"正向提示词",-1))),ot={class:"handle-item"},ht=He((()=>o("div",{class:"main-title"},"负向提示词",-1))),dt={class:"handle-item"},ct=He((()=>o("div",{class:"main-title"},"待换脸人像",-1))),ut={class:"handle-item bg"},mt={class:"line-draft-image-area"},gt={class:"upload-image-area-other"},vt=["src"],pt={key:1,class:"upload-text-tips"},ft=He((()=>o("div",{class:"upload-text"},"点击上传",-1))),At={class:"image-handl-area"},wt=He((()=>o("label",null,"笔刷半径",-1))),yt={class:"image-handl-area"},Dt=He((()=>o("div",{class:"main-title"},"相似度",-1))),bt={class:"handle-item"},It={class:"handle-min-slider"},Lt={class:"generate-btn"},xt={class:"review-area"},kt="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var Ct=F({__name:"index",setup(i){const s=l([]),v=l(null),p=l(null);l([]),l(null),l(70);const f=l(""),k=l("");l(1024),l(1024);const C=l(70),S=l(""),Y=l(0),M=l(null),P=l(10),R=e=>{const t=new FileReader;return t.onload=({target:t})=>{s.value.length>=15||s.value.push({file:e,url:t.result,weight:100})},t.readAsDataURL(e),!1},V=e=>{v.value=e;const t=new FileReader;return t.onload=({target:e})=>{p.value=e.result,M.value.initImage(p.value)},t.readAsDataURL(e),!1},X=()=>{v.value=null,p.value=null},T=()=>{if(!s.value.length)return y.error("请至少上传一张模特照片"),!1;if(!v.value)return y.error("请上传待换脸人像后操作"),!1;if(!M.value.handleList.length)return y.error("款选人脸区域后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",f.value),e.append("negative_prompt",k.value),e.append("mask_strength",C.value/100),s.value.forEach((({weight:t,file:a})=>{e.append("ref_faces",a)})),e.append("face",v.value),M.value.handleList.forEach((({imageData:t})=>{e.append("face_mask",t)})),e})(),t=D.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${kt}/img2img/swap_face`,e).then((e=>{if(t.close(),"未检测到人脸，请扩大人脸选区区域！"===e.data)return y.error(e.data),!1;S.value=`${kt}/img2img/${e.data}`})).catch((e=>{t.close(),e.response&&413===e.response.status&&y.error("上传图片过大, 请减少图片数量或者大小")}))},E=()=>{M.value.clearSelectionArea()},W=()=>{M.value.setClearAreaRadius(P.value)};return n((()=>{M.value=new Ge(Y.value),M.value.handleChange("clearArea","arc")})),(i,l)=>{const n=e("el-icon"),v=e("el-upload"),w=e("el-image"),y=e("el-scrollbar"),D=e("el-input"),M=e("el-slider"),U=e("el-button");return t(),r("div",qe,[o("div",ze,[Be,o("div",Je,[o("div",Ke,[d(v,{class:"avatar-uploader",drag:"",multiple:"",limit:15,disabled:s.value.length>=15,action:"","show-file-list":!1,"before-upload":R},{default:c((()=>[o("div",$e,[d(n,{class:"avatar-uploader-icon"},{default:c((()=>[d(h(I))])),_:1}),et])])),_:1},8,["disabled"])]),o("div",tt,[d(y,null,{default:c((()=>[o("div",at,[(t(!0),r(u,null,m(s.value,((e,a)=>(t(),r("div",{class:"image-item",key:a},[d(w,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),o("div",it,[d(n,{style:{color:"red"},onClick:e=>(e=>{s.value.splice(e,1)})(a)},{default:c((()=>[d(h(L))])),_:2},1032,["onClick"])])])))),128))])])),_:1})])])]),st,o("div",lt,[o("div",nt,[d(y,null,{default:c((()=>[rt,o("div",ot,[d(D,{type:"textarea",modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e),maxlength:"255"},null,8,["modelValue"])]),ht,o("div",dt,[d(D,{type:"textarea",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value=e),maxlength:"255"},null,8,["modelValue"])]),ct,o("div",ut,[o("div",mt,[o("div",gt,[d(v,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":V},{default:c((()=>[p.value?(t(),r("div",{key:0,class:"upload-image-del-area",onClick:l[3]||(l[3]=b((()=>{}),["stop"]))},[o("img",{src:p.value,class:"avatar"},null,8,vt),o("div",{class:"upload-image-del-btn-area",onClick:l[2]||(l[2]=b((()=>{}),["stop"]))},[o("div",{class:"upload-image-del-btn",onClick:b(X,["stop"])},[d(n,null,{default:c((()=>[d(h(x))])),_:1})])])])):(t(),r("div",pt,[d(n,{class:"avatar-uploader-icon"},{default:c((()=>[d(h(I))])),_:1}),ft]))])),_:1}),o("div",At,[wt,d(M,{style:{width:"calc(100% - 50px)"},modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value=e),onChange:W,min:1,max:100,size:"small"},null,8,["modelValue"])])]),o("div",yt,[o("div",{class:"main-title"},[g(" 框选人脸区域 "),o("div",{class:"title-handle-area",onClick:E}," 重置 ")]),o("canvas",{ref_key:"canvasDom",ref:Y},null,512)])])]),Dt,o("div",bt,[o("div",It,[d(M,{modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=e=>C.value=e)},null,8,["modelValue"])])])])),_:1}),o("div",Lt,[d(U,{style:{width:"100%"},type:"primary",onClick:l[6]||(l[6]=e=>T())},{default:c((()=>[g("生成")])),_:1})])]),o("div",xt,[S.value?(t(),a(w,{key:0,fit:"scale-down",src:S.value,"preview-src-list":[S.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):A("",!0)])])])}}},[["__scopeId","data-v-061b6b3e"]]);const St={class:"layout-body"},Yt={class:"layout-right"};var Mt=F({__name:"layout",props:{leftStyle:{}},setup:e=>(a,i)=>(t(),r("div",St,[o("div",{class:"layout-left",style:C(e.leftStyle)},[k(a.$slots,"left",{},void 0,!0)],4),k(a.$slots,"center",{},void 0,!0),o("div",Yt,[k(a.$slots,"right",{},void 0,!0)])]))},[["__scopeId","data-v-2be9378c"]]);function Pt(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],i=atob(t[1]);let s=i.length;const l=new Uint8Array(s);for(;s--;)l[s]=i.charCodeAt(s);return new Blob([l],{type:a})}class Rt{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.finishImage=null,this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,t){const{canvasDom:a}=this;switch(this.clearHandle(),e){case"selectionArea":a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionAreaFinish(e),this.getFinishImage()})),this.addListener(a,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"selectionArcArea":a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionArcAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionArcAreaFinish(e),this.getFinishImage()})),this.addListener(a,"mousemove",(e=>{this.selectionArcAreaMoving(e)}));break;case"clearArea":a.style.cursor="none",this.addListener(a,"mousedown",(e=>{this.clearAreaStart(e,t)})),this.addListener(a,"mouseup",(e=>{this.clearAreaFinish(e,t),this.getFinishImage()})),this.addListener(a,"mousemove",(e=>{this.clearAreaMoving(e,t)}));break;default:this.clearHandle()}}selectionArcAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,type:"selectionArcArea",status:0,imageData:null})}selectionArcAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionArcAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearAreaStart(e,t){const{offsetX:a,offsetY:i}=e,{clearSetting:s}=this,{radius:l}=s;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:l,handleX:a,handleY:i,type:"clearArea",clearType:t,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:t,offsetY:a}=e,{ctx:i,clearSetting:s}=this,{radius:l}=s;i.beginPath(),i.arc(t,a,l,0,2*Math.PI),i.stroke(),i.closePath()}clearAreaMoving(e){const{offsetX:t,offsetY:a}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:t,offsetY:a,radius:s}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:t,canvasDom:a}=this,{width:i,height:s}=a;this.handleList=[],t.beginPath(),t.clearRect(0,0,i,s),t.closePath();const l=new Image;l.src=e,l.onload=()=>{this.initImageData(l),this.drawImage()}}initImageData(e){const{canvasDom:t}=this,{width:a,height:i}=t,s=e.width,l=e.height,n={image:e,x:0,y:0,height:0,width:0};if(l>i||s>a)if(l/i>s/a){const e=i/l;n.height=i,n.width=e*s,n.y=0,n.x=a/2-n.width/2}else{const e=a/s;n.width=a,n.height=e*l,n.x=0,n.y=i/2-n.height/2}else if(l>s){const e=i/a;n.height=i,n.width=i/e,n.y=0,n.x=a/2-n.width/2}else{const e=a/i;n.width=a,n.height=a/e,n.y=i/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:t,y:a,width:i,height:s}=this.imageData,{ctx:l}=this;e&&(l.beginPath(),l.drawImage(e,t,a,i,s),l.closePath())}reDraw(){const{ctx:e,canvasDom:t,imageData:a}=this,{image:i}=a,{width:s,height:l}=t;e.beginPath(),e.clearRect(0,0,s,l),e.closePath(),i&&(this.drawImage(),this.getSelecttionAreaImages(),e.beginPath(),this.handleList.forEach((t=>{e.globalCompositeOperation="xor";let{type:a}=t;if("selectionArea"===a){let{handleX:a,handleY:i,offsetX:s,offsetY:l,status:n}=t;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const r=a>s?s:a,o=i>l?l:i,h=a>s?a-s:s-a,d=i>l?i-l:l-i;if((!h||!d)&&n)return;e.rect(r,o,h,d)}if("selectionArcArea"===a){let{handleX:a,handleY:i,offsetX:s,offsetY:l,status:n}=t;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const r=a>s?s:a,o=i>l?l:i,h=a>s?a-s:s-a,d=i>l?i-l:l-i,c=Math.sqrt(h*h+d*d)/2;if((!h||!d)&&n)return;e.moveTo(r+h/2-c,o+d/2-c),e.arc(r+h/2,o+d/2,c,0,2*Math.PI)}if("clearArea"===a){let{clearType:a,dataList:i,offsetX:s,offsetY:l,radius:n}=t;e.moveTo(s+n,l+n),e.arc(s,l,n,0,2*Math.PI),i.forEach((t=>{e.moveTo(t.offsetX+t.radius,t.offsetY+t.radius),e.arc(t.offsetX,t.offsetY,t.radius,0,2*Math.PI)}))}})),e.fill(),e.closePath())}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((t,a)=>{let{type:i}=t;if("selectionArea"===i){const{handleX:i,handleY:s,offsetX:l,offsetY:n,status:r,imageData:o}=t,h=this.canvasDom.width,d=this.canvasDom.height,c=this.imageData.width;this.imageData.height;const u=h===c?d/e.height:h/e.width;if(r&&!o){const r=document.createElement("canvas");r.width=h/u,r.height=d/u;const o=r.getContext("2d"),c=i>l?l:i,m=s>n?n:s,g=i>l?i-l:l-i,v=s>n?s-n:n-s;if(o.beginPath(),o.drawImage(e,this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),o.clearRect(Math.round(c/u),Math.round(m/u),Math.round(g/u),Math.round(v/u)),o.closePath(),!g||!v)return;const p=o.getImageData(this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/u),f.height=Math.round(this.imageData.height/u);f.getContext("2d").putImageData(p,0,0);const A=Pt(f.toDataURL("image/png"));t.imageData=new File([A],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}if("clearArea"===i){const{clearType:i,dataList:s,offsetX:l,offsetY:n,radius:r,status:o,imageData:h}=t,d=this.canvasDom.width,c=this.canvasDom.height,u=this.imageData.width;this.imageData.height;const m=d===u?c/e.height:d/e.width;if(o&&!h&&"arc"==i){const i=document.createElement("canvas");i.width=d/m,i.height=c/m;const o=i.getContext("2d");o.beginPath(),o.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),o.closePath(),o.beginPath(),o.globalCompositeOperation="xor",o.moveTo((l+r)/m,(n+r)/m),o.arc(l,n,r,0,2*Math.PI),s.forEach((e=>{o.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),o.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),o.fill(),o.closePath();const h=o.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),u=document.createElement("canvas");u.width=Math.round(this.imageData.width/m),u.height=Math.round(this.imageData.height/m);u.getContext("2d").putImageData(h,0,0);const g=Pt(u.toDataURL("image/png"));t.imageData=new File([g],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}}))}getFinishImage(){const{image:e}=this.imageData,t=this.canvasDom.width,a=this.canvasDom.height,i=this.imageData.width;this.imageData.height;const s=t===i?a/e.height:t/e.width,l=document.createElement("canvas");l.width=t/s,l.height=a/s;const n=l.getContext("2d");n.beginPath(),n.drawImage(e,this.imageData.x/s,this.imageData.y/s,this.imageData.width/s,this.imageData.height/s),n.closePath(),n.globalCompositeOperation="xor",n.beginPath(),this.handleList.forEach(((e,t)=>{const{type:a}=e;if("selectionArea"===a){let{handleX:t,handleY:a,offsetX:i,offsetY:l,status:r}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const o=t>i?i:t,h=a>l?l:a,d=t>i?t-i:i-t,c=a>l?a-l:l-a;if((!d||!c)&&r)return;n.rect(o/s,h/s,d/s,c/s)}if("clearArea"===a){let{clearType:t,dataList:a,offsetX:i,offsetY:l,radius:r}=e;n.moveTo((i+r)/s,(l+r)/s),n.arc(i/s,l/s,r/s,0,2*Math.PI),a.forEach((e=>{n.moveTo((e.offsetX+e.radius)/s,(e.offsetY+e.radius)/s),n.arc(e.offsetX/s,e.offsetY/s,e.radius/s,0,2*Math.PI)}))}if("selectionArcArea"===a){let{handleX:t,handleY:a,offsetX:i,offsetY:l,status:r}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const o=t>i?i:t,h=a>l?l:a,d=t>i?t-i:i-t,c=a>l?a-l:l-a,u=Math.sqrt(d*d+c*c)/2;if((!d||!c)&&r)return;n.moveTo((o+d/2-u)/s,(h+c/2-u)/s),n.arc((o+d/2)/s,(h+c/2)/s,u/s,0,2*Math.PI)}})),n.fill(),n.closePath();const r=n.getImageData(this.imageData.x/s,this.imageData.y/s,this.imageData.width/s,this.imageData.height/s),o=document.createElement("canvas");o.width=Math.round(this.imageData.width/s),o.height=Math.round(this.imageData.height/s);o.getContext("2d").putImageData(r,0,0);const h=Pt(o.toDataURL("image/png"));this.finishImage=new File([h],`${(new Date).getTime()}_finish.png`,{type:"image/png"})}addListener(e,t,a){e.addEventListener(t,a);var i=t+"_"+a.toString();this.listeners[i]={element:e,eventType:t,listener:a}}removeAllListeners(){for(var e in this.listeners){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.finishImage=null,this.reDraw()}clearAll(){const{ctx:e,canvasDom:t}=this,{width:a,height:i}=t;e.beginPath(),e.clearRect(0,0,a,i),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const Vt=e=>(p("data-v-ff43bea8"),e=e(),f(),e),Xt={class:"super-image-search-body"},Tt={class:"image-search-title"},Et={key:8,class:"image-handle-setting"},Wt=Vt((()=>o("label",null," 笔刷半径 ",-1))),Ut={class:"image-search-title-handle"},jt={class:"content"},Ft={class:"search-btn-area"},Nt=Vt((()=>o("div",{class:"image-search-title",style:{height:"30px"}},[o("div",null,"提示词")],-1))),Ot={class:"prompt-area"},_t={class:"prompt-item"},Zt=Vt((()=>o("div",{class:"prompt-item-label"},"正向提示词",-1))),Qt={class:"prompt-item-input"},Gt={class:"prompt-item"},Ht=Vt((()=>o("div",{class:"prompt-item-label"},"负向提示词",-1))),qt={class:"prompt-item-input"},zt={class:"prompt-btn"},Bt=Vt((()=>o("div",{class:"image-search-title",style:{height:"30px"}},[o("div",null,"生成图片")],-1))),Jt={class:"content",style:{height:"calc(100% - 40px)"}},Kt="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var $t=F({__name:"index",setup(i){const s=l(null),u=l(null),m=l(null),v=l(0);l(0);const p=l(10),f=l(""),b=l(""),I=l(""),x=l(""),k=e=>{u.value?(f.value=e,m.value.handleChange(e)):y.error("请在上传图片后操作")},C=()=>{m.value.setClearAreaRadius(p.value)},R=e=>{s.value=e;const t=new FileReader;return t.onload=({target:e})=>{u.value=e.result,m.value.initImage(u.value)},t.readAsDataURL(e),!1};const V=()=>{if(!s.value)return y.error("请上传图片后操作"),!1;if(!m.value.finishImage)return y.error("请先设置图片遮罩区域"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",I.value),e.append("negative_prompt",x.value),e.append("image",s.value),e.append("image_with_mask",m.value.finishImage),e})(),t=D.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${Kt}/img2img/inpaint`,e).then((e=>{t.close(),b.value=`${Kt}/img2img/${e.data}`})).catch((e=>{t.close(),e.response&&413===e.response.status&&y.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{m.value=new Rt(v.value)})),(i,l)=>{const n=e("el-icon"),X=e("el-button"),T=e("el-slider"),E=e("el-upload"),W=e("el-input"),U=e("el-image");return t(),r("div",Xt,[d(Mt,{leftStyle:{width:"calc(50% - 180px)"}},{left:c((()=>[o("div",Tt,[o("div",null,["selectionArea"!==f.value&&u.value?(t(),a(X,{key:0,type:"primary",class:"title-handle-btn",onClick:l[0]||(l[0]=e=>k("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(Y))])),_:1}),g(" 矩形 ")])),_:1})):A("",!0),"selectionArea"===f.value&&u.value?(t(),a(X,{key:1,class:"title-handle-btn",type:"warning",onClick:l[1]||(l[1]=e=>k("")),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(Y))])),_:1}),g(" 矩形 ")])),_:1})):A("",!0),"selectionArcArea"!==f.value&&u.value?(t(),a(X,{key:2,type:"primary",class:"title-handle-btn",onClick:l[2]||(l[2]=e=>k("selectionArcArea")),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(M))])),_:1}),g(" 圆形 ")])),_:1})):A("",!0),"selectionArcArea"===f.value&&u.value?(t(),a(X,{key:3,class:"title-handle-btn",type:"warning",onClick:l[3]||(l[3]=e=>k("")),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(M))])),_:1}),g(" 圆形 ")])),_:1})):A("",!0),"clearArea"!==f.value&&u.value?(t(),a(X,{key:4,type:"primary",class:"title-handle-btn",onClick:l[4]||(l[4]=e=>k("clearArea")),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(P))])),_:1}),g(" 笔刷 ")])),_:1})):A("",!0),"clearArea"===f.value&&u.value?(t(),a(X,{key:5,class:"title-handle-btn",type:"warning",onClick:l[5]||(l[5]=e=>k("")),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(P))])),_:1}),g(" 笔刷 ")])),_:1})):A("",!0),u.value?(t(),a(X,{key:6,class:"title-handle-btn",type:"primary",onClick:l[6]||(l[6]=e=>{m.value.clearSelectionArea()}),style:{"font-size":"12px"}},{default:c((()=>[d(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[d(h(L))])),_:1}),g(" 重置 ")])),_:1})):A("",!0),u.value?(t(),a(X,{key:7,class:"title-handle-btn",type:"primary",onClick:l[7]||(l[7]=e=>{S.prompt("请输入要识别的物品类别,例如: 床, 被单, 人物(英文)等,多种类别之间请使用逗号分割","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:e})=>{if(!e)return void y.error("请输入prompt后操作");e=(e+=",").replaceAll("，",",");const t=D.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),a=new FormData;a.append("prompt",e),a.append("image",s.value),w.post(`${Kt}/img2img/segment`,a).then((e=>{t.close(),"没有识别到任何物体，需要给定更加详细的物体类别prompt"!==e.data?(m.value.clearSelectionArea(),m.value.initImage(`${Kt}/img2img/${e.data}`)):y.error(e.data)})).catch((e=>{t.close(),e.response&&413===e.response.status&&y.error("上传图片过大, 请减少图片数量或者大小")}))})).catch((()=>{y({type:"info",message:"取消操作"})}))}),style:{"font-size":"12px"}},{default:c((()=>[g(" Ai识别 ")])),_:1})):A("",!0),u.value?(t(),r("div",Et,[Wt,d(T,{style:{width:"100px","margin-left":"20px",display:"inline-block","padding-top":"9px"},modelValue:p.value,"onUpdate:modelValue":l[8]||(l[8]=e=>p.value=e),onChange:C,min:1,max:100},null,8,["modelValue"])])):A("",!0)]),o("div",Ut,[d(E,{class:"upload-demo","before-upload":R,"show-file-list":!1,action:""},{default:c((()=>[d(X,{type:"text"},{default:c((()=>[g("上传图片")])),_:1})])),_:1})])]),o("div",jt,[o("canvas",{ref_key:"canvasDom",ref:v},null,512)])])),center:c((()=>[o("div",Ft,[Nt,o("div",Ot,[o("div",_t,[Zt,o("div",Qt,[d(W,{type:"textarea",modelValue:I.value,"onUpdate:modelValue":l[9]||(l[9]=e=>I.value=e)},null,8,["modelValue"])])]),o("div",Gt,[Ht,o("div",qt,[d(W,{type:"textarea",modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=e=>x.value=e)},null,8,["modelValue"])])]),o("div",zt,[d(X,{type:"primary",style:{width:"100%"},onClick:V},{default:c((()=>[g(" 生成 ")])),_:1})])])])])),right:c((()=>[Bt,o("div",Jt,[d(U,{src:b.value,fit:"scale-down","preview-src-list":[b.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])])])),_:1},8,["leftStyle"])])}}},[["__scopeId","data-v-ff43bea8"]]);const ea="_AICLOTH_CONSOLE_",ta="_AICLOTH_CONSOLE__token";function aa(e){localStorage.setItem(ea+"USER",JSON.stringify(e))}function ia(){const e=R.get(ta);return""!==e||void 0!==e||null!==e?e:null}function sa(e,t){localStorage.setItem(ea+e,JSON.stringify(t))}const la=w.create({baseURL:"http://www.weishih-ai.com:10010/dev-api",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function na(e){if(!e.response)return y.error({message:"请求超时",description:`${e.toString()}`}),Promise.reject(e);ia();const t=e.response.status,a=e.response.data,{userStore:i}=da;return 401===t?(y.error({message:"登录失效, 请重新登陆"}),i.handleLogout().then((()=>{setTimeout((()=>{ca.replace("/login")}),1500)}))):400!==t&&500!==t||y.error({message:a.message}),Promise.reject(e)}la.interceptors.request.use((e=>{const t=ia()||"22";return t&&e.headers&&(e.headers["X-Auth-Token"]=t),e}),na),la.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),na);const ra=V({id:"users",state:()=>({user:null,permissions:null,token:"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((t,a)=>{var i;(i=e,la.post("/sso/api/v1/session/login",i)).then((e=>{const a=e.token;var i;this.token=a.token,this.user=a.user,this.workingTenant=a.working_tenant,sa("workingTenant",a.working_tenant),aa(a.user),i=a.token,R.set(ta,i,{expires:1}),t({...a.user,needPasswd:e.need_passwd}),la.get("/sso/api/v1/roles").then((e=>{sa("roles",e.roles||[])}))})).catch((e=>{a(e)}))}))},handleLogout(e=""){return new Promise(((e,t)=>{R.remove(ta),localStorage.removeItem(ea+"USER"),this.user=null,this.permissions=null,this.token="",aa(null),e(null)}))},getUserInfo(){return new Promise(((e,t)=>{la.get("/sso/api/v1/accounts/get").then((t=>{const a=function(){const e=localStorage.getItem(ea+"USER");return e&&"undefined"!==e?JSON.parse(e):null}()||{};Object.assign(a,t),this.user=a,aa(a);const i=[].concat([a.sys_role]);window.localStorage.setItem("ROLE_PERMISSIONS_LIST",JSON.stringify(i)),this.permissions=i,e(a)})).catch((e=>{t(e)}))}))}}});const oa={"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:ra,setupStore:function(e){return ra(e)}},Symbol.toStringTag,{value:"Module"}))},ha=X(),da={};Object.keys(oa).forEach((e=>{const t=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];da[`${t}Store`]=oa[e].setupStore(ha)}));var ca=T({history:E("/"),routes:[{path:"/",name:"home",component:te,redirect:"/ImageGenerationImage",children:[{path:"ImageGenerationImage",name:"ImageGenerationImage",component:Ze},{path:"swapFace",name:"swapFace",component:Ct},{path:"partialModifications",name:"partialModifications",component:$t}]}]});if("undefined"!=typeof window){let e=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML="",e.insertBefore(t,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const ua=W(N);ua.use(X()),ua.use(ca),ua.use(U,{locale:j}),ua.mount("#app");
