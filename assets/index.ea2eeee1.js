import{r as e,o as a,c as t,u as l,a as i,b as s,d as n,e as o,f as d,g as r,h as u,w as c,F as h,i as m,j as v,t as g,k as p,p as f,l as y,m as w,E as b,n as k,q as x,s as _,v as D,x as C,y as A,z as L,A as I,B as V,C as U,D as S,G as M,H as P,I as E,J as T,K as R,L as Y,M as F,N as X,O as z,P as O,Q as W,R as $,S as j,T as Z,U as H,V as N,W as B,X as G,Y as Q,Z as q,_ as J,$ as K,a0 as ee,a1 as ae,a2 as te,a3 as le,a4 as ie,a5 as se}from"./lib.9d341e55.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?a.credentials="include":"anonymous"===e.crossorigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();var ne=(e,a)=>{const t=e.__vccOpts||e;for(const[l,i]of a)t[l]=i;return t};var oe=ne({},[["render",function(l,i){const s=e("RouterView");return a(),t(s,{id:"main-view"})}]]);const de=e=>(f("data-v-129722d4"),e=e(),y(),e),re={class:"nav-bar-body"},ue={class:"logo-area"},ce=["src"],he={class:"router-link-area"},me={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ve=[de((()=>d("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),de((()=>d("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],ge={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},pe=[de((()=>d("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),de((()=>d("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],fe={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ye=[de((()=>d("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),de((()=>d("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],we=de((()=>d("div",{class:"logout-btn"},null,-1)));var be=ne({__name:"navBar",setup(f){const y=l(),w=i(),b=[{name:"AI生图",path:"ImageGenerationImage",children:[{name:"图生图",path:"ImageGenerationImage"},{name:"增强图生图",path:"enhanceImageGenerationImage"},{name:"生图画板",path:"generationImageDrawBoard"}]},{name:"AI换脸",path:"swapFace"},{name:"AI换背景",path:"partialModifications"},{name:"识图",path:"imageSearch",children:[{name:"AI识图",path:"imageSearch"},{name:"图库",path:"gallery"},{name:"超级识图",path:"superImageSearch"},{name:"激活码管理",path:"activationKeys"},{name:"任务记录",path:"searchImageTaskList"}]},{name:"识图训练",path:"imageSearchTrain",children:[{name:"数据集",path:"imageSearchTrainDataset"},{name:"训练",path:"imageSearchTrain"},{name:"测试",path:"imageSearchTrainCheck"}]},{name:"模型训练",path:"trainModel"}];let k=s("ImageGenerationImage");const x=e=>{y.push(e)};return n((()=>{k.value=w.name})),(l,i)=>{const s=e("el-menu-item"),n=e("el-sub-menu"),f=e("el-menu");return a(),o("div",re,[d("div",ue,[d("img",{src:r("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVQAAABSCAYAAAALvCwcAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ4IDc5LjE2NDAzNiwgMjAxOS8wOC8xMy0wMTowNjo1NyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjM3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxOEFGNERGMTdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOEFGNERGMjdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgnCosYAAA7KSURBVHja7F3tUeM6FBUM/zdbwYYKllcBpgJCBZgKgAowFRAqIFQAVJBsBWQriF8FZCvg+cI1T/HakmxLsmyfM+OBIcGW9XF0vyXe399FfoWArB1Rdi3fP/GaXecCAAAgcHxwaCiEmj1/KhFpEQ/0OYYMAAAQqroRk+y6eTfDHYgVAAAQankDLrPr7b0eNjADAAAAQv3/wZFCva9DrEcYRgAARkmobCd9ercL2FcBABgPoUp20rd3d7jBkAIAMGhCze4bs3ruA7CvAgAwPEJlqXT53g1eYQYAAMA3oe47vH+cXVFH70bOqg3sqwAA+IRLQj0N4P2I1JewrwIA0HdCDQUkoSawrwIAAEK1S6wLDtuCGQAAABCqBcwE7KsAAIRAqJwu+sQe/FmP3z0Wn/ZVmAEAALCCPTlcam9vT0WkUfbjTnx60GWcZP+3Kvn+UnTn5a+LNLuusvd4GcrA8mZXlZq7yd71EdO/tN+eWIspw0vWb7NcsCjp38eytVDz+ZFi3aza3r+H4zHJfkyUJLa3lwbSVn0cqqas3kfqZ8X/LS3HlS49JAgEZQbgWN5Xfu+yK1L870LxnktQZ6N+20jfm5d8nlh4vmqORxgPM/7R3HOpWFOnbQj1QLMz0C58pdshHOM224ESqU3UHldhUGQGiHlhPHa982XP32ZtSRUSE/19JQCbWGdXlRloUtBqivhhQTpVbejnDU1UX5IzCwwuNtSz7BlrB1qW7n1vG9x6qujn763F1KKEyumipnn3LiXUZ4XUvBhDGitX5qrCG28ykFDt9XesmRcTxfdeHUtjTREX1o4LRA7GYmNbOjW4b1zjPlOuUTLPuXS/TL3Pfn3oWCqVpYVSm0l20YufVEgKNkA72II7vzMzAEsWK4XEFIMG3c+5wryo+t6kBXlMDaSxUW1sGml921A6tSXkEE+SCYi02W/5Z0WVn4g0JDvNsQHZHHLn32gGoA2xPjB5d4UXxbjQIpxjCVrDVvP5EZNpqiDbJojQ9TvQmfXuSbBis0CV3XNly/lqagI9CHxQaScg7/tcQ6wkSa74ZS9dtKPjfljwBCsbyCPaMcfm/XWoEaSaQkET/h7Zt2/LFh595oBAxiSd6oSjNPer8AYYK4ShxxbtmLDAMjPlgIMe9C+dI0WS6rXKScSfXbE9IxmS+sSL91GxWVyKATinAoqwSBUL+qfUzkUZ4RIh1yFVA2fUmMh0yoKRCon0+5pJdVIhkNXd4CYcEmdMon0jVMEvNyOjvfj0+uuINWaJ9WZAE/VZQahRC8kopIW06UFTY6G3W9Pcq2MionG70HznXLHAaW68aNrTFyRCbYtOZTWehY21om9mFRtfpQDXpvEHPVt3MZNHorONkBlAfDqVcjNAr4mVVHreJKIKNfSqsHMD/RnbtdA4wzRe9N88321I5icasnGWHWnomLsu+ZvKx3Bck1BboY+5/FPxv/f93GCyznmSDCEzSCWFXAoAaE/uadWVffzHg3SqwiJrx3OFhK7Sbl1hy2R964NQXaufObFqs5ukMKtD0W9b40LRr5MxZtIMASbxpxrJ7cYgTjQJ9N0jvm4MpNNf0ve/LuYCn+siD9k6zHjlQjZBulT5XxzvDrIZwCi7iT87cRxm5VJ6IHvRoai2MW1BT0DPUCfJ5KHhMyJLghTd41YVUWNDQp1WLP4dUdgDiFCXhmYAUh0OuX29IiEiVYVaBkIFgL9x3EISJfIk/8T3bH2d6MITbUioR4rFn7BnPhF+wphyMwA9T5tb3EH7TNWgpctxEZ+xqy7STy9CqfwDALKEWiMKZs3aNRHnuq6QYoNQyUZxXuV17yiMiZ7xWjPMKmH1o6x9vkkicnz/iQgsiYMD6g8DU0Wr5qpv7QtoD9Pwqfs2ERO2bKhUyuyXhrgWwn8YU5yTZfb8W92CFtVprNeYj35INSAtIVXNUUjivVT7F64fYotQSeJZGsaHzrmKlE81O2GiNIpf5fbRjkZFD34jrXOU+Ffx2ZHlZ80Viz3PIddpFClLzani87FLqBcG3zvWpB5XgThju1f453cLDdeq2ZIUQBKA74IsZCM5C1nCeG84ogHgcCiSG5uAqvLryTH43UMbyrQlHakqhQZNRtpWo42psrVOmggedcrlWcAzR8psHGjIFOu+2qmHark+4p1pbjbXlnRdjT/o6vxFQu0ppmIgMK2L6uC5E66xuWlby7dsPPpUD9Xh2LrgmkhZsd8CyFY6q5kmmrB646MWK+2M1AkLnX0V6IbQRPNwlyYoalU67+5EWAq5Y+I7FQ0LcpRgmpsQ2Bn8kesPu697uFD5q1SRCxOVgCdXIvyGMWlVpQ7UzTbI7W5VoHH45eC+1lR+jtDwOQd2VFaDYi0zW4c6NnjXR0kFr7NhJA6L0Jw09TVwCJ9L7Waete1ellBdqfy+iqNQ45cWw5hctG/BxWqvAzhLKmm5QKca4vvV5BkG9x0SdNLn947aJZ+xth3IeEwdr3NvY+W7OAqpcRvO29WRSsrZTBfCn4dyxu176Lk9UNf2VwHo5t9WM++OPDdpy5t9IrWRzGowVwWEgxJVMPLw3CZhTC5POy0jfqMygYFCt9j/xdRvLaV+89gOWpelWWhStp/T0noDw9qBkLYtI9SLDtRs2nFPNGaALZMwTRz6/nlI7QsQ55pNao01ZYTfis3JtYSa55Hf62yTPDfP2NMea8Y/Lznn20QSkvZx5uK+f3n5pWyhnLR8Eeumpn2VvvvgsX1dH9JXZ1Anun6piHP9juIqtUhi4uh5K74e645HfkIur18i11P+OSkIJxdjHlQ+frpqjczbOBt3vPzZjeSHToV/b/uWX+jWsGNi4ak+wJ7cOWFPlkjUK4mW41bnqDLwENv08kc1xvVOQXC3hurdqth2nl+qknFWNiF+V0oWWDuy3R/x2kodrY205furvO73htLvqUJr2Jnbmudd1M3lpzH7OtxRDuyv+nJ2vXoOEDeqxi+1b+66QT3afZ8avuKbYV8HF9ivCdSOWtx3pnnfI8/vEiQcv/PU8B4L0+LamufFppqglJD0kKv8+ya7T3b9I/x626kTF0wOU4P2kcOKIgKGcMxJW0ln1lSFRcX/v6CzNR+hi0a3xiYcpbQRJWZH47CpQlFmXzAOY5KOOfFJ/KFBt7s+a0gVZ8P/rcpuQaidYsqakfISjqMuOLX0iYk0qTIx7TeYZEkH0iARRd1q/NdjIlbDEyMf2SZVhchVjnqPkWo0KcAtlkxiumvmYE1FXFfhjdsxExpnZKPAfkka/KcDMwBJrKcGbRzSaacm0J23k7IXeK6Ruq6whnfwW/HZT3TP4PAzL07DJJqIGhEd+2WSTnZdchqmjrTWHWQzEbE+NzjtdLDSKtt0Is3XEu6TPDSnCjiOehdrjToKiX5YuOK10kj72C8szBmLzyTFPJl62znMgKRBn/ZVIsoN7yZaYuX2DY5U+d11UmVayPhSqf1wTu1ipfncZ0UsCunxDtGTGOwQUJRQ7yrU7KWhNJgI//ZVeqbWvsqkOqi8Zx6TpYFKkhT6YqUhCjinpM1I8znIZrzYMqd8FeU+KCHQMkSifjbTSvg9lM/ktNNnoQ4C7xuZPhn0b1pRj+BFYSaoc0rkoMEV3mk+VXn0fdpRjzsKif4R8Ib2pVl5XNf5yajzv9ZIg4r9Gz5oz3Thd1GN/07Rnte+B/bXTLaYVtyDVPs302Bo6bmjCeyX7q9LHJl4ehcE9lffw1Zgf2XiC/ttIkUbGnn56QXvGthXfZoBrhRt67XUJan5JjGQldoE76yqMbmEw2VHIlEB8ajDVemJv8jpTmnV2iL5bQpM52p2JOoVjfZVZiwSAwuZYqfhnaEZZW1QRJomyzfNGKMy1aepSBWWRuOyQjcNZvMkdX7V5AQCGxX7YyZLigy4NyDWM59FTQZCpFNR73TYj3420B7WApWHpoUN5OOnXCDDwI5KcdGI33WDpaFVwZY2dV+3OIptQv1Ss0XYh/L1dcHf8aZl2kekppwM8UC2CvLTOSNupBMiyv5fJb3L+KUgVLItR03PVAK0mnBvcODg5XOivDAojOu7aHRfiCM/DO+q5mbTazIt1Kk0JUwdIkvNexbqpIfIg9p/ze3wjUjoM/EAB4QqE2vIh/KFTipxg3/NybTPNs8o1PEn4YAPxasi93NRiPd1gG0Xm2X23umIluC0YWQIrbut61NPY4ks71VxjYXTAsYcWN6ETNM2kqmjY3WHiEeFlOpD7Z90FJo2JpPcTUP+KT1GeiXcHNKX5MRqYF8lM8Cx8HNYYJ3dJ1TQmF0M0WYaIHRqv2tv/534O5sRCAjFOFSXRU5oZ82rRel22ZBO5aT+OAt0/OhY4ROQqT+1X6jjmM8Ru2sdJPkdGlzPITR2v6h2eygiTWSqKxr9I4C+yfN0/wmQsFbcrjnWm5NxV433vUY1jtGFdgUa5iXllX3vTwiNPVCo3Qvh1vtOE4/CrHYO5TMsRedDtbsOkEipPVqzycjIb1v4Xf7bH+n3tNCPO3+rMdY0N1Q2NopJxUY3Uhwo1BuaYHnAvkkRjiagHT3hQP+UnzH1sAhVkt9tgPGE1DdEovOBFyy55zlhi/xcqP1rLvxTtelHiEkFoSonkPj0vsfCXXaTDyLNQQHaszL1PkAVOlSCd0VWfZHsbjVa1I1o7pxKBeBDQOmGUKXJvuCdORY9DmuiRcuOg3OWhu4Dk/xWTPo+23Qt7ITGjKLcH8ekKlN2m5Y/JCfjCAlONf9M+3Ch2MTWPvr4I0VWLt9X4x+nmnJZIQCZHQAAeEPT8n3yWU1nUFEAAAA+sd/mnzNSfe7gkD4AAIDhEapErGS/GNORzQAAAG4ItWAGCCVrYYXhBQDAK5o4pQzvG3d4Ps6mq/ONAAAYL5c6I1TpIYnmMDibeOPnIZ8aAIDhESo/yEeY1QOIFACAwRNqgVhtmwGWNo4KBgAA6BWhSg+2YV81OsYaAABg0IQqNSCBnRQAABCqXTOAqX31Cd57AABAqPrGRAozAOykAACAUBs0Sravknp/haECAACE2tIUgCECAKBPhPqfAAMAs4iqNjzWgLIAAAAASUVORK5CYII=")},null,8,ce)]),d("div",he,[u(f,{"background-color":"#22335D","text-color":"#ffffff","default-active":r(k),class:"el-menu-demo",mode:"horizontal",onSelect:x},{default:c((()=>[(a(),o(h,null,m(b,((e,l)=>(a(),o(h,{key:l},[e.children?p("",!0):(a(),t(s,{key:0,index:e.path},{default:c((()=>[(a(),o("svg",me,ve)),v(" "+g(e.name),1)])),_:2},1032,["index"])),e.children?(a(),t(n,{key:1,index:String(l)},{title:c((()=>[(a(),o("svg",ge,pe)),v(" "+g(e.name),1)])),default:c((()=>[(a(!0),o(h,null,m(e.children,(e=>(a(),t(s,{index:e.path,key:e.path},{default:c((()=>[(a(),o("svg",fe,ye)),v(" "+g(e.name),1)])),_:2},1032,["index"])))),128))])),_:2},1032,["index"])):p("",!0)],64)))),64))])),_:1},8,["default-active"])]),d("div",{class:"handle-area"},[d("div",{class:"user-profile-image"},[d("img",{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})]),we])])}}},[["__scopeId","data-v-129722d4"]]);const ke={class:"home-body"},xe={class:"home-child-view"};var _e=ne({__name:"index",setup:t=>(t,l)=>{const i=e("router-view");return a(),o("div",ke,[u(be),d("div",xe,[u(i)])])}},[["__scopeId","data-v-f24c8a92"]]);const De=e=>(f("data-v-7d14f03d"),e=e(),y(),e),Ce={class:"main-body"},Ae={class:"image-area"},Le=De((()=>d("div",{class:"main-title"},"参考图",-1))),Ie={class:"image-all"},Ve={class:"image-item upload-image-area"},Ue={class:"upload-text-tips"},Se=De((()=>d("div",{class:"upload-text"},"点击上传",-1))),Me={class:"other-images"},Pe={class:"other-images-view-box"},Ee={class:"del-btn"},Te={class:"image-handl-area"},Re=De((()=>d("label",null,"权重",-1))),Ye=De((()=>d("div",{class:"main-title"},null,-1))),Fe={class:"bottom-area"},Xe={class:"handle-area"},ze=De((()=>d("div",{class:"main-title"},"正向提示词",-1))),Oe={class:"handle-item"},We=De((()=>d("div",{class:"main-title"},"负向提示词",-1))),$e={class:"handle-item"},je={class:"handle-item"},Ze={class:"handle-min"},He=De((()=>d("div",{class:"main-title"},"风格",-1))),Ne={class:"handle-min"},Be=De((()=>d("div",{class:"main-title"},"相似度",-1))),Ge={class:"handle-min-slider"},Qe={class:"handle-min"},qe=De((()=>d("div",{class:"main-title"},"宽度",-1))),Je={class:"handle-min"},Ke=De((()=>d("div",{class:"main-title"},"高度",-1))),ea=De((()=>d("div",{class:"main-title"},"线稿参考图",-1))),aa={class:"handle-item bg"},ta={class:"line-draft-image-area"},la={class:"upload-image-area-other"},ia=["src"],sa={key:1,class:"upload-text-tips"},na=De((()=>d("div",{class:"upload-text"},"点击上传",-1))),oa={class:"image-handl-area"},da=De((()=>d("label",null,"权重",-1))),ra={class:"generate-btn"},ua={class:"review-area"},ca="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var ha=ne({__name:"index",setup(l){const i=s([]),g=s(null),f=s(null),y=s([]),A=s(null),L=s(100),I=s(""),V=s(""),U=s(1024),S=s(1024),M=s(70),P=s(""),E=e=>{const a=new FileReader;return a.onload=({target:a})=>{i.value.length>=5||i.value.push({file:e,url:a.result,weight:100})},a.readAsDataURL(e),!1},T=e=>{g.value=e;const a=new FileReader;return a.onload=({target:e})=>{f.value=e.result},a.readAsDataURL(e),!1},R=()=>{g.value=null,f.value=null},Y=()=>{if(!i.value.length&&!g.value)return b.error("请至少上传一张参考图或上传线稿参考图"),!1;if(!A.value)return b.error("请选择风格后操作"),!1;const e=(()=>{const e=new FormData;return e.append("base_model",A.value),g.value&&(e.append("lineart",g.value||""),e.append("lineart_weight",L.value/100)),e.append("positive_prompt",I.value),e.append("negative_prompt",V.value),e.append("ref",M.value/100),e.append("width",U.value),e.append("height",S.value),i.value.length?i.value.forEach((({weight:a,file:t})=>{e.append("weights",a/100),e.append("files",t)})):(e.append("weights",-1),e.append("files",new File([0],"test.png"))),e})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});g.value?w.post(`${ca}/img2img/lineart`,e).then((e=>{a.close(),P.value=`${ca}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")})):w.post(`${ca}/img2img/gen`,e).then((e=>{a.close(),P.value=`${ca}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{w.get(`${ca}/img2img/base_models`).then((e=>{Object.keys(e.data).forEach((a=>{y.value.push({name:a,value:e.data[a]})}))}))})),(l,s)=>{const n=e("el-icon"),g=e("el-upload"),w=e("el-image"),b=e("el-slider"),k=e("el-scrollbar"),F=e("el-input"),X=e("el-option"),z=e("el-select"),O=e("el-input-number"),W=e("el-button");return a(),o("div",Ce,[d("div",Ae,[Le,d("div",Ie,[d("div",Ve,[u(g,{class:"avatar-uploader",drag:"",multiple:"",limit:5,disabled:i.value.length>=5,action:"","show-file-list":!1,"before-upload":E},{default:c((()=>[d("div",Ue,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),Se])])),_:1},8,["disabled"])]),d("div",Me,[u(k,null,{default:c((()=>[d("div",Pe,[(a(!0),o(h,null,m(i.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[u(w,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),d("div",Ee,[u(n,{style:{color:"red"},onClick:e=>(e=>{i.value.splice(e,1)})(t)},{default:c((()=>[u(r(D))])),_:2},1032,["onClick"])]),d("div",Te,[Re,u(b,{modelValue:e.weight,"onUpdate:modelValue":a=>e.weight=a,style:{width:"calc(100% - 50px)"},min:0,max:100,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])])),_:1})])])]),Ye,d("div",Fe,[d("div",Xe,[u(k,null,{default:c((()=>[ze,d("div",Oe,[u(F,{type:"textarea",modelValue:I.value,"onUpdate:modelValue":s[0]||(s[0]=e=>I.value=e),maxlength:"255"},null,8,["modelValue"])]),We,d("div",$e,[u(F,{type:"textarea",modelValue:V.value,"onUpdate:modelValue":s[1]||(s[1]=e=>V.value=e),maxlength:"255"},null,8,["modelValue"])]),d("div",je,[d("div",Ze,[He,u(z,{modelValue:A.value,"onUpdate:modelValue":s[2]||(s[2]=e=>A.value=e)},{default:c((()=>[(a(!0),o(h,null,m(y.value,(e=>(a(),t(X,{key:e.name,value:e.value,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),d("div",Ne,[Be,d("div",Ge,[u(b,{modelValue:M.value,"onUpdate:modelValue":s[3]||(s[3]=e=>M.value=e)},null,8,["modelValue"])])]),d("div",Qe,[qe,u(O,{style:{width:"100%"},modelValue:U.value,"onUpdate:modelValue":s[4]||(s[4]=e=>U.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])]),d("div",Je,[Ke,u(O,{style:{width:"100%"},modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=e=>S.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])])]),ea,d("div",aa,[d("div",ta,[d("div",la,[u(g,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":T},{default:c((()=>[f.value?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:s[7]||(s[7]=x((()=>{}),["stop"]))},[d("img",{src:f.value,class:"avatar"},null,8,ia),d("div",{class:"upload-image-del-btn-area",onClick:s[6]||(s[6]=x((()=>{}),["stop"]))},[d("div",{class:"upload-image-del-btn",onClick:x(R,["stop"])},[u(n,null,{default:c((()=>[u(r(C))])),_:1})])])])):(a(),o("div",sa,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),na]))])),_:1})]),d("div",oa,[da,u(b,{style:{width:"calc(100% - 50px)"},disabled:!f.value,modelValue:L.value,"onUpdate:modelValue":s[8]||(s[8]=e=>L.value=e),min:0,max:100,size:"small"},null,8,["disabled","modelValue"])])])])])),_:1}),d("div",ra,[u(W,{style:{width:"100%"},type:"primary",onClick:s[9]||(s[9]=e=>Y())},{default:c((()=>[v("生成")])),_:1})])]),d("div",ua,[P.value?(a(),t(w,{key:0,fit:"scale-down",src:P.value,"preview-src-list":[P.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):p("",!0)])])])}}},[["__scopeId","data-v-7d14f03d"]]);const ma={class:"layout-body"},va={class:"layout-right"};var ga=ne({__name:"layout",props:{leftStyle:{}},setup:e=>(t,l)=>(a(),o("div",ma,[d("div",{class:"layout-left",style:L(e.leftStyle)},[A(t.$slots,"left",{},void 0,!0)],4),A(t.$slots,"center",{},void 0,!0),d("div",va,[A(t.$slots,"right",{},void 0,!0)])]))},[["__scopeId","data-v-2be9378c"]]);const pa=e=>(f("data-v-b889ae40"),e=e(),y(),e),fa={class:"main-body"},ya={class:"setting-area"},wa={class:"upload-image-area"},ba={class:"upload-text-tips"},ka=pa((()=>d("div",{class:"upload-text"},"点击上传",-1))),xa={class:"setting-slider"},_a=pa((()=>d("span",{class:"setting-name"},"参考程度",-1))),Da=["onClick"],Ca={class:"upload-image-area"},Aa={class:"upload-text-tips"},La=pa((()=>d("div",{class:"upload-text"},"点击上传",-1))),Ia={class:"setting-slider"},Va=pa((()=>d("span",{class:"setting-name"},"参考程度",-1))),Ua={key:0,class:"image-item"},Sa={class:"image-area"},Ma={class:"handle-area"},Pa={class:"handle-parameter"},Ea={class:"handle-parameter-prompt"},Ta={key:0,class:"handle-parameter-tag"},Ra=pa((()=>d("div",{class:"tag-name"},"风格参考",-1))),Ya={key:1,class:"handle-parameter-tag"},Fa=pa((()=>d("div",{class:"tag-name"},"结构参考",-1))),Xa={class:"tag-info"},za={class:"tag-name"},Oa={class:"handle-btn"},Wa="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var $a=ne({__name:"index",setup(l){const i=s("1"),f=s([]),y=s([]),D=s(null),A=s(null),L=s([]),U=s(null),S=s(!0),M=s(""),P=s("1:1"),E=s(100),T=s(100),R=s(null),Y=e=>{D.value=e;const a=new FileReader;return a.onload=({target:e})=>{A.value=e.result},a.readAsDataURL(e),!1},F=e=>{if(5<=f.value.length)return!1;const a=new FileReader;return a.onload=({target:a})=>{y.value.find((e=>e===a.result))||(f.value.push(e),y.value.push(a.result))},a.readAsDataURL(e),!1},X=(e="all",a=0)=>{"all"===e?(y.value=[],f.value=[]):(f.value.splice(a,1),y.value.splice(a,1))},z=()=>{if(!U.value)return b.error("请选择性模型"),!1;const e=(()=>{const e=new FormData;return e.append("base_model",U.value),e.append("composition",D.value||""),e.append("composition_weight",E.value/100),e.append("prompt",M.value.replaceAll("，",",")),e.append("shape",P.value),f.value.forEach((a=>{e.append("files",a)})),e.append("style_weight",T.value/100),e})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});let t=null;t=f.value.length?S.value?"gen_art":"gen_base":"gen_comp_art",w.post(`${Wa}/img2img/${t}`,e,{timeout:6e5}).then((e=>{a.close(),R.value=`${Wa}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))},O=()=>{D.value=null,A.value=null};return n((()=>{w.get(`${Wa}/img2img/base_models`).then((e=>{Object.keys(e.data).forEach((a=>{L.value.push({name:a,value:e.data[a]})}))}))})),(l,s)=>{const n=e("el-icon"),f=e("el-upload"),w=e("el-slider"),b=e("el-image"),k=e("el-collapse-item"),D=e("el-option"),W=e("el-select"),$=e("el-form-item"),j=e("el-switch"),Z=e("el-form"),H=e("el-collapse"),N=e("el-scrollbar"),B=e("el-input"),G=e("el-button");return a(),o("div",fa,[u(ga,{leftStyle:{width:"300px"}},{left:c((()=>[d("div",ya,[u(N,null,{default:c((()=>[u(H,{modelValue:i.value,"onUpdate:modelValue":s[6]||(s[6]=e=>i.value=e),accordion:""},{default:c((()=>[u(k,{title:"风格参考",name:"1"},{default:c((()=>[d("div",wa,[u(f,{class:"avatar-uploader",drag:"",action:"",multiple:"","show-file-list":!1,"before-upload":F},{default:c((()=>[d("div",ba,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),ka])])),_:1})]),d("div",xa,[_a,u(w,{modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=e=>T.value=e),min:1,max:100},null,8,["modelValue"])]),(a(!0),o(h,null,m(y.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[u(b,{style:{width:"100%",height:"190px"},previewSrcList:[e],src:e,fit:"cover",lazy:""},null,8,["previewSrcList","src"]),d("div",{class:"image-icon del",onClick:x((e=>X("item",t)),["stop"])},[u(n,null,{default:c((()=>[u(r(C))])),_:1})],8,Da)])))),128))])),_:1}),u(k,{title:"结构参考",name:"2"},{default:c((()=>[d("div",Ca,[u(f,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":Y},{default:c((()=>[d("div",Aa,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),La])])),_:1})]),d("div",Ia,[Va,u(w,{modelValue:E.value,"onUpdate:modelValue":s[1]||(s[1]=e=>E.value=e),min:1,max:100},null,8,["modelValue"])]),A.value?(a(),o("div",Ua,[u(b,{style:{width:"100%",height:"190px"},previewSrcList:[A.value],src:A.value,fit:"cover",lazy:""},null,8,["previewSrcList","src"]),d("div",{class:"image-icon del",onClick:s[2]||(s[2]=x((e=>O()),["stop"]))},[u(n,null,{default:c((()=>[u(r(C))])),_:1})])])):p("",!0)])),_:1}),u(k,{title:"其他参数",name:"3"},{default:c((()=>[u(Z,{"label-width":"80px"},{default:c((()=>[u($,{label:"宽高比"},{default:c((()=>[u(W,{modelValue:P.value,"onUpdate:modelValue":s[3]||(s[3]=e=>P.value=e)},{default:c((()=>[u(D,{label:"3:2",value:"3:2"}),u(D,{label:"2:3",value:"2:3"}),u(D,{label:"1:1",value:"1:1"}),u(D,{label:"3:4",value:"3:4"}),u(D,{label:"4:3",value:"4:3"}),u(D,{label:"9:16",value:"9:16"}),u(D,{label:"16:9",value:"16:9"})])),_:1},8,["modelValue"])])),_:1}),u($,{label:"底模选择"},{default:c((()=>[u(W,{modelValue:U.value,"onUpdate:modelValue":s[4]||(s[4]=e=>U.value=e)},{default:c((()=>[(a(!0),o(h,null,m(L.value,(e=>(a(),t(D,{key:e.name,value:e.value,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),u($,{label:"增强效果"},{default:c((()=>[u(j,{modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=e=>S.value=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])])),right:c((()=>[d("div",Sa,[u(b,{src:R.value,previewSrcList:[R.value],style:{width:"100%",height:"100%"},fit:"scale-down"},null,8,["src","previewSrcList"])]),d("div",Ma,[d("div",Pa,[d("div",Ea,[u(B,{style:{height:"100%"},type:"textarea",modelValue:M.value,"onUpdate:modelValue":s[7]||(s[7]=e=>M.value=e),placeholder:"prompt"},null,8,["modelValue"])]),y.value.length?(a(),o("div",Ta,[Ra,(a(!0),o(h,null,m(y.value,((e,t)=>(a(),o("div",{class:"tag-info",key:t},[u(b,{style:{width:"100%",height:"100%"},fit:"cover",src:e},null,8,["src"])])))),128)),d("div",{class:"tag-del-btn",onClick:s[8]||(s[8]=e=>X())},[u(n,null,{default:c((()=>[u(r(V))])),_:1})])])):p("",!0),A.value?(a(),o("div",Ya,[Fa,d("div",Xa,[u(b,{style:{width:"100%",height:"100%"},fit:"cover",src:A.value},null,8,["src"])]),d("div",{class:"tag-del-btn",onClick:s[9]||(s[9]=e=>O())},[u(n,null,{default:c((()=>[u(r(V))])),_:1})])])):p("",!0),d("div",{class:I(["handle-parameter-tag",S.value?"success":"danger"]),type:"alone"},[d("div",za," 增强 "+g(S.value?"开":"关"),1)],2)]),d("div",Oa,[u(G,{type:"primary",style:{width:"100%",height:"100%","border-radius":"10px"},onClick:z},{default:c((()=>[v(" 生成 ")])),_:1})])])])),_:1})])}}},[["__scopeId","data-v-b889ae40"]]);function ja(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}class Za{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,a){const{canvasDom:t}=this;switch(this.clearHandle(),e){case"selectionArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(t,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"clearArea":t.style.cursor="none",this.addListener(t,"mousedown",(e=>{this.clearAreaStart(e,a)})),this.addListener(t,"mouseup",(e=>{this.clearAreaFinish(e,a)})),this.addListener(t,"mousemove",(e=>{this.clearAreaMoving(e,a)}));break;default:this.clearHandle()}}clearAreaStart(e,a){const{offsetX:t,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:s,handleX:t,handleY:l,type:"clearArea",clearType:a,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:a,offsetY:t}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.arc(a,t,s,0,2*Math.PI),l.stroke(),l.closePath()}clearAreaMoving(e){const{offsetX:a,offsetY:t}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:a,offsetY:t,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t;this.handleList=[],a.beginPath(),a.clearRect(0,0,l,i),a.closePath();const s=new Image;s.src=e,s.onload=()=>{this.initImageData(s),this.drawImage()}}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a,imageData:t}=this,{image:l}=t,{width:i,height:s}=a;e.beginPath(),e.clearRect(0,0,i,s),e.closePath(),l&&(this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((a=>{let{type:t}=a;if("selectionArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n}=a;e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const o=t>i?i:t,d=l>s?s:l,r=t>i?t-i:i-t,u=l>s?l-s:s-l;if((!r||!u)&&n)return;e.rect(o,d,r,u),e.stroke(),e.closePath()}if("clearArea"===t){let{clearType:t,dataList:l,offsetX:i,offsetY:s,radius:n}=a;"arc"==t&&(e.beginPath(),e.globalCompositeOperation="destination-out",e.moveTo(i+n,s+n),e.arc(i,s,n,0,2*Math.PI),l.forEach((a=>{e.moveTo(a.offsetX+a.radius,a.offsetY+a.radius),e.arc(a.offsetX,a.offsetY,a.radius,0,2*Math.PI)})),e.fill(),e.globalCompositeOperation="source-over",e.closePath())}})))}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((a,t)=>{let{type:l}=a;if("selectionArea"===l){const{handleX:l,handleY:i,offsetX:s,offsetY:n,status:o,imageData:d}=a,r=this.canvasDom.width,u=this.canvasDom.height,c=this.imageData.width;this.imageData.height;const h=r===c?u/e.height:r/e.width;if(o&&!d){const o=document.createElement("canvas");o.width=r/h,o.height=u/h;const d=o.getContext("2d"),c=l>s?s:l,m=i>n?n:i,v=l>s?l-s:s-l,g=i>n?i-n:n-i;if(d.beginPath(),d.drawImage(e,this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),d.clearRect(Math.round(c/h),Math.round(m/h),Math.round(v/h),Math.round(g/h)),d.closePath(),!v||!g)return;const p=d.getImageData(this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/h),f.height=Math.round(this.imageData.height/h);f.getContext("2d").putImageData(p,0,0);const y=ja(f.toDataURL("image/png"));a.imageData=new File([y],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}if("clearArea"===l){const{clearType:l,dataList:i,offsetX:s,offsetY:n,radius:o,status:d,imageData:r}=a,u=this.canvasDom.width,c=this.canvasDom.height,h=this.imageData.width;this.imageData.height;const m=u===h?c/e.height:u/e.width;if(d&&!r&&"arc"==l){const l=document.createElement("canvas");l.width=u/m,l.height=c/m;const d=l.getContext("2d");d.beginPath(),d.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),d.closePath(),d.beginPath(),d.globalCompositeOperation="destination-out",d.moveTo((s+o)/m,(n+o)/m),d.arc(s,n,o,0,2*Math.PI),i.forEach((e=>{d.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),d.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),d.fill(),d.globalCompositeOperation="source-over",d.closePath();const r=d.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),h=document.createElement("canvas");h.width=Math.round(this.imageData.width/m),h.height=Math.round(this.imageData.height/m);h.getContext("2d").putImageData(r,0,0);const v=ja(h.toDataURL("image/png"));a.imageData=new File([v],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}}))}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const Ha=e=>(f("data-v-061b6b3e"),e=e(),y(),e),Na={class:"main-body"},Ba={class:"image-area"},Ga=Ha((()=>d("div",{class:"main-title"},"模特照片",-1))),Qa={class:"image-all"},qa={class:"image-item upload-image-area"},Ja={class:"upload-text-tips"},Ka=Ha((()=>d("div",{class:"upload-text"},"点击上传",-1))),et={class:"other-images"},at={class:"other-images-view-box"},tt={class:"del-btn"},lt=Ha((()=>d("div",{class:"main-title"},null,-1))),it={class:"bottom-area"},st={class:"handle-area"},nt=Ha((()=>d("div",{class:"main-title"},"正向提示词",-1))),ot={class:"handle-item"},dt=Ha((()=>d("div",{class:"main-title"},"负向提示词",-1))),rt={class:"handle-item"},ut=Ha((()=>d("div",{class:"main-title"},"待换脸人像",-1))),ct={class:"handle-item bg"},ht={class:"line-draft-image-area"},mt={class:"upload-image-area-other"},vt=["src"],gt={key:1,class:"upload-text-tips"},pt=Ha((()=>d("div",{class:"upload-text"},"点击上传",-1))),ft={class:"image-handl-area"},yt=Ha((()=>d("label",null,"笔刷半径",-1))),wt={class:"image-handl-area"},bt=Ha((()=>d("div",{class:"main-title"},"相似度",-1))),kt={class:"handle-item"},xt={class:"handle-min-slider"},_t={class:"generate-btn"},Dt={class:"review-area"},Ct="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var At=ne({__name:"index",setup(l){const i=s([]),g=s(null),f=s(null);s([]),s(null),s(70);const y=s(""),A=s("");s(1024),s(1024);const L=s(70),I=s(""),V=s(0),U=s(null),S=s(10),M=e=>{const a=new FileReader;return a.onload=({target:a})=>{i.value.length>=15||i.value.push({file:e,url:a.result,weight:100})},a.readAsDataURL(e),!1},P=e=>{g.value=e;const a=new FileReader;return a.onload=({target:e})=>{f.value=e.result,U.value.initImage(f.value)},a.readAsDataURL(e),!1},E=()=>{g.value=null,f.value=null},T=()=>{if(!i.value.length)return b.error("请至少上传一张模特照片"),!1;if(!g.value)return b.error("请上传待换脸人像后操作"),!1;if(!U.value.handleList.length)return b.error("款选人脸区域后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",y.value),e.append("negative_prompt",A.value),e.append("mask_strength",L.value/100),i.value.forEach((({weight:a,file:t})=>{e.append("ref_faces",t)})),e.append("face",g.value),U.value.handleList.forEach((({imageData:a})=>{e.append("face_mask",a)})),e})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${Ct}/img2img/swap_face`,e).then((e=>{if(a.close(),"未检测到人脸，请扩大人脸选区区域！"===e.data)return b.error(e.data),!1;I.value=`${Ct}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))},R=()=>{U.value.clearSelectionArea()},Y=()=>{U.value.setClearAreaRadius(S.value)};return n((()=>{U.value=new Za(V.value),U.value.handleChange("clearArea","arc")})),(l,s)=>{const n=e("el-icon"),g=e("el-upload"),w=e("el-image"),b=e("el-scrollbar"),k=e("el-input"),U=e("el-slider"),F=e("el-button");return a(),o("div",Na,[d("div",Ba,[Ga,d("div",Qa,[d("div",qa,[u(g,{class:"avatar-uploader",drag:"",multiple:"",limit:15,disabled:i.value.length>=15,action:"","show-file-list":!1,"before-upload":M},{default:c((()=>[d("div",Ja,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),Ka])])),_:1},8,["disabled"])]),d("div",et,[u(b,null,{default:c((()=>[d("div",at,[(a(!0),o(h,null,m(i.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[u(w,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),d("div",tt,[u(n,{style:{color:"red"},onClick:e=>(e=>{i.value.splice(e,1)})(t)},{default:c((()=>[u(r(D))])),_:2},1032,["onClick"])])])))),128))])])),_:1})])])]),lt,d("div",it,[d("div",st,[u(b,null,{default:c((()=>[nt,d("div",ot,[u(k,{type:"textarea",modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=e=>y.value=e),maxlength:"255"},null,8,["modelValue"])]),dt,d("div",rt,[u(k,{type:"textarea",modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=e=>A.value=e),maxlength:"255"},null,8,["modelValue"])]),ut,d("div",ct,[d("div",ht,[d("div",mt,[u(g,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":P},{default:c((()=>[f.value?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:s[3]||(s[3]=x((()=>{}),["stop"]))},[d("img",{src:f.value,class:"avatar"},null,8,vt),d("div",{class:"upload-image-del-btn-area",onClick:s[2]||(s[2]=x((()=>{}),["stop"]))},[d("div",{class:"upload-image-del-btn",onClick:x(E,["stop"])},[u(n,null,{default:c((()=>[u(r(C))])),_:1})])])])):(a(),o("div",gt,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),pt]))])),_:1}),d("div",ft,[yt,u(U,{style:{width:"calc(100% - 50px)"},modelValue:S.value,"onUpdate:modelValue":s[4]||(s[4]=e=>S.value=e),onChange:Y,min:1,max:100,size:"small"},null,8,["modelValue"])])]),d("div",wt,[d("div",{class:"main-title"},[v(" 框选人脸区域 "),d("div",{class:"title-handle-area",onClick:R}," 重置 ")]),d("canvas",{ref_key:"canvasDom",ref:V},null,512)])])]),bt,d("div",kt,[d("div",xt,[u(U,{modelValue:L.value,"onUpdate:modelValue":s[5]||(s[5]=e=>L.value=e)},null,8,["modelValue"])])])])),_:1}),d("div",_t,[u(F,{style:{width:"100%"},type:"primary",onClick:s[6]||(s[6]=e=>T())},{default:c((()=>[v("生成")])),_:1})])]),d("div",Dt,[I.value?(a(),t(w,{key:0,fit:"scale-down",src:I.value,"preview-src-list":[I.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):p("",!0)])])])}}},[["__scopeId","data-v-061b6b3e"]]);function Lt(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}class It{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.finishImage=null,this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,a){const{canvasDom:t}=this;switch(this.clearHandle(),e){case"selectionArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionAreaFinish(e),this.getFinishImage()})),this.addListener(t,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"selectionArcArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionArcAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionArcAreaFinish(e),this.getFinishImage()})),this.addListener(t,"mousemove",(e=>{this.selectionArcAreaMoving(e)}));break;case"clearArea":t.style.cursor="none",this.addListener(t,"mousedown",(e=>{this.clearAreaStart(e,a)})),this.addListener(t,"mouseup",(e=>{this.clearAreaFinish(e,a),this.getFinishImage()})),this.addListener(t,"mousemove",(e=>{this.clearAreaMoving(e,a)}));break;default:this.clearHandle()}}selectionArcAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArcArea",status:0,imageData:null})}selectionArcAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionArcAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearAreaStart(e,a){const{offsetX:t,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:s,handleX:t,handleY:l,type:"clearArea",clearType:a,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:a,offsetY:t}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.arc(a,t,s,0,2*Math.PI),l.stroke(),l.closePath()}clearAreaMoving(e){const{offsetX:a,offsetY:t}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:a,offsetY:t,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t;this.handleList=[],a.beginPath(),a.clearRect(0,0,l,i),a.closePath(),e.includes("http")&&w({method:"get",url:e,responseType:"blob"}).then((e=>{this.finishImage=new File([e.data],`${(new Date).getTime()}.png`,{type:"image/png"})}));const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{this.initImageData(s),this.drawImage()},s.src=e}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a,imageData:t}=this,{image:l}=t,{width:i,height:s}=a;e.beginPath(),e.clearRect(0,0,i,s),e.closePath(),l&&(this.drawImage(),this.getSelecttionAreaImages(),e.beginPath(),this.handleList.forEach((a=>{e.globalCompositeOperation="destination-out";let{type:t}=a;if("selectionArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n}=a;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const o=t>i?i:t,d=l>s?s:l,r=t>i?t-i:i-t,u=l>s?l-s:s-l;if((!r||!u)&&n)return;e.rect(o,d,r,u)}if("selectionArcArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n}=a;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const o=t>i?i:t,d=l>s?s:l,r=t>i?t-i:i-t,u=l>s?l-s:s-l,c=Math.sqrt(r*r+u*u)/2;if((!r||!u)&&n)return;e.moveTo(o+r/2-c,d+u/2-c),e.arc(o+r/2,d+u/2,c,0,2*Math.PI)}if("clearArea"===t){let{clearType:t,dataList:l,offsetX:i,offsetY:s,radius:n}=a;e.moveTo(i+n,s+n),e.arc(i,s,n,0,2*Math.PI),l.forEach((a=>{e.moveTo(a.offsetX+a.radius,a.offsetY+a.radius),e.arc(a.offsetX,a.offsetY,a.radius,0,2*Math.PI)}))}})),e.fill(),e.globalCompositeOperation="source-over",e.closePath())}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((a,t)=>{let{type:l}=a;if("selectionArea"===l){const{handleX:l,handleY:i,offsetX:s,offsetY:n,status:o,imageData:d}=a,r=this.canvasDom.width,u=this.canvasDom.height,c=this.imageData.width;this.imageData.height;const h=r===c?u/e.height:r/e.width;if(o&&!d){const o=document.createElement("canvas");o.width=r/h,o.height=u/h;const d=o.getContext("2d"),c=l>s?s:l,m=i>n?n:i,v=l>s?l-s:s-l,g=i>n?i-n:n-i;if(d.beginPath(),d.drawImage(e,this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),d.clearRect(Math.round(c/h),Math.round(m/h),Math.round(v/h),Math.round(g/h)),d.closePath(),!v||!g)return;const p=d.getImageData(this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/h),f.height=Math.round(this.imageData.height/h);f.getContext("2d").putImageData(p,0,0);const y=Lt(f.toDataURL("image/png"));a.imageData=new File([y],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}if("clearArea"===l){const{clearType:l,dataList:i,offsetX:s,offsetY:n,radius:o,status:d,imageData:r}=a,u=this.canvasDom.width,c=this.canvasDom.height,h=this.imageData.width;this.imageData.height;const m=u===h?c/e.height:u/e.width;if(d&&!r&&"arc"==l){const l=document.createElement("canvas");l.width=u/m,l.height=c/m;const d=l.getContext("2d");d.beginPath(),d.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),d.closePath(),d.beginPath(),d.globalCompositeOperation="destination-out",d.moveTo((s+o)/m,(n+o)/m),d.arc(s,n,o,0,2*Math.PI),i.forEach((e=>{d.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),d.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),d.fill(),ctx.globalCompositeOperation="source-over",d.closePath();const r=d.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),h=document.createElement("canvas");h.width=Math.round(this.imageData.width/m),h.height=Math.round(this.imageData.height/m);h.getContext("2d").putImageData(r,0,0);const v=Lt(h.toDataURL("image/png"));a.imageData=new File([v],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}}))}getFinishImage(){const{image:e}=this.imageData,a=this.canvasDom.width,t=this.canvasDom.height,l=this.imageData.width;this.imageData.height;const i=a===l?t/e.height:a/e.width,s=document.createElement("canvas");s.width=a/i,s.height=t/i;const n=s.getContext("2d");n.beginPath(),n.drawImage(e,this.imageData.x/i,this.imageData.y/i,this.imageData.width/i,this.imageData.height/i),n.closePath(),n.globalCompositeOperation="destination-out",n.beginPath(),this.handleList.forEach(((e,a)=>{const{type:t}=e;if("selectionArea"===t){let{handleX:a,handleY:t,offsetX:l,offsetY:s,status:o}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const d=a>l?l:a,r=t>s?s:t,u=a>l?a-l:l-a,c=t>s?t-s:s-t;if((!u||!c)&&o)return;n.rect(d/i,r/i,u/i,c/i)}if("clearArea"===t){let{clearType:a,dataList:t,offsetX:l,offsetY:s,radius:o}=e;n.moveTo((l+o)/i,(s+o)/i),n.arc(l/i,s/i,o/i,0,2*Math.PI),t.forEach((e=>{n.moveTo((e.offsetX+e.radius)/i,(e.offsetY+e.radius)/i),n.arc(e.offsetX/i,e.offsetY/i,e.radius/i,0,2*Math.PI)}))}if("selectionArcArea"===t){let{handleX:a,handleY:t,offsetX:l,offsetY:s,status:o}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const d=a>l?l:a,r=t>s?s:t,u=a>l?a-l:l-a,c=t>s?t-s:s-t,h=Math.sqrt(u*u+c*c)/2;if((!u||!c)&&o)return;n.moveTo((d+u/2-h)/i,(r+c/2-h)/i),n.arc((d+u/2)/i,(r+c/2)/i,h/i,0,2*Math.PI)}})),n.fill(),n.globalCompositeOperation="source-over",n.closePath();const o=n.getImageData(this.imageData.x/i,this.imageData.y/i,this.imageData.width/i,this.imageData.height/i),d=document.createElement("canvas");d.width=Math.round(this.imageData.width/i),d.height=Math.round(this.imageData.height/i);d.getContext("2d").putImageData(o,0,0);const r=Lt(d.toDataURL("image/png"));this.finishImage=new File([r],`${(new Date).getTime()}_finish.png`,{type:"image/png"})}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.finishImage=null,this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const Vt=e=>(f("data-v-35679002"),e=e(),y(),e),Ut={class:"super-image-search-body"},St={class:"image-search-title"},Mt={key:8,class:"image-handle-setting"},Pt=Vt((()=>d("label",null," 笔刷半径 ",-1))),Et={class:"image-search-title-handle"},Tt={class:"content"},Rt={class:"search-btn-area"},Yt=Vt((()=>d("div",{class:"image-search-title",style:{height:"30px"}},[d("div",null,"提示词")],-1))),Ft={class:"prompt-area"},Xt={class:"prompt-item"},zt=Vt((()=>d("div",{class:"prompt-item-label"},"正向提示词",-1))),Ot={class:"prompt-item-input"},Wt={class:"prompt-item"},$t=Vt((()=>d("div",{class:"prompt-item-label"},"负向提示词",-1))),jt={class:"prompt-item-input"},Zt={class:"prompt-btn"},Ht=Vt((()=>d("div",{class:"image-search-title",style:{height:"30px"}},[d("div",null,"生成图片")],-1))),Nt={class:"content",style:{height:"calc(100% - 40px)"}},Bt="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var Gt=ne({__name:"index",setup(l){const i=s(null),h=s(null),m=s(null),g=s(0);s(0);const f=s(10),y=s(""),x=s(""),_=s(""),C=s(""),A=e=>{h.value?(y.value=e,m.value.handleChange(e)):b.error("请在上传图片后操作")},L=()=>{m.value.setClearAreaRadius(f.value)},I=e=>{i.value=e;const a=new FileReader;return a.onload=({target:e})=>{h.value=e.result,m.value.initImage(h.value)},a.readAsDataURL(e),!1};const V=()=>{if(!i.value)return b.error("请上传图片后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",_.value),e.append("negative_prompt",C.value),e.append("image",i.value),m.value.finishImage?(e.append("image_with_mask",m.value.finishImage),e):(e.append("image_with_mask",i.value),e)})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${Bt}/img2img/inpaint`,e).then((e=>{a.close(),x.value=`${Bt}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{m.value=new It(g.value)})),(l,s)=>{const n=e("el-icon"),E=e("el-button"),T=e("el-slider"),R=e("el-upload"),Y=e("el-input"),F=e("el-image");return a(),o("div",Ut,[u(ga,{leftStyle:{width:"calc(50% - 180px)"}},{left:c((()=>[d("div",St,[d("div",null,["selectionArea"!==y.value&&h.value?(a(),t(E,{key:0,type:"primary",class:"title-handle-btn",onClick:s[0]||(s[0]=e=>A("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 矩形 ")])),_:1})):p("",!0),"selectionArea"===y.value&&h.value?(a(),t(E,{key:1,class:"title-handle-btn",type:"warning",onClick:s[1]||(s[1]=e=>A("")),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 矩形 ")])),_:1})):p("",!0),"selectionArcArea"!==y.value&&h.value?(a(),t(E,{key:2,type:"primary",class:"title-handle-btn",onClick:s[2]||(s[2]=e=>A("selectionArcArea")),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(M))])),_:1}),v(" 圆形 ")])),_:1})):p("",!0),"selectionArcArea"===y.value&&h.value?(a(),t(E,{key:3,class:"title-handle-btn",type:"warning",onClick:s[3]||(s[3]=e=>A("")),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(M))])),_:1}),v(" 圆形 ")])),_:1})):p("",!0),"clearArea"!==y.value&&h.value?(a(),t(E,{key:4,type:"primary",class:"title-handle-btn",onClick:s[4]||(s[4]=e=>A("clearArea")),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(P))])),_:1}),v(" 笔刷 ")])),_:1})):p("",!0),"clearArea"===y.value&&h.value?(a(),t(E,{key:5,class:"title-handle-btn",type:"warning",onClick:s[5]||(s[5]=e=>A("")),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(P))])),_:1}),v(" 笔刷 ")])),_:1})):p("",!0),h.value?(a(),t(E,{key:6,class:"title-handle-btn",type:"primary",onClick:s[6]||(s[6]=e=>{m.value.initImage(h.value)}),style:{"font-size":"12px"}},{default:c((()=>[u(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(D))])),_:1}),v(" 重置 ")])),_:1})):p("",!0),h.value?(a(),t(E,{key:7,class:"title-handle-btn",type:"primary",onClick:s[7]||(s[7]=e=>{U.prompt("请输入要识别的物品类别,例如: 床, 被单, 人物(英文)等,多种类别之间请使用逗号分割","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:e})=>{if(!e)return void b.error("请输入prompt后操作");e=(e+=",").replaceAll("，",",");const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("prompt",e),t.append("image",i.value),w.post(`${Bt}/img2img/segment`,t).then((e=>{a.close(),"没有识别到任何物体，需要给定更加详细的物体类别prompt!"!==e.data?(m.value.clearSelectionArea(),m.value.initImage(`${Bt}/img2img/${e.data}`)):b.error(e.data)})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))})).catch((()=>{b({type:"info",message:"取消操作"})}))}),style:{"font-size":"12px"}},{default:c((()=>[v(" Ai识别 ")])),_:1})):p("",!0),h.value?(a(),o("div",Mt,[Pt,u(T,{style:{width:"100px","margin-left":"20px",display:"inline-block","padding-top":"9px"},modelValue:f.value,"onUpdate:modelValue":s[8]||(s[8]=e=>f.value=e),onChange:L,min:1,max:100},null,8,["modelValue"])])):p("",!0)]),d("div",Et,[u(R,{class:"upload-demo","before-upload":I,"show-file-list":!1,action:""},{default:c((()=>[u(E,{type:"text"},{default:c((()=>[v("上传图片")])),_:1})])),_:1})])]),d("div",Tt,[d("canvas",{ref_key:"canvasDom",ref:g},null,512)])])),center:c((()=>[d("div",Rt,[Yt,d("div",Ft,[d("div",Xt,[zt,d("div",Ot,[u(Y,{type:"textarea",modelValue:_.value,"onUpdate:modelValue":s[9]||(s[9]=e=>_.value=e)},null,8,["modelValue"])])]),d("div",Wt,[$t,d("div",jt,[u(Y,{type:"textarea",modelValue:C.value,"onUpdate:modelValue":s[10]||(s[10]=e=>C.value=e)},null,8,["modelValue"])])]),d("div",Zt,[u(E,{type:"primary",style:{width:"100%"},onClick:V},{default:c((()=>[v(" 生成 ")])),_:1})])])])])),right:c((()=>[Ht,d("div",Nt,[u(F,{src:x.value,fit:"scale-down","preview-src-list":[x.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])])])),_:1},8,["leftStyle"])])}}},[["__scopeId","data-v-35679002"]]);const Qt=e=>(f("data-v-7720ba97"),e=e(),y(),e),qt={class:"m-spin"},Jt={class:"m-spin-box"},Kt={key:0,class:"m-spin-dot"},el=[Qt((()=>d("span",{class:"u-dot-item"},null,-1))),Qt((()=>d("span",{class:"u-dot-item"},null,-1))),Qt((()=>d("span",{class:"u-dot-item"},null,-1))),Qt((()=>d("span",{class:"u-dot-item"},null,-1)))],al={key:1,class:"u-quarter-circle"},tl={key:2,class:"u-three-quarters-circle"},ll={key:3,class:"m-dynamic-circle"},il=[Qt((()=>d("svg",{class:"circular",viewBox:"0 0 50 50"},[d("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)))];var sl=ne(E({__name:"Spin",props:{spinning:{type:Boolean,default:!0},size:{default:"default"},tip:{default:""},indicator:{default:"dot"},color:{default:"#1677FF"}},setup:e=>(e,t)=>(a(),o("div",{class:I(`m-spin-wrap ${e.size}`),style:L(`--color: ${e.color};`)},[T(d("div",qt,[d("div",Jt,["dot"===e.indicator?(a(),o("div",Kt,el)):p("",!0),"quarter-circle"===e.indicator?(a(),o("div",al)):p("",!0),"three-quarters-circle"===e.indicator?(a(),o("div",tl)):p("",!0),"dynamic-circle"===e.indicator?(a(),o("div",ll,il)):p("",!0),T(d("p",{class:"u-tip"},g(e.tip),513),[[R,e.tip]])])],512),[[R,e.spinning]]),d("div",{class:I(["m-spin-content",{"m-spin-mask":e.spinning}])},[A(e.$slots,"default",{},void 0,!0)],2)],6))}),[["__scopeId","data-v-7720ba97"]]);const nl=e=>(f("data-v-bd6aed36"),e=e(),y(),e),ol=["onMouseenter"],dl=["src","alt","onLoad"],rl=["onClick"],ul={style:{color:"#fff","margin-bottom":"5px"}},cl={style:{color:"#fff","margin-bottom":"5px"}},hl={style:{color:"#fff",width:"100%",display:"-webkit-box","word-break":"break-all","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",overflow:"hidden","text-overflow":"ellipsis"}},ml={style:{position:"absolute",right:"10px",bottom:"5px"}},vl=["onClick"],gl=[nl((()=>d("rect",{stroke:"null",id:"svg_1",fill:"white",rx:"18",height:"36",width:"36"},null,-1))),nl((()=>d("path",{stroke:"#F3745D",id:"svg_2","stroke-width":"2",d:"m9.699395,11l16.60121,0l0,16.532009l-16.60121,0l0,-16.532009z"},null,-1))),nl((()=>d("path",{stroke:"#F3745D",id:"svg_3","stroke-width":"2",d:"m14.553074,6l6.893853,0l0,4.173591l-6.893853,0l0,-4.173591z"},null,-1))),nl((()=>d("path",{stroke:"#F3745D",id:"svg_4","stroke-width":"2",d:"m6.932526,10l22.134948,0"},null,-1))),nl((()=>d("path",{stroke:"#F3745D",id:"svg_5","stroke-width":"1.6",d:"m20.62999,14.8l0,7.240074"},null,-1))),nl((()=>d("path",{stroke:"#F3745D",id:"svg_6","stroke-width":"1.6",d:"m15.649886,14.8l0,7.170871"},null,-1)))],pl=["onClick"],fl=[nl((()=>d("rect",{width:"36",height:"36",rx:"18",fill:"white"},null,-1))),nl((()=>d("path",{d:"M9.8125 9.81836H17.9943L19.4819 11.8638H26.1761V26.182H9.8125V9.81836Z",stroke:"#4075E5","stroke-width":"2"},null,-1))),nl((()=>d("path",{d:"M9.8125 15.9547H26.1761",stroke:"#4075E5","stroke-width":"2"},null,-1)))],yl=["onClick"],wl=[nl((()=>d("rect",{width:"36",height:"36",rx:"18",fill:"white"},null,-1))),nl((()=>d("path",{d:"M17.2504 24.6942C21.3583 24.6942 24.6884 21.3642 24.6884 17.2563C24.6884 13.1484 21.3583 9.81836 17.2504 9.81836C13.1426 9.81836 9.8125 13.1484 9.8125 17.2563C9.8125 21.3642 13.1426 24.6942 17.2504 24.6942Z",stroke:"#4075E5","stroke-width":"2"},null,-1))),nl((()=>d("path",{d:"M26.1721 26.182L22.4531 22.46",stroke:"#4075E5","stroke-width":"2"},null,-1)))],bl=["onMouseenter"],kl=["src","alt","onLoad"],xl={class:"overlay"},_l={style:{color:"#fff"}};var Dl=ne(E({__name:"Index",props:{images:{default:()=>[]},columnCount:{default:3},columnGap:{default:20},width:{default:"100%"},backgroundColor:{default:"#fff"},mode:{default:"JS"}},emits:["handleShowInfoModal","handleDelete"],setup(l,{emit:i}){const v=l,f=Y((()=>"number"==typeof v.width?v.width+"px":v.width)),y=i,w=s([]),b=s([]),k=s(),_=s(),D=Y((()=>Math.max(...b.value)+v.columnGap)),C=Y((()=>v.images.length)),A=s(Array(C.value).fill(!1));function I(e){A.value[e]=!0}function V(e,a){if(e<v.columnCount)return b.value[e]=v.columnGap+a,{top:v.columnGap,left:(_.value+v.columnGap)*e+v.columnGap};{const e=Math.min(...b.value);var t=0;for(let a=0;a<b.value.length;a++)if(b.value[a]===e){t=a;break}return b.value[t]=e+v.columnGap+a,{top:e+v.columnGap,left:(_.value+v.columnGap)*t+v.columnGap}}}function U(e,a){return new Promise((t=>{const l=new Image;l.src=e,l.onload=function(){var e=l.height/(l.width/_.value);w.value[a]={width:_.value,height:e,...V(a,e)},t("load")}}))}async function S(){var e;_.value=(k.value.offsetWidth-(v.columnCount+1)*v.columnGap)/v.columnCount;const a=v.images.length;for(let t=null==(e=w.value)?void 0:e.length;t<a;t++)await U(v.images[t].src,t)}F((()=>v.images),(e=>{e.length&&"JS"===v.mode&&S()})),n((()=>{v.images.length&&"JS"===v.mode&&S()}));let M=s(null);return(l,i)=>{const s=e("svg-icon"),n=e("a-space");return a(),o(h,null,["JS"===l.mode?(a(),o("div",X({key:0},l.$attrs,{class:"m-waterfall-js",ref_key:"waterfall",ref:k,style:`background-color: ${l.backgroundColor}; width: ${f.value}; height: ${D.value}px;`}),[(a(!0),o(h,null,m(w.value,((e,s)=>(a(),t(sl,{class:"m-img",style:L(`border:solid 1px #d9d9d9; border-radius: 16px; width: ${e.width}px; height: ${e.height}px; top: ${e&&e.top}px; left: ${e&&e.left}px;`),spinning:!A.value[s],size:"small",indicator:"dynamic-circle",key:s},{default:c((()=>{var e,t;return[d("div",{class:"relative flex justify-center align-center",onMouseenter:e=>z(M)?M.value=s:M=s,onMouseleave:i[0]||(i[0]=e=>z(M)?M.value=null:M=null)},[d("img",{class:"u-img",src:l.images[s].src,alt:l.images[s].title,onLoad:e=>I(s)},null,40,dl),T(d("div",{class:"overlay",onClick:e=>y("showHandle",l.images[s])},[d("div",null,[d("div",ul,g(l.images[s].title),1),d("div",cl,"尺寸："+g((null==(e=l.images[s].width)?void 0:e.toFixed(2))+" * "+(null==(t=l.images[s].height)?void 0:t.toFixed(2))),1),d("div",hl,"文件位置："+g(l.images[s].fileAddress),1)]),d("div",ml,[(a(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"10px"},onClick:x((e=>y("handleDel",l.images[s])),["stop"])},gl,8,vl)),(a(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"10px"},onClick:x((e=>y("handleOpenDir",l.images[s])),["stop"])},fl,8,pl)),(a(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:x((e=>y("handleshowImage",l.images[s])),["stop"])},wl,8,yl))])],8,rl),[[R,r(M)===s]])],40,ol)]})),_:2},1032,["style","spinning"])))),128))],16)):p("",!0),"CSS"===l.mode?(a(),o("div",X({key:1},l.$attrs,{class:"m-waterfall-css",style:`background: ${l.backgroundColor}; width: ${f.value}; padding: ${l.columnGap}px; column-count: ${l.columnCount}; column-gap: ${l.columnGap}px;`}),[(a(!0),o(h,null,m(l.images,((e,o)=>(a(),t(sl,{style:L(`border:solid 1px #E6EAEE;border-radius: 10px;margin-bottom: ${l.columnGap}px;`),spinning:!A.value[o],size:"small",indicator:"dynamic-circle",key:o},{default:c((()=>[d("div",{style:{position:"relative"},onMouseenter:e=>z(M)?M.value=o:M=o,onMouseleave:i[1]||(i[1]=e=>z(M)?M.value=null:M=null)},[d("img",{class:"u-img",src:e.src,alt:e.title,onLoad:e=>I(o)},null,40,kl),T(d("div",xl,[u(n,{size:20},{default:c((()=>[u(s,{"icon-class":"del_active",onClick:e=>y("handleDelete",l.images[o])},null,8,["onClick"]),u(s,{"icon-class":"edit2",onClick:e=>y("handleShowInfoModal",l.images[o])},null,8,["onClick"])])),_:2},1024),d("div",_l,g(e.title),1)],512),[[R,r(M)===o]])],40,bl)])),_:2},1032,["style","spinning"])))),128))],16)):p("",!0)],64)}}}),[["__scopeId","data-v-bd6aed36"]]);const Cl={class:"my-header"},Al={class:"dialog-header"},Ll=["id"],Il={class:"image-area"},Vl={class:"image-item"},Ul=["src"],Sl={class:"image-msg-area"},Ml={class:"image-msg-item"},Pl={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000","margin-bottom":"10px"}},El={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000","margin-bottom":"10px"}},Tl={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000",width:"100%",display:"-webkit-box","word-break":"break-all","margin-bottom":"10px","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","text-overflow":"ellipsis"}},Rl=(e=>(f("data-v-0b61c804"),e=e(),y(),e))((()=>d("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("rect",{width:"36",height:"36",rx:"18",fill:"white"}),d("path",{d:"M9.8125 9.81836H17.9943L19.4819 11.8638H26.1761V26.182H9.8125V9.81836Z",stroke:"#4075E5","stroke-width":"2"}),d("path",{d:"M9.8125 15.9547H26.1761",stroke:"#4075E5","stroke-width":"2"})],-1)));var Yl=ne({__name:"imageDialog",setup(l,{expose:i}){const n=s(!1),o=s({});return i({init:e=>{o.value=e,n.value=!0}}),(l,i)=>{const s=e("el-button"),r=e("el-dialog");return a(),t(r,{"align-center":"",modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=e=>n.value=e),"show-close":!1,width:"600","before-close":l.handleClose},{header:c((({close:e,titleId:a})=>[d("div",Cl,[d("div",Al,[d("div",{id:a,class:"dialog-title",style:{"text-align":"center"}},"预览",8,Ll),u(s,{size:"small",type:"text",onClick:e,class:"dialog-close-btn"},{default:c((()=>[v(" 关闭 ")])),_:2},1032,["onClick"])])])])),default:c((()=>[d("div",Il,[d("div",Vl,[d("img",{src:o.value.src},null,8,Ul)]),d("div",Sl,[d("div",Ml,[d("div",Pl,g(o.value.title),1),d("div",El," 尺寸："+g(o.value.width.toFixed(2)+" * "+o.value.height.toFixed(2)),1),d("div",Tl," 文件位置："+g(o.value.fileAddress),1),u(s,{type:"text",style:{padding:"0"},onClick:i[0]||(i[0]=e=>(({fileAddress:e})=>{window.open(e)})(o.value))},{default:c((()=>[Rl,v(" 打开所在文件夹 ")])),_:1})])])])])),_:1},8,["modelValue","before-close"])}}},[["__scopeId","data-v-0b61c804"]]);function Fl(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}function Xl(e,a){return"left"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e>l?e:l,i.height=e>l?e:l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(n,o),s.rotate(-Math.PI/2),s.translate(-n,-o),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const d=s.getImageData(o-t.height/2,n-t.width/2,l,e),r=document.createElement("canvas");r.width=l,r.height=e,r.getContext("2d").putImageData(d,0,0);const u=Fl(r.toDataURL("image/png")),c=new File([u],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:c,url:e.result})},h.readAsDataURL(c)}})))(e):"right"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e>l?e:l,i.height=e>l?e:l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(n,o),s.rotate(Math.PI/2),s.translate(-n,-o),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const d=s.getImageData(o-t.height/2,n-t.width/2,l,e),r=document.createElement("canvas");r.width=l,r.height=e,r.getContext("2d").putImageData(d,0,0);const u=Fl(r.toDataURL("image/png")),c=new File([u],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:c,url:e.result})},h.readAsDataURL(c)}})))(e):"horizontal"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e,i.height=l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(2*n,0),s.scale(-1,1),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const d=s.getImageData(0,0,e,l),r=document.createElement("canvas");r.width=e,r.height=l,r.getContext("2d").putImageData(d,0,0);const u=Fl(r.toDataURL("image/png")),c=new File([u],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:c,url:e.result})},h.readAsDataURL(c)}})))(e):"vertical"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e,i.height=l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(0,2*o),s.scale(1,-1),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const d=s.getImageData(0,0,e,l),r=document.createElement("canvas");r.width=e,r.height=l,r.getContext("2d").putImageData(d,0,0);const u=Fl(r.toDataURL("image/png")),c=new File([u],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:c,url:e.result})},h.readAsDataURL(c)}})))(e):void 0}const zl={class:"image-search-body"},Ol={class:"upload-image-title"},Wl={key:0,class:"clear-result"},$l={class:"upload-image-area"},jl=["src"],Zl={key:1,class:"upload-text-tips"},Hl=(e=>(f("data-v-216c4056"),e=e(),y(),e))((()=>d("div",{class:"upload-text"},"点击上传",-1))),Nl={key:0,class:"image-handle-area"},Bl={class:"image-handle-item"},Gl={class:"image-handle-item"},Ql={key:1,class:"search-btn-area"},ql={class:"search-result-area"},Jl={class:"search-result-title"},Kl={key:0,class:"result-num"},ei={key:0,class:"search-result-images-area"},ai="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo";var ti=ne({__name:"index",setup(t){const l=s(null),i=s(null),n=s([]),h=s(0),m=s([]),f=s(!1),y=e=>{Xl(i.value,e).then((({file:e,url:a})=>{l.value=e,i.value=a}))},b=e=>{l.value=e;const a=new FileReader;return a.onload=({target:e})=>{i.value=e.result},a.readAsDataURL(e),!1},k=()=>{l.value=null,i.value=null},D=()=>{const e=new FormData;e.append("file",l.value),f.value=!0,w.post(`${ai}/search`,e).then((e=>{const{data:a}=e;m.value=a.result.map((e=>({title:e,fileAddress:`${ai}/static/${e}`,width:1920,height:1080,src:`${ai}/static/${e}`}))),f.value=!1}))},A=e=>{h.value.init(e)},L=({fileAddress:e})=>{window.open(e)},I=()=>{n.value=[],m.value=[],i.value=null,l.value=null};return(t,l)=>{const s=e("el-button"),n=e("el-icon"),w=e("el-upload"),V=e("el-scrollbar"),U=O("loading");return a(),o("div",zl,[u(ga,null,{left:c((()=>[d("div",Ol,[v(" 上传识别图 "),m.value.length?(a(),o("div",Wl,[u(s,{style:{padding:"0",height:"20px","line-height":"20px"},type:"text",onClick:I},{default:c((()=>[v("清空")])),_:1})])):p("",!0)]),d("div",$l,[u(w,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":b},{default:c((()=>[i.value?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:l[1]||(l[1]=x((()=>{}),["stop"]))},[d("img",{src:i.value,class:"avatar"},null,8,jl),d("div",{class:"upload-image-del-btn-area",onClick:l[0]||(l[0]=x((()=>{}),["stop"]))},[d("div",{class:"upload-image-del-btn",onClick:x(k,["stop"])},[u(n,null,{default:c((()=>[u(r(C))])),_:1})])])])):(a(),o("div",Zl,[u(n,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),Hl]))])),_:1})]),i.value?(a(),o("div",Nl,[d("div",Bl,[u(s,{onClick:l[2]||(l[2]=e=>y("left")),size:"small"},{default:c((()=>[v(" 左旋90° ")])),_:1}),u(s,{onClick:l[3]||(l[3]=e=>y("horizontal")),size:"small"},{default:c((()=>[v(" 水平镜像 ")])),_:1})]),d("div",Gl,[u(s,{onClick:l[4]||(l[4]=e=>y("right")),size:"small"},{default:c((()=>[v(" 右旋90° ")])),_:1}),u(s,{onClick:l[5]||(l[5]=e=>y("vertical")),size:"small"},{default:c((()=>[v(" 垂直镜像 ")])),_:1})])])):p("",!0),i.value?(a(),o("div",Ql,[u(s,{round:"",type:"primary",onClick:D},{default:c((()=>[v("开始识别")])),_:1})])):p("",!0)])),right:c((()=>[d("div",ql,[d("div",Jl,[v(" 搜索结果 "),m.value.length?(a(),o("div",Kl," 共 "+g(m.value.length)+" 张 ",1)):p("",!0)]),T((a(),o("div",{class:"search-result-images","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[u(V,null,{default:c((()=>[m.value.length?(a(),o("div",ei,[u(Dl,{onHandleshowImage:A,onHandleOpenDir:L,columnCount:5,images:m.value},null,8,["images"])])):p("",!0)])),_:1})])),[[U,f.value]])])])),_:1}),u(Yl,{ref_key:"imageDialogDom",ref:h},null,512)])}}},[["__scopeId","data-v-216c4056"]]);const li=e=>(f("data-v-6e71c3e2"),e=e(),y(),e),ii={class:"dir-area"},si=li((()=>d("div",{class:"dir-list-title"},[v(" 链接本地图库 "),d("div",{class:"add-gallery-btn"})],-1))),ni={key:0,class:"dir-list"},oi={class:"dir-path"},di={class:"dir-handle"},ri={class:"images-all-area"},ui={class:"images-all-title"},ci=li((()=>d("div",null,null,-1))),hi={class:"images-num"},mi=li((()=>d("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("rect",{x:"3.5",y:"3.5",width:"13",height:"13",stroke:"#79bbff","stroke-width":"1.5"}),d("path",{d:"M5 10H15",stroke:"#79bbff","stroke-width":"1.5"}),d("path",{d:"M10 5V15",stroke:"#79bbff","stroke-width":"1.5"})],-1))),vi={key:0,style:{"margin-left":"20px"}},gi={key:0,class:"images-all-images-area"},pi={class:"dir-list-content"},fi={class:"dir-info-icon"},yi=["onClick"],wi="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo",bi='<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n';var ki=ne({__name:"index",setup(l){s([]);const i=s(0),r=s([]),f=s([]),y=s(!1),k=s(!1),_=s(!1),D=s([]),C=()=>{y.value=!0,w.get(`${wi}/images`).then((e=>{const{data:a}=e;y.value=!1,f.value=r.value=a.images.map((e=>({title:e,fileAddress:`${wi}/static/${e}`,width:1920,height:1080,src:`${wi}/static/${e}`})))}))},A=()=>{k.value=!0,setTimeout((()=>{k.value=!1,D.value=["线上图库"]}),1e3),C()},L=e=>{D.value.push(e),_.value=!1},I=()=>{b("演示版本暂无此功能，请于正式版本使用")};return n((()=>{A(),window.onFolderSelected=L})),(l,s)=>{const n=e("el-button"),w=e("el-empty"),b=e("el-scrollbar"),A=e("el-upload"),L=e("el-image"),V=O("loading");return T((a(),o("div",{class:"gallery-body","element-loading-spinner":bi,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[u(ga,null,{left:c((()=>[d("div",ii,[si,T((a(),o("div",{class:"dir-all-area","element-loading-spinner":bi,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[u(b,null,{default:c((()=>[D.value.length?(a(),o("div",ni,[(a(!0),o(h,null,m(D.value,((e,t)=>(a(),o("div",{class:"dir-list-item",key:t},[d("div",oi,g(e),1),d("div",di,[u(n,{type:"text",onClick:e=>{},style:{color:"#f3745d",padding:"0",height:"20px","vertical-align":"top"}},{default:c((()=>[v("删除")])),_:2},1032,["onClick"])])])))),128))])):(a(),t(w,{key:1,description:"暂未连接本地图库",style:{"padding-top":"200px",color:"rgba(0, 0, 0, 1)"}},{default:c((()=>[u(n,{type:"primary",round:"",onClick:I},{default:c((()=>[v("选择")])),_:1})])),_:1}))])),_:1})])),[[V,k.value]])])])),right:c((()=>[d("div",ri,[d("div",ui,[v(" 图库预览 "),ci,d("div",hi,[u(A,{class:"upload-demo","show-file-list":!1,"on-success":C,action:`${wi}/upload`},{default:c((()=>[u(n,{type:"text",size:"small",style:{padding:"0"}},{default:c((()=>[mi,v(" 上传图片 ")])),_:1})])),_:1},8,["action"]),f.value.length?(a(),o("div",vi," 共 "+g(r.value.length)+" 张 ",1)):p("",!0)])]),T((a(),o("div",{class:"images-all-images","element-loading-spinner":bi,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[u(b,null,{default:c((()=>[f.value.length?(a(),o("div",gi,[d("div",pi,[(a(!0),o(h,null,m(f.value,((e,t)=>(a(),o("div",{class:"dir-list-info",type:"image",key:t},[d("div",fi,[u(L,{style:{width:"100%",height:"100px"},"preview-src-list":[e.src],src:e.src,fit:"cover",lazy:""},null,8,["preview-src-list","src"])]),d("div",{class:"dir-name",onClick:x((a=>{return t=e,void i.value.init(t);var t}),["stop"])},g(e.title),9,yi)])))),128))])])):(a(),t(w,{key:1,description:"暂无内容",style:{"padding-top":"200px",color:"rgba(0, 0, 0, 1)"}}))])),_:1})])),[[V,y.value]])])])),_:1}),u(Yl,{ref_key:"imageDialogDom",ref:i},null,512)])),[[V,_.value]])}}},[["__scopeId","data-v-6e71c3e2"]]);class xi{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e){const{canvasDom:a}=this;if("selectionArea"===e)a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(a,"mousemove",(e=>{this.selectionAreaMoving(e)}));else this.clearHandle()}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t;this.handleList=[],a.beginPath(),a.clearRect(0,0,l,i),a.closePath();const s=new Image;s.src=e,s.onload=()=>{this.initImageData(s),this.drawImage()}}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath(),this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((({handleX:a,handleY:t,offsetX:l,offsetY:i,status:s})=>{e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const n=a>l?l:a,o=t>i?i:t,d=a>l?a-l:l-a,r=t>i?t-i:i-t;(d&&r||!s)&&(e.rect(n,o,d,r),e.stroke(),e.closePath())}))}getSelecttionAreaImages(){this.handleList.forEach(((e,a)=>{const{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n,imageData:o}=e,{ctx:d}=this;if(n&&!o){const n=t>i?i:t,o=l>s?s:l,r=t>i?t-i:i-t,u=l>s?l-s:s-l;if(!r||!u)return;const c=d.getImageData(Math.round(n),Math.round(o),Math.round(r),Math.round(u)),h=document.createElement("canvas");h.width=r,h.height=u;h.getContext("2d").putImageData(c,0,0);const m=function(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}(h.toDataURL("image/png"));e.imageData=new File([m],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}))}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}}const _i=e=>(f("data-v-589b370f"),e=e(),y(),e),Di={class:"super-image-search-body"},Ci={class:"image-search-title"},Ai={key:3,class:"image-handle-area"},Li={class:"image-handle-item"},Ii=_i((()=>d("div",{class:"image-handle-item"},null,-1))),Vi={class:"image-search-title-handle"},Ui={class:"content"},Si={class:"search-btn-area"},Mi=_i((()=>d("br",null,null,-1))),Pi={class:"image-search-title",style:{height:"30px"}},Ei=_i((()=>d("div",null,"搜索结果",-1))),Ti={class:"image-search-title-handle"},Ri={class:"content",style:{height:"calc(100% - 40px)"}},Yi="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo";var Fi=ne({__name:"index",setup(l){const i=s(null),h=s(null),m=s(null),f=s(0),y=s(0),k=s(""),x=s([]),_=s(!1),C=s("图片搜索"),A=s(""),L=s(10),I=s(!1),V=e=>{Xl(h.value,e).then((({file:e,url:a})=>{i.value=e,h.value=a,m.value.initImage(h.value)}))},U=e=>{h.value?(k.value=e,m.value.handleChange(e)):b.error("请在上传图片后操作")};const M=e=>{i.value=e;const a=new FileReader;return a.onload=({target:e})=>{h.value=e.result,m.value.initImage(h.value)},a.readAsDataURL(e),!1},P=()=>{if(_.value=!0,"图片搜索"===C.value){let e=m.value.handleList;e.length?(e=>{let a=new FormData;e.forEach((({imageData:e})=>{a.append("files",e)})),I.value&&x.value.forEach((e=>{a.append("img_list",e.title)})),w.post(`${Yi}/super_search?search_num=${L.value}`,a).then((e=>{const{data:a}=e;x.value=a.result.map((e=>({title:e,fileAddress:`${Yi}/static/${e}`,width:1920,height:1080,src:`${Yi}/static/${e}`}))),_.value=!1}))})(e):(()=>{const e=new FormData;e.append("file",i.value),I.value&&x.value.forEach((a=>{e.append("img_list",a.title)})),w.post(`${Yi}/search?search_num=${L.value}`,e).then((e=>{const{data:a}=e;x.value=a.result.map((e=>({title:e,fileAddress:`${Yi}/static/${e}`,width:1920,height:1080,src:`${Yi}/static/${e}`}))),_.value=!1}))})()}else"描述搜索"===C.value&&(I.value&&JSON.parse(JSON.stringify(x.value)).map((e=>e.title)),w.post(`${Yi}/text_search?text=${A.value}&search_num=${L.value}`).then((e=>{const{data:a}=e;x.value=a.result.map((e=>({title:e,fileAddress:`${Yi}/static/${e}`,width:1920,height:1080,src:`${Yi}/static/${e}`}))),_.value=!1})))},E=e=>{i.value=null,h.value=null,k.value="",A.value="",C.value=e,m.value.handleChange(""),m.value.clearAll()},Y=e=>{y.value.init(e)},F=({fileAddress:e})=>{window.open(e)};return n((()=>{m.value=new xi(f.value)})),(l,i)=>{const s=e("el-icon"),n=e("el-button"),w=e("el-dropdown-item"),b=e("el-dropdown-menu"),X=e("el-dropdown"),z=e("el-upload"),O=e("el-input"),$=e("el-checkbox"),j=e("el-input-number"),Z=e("el-form-item"),H=e("el-form"),N=e("el-scrollbar");return a(),o("div",Di,[u(ga,{leftStyle:{width:"calc(50% - 55px)"}},{left:c((()=>[d("div",Ci,[d("div",null,[u(X,null,{dropdown:c((()=>[u(b,null,{default:c((()=>[u(w,{onClick:i[0]||(i[0]=e=>E("图片搜索"))},{default:c((()=>[v("图片搜索")])),_:1}),u(w,{onClick:i[1]||(i[1]=e=>E("描述搜索"))},{default:c((()=>[v("描述搜索")])),_:1})])),_:1})])),default:c((()=>[u(n,{type:"primary"},{default:c((()=>[v(g(C.value)+" ",1),u(s,{class:"el-icon--right"},{default:c((()=>[u(r(W))])),_:1})])),_:1})])),_:1}),""===k.value&&h.value?(a(),t(n,{key:0,type:"primary",class:"title-handle-btn",onClick:i[2]||(i[2]=e=>U("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 框选区域 ")])),_:1})):p("",!0),"selectionArea"===k.value&&h.value?(a(),t(n,{key:1,class:"title-handle-btn",type:"warning",onClick:i[3]||(i[3]=e=>U("")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 框选区域 ")])),_:1})):p("",!0),h.value?(a(),t(n,{key:2,class:"title-handle-btn",type:"primary",onClick:i[4]||(i[4]=e=>{m.value.clearSelectionArea()}),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(D))])),_:1}),v(" 清空框选区域 ")])),_:1})):p("",!0),h.value?(a(),o("div",Ai,[d("div",Li,[u(n,{onClick:i[5]||(i[5]=e=>V("left")),size:"small"},{default:c((()=>[v(" 左旋90° ")])),_:1}),u(n,{onClick:i[6]||(i[6]=e=>V("right")),size:"small"},{default:c((()=>[v(" 右旋90° ")])),_:1}),u(n,{onClick:i[7]||(i[7]=e=>V("horizontal")),size:"small"},{default:c((()=>[v(" 水平镜像 ")])),_:1}),u(n,{onClick:i[8]||(i[8]=e=>V("vertical")),size:"small"},{default:c((()=>[v(" 垂直镜像 ")])),_:1})]),Ii])):p("",!0)]),d("div",Vi,["图片搜索"===C.value?(a(),t(z,{key:0,class:"upload-demo","before-upload":M,"show-file-list":!1,action:""},{default:c((()=>[u(n,{type:"text"},{default:c((()=>[v("上传图片")])),_:1})])),_:1})):p("",!0)])]),d("div",Ui,[T(d("canvas",{ref_key:"canvasDom",ref:f},null,512),[[R,"图片搜索"===C.value]]),T(u(O,{style:{height:"100%"},type:"textarea",modelValue:A.value,"onUpdate:modelValue":i[9]||(i[9]=e=>A.value=e),placeholder:"请输入图片描述"},null,8,["modelValue"]),[[R,"描述搜索"===C.value]])])])),center:c((()=>[d("div",Si,[d("div",null,[u($,{modelValue:I.value,"onUpdate:modelValue":i[10]||(i[10]=e=>I.value=e),style:{"margin-bottom":"10px"}},{default:c((()=>[v("基于上次"),Mi,v("结果搜索")])),_:1},8,["modelValue"]),u(n,{type:"primary",class:"title-handle-btn",onClick:i[11]||(i[11]=e=>P()),disabled:!h.value&&!A.value,loading:_.value},{default:c((()=>[v("搜索")])),_:1},8,["disabled","loading"])])])])),right:c((()=>[d("div",Pi,[Ei,d("div",Ti,[u(H,null,{default:c((()=>[u(Z,{label:"搜索数量"},{default:c((()=>[u(j,{modelValue:L.value,"onUpdate:modelValue":i[12]||(i[12]=e=>L.value=e),min:1,controls:!1},null,8,["modelValue"])])),_:1})])),_:1})])]),d("div",Ri,[u(N,null,{default:c((()=>[_.value?p("",!0):(a(),t(Dl,{key:0,onHandleshowImage:Y,onHandleOpenDir:F,columnCount:3,images:x.value},null,8,["images"]))])),_:1})])])),_:1},8,["leftStyle"]),u(Yl,{ref_key:"imageDialogDom",ref:y},null,512)])}}},[["__scopeId","data-v-589b370f"]]);const Xi={__name:"addOrUpdate",emits:["review"],setup(l,{expose:i,emit:n}){s([]);const r=s(!1),g=s({}),p=s("add"),f=s(["普通会员","超级会员"]),y=s(!1),b=n;return i({init:(e="add",a={name:"",valid_days:0,account_type:"普通会员",available_images:0})=>{g.value=a,p.value=e,r.value=!0}}),(l,i)=>{const s=e("el-input"),n=e("el-form-item"),p=e("el-input-number"),k=e("el-option"),x=e("el-select"),_=e("el-form"),D=e("el-button"),C=e("el-dialog");return a(),t(C,{title:"激活码",modelValue:r.value,"onUpdate:modelValue":i[5]||(i[5]=e=>r.value=e),"show-close":!1,width:"400","before-close":l.handleClose},{footer:c((()=>[d("div",null,[u(D,{onClick:i[4]||(i[4]=e=>(y.value=!0,void w.post("https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo/add_account",g.value).then((()=>{b("review"),y.value=!1,r.value=!1})).catch((e=>{e.includes("Network Error")?ElMessage.error("网络错误"):ElMessage.error("未知错误")})))),loading:y.value},{default:c((()=>[v("保存")])),_:1},8,["loading"])])])),default:c((()=>[u(_,{"label-width":"100px"},{default:c((()=>[u(n,{label:"用户名"},{default:c((()=>[u(s,{modelValue:g.value.username,"onUpdate:modelValue":i[0]||(i[0]=e=>g.value.username=e)},null,8,["modelValue"])])),_:1}),u(n,{label:"有效时长"},{default:c((()=>[u(p,{modelValue:g.value.valid_days,"onUpdate:modelValue":i[1]||(i[1]=e=>g.value.valid_days=e),controls:!1,precision:0,step:1,min:0},null,8,["modelValue"]),v("  天 ")])),_:1}),u(n,{label:"会员类型"},{default:c((()=>[u(x,{style:{width:"100%","text-align":"left"},modelValue:g.value.account_type,"onUpdate:modelValue":i[2]||(i[2]=e=>g.value.account_type=e)},{default:c((()=>[(a(!0),o(h,null,m(f.value,(e=>(a(),t(k,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(n,{label:"可用图片数量"},{default:c((()=>[u(p,{modelValue:g.value.available_images,"onUpdate:modelValue":i[3]||(i[3]=e=>g.value.available_images=e),controls:!1,precision:0,step:1,min:0},null,8,["modelValue"]),v("  张 ")])),_:1})])),_:1})])),_:1},8,["modelValue","before-close"])}}};const zi=e=>(f("data-v-52ff9cb6"),e=e(),y(),e),Oi={class:"table-handle-area"},Wi={class:"table-handle-info-area"},$i={class:"table-area"},ji={class:"table-area-info"},Zi={class:"table-area"},Hi=zi((()=>d("br",null,null,-1))),Ni=zi((()=>d("br",null,null,-1))),Bi={class:"pagination-body"},Gi="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo";var Qi=ne({__name:"index",setup(l){const i=s([]),r=s(1),h=s(10),m=s(!1),f=s(0),y=s([]);s(["普通会员","超级会员"]);const k=()=>{w.get(`${Gi}/get_accounts`).then((({data:e})=>{y.value=e,x()})).catch((e=>{}))},x=()=>{const e=JSON.parse(JSON.stringify(y.value)).filter((({"用户名称":e})=>!D.value||e.includes(D.value)));i.value=e.splice((r.value-1)*h.value,(r.value-1)*h.value+h.value)},_=()=>{r.value=1,x()},D=s(null);return n((()=>{k()})),(l,s)=>{const n=e("el-input"),h=e("el-col"),C=e("el-button"),A=e("el-row"),L=e("el-table-column"),I=e("el-switch"),V=e("el-table"),S=e("el-pagination"),M=O("loading");return T((a(),o("div",{class:"main-body","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[d("div",Oi,[d("div",Wi,[u(A,{gutter:20},{default:c((()=>[u(h,{span:4},{default:c((()=>[u(n,{onInput:_,placeholder:"用户名称",modelValue:D.value,"onUpdate:modelValue":s[0]||(s[0]=e=>D.value=e),clearable:""},null,8,["modelValue"])])),_:1}),u(h,{span:12},{default:c((()=>[v("   ")])),_:1}),u(h,{span:8,style:{"text-align":"right"}},{default:c((()=>[u(C,{type:"primary",onClick:s[1]||(s[1]=e=>{f.value.init()})},{default:c((()=>[v("添加激活码")])),_:1})])),_:1})])),_:1})])]),d("div",$i,[d("div",ji,[d("div",Zi,[u(V,{data:i.value,border:"",height:"100%"},{default:c((()=>[u(L,{label:"用户名称",prop:"用户名称",align:"center"}),u(L,{label:"激活码",prop:"API",align:"center"},{default:c((({row:e})=>[v(g(e.API)+" ",1),u(C,{type:"text",size:"small",onClick:a=>{return t=e.API,(l=document.createElement("textarea")).style.position="fixed",l.style.opacity=0,l.value=t,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),void b.success("复制成功");var t,l}},{default:c((()=>[v(" 复制 ")])),_:2},1032,["onClick"])])),_:1}),u(L,{label:"注册时间",prop:"注册时间",align:"center"}),u(L,{label:"到期时间",prop:"到期时间",align:"center"}),u(L,{label:"会员类型",prop:"会员类型",align:"center"},{default:c((({row:e})=>[v(g(e.会员类型)+" ",1),"普通会员"===e.会员类型?(a(),t(C,{key:0,type:"text",size:"small",onClick:a=>{return t=e.用户名称,m.value=!0,void w.post(`${Gi}/upgrade_account`,{username:t}).then((()=>{k(),m.value=!1})).catch((e=>{}));var t}},{default:c((()=>[v("升级")])),_:2},1032,["onClick"])):p("",!0)])),_:1}),u(L,{label:"注册图片数目",prop:"注册图片数目",align:"center"}),u(L,{label:"可用图片数目",prop:"可用图片数目",align:"center"}),u(L,{label:"是否停用",align:"center",fixed:"right"},{default:c((({row:e})=>[u(I,{size:"small",modelValue:e.是否停用,"onUpdate:modelValue":a=>e.是否停用=a,onChange:a=>{return t=e.用户名称,m.value=!0,void w.post(`${Gi}/ban_account`,{username:t}).then((()=>{m.value=!1})).catch((e=>{}));var t}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),u(L,{label:"操作",align:"center",fixed:"right"},{default:c((({row:e})=>[u(C,{size:"small",style:{"margin-bottom":"5px"},onClick:a=>{return t=e.用户名称,void U.prompt("请输入延长时间","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/[0-9]?/,inputErrorMessage:"请输入数字"}).then((({value:e})=>{m.value=!0,w.post(`${Gi}/span_account`,{username:t,days:e}).then((()=>{m.value=!1,k(),b.success("修改成功")})).catch((e=>{}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var t}},{default:c((()=>[v("延长时间")])),_:2},1032,["onClick"]),Hi,u(C,{size:"small",style:{"margin-bottom":"5px"},onClick:a=>{return t=e.用户名称,void U.prompt("请输入增加数量","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/[0-9]?/,inputErrorMessage:"请输入数字"}).then((({value:e})=>{m.value=!0,w.post(`${Gi}/addImg_account`,{username:t,available_images:e}).then((()=>{m.value=!1,k(),b.success("修改成功")})).catch((e=>{}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var t}},{default:c((()=>[v("增加次数")])),_:2},1032,["onClick"]),Ni,u(C,{type:"danger",size:"small",onClick:a=>{return t=e.用户名称,m.value=!0,void w.post(`${Gi}/delete_account`,{username:t}).then((()=>{m.value=!1,k()})).catch((e=>{}));var t}},{default:c((()=>[v("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),d("div",Bi,[u(S,{small:"",modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=e=>r.value=e),onCurrentChange:s[3]||(s[3]=e=>x()),background:"",layout:"prev, pager, next",total:y.value.length},null,8,["modelValue","total"])])])])]),u(Xi,{ref_key:"addOrUpdateDom",ref:f,onReview:k},null,512)])),[[M,m.value]])}}},[["__scopeId","data-v-52ff9cb6"]]);const qi={},Ji={class:"main-body"},Ki=[(e=>(f("data-v-7883bf73"),e=e(),y(),e))((()=>d("iframe",{src:"http://47.88.56.24:5006/"},null,-1)))];var es=ne(qi,[["render",function(e,t){return a(),o("div",Ji,Ki)}],["__scopeId","data-v-7883bf73"]]);const as={class:"image-list"},ts=["onClick"],ls="https://u248120-8f1e-2c47d43a.westb.seetacloud.com:8443";var is=ne({__name:"addImageset",emits:["reviewImageset","reviewImage"],setup(l,{expose:i,emit:n}){const g=n,f=s(!1),y=s(null),_=s(null),D=s([]),A=s([]),L=s(null),I=s(null),V=["本地上传","网络图片"],U=()=>{I.value=null,f.value=!0,A.value=[],D.value=[]},S=e=>{const a=new FileReader;return a.onload=({target:a})=>{D.value.push(e),A.value.push(a.result)},a.readAsDataURL(e),!1},M=()=>{if(!D.value.length&&"本地上传"===L.value)return b.error("请上传图片后操作"),!1;if(!A.value.length&&"本地上传"!==L.value)return b.error("请搜索图片后操作"),!1;(null===_.value?"本地上传"===L.value?R:E:P)().then((()=>{_.value?g("reviewImage"):g("reviewImageset"),f.value=!1}))},P=()=>{const e=new FormData;e.append("dataset",y.value),e.append("imageset",_.value),D.value.forEach((a=>{e.append("images",a)}));const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});return new Promise((t=>{w.post(`${ls}/datasets/upload_image`,e).then((()=>{a.close(),b({type:"success",message:"操作成功"}),t()}))}))},E=()=>{const e=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});return new Promise((a=>{w.post(`${ls}/datasets/add_imageset_spider`,{dataset:y.value,image_urls:A.value}).then((()=>{e.close(),b({type:"success",message:"操作成功"}),a()}))}))},T=()=>{const e=new FormData;e.append("web_url",I.value),w.post(`${ls}/datasets/spider`,e).then((({data:e})=>{A.value=e,b({type:"success",message:"操作成功"})}))},R=()=>{let e=0;const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});return new Promise((t=>{D.value.forEach((l=>{const i=new FormData;i.append("dataset",y.value),i.append("images",l),w.post(`${ls}/datasets/add_imageset`,i).then((()=>{e+=1,e%10||b({type:"success",message:`当前上传进度: ${Math.round(e/D.value.length*1e4)/100} %`}),e===D.value.length&&(a.close(),b({type:"success",message:"操作成功"}),t())}))}))}))};return i({init:(e,a=null)=>{y.value=e||y.value,_.value=a,I.value=null,L.value="本地上传",f.value=!0,A.value=[],D.value=[]}}),(l,i)=>{const s=e("el-segmented"),n=e("el-form-item"),g=e("el-button"),y=e("el-upload"),w=e("el-input"),b=e("el-image"),k=e("el-icon"),P=e("el-scrollbar"),E=e("el-form"),R=e("el-dialog");return a(),t(R,{modelValue:f.value,"onUpdate:modelValue":i[2]||(i[2]=e=>f.value=e),width:"800",title:_.value?"上传图片":"新建图片集"},{footer:c((()=>[u(g,{onClick:M},{default:c((()=>[v("保存")])),_:1})])),default:c((()=>[u(E,{"label-width":"100px"},{default:c((()=>[_.value?p("",!0):(a(),t(n,{key:0,label:"图片目标"},{default:c((()=>[u(s,{modelValue:L.value,"onUpdate:modelValue":i[0]||(i[0]=e=>L.value=e),options:V,onChange:U},null,8,["modelValue"])])),_:1})),"本地上传"===L.value?(a(),t(n,{key:1,label:"上传图片"},{default:c((()=>[u(y,{class:"upload-demo","show-file-list":!1,accept:"image/*",action:"''",multiple:"","before-upload":S},{default:c((()=>[u(g,{size:"small"},{default:c((()=>[v(" 上传图片 ")])),_:1})])),_:1})])),_:1})):p("",!0),"网络图片"===L.value?(a(),t(n,{key:2,label:"网络地址"},{default:c((()=>[u(w,{modelValue:I.value,"onUpdate:modelValue":i[1]||(i[1]=e=>I.value=e),clearable:""},{append:c((()=>[u(g,{icon:r($),onClick:T},null,8,["icon"])])),_:1},8,["modelValue"])])),_:1})):p("",!0),u(n,{label:"图片预览"},{default:c((()=>[d("div",as,[u(P,{height:"300px"},{default:c((()=>[(a(!0),o(h,null,m(A.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[u(b,{style:{width:"100%",height:"130px"},src:e,fit:"cover",lazy:""},null,8,["src"]),d("div",{class:"image-icon del",onClick:x((e=>(e=>{D.value.splice(e,1),A.value.splice(e,1)})(t)),["stop"])},[u(k,null,{default:c((()=>[u(r(C))])),_:1})],8,ts)])))),128))])),_:1})])])),_:1})])),_:1})])),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-1fff5cc4"]]);const ss={key:1,class:"image-item"},ns={class:"file-name"};var os=ne({__name:"addMockup",emits:["review"],setup(l,{expose:i,emit:n}){const h=s(!1),m=s(null),p=s(null),f=s(null),y=s(null),_=n,D=e=>{const a=new FileReader;return a.onload=({target:a})=>{m.value=e,p.value=a.result},a.readAsDataURL(e),!1},A=e=>(f.value=e,!1),L=()=>{if(!y.value)return void b.error("请输入样机名后操作");if(!m.value)return void b.error("请上传封面图后操作");if(!f.value)return void b.error("请上传样机psd后操作");const e=new FormData;e.append("psd_file",f.value),e.append("preview_file",m.value),e.append("mockup_name",y.value);const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post("https://u248120-8f1e-2c47d43a.westb.seetacloud.com:8443/datasets/upload_mockup",e).then((({data:e})=>{a.close(),"错误的psd文件"!==e?(_("review"),h.value=!1,b({type:"success",message:"添加成功"})):b.error("请上传正确的psd文件")}))};return i({init:()=>{m.value=null,p.value=null,f.value=null,h.value=!0}}),(l,i)=>{const s=e("el-input"),n=e("el-form-item"),w=e("el-button"),b=e("el-upload"),k=e("el-image"),_=e("el-icon"),I=e("el-form"),V=e("el-dialog");return a(),t(V,{modelValue:h.value,"onUpdate:modelValue":i[2]||(i[2]=e=>h.value=e),width:"500",title:"添加样机"},{footer:c((()=>[u(w,{onClick:L},{default:c((()=>[v("保存")])),_:1})])),default:c((()=>[u(I,{"label-width":"100px"},{default:c((()=>[u(n,{label:"样机名称"},{default:c((()=>[u(s,{modelValue:y.value,"onUpdate:modelValue":i[0]||(i[0]=e=>y.value=e),clearable:""},null,8,["modelValue"])])),_:1}),u(n,{label:"上传封面图片"},{default:c((()=>[null===p.value?(a(),t(b,{key:0,class:"upload-demo","show-file-list":!1,accept:"image/*",action:"''","before-upload":D},{default:c((()=>[u(w,{size:"small"},{default:c((()=>[v(" 上传图片 ")])),_:1})])),_:1})):(a(),o("div",ss,[u(k,{style:{width:"100%",height:"130px"},src:p.value,fit:"cover",lazy:""},null,8,["src"]),d("div",{class:"image-icon del",onClick:i[1]||(i[1]=x((e=>(m.value=null,void(p.value=null))),["stop"]))},[u(_,null,{default:c((()=>[u(r(C))])),_:1})])]))])),_:1}),u(n,{label:"上传样机psd"},{default:c((()=>[d("div",ns,g(null===f.value?"暂未上传":f.value.name),1),u(b,{class:"upload-demo","show-file-list":!1,accept:"image/vnd.adobe.photoshop,.psd",action:"''","before-upload":A},{default:c((()=>[u(w,{size:"small"},{default:c((()=>[v(" 上传样机 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-058b9088"]]);const ds=e=>(f("data-v-6179594b"),e=e(),y(),e),rs={class:"handle-area"},us={class:"selected-all-area"},cs={class:"select-all-item"},hs=ds((()=>d("div",{class:"select-all-name"},"样机",-1))),ms={class:"select-all-item"},vs=ds((()=>d("div",{class:"select-all-name"},"数据集",-1))),gs={class:"other-select-area"},ps={class:"select-list"},fs=["onClick"],ys={class:"selected-name"},ws={class:"select-list"},bs=["onClick"],ks={class:"selected-name"},xs={key:0,class:"progress-area"},_s={class:"progress-item"},Ds={class:"btn-area"},Cs="https://u248120-8f1e-2c47d43a.westb.seetacloud.com:8443";var As=ne({__name:"updateMockupImage",emits:["review"],setup(l,{expose:i,emit:n}){const r=s(!1),f=s([]),y=s([]),k=s(!1),_=s([]),D=s([]),C=s(!1),A=s(!0),V=s(1),U=s(1),S=s(!1),M=n,P=(e,a=0)=>{if(a===e.length)return;const{mockup:t,dataset:l}=e[a];a+=1;const i=new FormData;i.append("mockup",t),i.append("dataset",l),w.post(`${Cs}/datasets/update_mockup_image`,i).then((()=>{U.value+=1,U.value===V.value&&(S.value=!1),P(e,a)})).catch((()=>{U.value+=1,U.value===V.value&&(S.value=!1),P(e,a)}))},E=()=>{if(!y.value.length)return void b.error("请选择样机后操作");if(!D.value.length)return void b.error("请选择数据集后操作");const e=[];y.value.forEach((a=>{D.value.forEach((t=>{e.push({mockup:a,dataset:t})}))})),V.value=e.length+1,U.value=1,S.value=!0,P(e)},T=()=>{r.value=!1,M("review")};return F(k,(e=>{A.value&&(y.value=e?JSON.parse(JSON.stringify(f.value)):[])})),F(C,(e=>{A.value&&(D.value=e?JSON.parse(JSON.stringify(_.value)):[])})),i({init:(e,a)=>{r.value=!0,f.value=e,_.value=a,V.value=1,U.value=1,y.value=[],D.value=[],k.value=!1,C.value=!1}}),(l,i)=>{const s=e("el-checkbox"),n=e("el-image"),w=e("el-scrollbar"),b=e("el-button"),M=e("el-dialog");return a(),t(M,{modelValue:r.value,"onUpdate:modelValue":i[3]||(i[3]=e=>r.value=e),width:"800",title:"更新样机图片","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:c((()=>[d("div",rs,[d("div",us,[d("div",cs,[hs,u(s,{modelValue:k.value,"onUpdate:modelValue":i[0]||(i[0]=e=>k.value=e),value:!0},{default:c((()=>[v("全选")])),_:1},8,["modelValue"])]),d("div",ms,[vs,u(s,{modelValue:C.value,"onUpdate:modelValue":i[1]||(i[1]=e=>C.value=e),value:!0},{default:c((()=>[v("全选")])),_:1},8,["modelValue"])])]),d("div",gs,[d("div",ps,[u(w,null,{default:c((()=>[(a(!0),o(h,null,m(f.value,((e,t)=>{return a(),o("div",{class:I(["selected-item",{selected:(l=e,-1!==y.value.findIndex((e=>e===l)))}]),onClick:a=>(e=>{const a=y.value.findIndex((a=>a===e));a>=0?(1!==y.value.length&&(A.value=!1),k.value=!1,y.value.splice(a,1),j((()=>{A.value=!0}))):y.value.length+1===f.value.length?k.value=!0:y.value.push(e)})(e),key:t},[u(n,{style:{width:"50px",height:"50px","margin-right":"10px"},onClick:i[2]||(i[2]=x((()=>{}),["stop"])),previewSrcList:[`${Cs}/datasets/mockups/${e}`],src:`${Cs}/datasets/mockups/${e}`},null,8,["previewSrcList","src"]),d("div",ys,g(e),1)],10,fs);var l})),128))])),_:1})]),d("div",ws,[u(w,null,{default:c((()=>[(a(!0),o(h,null,m(_.value,((e,t)=>{return a(),o("div",{class:I(["selected-item",{selected:(l=e,-1!==D.value.findIndex((e=>e===l)))}]),onClick:a=>(e=>{const a=D.value.findIndex((a=>a===e));a>=0?(1!==D.value.length&&(A.value=!1),C.value=!1,D.value.splice(a,1),j((()=>{A.value=!0}))):D.value.length+1===_.value.length?C.value=!0:D.value.push(e)})(e),key:t},[d("div",ks,g(e),1)],10,bs);var l})),128))])),_:1})])])]),V.value!==U.value?(a(),o("div",xs,[d("div",_s,[d("div",{class:"progress-info",style:L({width:U.value/V.value*100+"%"})},null,4)])])):p("",!0),d("div",Ds,[S.value?p("",!0):(a(),t(b,{key:0,type:"primary",onClick:T},{default:c((()=>[v("关闭")])),_:1})),u(b,{type:"primary",disabled:S.value,onClick:E},{default:c((()=>[v("开始")])),_:1},8,["disabled"])])])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-6179594b"]]);const Ls={class:"main-body"},Is={class:"dataset"},Vs=(e=>(f("data-v-25eecc4c"),e=e(),y(),e))((()=>d("div",{class:"dataset-title"},"图像数据集",-1))),Us={class:"dataset-list"},Ss=["onClick"],Ms={class:"dataset-handle"},Ps={class:"add-dataset-btn"},Es={class:"handle-area"},Ts={class:"image-area"},Rs={class:"image-name"},Ys=["onClick"],Fs={key:3,class:"image-icon"},Xs=["onClick"],zs={class:"image-name"},Os="https://u248120-8cc7-40703421.westc.gpuhub.com:8443";var Ws=ne({__name:"index",setup(l){const i=s([]),f=s(0),y=s([]),_=s([]),D=s([]),A=s(null),L=s(null),I=s("addImagesetDom"),V=s("addMockupDom"),S=s("updateMockupImageDom"),M=()=>{y.value=[],w.get(`${Os}/datasets/datasets`).then((e=>{const{data:a}=e;i.value=a}))},P=()=>{f.value=0,y.value=[],A.value=null,L.value=null,w.get(`${Os}/datasets/mockups`).then((e=>{const{data:a}=e;_.value=a}))},E=e=>{const a=y.value.findIndex((e=>e===L.value));L.value=y.value[a+e],$(L.value)},T=e=>{e=e||A.value,f.value=1,L.value=null,y.value=[];const a=new FormData;a.append("dataset",e),A.value=e,w.post(`${Os}/datasets/get_imagesets`,a).then((e=>{const{data:a}=e;y.value=a}))},R=e=>{const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("dataset",A.value),t.append("imageset",e),w.post(`${Os}/datasets/delete_imageset`,t).then((()=>{a.close(),T(),b({type:"success",message:"删除成功"})}))},Y=e=>{const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("dataset",A.value),t.append("imageset",L.value),t.append("image_name",e),w.post(`${Os}/datasets/delete_image`,t).then((()=>{a.close(),$(),b({type:"success",message:"删除成功"})}))},F=()=>{const e=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),a=new FormData;a.append("dataset",A.value),a.append("imageset",L.value),w.post(`${Os}/datasets/delete_imageset`,a).then((()=>{e.close();const a=y.value.findIndex((e=>e===L.value));y.value.splice(a,1),y.value.length?a===y.value.length?(L.value=y.value[a-1],E(0)):(L.value=y.value[a],E(0)):X(),b({type:"success",message:"删除成功"})}))},X=()=>{L.value=null,D.value=[]},z=()=>{I.value.init(A.value)},O=()=>{I.value.init(A.value,L.value)},W=()=>{S.value.init(_.value,i.value)},$=e=>{e=e||L.value,L.value=e;const a=new FormData;a.append("dataset",A.value),a.append("imageset",e),w.post(`${Os}/datasets/get_images`,a).then((e=>{const{data:a}=e;D.value=a}))},j=()=>{V.value.init()},N=()=>{f.value=0,L.value=null,A.value=null,D.value=[],_.value=[],y.value=[],M(),P()};return n((()=>{N()})),(l,s)=>{const n=e("el-button"),B=e("el-scrollbar"),G=e("el-image"),Q=e("el-icon");return a(),o("div",Ls,[u(ga,null,{left:c((()=>[d("div",Is,[d("label",{class:"dataset-name",onClick:s[0]||(s[0]=e=>P())},"样机数据集")]),Vs,d("div",Us,[u(B,null,{default:c((()=>[(a(!0),o(h,null,m(i.value,((e,t)=>(a(),o("div",{class:"dataset",key:t},[d("label",{class:"dataset-name",onClick:a=>T(e)},g(e),9,Ss),d("label",Ms,[u(n,{type:"text",class:"text-btn",onClick:a=>{return t=e,void U.prompt("请输入数据集名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputValue:t}).then((({value:e})=>{if(i.value.find((a=>a===e)))return void b.error("数据集名称不可重复");const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),l=new FormData;l.append("dataset_name",t),l.append("new_name",e),w.post(`${Os}/datasets/rename_dataset`,l).then((()=>{a.close(),M(),b({type:"success",message:"修改成功"})}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var t}},{default:c((()=>[v("重命名")])),_:2},1032,["onClick"]),u(n,{type:"text",class:"text-btn danger",onClick:a=>{return t=e,void U.confirm("此操作不可逆是否继续?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),a=new FormData;a.append("dataset_name",t),w.post(`${Os}/datasets/delete_dataset`,a).then((()=>{e.close(),M(),b({type:"success",message:"删除成功"})}))})).catch((()=>{b({type:"info",message:"取消删除"})}));var t}},{default:c((()=>[v("删除")])),_:2},1032,["onClick"])])])))),128))])),_:1})]),d("div",Ps,[u(n,{style:{width:"100%"},type:"primary",onClick:s[1]||(s[1]=e=>{U.prompt("请输入数据集名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:e})=>{if(!e)return void b.error("请输入数据集名称");if(i.value.find((a=>a===e)))return void b.error("数据集名称不可重复");const a=new FormData;a.append("dataset_name",e);const t=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${Os}/datasets/add_dataset`,a).then((()=>{t.close(),M(),b({type:"success",message:"添加成功"})}))})).catch((()=>{b({type:"info",message:"取消操作"})}))})},{default:c((()=>[v(" 添加图像数据集 ")])),_:1})])])),right:c((()=>[d("div",Es,[d("div",null,[L.value?(a(),t(n,{key:0,type:"text",onClick:s[2]||(s[2]=e=>X())},{default:c((()=>[v("返回")])),_:1})):p("",!0)]),d("div",null,[L.value?(a(),t(n,{key:0,onClick:s[3]||(s[3]=e=>E(-1)),disabled:0===y.value.findIndex((e=>e===L.value))},{default:c((()=>[v("上一组")])),_:1},8,["disabled"])):p("",!0),L.value?(a(),t(n,{key:1,onClick:s[4]||(s[4]=e=>E(1)),disabled:y.value.findIndex((e=>e===L.value))===y.value.length-1},{default:c((()=>[v("下一组")])),_:1},8,["disabled"])):p("",!0),L.value?(a(),t(n,{key:2,type:"danger",onClick:F},{default:c((()=>[v("删除当前图片集")])),_:1})):p("",!0),0===f.value?(a(),t(n,{key:3,type:"primary",onClick:j},{default:c((()=>[v("新增样机数据")])),_:1})):p("",!0),u(n,{type:"primary",onClick:W},{default:c((()=>[v("更新样机图片")])),_:1}),1!==f.value||L.value?p("",!0):(a(),t(n,{key:4,onClick:z},{default:c((()=>[v("新增图片集")])),_:1})),1===f.value&&L.value?(a(),t(n,{key:5,onClick:O},{default:c((()=>[v("上传图片")])),_:1})):p("",!0)])]),d("div",Ts,[u(B,null,{default:c((()=>[0===f.value?(a(!0),o(h,{key:0},m(_.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[u(G,{style:{width:"100%",height:"190px"},previewSrcList:[`${Os}/datasets/mockups/${e}`],src:`${Os}/datasets/mockups/${e}`,fit:"cover",lazy:""},null,8,["previewSrcList","src"]),d("div",Rs,g(e),1)])))),128)):p("",!0),1===f.value?(a(!0),o(h,{key:1},m(L.value?D.value:y.value,((e,l)=>(a(),o("div",{class:"image-item",key:l},[L.value?(a(),t(G,{key:0,style:{width:"100%",height:"190px"},previewSrcList:[`${Os}/datasets/datasets/${A.value}/${L.value}/${e}`],src:`${Os}/datasets/datasets/${A.value}/${L.value}/${e}`,fit:"cover",lazy:""},null,8,["previewSrcList","src"])):(a(),t(G,{key:1,style:{width:"100%",height:"190px"},fit:"cover",onClick:a=>$(e),lazy:"",src:`${Os}/datasets/datasets/${A.value}/${e}/${e}`},null,8,["onClick","src"])),!L.value||L.value&&e!==L.value?(a(),o("div",{key:2,class:"image-icon del",onClick:x((a=>(e=>{U.confirm("此操作不可逆是否继续?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{L.value?Y(e):R(e)})).catch((()=>{b({type:"info",message:"取消操作"})}))})(e)),["stop"])},[u(Q,null,{default:c((()=>[u(r(C))])),_:1})],8,Ys)):p("",!0),L.value?p("",!0):(a(),o("div",Fs,[u(Q,null,{default:c((()=>[u(r(Z))])),_:1})])),L.value&&e!==L.value?(a(),o("div",{key:4,class:"image-icon",onClick:x((a=>(e=>{const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("dataset_name",A.value),t.append("imageset",L.value),t.append("image",e),w.post(`${Os}/datasets/set_main`,t).then((()=>{a.close(),$();const t=y.value.findIndex((e=>e===L.value));y.value.splice(t,1,e),L.value=e,$(),b({type:"success",message:"操作"})}))})(e)),["stop"])},[u(Q,null,{default:c((()=>[u(r(H))])),_:1})],8,Xs)):p("",!0),d("div",zs,g(e),1)])))),128)):p("",!0)])),_:1})])])),_:1}),u(is,{ref_key:"addImagesetDom",ref:I,onReviewImageset:T,onReviewImage:$},null,512),u(os,{ref_key:"addMockupDom",ref:V,onReview:P},null,512),u(As,{ref_key:"updateMockupImageDom",ref:S,onReview:N},null,512)])}}},[["__scopeId","data-v-25eecc4c"]]);function $s(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}const js={class:"table-handle-area"},Zs={class:"table-handle-info-area"},Hs={class:"table-area"},Ns={class:"table-area-info"},Bs={class:"table-area"},Gs={class:"pagination-body"};var Qs=ne({__name:"index",setup(l){const i=s(null),p=s(1),f=s(10),y=s(0),k=s($s(new Date(`${(new Date).getFullYear()}-${String((new Date).getMonth()+1).padStart(2,"0")}-01`))),x=s($s(new Date)),_=s(""),D=s(0),C=s(!1),A=s([]),L=s({watch:{name:"监听执行",type:"success"},schedule:{name:"计划执行",type:"primary"}}),I=s(null),V=s({init:{name:"初始化",type:"info"},running:{name:"进行中",type:"primary"},canceled:{name:"已取消",type:"warning"},done:{name:"已完成",type:"success"},fail:{name:"已失败",type:"danger"}}),U=s(null),S=s(""),M=()=>new Promise(((e,a)=>{w.post("http://www.weishih-ai.com:10010/sso/api/v1/session/login",{phone:"13693610685",passwd:"123456",register:1,smscode:""}).then((({data:a})=>{e(a)})).catch((e=>{a(e)}))})),P=()=>{C.value=!0,w({method:"get",url:"/xpic/api/v1/tasks",params:{starttime:Math.round(new Date(k.value+" 00:00:00").getTime()/1e3),page_no:p.value,page_size:f.value,picdir:_.value,status:U.value,task_type:I.value,tenant_name:S.value,endtime:Math.round(new Date(x.value+" 23:59:29").getTime()/1e3)},headers:{"X-Auth-Token":i.value}}).then((({data:e})=>{A.value=e.tasks,D.value=e.paginator.total_count,C.value=!1})).catch((e=>{String(e).includes("Request failed with status code 404")&&b.error("请求地址不存在"),C.value=!1}))},E=()=>{p.value=1,P()},R=e=>{p.value=1,f.value=e,P()},Y=e=>{p.value=e,P()};return n((()=>{y.value=document.body.clientHeight,p.value=1,f.value=10,k.value=$s(new Date(`${(new Date).getFullYear()}-${String((new Date).getMonth()+1).padStart(2,"0")}-01 00:00:00`)),x.value=$s(new Date),_.value="",M().then((({token:e})=>{i.value=e.token,P()}))})),(l,i)=>{const s=e("el-input"),n=e("el-form-item"),f=e("el-option"),y=e("el-select"),w=e("el-date-picker"),b=e("el-button"),M=e("el-form"),P=e("el-table-column"),F=e("el-tag"),X=e("el-table"),z=e("el-pagination"),W=O("loading");return T((a(),o("div",{class:"main-body","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[d("div",js,[d("div",Zs,[u(M,{inline:"",size:"small"},{default:c((()=>[u(n,{label:"图库目录"},{default:c((()=>[u(s,{placeholder:"目录",modelValue:_.value,"onUpdate:modelValue":i[0]||(i[0]=e=>_.value=e),clearable:"",style:{width:"150px"}},null,8,["modelValue"])])),_:1}),u(n,{label:"租户名称"},{default:c((()=>[u(s,{placeholder:"租户id",modelValue:S.value,"onUpdate:modelValue":i[1]||(i[1]=e=>S.value=e),clearable:"",style:{width:"150px"}},null,8,["modelValue"])])),_:1}),u(n,{label:"任务类型"},{default:c((()=>[u(y,{modelValue:I.value,"onUpdate:modelValue":i[2]||(i[2]=e=>I.value=e),clearable:"",style:{width:"100px"}},{default:c((()=>[(a(!0),o(h,null,m(Object.keys(L.value),(e=>(a(),t(f,{key:e,label:L.value[e].name,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(n,{label:"任务状态"},{default:c((()=>[u(y,{modelValue:U.value,"onUpdate:modelValue":i[3]||(i[3]=e=>U.value=e),clearable:"",style:{width:"100px"}},{default:c((()=>[(a(!0),o(h,null,m(Object.keys(V.value),(e=>(a(),t(f,{key:e,label:V.value[e].name,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(n,{label:"开始时间"},{default:c((()=>[u(w,{modelValue:k.value,"onUpdate:modelValue":i[4]||(i[4]=e=>k.value=e),style:{width:"150px"}},null,8,["modelValue"])])),_:1}),u(n,{label:"结束时间"},{default:c((()=>[u(w,{modelValue:x.value,"onUpdate:modelValue":i[5]||(i[5]=e=>x.value=e),style:{width:"150px"}},null,8,["modelValue"])])),_:1}),u(n,{label:"","label-width":"0"},{default:c((()=>[u(b,{type:"primary",onClick:E},{default:c((()=>[v("搜索")])),_:1})])),_:1})])),_:1})])]),d("div",Hs,[d("div",Ns,[d("div",Bs,[u(X,{data:A.value,border:"",height:"100%"},{default:c((()=>[u(P,{label:"任务ID",prop:"id",align:"center"}),u(P,{label:"用户ID",prop:"tenant_id",align:"center"}),u(P,{label:"所属用户",prop:"tenant_name",align:"center"}),u(P,{label:"任务类型",prop:"type",align:"center"},{default:c((({row:e})=>[u(F,{type:L.value[e.type].type},{default:c((()=>[v(g(L.value[e.type].name),1)])),_:2},1032,["type"])])),_:1}),u(P,{label:"图库目录",prop:"picdir",align:"center"}),u(P,{label:"总数",prop:"total",align:"center"}),u(P,{label:"成功数量",prop:"success",align:"center"}),u(P,{label:"失败数量",prop:"fail",align:"center"}),u(P,{label:"任务状态",prop:"status",align:"center"},{default:c((({row:e})=>[u(F,{type:V.value[e.status].type},{default:c((()=>[v(g(V.value[e.status].name),1)])),_:2},1032,["type"])])),_:1}),u(P,{label:"任务开始时间",prop:"started_at",align:"center"},{default:c((({row:e})=>[v(g(r($s)(new Date(1e3*e.started_at))),1)])),_:1}),u(P,{label:"任务结束时间",prop:"ended_at",align:"center"},{default:c((({row:e})=>[v(g(r($s)(new Date(1e3*e.ended_at))),1)])),_:1})])),_:1},8,["data"]),d("div",Gs,[u(z,{small:"",modelValue:p.value,"onUpdate:modelValue":i[6]||(i[6]=e=>p.value=e),onSizeChange:R,onCurrentChange:Y,background:"",layout:"total, sizes, prev, pager, next, jumper",total:D.value},null,8,["modelValue","total"])])])])])])),[[W,C.value]])}}},[["__scopeId","data-v-465da10f"]]);class qs{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.handleData={typeUUid:null,color:"#000000"},this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.finishImage=null,this.listeners={}}setHandleData(e){this.handleData=e,this.handleList.forEach((a=>{a.typeUUid===e.typeUUid&&(a.color=e.color)})),this.reDraw()}setModel(e){this.handleList=e,this.reDraw()}resetSize({width:e,height:a}){this.canvasDom.width===e&&this.canvasDom.height===a||(this.canvasDom.width=e,this.canvasDom.height=a,b.success("画布尺寸重置，重置所有元素"),this.clearSelectionArea())}handleChange(e,a){const{canvasDom:t}=this;switch(this.clearHandle(),e){case"selectionArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(t,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"selectionArcArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionArcAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionArcAreaFinish(e)})),this.addListener(t,"mousemove",(e=>{this.selectionArcAreaMoving(e)}));break;case"clearArea":t.style.cursor="none",this.addListener(t,"mousedown",(e=>{this.clearAreaStart(e,a)})),this.addListener(t,"mouseup",(e=>{this.clearAreaFinish(e,a)})),this.addListener(t,"mousemove",(e=>{this.clearAreaMoving(e,a)}));break;default:this.clearHandle()}}selectionArcAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArcArea",color:this.handleData.color,typeUUid:this.handleData.typeUUid,isShow:!0,status:0,imageData:null})}selectionArcAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionArcAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.handleList[this.handleList.length-1].uuid=N(),this.reDraw(),this.setUUid(this.handleList[this.handleList.length-1].typeUUid,{handleUUid:this.handleList[this.handleList.length-1].uuid,handleType:this.handleType,handleData:this.handleList[this.handleList.length-1]})}clearAreaStart(e,a){const{offsetX:t,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.push({dataList:[],radius:s,handleX:t,handleY:l,type:"clearArea",color:this.handleData.color,typeUUid:this.handleData.typeUUid,clearType:a,isShow:!0,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:a,offsetY:t}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.save(),l.strokeStyle="#000000",l.arc(a,t,s,0,2*Math.PI),l.stroke(),l.restore(),l.closePath()}clearAreaMoving(e){const{offsetX:a,offsetY:t}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type&&!e.status))&&this.handleList.find((e=>"clearArea"===e.type&&!e.status)).dataList.push({offsetX:a,offsetY:t,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type&&!e.status))&&(this.handleList.find((e=>"clearArea"===e.type&&!e.status)).uuid=N(),this.handleList.find((e=>"clearArea"===e.type&&!e.status)).status=1,this.reDraw(),this.setUUid(this.handleList[this.handleList.length-1].typeUUid,{handleUUid:this.handleList[this.handleList.length-1].uuid,handleType:this.handleType,handleData:this.handleList[this.handleList.length-1]}))}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArea",color:this.handleData.color,typeUUid:this.handleData.typeUUid,isShow:!0,status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.handleList[this.handleList.length-1].uuid=N(),this.reDraw(),this.setUUid(this.handleList[this.handleList.length-1].typeUUid,{handleUUid:this.handleList[this.handleList.length-1].uuid,handleType:this.handleType,handleData:this.handleList[this.handleList.length-1]})}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a,imageData:t}=this,{width:l,height:i}=a;e.beginPath(),e.clearRect(0,0,l,i),e.closePath(),this.handleList.forEach((a=>{a.imageData=null;let{type:t,isShow:l,status:i}=a;if(l){if("selectionArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n,color:o}=a;e.beginPath(),e.save(),e.strokeStyle="rgba(255, 255, 255, 1)",e.fillStyle=o,e.lineWidth=2;const d=t>i?i:t,r=l>s?s:l,u=t>i?t-i:i-t,c=l>s?l-s:s-l;if((!u||!c)&&n)return;if(e.rect(d,r,u,c),e.fill(),e.closePath(),e.restore(),!n)return;const h=document.createElement("canvas");h.width=this.canvasDom.width,h.height=this.canvasDom.height;const m=h.getContext("2d");if(m.beginPath(),m.save(),m.strokeStyle="rgba(255, 255, 255, 1)",m.fillStyle=o,m.lineWidth=2,(!u||!c)&&n)return;m.rect(d,r,u,c),m.fill(),m.closePath(),m.restore(),a.imageData=h.toDataURL("image/png")}if("selectionArcArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n,color:o}=a;e.beginPath(),e.strokeStyle="rgba(255, 255, 255, 1)",e.fillStyle=o,e.lineWidth=2;const d=t>i?i:t,r=l>s?s:l,u=t>i?t-i:i-t,c=l>s?l-s:s-l,h=Math.sqrt(u*u+c*c)/2;if((!u||!c)&&n)return;if(e.moveTo(d+u/2-h,r+c/2-h),e.arc(d+u/2,r+c/2,h,0,2*Math.PI),e.fill(),e.closePath(),!n)return;const m=document.createElement("canvas");m.width=this.canvasDom.width,m.height=this.canvasDom.height;const v=m.getContext("2d");if(v.beginPath(),v.strokeStyle="rgba(255, 255, 255, 1)",v.fillStyle=o,v.lineWidth=2,(!u||!c)&&n)return;v.moveTo(d+u/2-h,r+c/2-h),v.arc(d+u/2,r+c/2,h,0,2*Math.PI),v.fill(),v.closePath(),a.imageData=m.toDataURL("image/png")}if("clearArea"===t){let{clearType:t,dataList:l,offsetX:s,offsetY:n,radius:o,color:d}=a;if(e.beginPath(),e.save(),e.fillStyle=d,e.moveTo(s+o,n+o),e.arc(s,n,o,0,2*Math.PI),l.forEach((a=>{e.moveTo(a.offsetX+a.radius,a.offsetY+a.radius),e.arc(a.offsetX,a.offsetY,a.radius,0,2*Math.PI)})),e.fill(),e.restore(),e.closePath(),!i)return;const r=document.createElement("canvas");r.width=this.canvasDom.width,r.height=this.canvasDom.height;const u=r.getContext("2d");u.beginPath(),u.save(),u.fillStyle=d,u.moveTo(s+o,n+o),u.arc(s,n,o,0,2*Math.PI),l.forEach((e=>{u.moveTo(e.offsetX+e.radius,e.offsetY+e.radius),u.arc(e.offsetX,e.offsetY,e.radius,0,2*Math.PI)})),u.fill(),u.restore(),u.closePath(),a.imageData=r.toDataURL("image/png")}}}))}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.finishImage=null,this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}getFinishImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t,s={};return Object.keys(e).forEach((e=>{s[e]={imageUrl:null,imageFile:null};const a=document.createElement("canvas");let t=!1;a.width=l,a.height=i;const n=a.getContext("2d");this.handleList.forEach((a=>{let{type:l}=a;if(e===a.typeUUid){if(t=!0,"selectionArea"===l){let{handleX:e,handleY:t,offsetX:l,offsetY:i,status:s,color:o}=a;n.beginPath(),n.save(),n.strokeStyle="rgba(255, 255, 255, 1)",n.fillStyle=o,n.lineWidth=2;const d=e>l?l:e,r=t>i?i:t,u=e>l?e-l:l-e,c=t>i?t-i:i-t;if((!u||!c)&&s)return;n.rect(d,r,u,c),n.fill(),n.closePath(),n.restore()}if("selectionArcArea"===l){let{handleX:e,handleY:t,offsetX:l,offsetY:i,status:s,color:o}=a;n.beginPath(),n.strokeStyle="rgba(255, 255, 255, 1)",n.fillStyle=o,n.lineWidth=2;const d=e>l?l:e,r=t>i?i:t,u=e>l?e-l:l-e,c=t>i?t-i:i-t,h=Math.sqrt(u*u+c*c)/2;if((!u||!c)&&s)return;n.moveTo(d+u/2-h,r+c/2-h),n.arc(d+u/2,r+c/2,h,0,2*Math.PI),n.fill(),n.closePath()}if("clearArea"===l){let{clearType:e,dataList:t,offsetX:l,offsetY:i,radius:s,color:o}=a;n.beginPath(),n.save(),n.fillStyle=o,n.moveTo(l+s,i+s),n.arc(l,i,s,0,2*Math.PI),t.forEach((e=>{n.moveTo(e.offsetX+e.radius,e.offsetY+e.radius),n.arc(e.offsetX,e.offsetY,e.radius,0,2*Math.PI)})),n.fill(),n.restore(),n.closePath()}}else if(t){if("selectionArea"===l){let{handleX:e,handleY:t,offsetX:l,offsetY:i,status:s,color:o}=a;n.beginPath(),n.save(),n.globalCompositeOperation="destination-out",n.strokeStyle="rgba(255, 255, 255, 1)",n.fillStyle=o,n.lineWidth=2;const d=e>l?l:e,r=t>i?i:t,u=e>l?e-l:l-e,c=t>i?t-i:i-t;if((!u||!c)&&s)return;n.rect(d,r,u,c),n.fill(),n.closePath(),n.restore()}if("selectionArcArea"===l){let{handleX:e,handleY:t,offsetX:l,offsetY:i,status:s,color:o}=a;n.beginPath(),n.save(),n.globalCompositeOperation="destination-out",n.strokeStyle="rgba(255, 255, 255, 1)",n.fillStyle=o,n.lineWidth=2;const d=e>l?l:e,r=t>i?i:t,u=e>l?e-l:l-e,c=t>i?t-i:i-t,h=Math.sqrt(u*u+c*c)/2;if((!u||!c)&&s)return;n.moveTo(d+u/2-h,r+c/2-h),n.arc(d+u/2,r+c/2,h,0,2*Math.PI),n.fill(),n.restore(),n.closePath()}if("clearArea"===l){let{clearType:e,dataList:t,offsetX:l,offsetY:i,radius:s,color:o}=a;n.beginPath(),n.save(),n.globalCompositeOperation="destination-out",n.fillStyle=o,n.moveTo(l+s,i+s),n.arc(l,i,s,0,2*Math.PI),t.forEach((e=>{n.moveTo(e.offsetX+e.radius,e.offsetY+e.radius),n.arc(e.offsetX,e.offsetY,e.radius,0,2*Math.PI)})),n.fill(),n.restore(),n.closePath()}}})),s[e].imageUrl=a.toDataURL("image/png");const o=function(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}(s[e].imageUrl);s[e].imageFile=new File([o],`${e}.png`,{type:"image/png"})})),s}}class Js{constructor(){this.types={}}beforeAdd(){const e=N();return this.types[e]={name:"",color:"rgba(0,0,0,1)",prompt:"",imageFile:null,imageUrl:null,promptWeight:100,imageWeight:100},{uuid:e,typeEntity:{name:"",color:"rgba(0,0,0,1)",prompt:"",imageFile:null,imageUrl:null,promptWeight:100,imageWeight:100}}}setModel(e){this.types=e}add(e,a){this.types[e]=a}remove(e){delete this.types[e]}get(e){return{uuid:e,typeEntity:this.types[e]}}getList(){return Object.keys(this.types).map((e=>({name:this.types[e].name,uuid:e,imageUrl:this.types[e].imageUrl})))}}class Ks{constructor(){this.layers={}}add(e,a){const t=N(),{handleUUid:l,type:i}=a;this.layers[t]={typeUUid:e,handleUUid:l,handleData:a.handleData,handleType:i,name:"未命名",isShow:!0},this.setList(this.getList())}setModel(e){this.layers=e,this.setList(this.getList())}get(e){const{typeUUid:a,handleUUid:t,handleType:l,name:i,isShow:s,handleData:n}=this.layers[e],{imageData:o}=n;return{uuid:e,typeUUid:a,handleUUid:t,handleType:l,name:i,isShow:s,imageData:o}}getList(){let e=[...new Set(Object.keys(this.layers).map((e=>this.get(e).typeUUid)))];const a=Object.keys(this.layers).map((e=>this.get(e)));let t=[];return e.forEach((e=>{t.push({uuid:e,layers:a.filter((a=>a.typeUUid===e))})})),t}clear(){this.layers={},this.setList(this.getList())}remove(e){const a=this.layers[e];return delete this.layers[e],this.setList(this.getList()),a}change(e,a){this.layers[e]=Object.assign(this.layers[e],a),this.setList(this.getList())}}const en={class:"upload-image-area"},an=["src"],tn={key:1,class:"upload-text-tips"},ln=(e=>(f("data-v-19297a3b"),e=e(),y(),e))((()=>d("div",{class:"upload-text"},"点击上传",-1)));var sn=ne({__name:"addLayerType",emits:["setLayerType"],setup(t,{expose:l,emit:i}){const n=s(!1),h=s(0),m=s({}),g=s(null),p=i,f=e=>{const a=new FileReader;return a.onload=({target:a})=>{m.value.imageFile=e,m.value.imageUrl=a.result},a.readAsDataURL(e),!1},y=(e=0)=>m.value.prompt||1!==h.value?m.value.imageUrl||1!==h.value?(0===e&&1===h.value||p("setLayerType",g.value,m.value,e),void(n.value=!1)):(b.error("请上传风格参考"),!1):(b.error("请输入prompt"),!1),w=()=>{m.value.imageFile=null,m.value.imageUrl=null};return l({init:(e,a,t=0)=>{n.value=!0,h.value=t,m.value=a,g.value=e}}),(t,l)=>{const i=e("el-input"),s=e("el-form-item"),g=e("el-color-picker"),p=e("el-slider"),b=e("el-icon"),k=e("el-upload"),D=e("el-form"),A=e("el-button"),L=e("el-dialog");return a(),o("div",null,[u(L,{title:(h.value?"编辑":"新建")+"类型",width:"500",modelValue:n.value,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value=e),"close-on-click-modal":!1,"before-close":()=>{y()}},{footer:c((()=>[u(A,{onClick:l[7]||(l[7]=e=>y())},{default:c((()=>[v("取消")])),_:1}),u(A,{onClick:l[8]||(l[8]=e=>y(1)),type:"primary"},{default:c((()=>[v("保存")])),_:1})])),default:c((()=>[u(D,{"label-width":"120px"},{default:c((()=>[u(s,{label:"类型名称",required:""},{default:c((()=>[u(i,{modelValue:m.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value.name=e),clearable:""},null,8,["modelValue"])])),_:1}),u(s,{label:"展示颜色选择"},{default:c((()=>[u(g,{modelValue:m.value.color,"onUpdate:modelValue":l[1]||(l[1]=e=>m.value.color=e)},null,8,["modelValue"])])),_:1}),u(s,{label:"Prompt",required:""},{default:c((()=>[u(i,{type:"textarea",resize:!1,modelValue:m.value.prompt,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value.prompt=e)},null,8,["modelValue"])])),_:1}),u(s,{label:"Prompt权重"},{default:c((()=>[u(p,{min:0,step:1,max:100,modelValue:m.value.promptWeight,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value.promptWeight=e),"show-input":"","show-input-controls":!1},null,8,["modelValue"])])),_:1}),u(s,{label:"风格参考",required:""},{default:c((()=>[d("div",en,[u(k,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":f},{default:c((()=>[m.value.imageUrl?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:l[5]||(l[5]=x((()=>{}),["stop"]))},[d("img",{src:m.value.imageUrl,class:"avatar"},null,8,an),d("div",{class:"upload-image-del-btn-area",onClick:l[4]||(l[4]=x((()=>{}),["stop"]))},[d("div",{class:"upload-image-del-btn",onClick:x(w,["stop"])},[u(b,null,{default:c((()=>[u(r(C))])),_:1})])])])):(a(),o("div",tn,[u(b,{class:"avatar-uploader-icon"},{default:c((()=>[u(r(_))])),_:1}),ln]))])),_:1})])])),_:1}),u(s,{label:"风格参考权重"},{default:c((()=>[u(p,{min:0,step:1,max:100,modelValue:m.value.imageWeight,"onUpdate:modelValue":l[6]||(l[6]=e=>m.value.imageWeight=e),"show-input":"","show-input-controls":!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["title","modelValue","before-close"])])}}},[["__scopeId","data-v-19297a3b"]]);const nn={__name:"genrationImage",emits:["setResultImage","setPrompt"],setup(l,{expose:i,emit:n}){const o=s(!1),d=s(!1),r=s(""),h=s({}),m=n,g=()=>{if(!r.value)return void b.error("请输入prompt");const e=(()=>{const e=new FormData,{layerTypes:a,imageAll:t,canvasSetting:l}=h.value,{width:i,height:s}=l;return e.append("prompt",r.value),e.append("width",i),e.append("height",s),Object.keys(a).forEach((l=>{if(t[l]){const{imageFile:i}=t[l],{prompt:s,promptWeight:n,imageWeight:o}=a[l];e.append("mask_images",i),e.append("ref_images",a[l].imageFile),e.append("objects",JSON.stringify({prompt:s,prompt_weight:n/100,ref_weight:o/100}))}})),e})();d.value=!0,w.post("https://u248120-b02b-2e642071.westb.seetacloud.com:8443/designer/generate",e).then((e=>{d.value=!1,o.value=!1,m("setResultImage",`https://u248120-b02b-2e642071.westb.seetacloud.com:8443/designer/${e.data}`)})).catch((()=>{d.value=!1}))};return i({init:(e,a,t,l)=>{o.value=!0,h.value={layerTypes:e,imageAll:a,canvasSetting:t},r.value=l}}),(l,i)=>{const s=e("el-form-item"),n=e("el-input"),h=e("el-form"),p=e("el-button"),f=e("el-dialog");return a(),t(f,{title:"生成图片",width:"500",modelValue:o.value,"onUpdate:modelValue":i[3]||(i[3]=e=>o.value=e),"close-on-click-modal":!1},{footer:c((()=>[u(p,{onClick:i[2]||(i[2]=e=>o.value=!1)},{default:c((()=>[v("取消")])),_:1}),u(p,{type:"primary",loading:d.value,onClick:g},{default:c((()=>[v(" 生成 ")])),_:1},8,["loading"])])),default:c((()=>[u(h,{"label-width":"100px"},{default:c((()=>[u(s,{label:"底模选择"},{default:c((()=>[v(" 默认底模 ")])),_:1}),u(s,{label:"Prompt"},{default:c((()=>[u(n,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=e=>r.value=e),type:"textarea",onChange:i[1]||(i[1]=e=>{m("setPrompt",r.value)})},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}}};const on=e=>(f("data-v-f69ae900"),e=e(),y(),e),dn={class:"image-search-title"},rn={key:7,class:"image-handle-setting"},un=on((()=>d("label",null," 笔刷半径 ",-1))),cn={class:"content"},hn={class:"search-btn-area"},mn=on((()=>d("div",{class:"image-search-title",style:{height:"30px"}},[d("div",null,"提示词")],-1))),vn={class:"prompt-area"},gn={class:"prompt-item"},pn=on((()=>d("div",{class:"prompt-item-label"},"正向提示词",-1))),fn={class:"prompt-item-input"},yn={class:"prompt-btn"},wn=on((()=>d("div",{class:"image-search-title",style:{height:"30px"}},[d("div",null,"生成图片")],-1))),bn={class:"content",style:{height:"calc(100% - 40px)"}},kn="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var xn=ne({__name:"reviewResultImage",emits:["reviewResultImage"],setup(l,{expose:i,emit:n}){const h=n,m=s(null),g=s(!1),f=s(null),y=s(document.body.clientHeight),x=s(null),_=s(0);s(0);const C=s(10),A=s(""),I=s(""),V=s(""),U=s(""),E=e=>{f.value?(A.value=e,x.value.handleChange(e)):b.error("请在上传图片后操作")},T=()=>{x.value.setClearAreaRadius(C.value)};const R=()=>{if(!m.value)return b.error("请上传图片后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",V.value),e.append("negative_prompt",U.value),e.append("image",m.value),x.value.finishImage?(e.append("image_with_mask",x.value.finishImage),e):(e.append("image_with_mask",m.value),e)})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});w.post(`${kn}/img2img/inpaint`,e).then((e=>{a.close(),I.value=`${kn}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))},Y=()=>{h("reviewResultImage",I.value),x.value.initImage(I.value),I.value=null};return i({init:e=>{f.value=e,g.value=!0,w({method:"get",url:e,responseType:"blob"}).then((e=>{m.value=new File([e.data],`${(new Date).getTime()}.png`,{type:"image/png"})})),j((()=>{x.value=new It(_.value),x.value.initImage(e)}))}}),(l,i)=>{const s=e("el-icon"),n=e("el-button"),h=e("el-slider"),m=e("el-input"),w=e("el-image"),b=e("el-dialog");return a(),t(b,{width:"1200",title:"图片展示",modelValue:g.value,"onUpdate:modelValue":i[9]||(i[9]=e=>g.value=e),fullscreen:""},{default:c((()=>[d("div",{class:"super-image-search-body",style:L({height:y.value-75+"px"})},[u(ga,{leftStyle:{width:"calc(50%)"}},{left:c((()=>[d("div",dn,[d("div",null,["selectionArea"!==A.value&&f.value?(a(),t(n,{key:0,type:"primary",class:"title-handle-btn",onClick:i[0]||(i[0]=e=>E("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 矩形 ")])),_:1})):p("",!0),"selectionArea"===A.value&&f.value?(a(),t(n,{key:1,class:"title-handle-btn",type:"warning",onClick:i[1]||(i[1]=e=>E("")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 矩形 ")])),_:1})):p("",!0),"selectionArcArea"!==A.value&&f.value?(a(),t(n,{key:2,type:"primary",class:"title-handle-btn",onClick:i[2]||(i[2]=e=>E("selectionArcArea")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(M))])),_:1}),v(" 圆形 ")])),_:1})):p("",!0),"selectionArcArea"===A.value&&f.value?(a(),t(n,{key:3,class:"title-handle-btn",type:"warning",onClick:i[3]||(i[3]=e=>E("")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(M))])),_:1}),v(" 圆形 ")])),_:1})):p("",!0),"clearArea"!==A.value&&f.value?(a(),t(n,{key:4,type:"primary",class:"title-handle-btn",onClick:i[4]||(i[4]=e=>E("clearArea")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(P))])),_:1}),v(" 笔刷 ")])),_:1})):p("",!0),"clearArea"===A.value&&f.value?(a(),t(n,{key:5,class:"title-handle-btn",type:"warning",onClick:i[5]||(i[5]=e=>E("")),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(P))])),_:1}),v(" 笔刷 ")])),_:1})):p("",!0),f.value?(a(),t(n,{key:6,class:"title-handle-btn",type:"primary",onClick:i[6]||(i[6]=e=>{x.value.initImage(f.value)}),style:{"font-size":"12px"}},{default:c((()=>[u(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(D))])),_:1}),v(" 重置 ")])),_:1})):p("",!0),f.value?(a(),o("div",rn,[un,u(h,{style:{width:"100px","margin-left":"20px",display:"inline-block","padding-top":"9px"},modelValue:C.value,"onUpdate:modelValue":i[7]||(i[7]=e=>C.value=e),onChange:T,min:1,max:100},null,8,["modelValue"])])):p("",!0)])]),d("div",cn,[d("canvas",{ref_key:"canvasDom",ref:_},null,512)])])),center:c((()=>[d("div",hn,[mn,d("div",vn,[d("div",gn,[pn,d("div",fn,[u(m,{type:"textarea",modelValue:V.value,"onUpdate:modelValue":i[8]||(i[8]=e=>V.value=e)},null,8,["modelValue"])])]),d("div",yn,[u(n,{type:"primary",style:{width:"100%",display:"block","margin-bottom":"15px"},onClick:R},{default:c((()=>[v(" 生成 ")])),_:1}),I.value?(a(),t(n,{key:0,type:"primary",style:{width:"100%","margin-left":"0px"},onClick:Y},{default:c((()=>[v(" 替换结果图 ")])),_:1})):p("",!0)])])])])),right:c((()=>[wn,d("div",bn,[u(w,{src:I.value,fit:"scale-down","preview-src-list":[I.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])])])),_:1},8,["leftStyle"])],4)])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-f69ae900"]]);const _n=e=>(f("data-v-05f5da2c"),e=e(),y(),e),Dn={class:"main-body"},Cn={class:"left-area"},An={class:"canvas-handle-area"},Ln={class:"image-handle-setting"},In=_n((()=>d("label",null," 画板宽度 ",-1))),Vn={class:"image-handle-setting"},Un=_n((()=>d("label",null," 画板高度 ",-1))),Sn={class:"image-handle-setting"},Mn=_n((()=>d("label",null," 笔刷半径 ",-1))),Pn={class:"canvas-area"},En={class:"canvas-info"},Tn={class:"right-area"},Rn={class:"now-type"},Yn={class:"title"},Fn={class:"type-info"},Xn={style:{padding:"14px"}},zn={style:{display:"flex","align-items":"center","justify-items":"space-between"}},On=_n((()=>d("div",{class:"title"},"图层信息",-1))),Wn={class:"layer-list"},$n={class:"layer-group"},jn={class:"layer-name"},Zn=_n((()=>d("div",{class:"layer-handle"},null,-1))),Hn={class:"layer-item-info-min"},Nn={class:"layer-item-info-min"},Bn={class:"layer-item-info-min"};var Gn=ne({__name:"index",setup(l){const i=s("canvasDom"),f=s(null),y=s(null),w=s(null),k=s("addLayerTypeDom"),_=s("genrationImageDom"),A=s("reviewResultImageDom"),I=s([]),V=s(null),E=s({name:"",color:"rgba(0,0,0,1)",prompt:"",imageFile:null,imageUrl:null,promptWeight:100,imageWeight:100}),T=s(""),R=s([]),Y=s(10),F=s(1024),X=s(1024),z=s(""),O=s(null),W=()=>{const{uuid:e,typeEntity:a}=w.value.beforeAdd();k.value.init(e,a)},$=()=>{const{uuid:e,typeEntity:a}=w.value.get(V.value);k.value.init(e,a,1)},j=(e,a,t=0)=>{if(0===t)w.value.remove(e),I.value=w.value.getList(),V.value=V.value===e?null:V.value;else{w.value.add(e,a),f.value.setHandleData({color:a.color,typeUUid:e});const t=y.value.getList().find((a=>a.uuid===e));t&&t.layers.forEach((e=>{const{handleUUid:a}=e,t=f.value.handleList.find((e=>e.uuid===a));y.value.change(e.uuid,{handleData:t})})),I.value=w.value.getList(),V.value=e,E.value=a}},Z=()=>{let e=null;e=V.value?w.value.get(V.value).typeEntity:{name:"",color:"rgba(0,0,0,1)",prompt:"",imageFile:null,imageUrl:null,promptWeight:100,imageWeight:100},f.value.setHandleData({color:e.color,typeUUid:V.value||null}),E.value=e},H=e=>{T.value=e,f.value.handleChange(e)},N=e=>{R.value=e},J=e=>{const{uuid:a,handleUUid:t,isShow:l,typeUUid:i}=e,s=f.value.handleList.find((e=>e.uuid===t));s.isShow=l,s.typeUUid=i;const n=w.value.get(i).typeEntity;f.value.setHandleData({color:n?n.color:"#000000",typeUUid:i}),f.value.reDraw(),y.value.change(a,e)};function K(){f.value.clearSelectionArea(),y.value.clear()}const ee=({uuid:e,handleUUid:a})=>{y.value.remove(e);const t=f.value.handleList.findIndex((e=>e.uuid===a));f.value.handleList.splice(t,1),f.value.reDraw()},ae=()=>{f.value.setClearAreaRadius(Y.value)},te=()=>{const e=f.value.getFinishImage(w.value.types),a=w.value.types,t=f.value.canvasDom;_.value.init(a,e,t,z.value)},le=e=>{z.value=e},ie=e=>{O.value=e,ne(e)},se=e=>{O.value=e},ne=e=>{A.value.init(e)},oe=()=>{f.value.resetSize({width:F.value,height:X.value}),y.value.clear()};const de=()=>{U.prompt("请输入导出文件名称","导出",{confirmButtonText:"导出",cancelButtonText:"取消",inputValue:"模板",inputPattern:/\S+?/,inputErrorMessage:"请输入文件名称"}).then((({value:e})=>{const a=y.value.layers,t=w.value.types,l=f.value.handleList,i={layers:a,types:t,prompt:z.value,handleList:l,width:F.value,height:X.value};!function(e,a){const t=new Blob([a],{type:"text/plain;charset=utf-8"}),l=URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=e,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}(`${e}.txt`,JSON.stringify(i)),b({type:"success",message:"导出成功"})})).catch((()=>{b({type:"info",message:"取消导出"})}))};const re=e=>{K();var a=new FileReader;return a.onload=function(e){const a=e.target.result,t=JSON.parse(a),{layers:l,types:i,handleList:s,width:n,height:o}=t;z.value=t.prompt,Object.keys(i).forEach((e=>{const a=i[e].imageUrl,t=a.split(";")[0].split(":")[1],l=function(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}(a);i[e].imageFile=new File([l],`${e}_ref.png`,{type:t})})),X.value=o,F.value=n,oe(),w.value.setModel(i),I.value=w.value.getList(),f.value.setModel(s),y.value.setModel(l)},a.readAsText(e),!1},ue=()=>{w.value.remove(V.value);const e=R.value.find((e=>e.uuid===V.value));if(e){const{layers:a}=e;a.forEach((e=>{ee(e)}))}I.value=w.value.getList(),V.value=null};return n((()=>{y.value=new Ks,y.value.setList=N,f.value=new qs(i.value),f.value.setUUid=(e,a)=>{y.value.add(e,a)},w.value=new Js})),(l,s)=>{const n=e("el-input-number"),f=e("el-slider"),y=e("el-icon"),w=e("el-button"),b=e("el-popover"),U=e("el-upload"),z=e("el-scrollbar"),N=e("el-option"),ce=e("el-select"),he=e("el-skeleton-item"),me=e("el-skeleton"),ve=e("el-image"),ge=e("el-input"),pe=e("el-collapse-item"),fe=e("el-collapse");return a(),o("div",Dn,[d("div",Cn,[d("div",An,[d("div",null,[u(b,{placement:"top-start",title:"设置",width:300,trigger:"click",content:""},{reference:c((()=>[u(w,null,{default:c((()=>[u(y,null,{default:c((()=>[u(r(B))])),_:1})])),_:1})])),default:c((()=>[d("div",Ln,[In,u(n,{onChange:oe,style:{width:"100px","margin-left":"20px",display:"inline-block","margin-top":"-5px","vertical-align":"top"},controls:!1,modelValue:F.value,"onUpdate:modelValue":s[0]||(s[0]=e=>F.value=e),min:1},null,8,["modelValue"])]),d("div",Vn,[Un,u(n,{onChange:oe,style:{width:"100px","margin-left":"20px",display:"inline-block","margin-top":"-5px","vertical-align":"top"},controls:!1,modelValue:X.value,"onUpdate:modelValue":s[1]||(s[1]=e=>X.value=e),min:1},null,8,["modelValue"])]),d("div",Sn,[Mn,u(f,{style:{width:"100px","margin-left":"20px",display:"inline-block","padding-top":"9px"},modelValue:Y.value,"onUpdate:modelValue":s[2]||(s[2]=e=>Y.value=e),onChange:ae,min:1,max:100},null,8,["modelValue"])])])),_:1}),"selectionArea"!==T.value?(a(),t(w,{key:0,type:"primary",class:"title-handle-btn",onClick:s[3]||(s[3]=e=>H("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 矩形 ")])),_:1})):p("",!0),"selectionArea"===T.value?(a(),t(w,{key:1,class:"title-handle-btn",type:"warning",onClick:s[4]||(s[4]=e=>H("")),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(S))])),_:1}),v(" 矩形 ")])),_:1})):p("",!0),"selectionArcArea"!==T.value?(a(),t(w,{key:2,type:"primary",class:"title-handle-btn",onClick:s[5]||(s[5]=e=>H("selectionArcArea")),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(M))])),_:1}),v(" 圆形 ")])),_:1})):p("",!0),"selectionArcArea"===T.value?(a(),t(w,{key:3,class:"title-handle-btn",type:"warning",onClick:s[6]||(s[6]=e=>H("")),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(M))])),_:1}),v(" 圆形 ")])),_:1})):p("",!0),"clearArea"!==T.value?(a(),t(w,{key:4,type:"primary",class:"title-handle-btn",onClick:s[7]||(s[7]=e=>H("clearArea")),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(P))])),_:1}),v(" 笔刷 ")])),_:1})):p("",!0),"clearArea"===T.value?(a(),t(w,{key:5,class:"title-handle-btn",type:"warning",onClick:s[8]||(s[8]=e=>H("")),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(P))])),_:1}),v(" 笔刷 ")])),_:1})):p("",!0),u(w,{class:"title-handle-btn",type:"primary",onClick:s[9]||(s[9]=e=>K()),style:{"font-size":"12px"}},{default:c((()=>[u(y,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[u(r(D))])),_:1}),v(" 重置 ")])),_:1})]),d("div",null,[u(U,{class:"upload-demo","show-file-list":!1,accept:".txt",action:"''","before-upload":re},{default:c((()=>[u(w,null,{default:c((()=>[v(" 导入模板 ")])),_:1})])),_:1}),u(w,{onClick:de},{default:c((()=>[v("导出")])),_:1}),O.value?(a(),t(w,{key:0,onClick:s[10]||(s[10]=e=>ne(O.value))},{default:c((()=>[v("结果图片")])),_:1})):p("",!0),u(w,{onClick:te,type:"primary"},{default:c((()=>[v("生成图片")])),_:1}),u(w,{onClick:W},{default:c((()=>[v(" 添加图层类型 ")])),_:1})])]),d("div",Pn,[u(z,{style:{height:"100%"}},{default:c((()=>[d("div",En,[d("canvas",{ref_key:"canvasDom",ref:i,style:L({width:F.value+"px",height:X.value+"px"})},null,4)])])),_:1})])]),d("div",Tn,[d("div",Rn,[d("div",Yn,[v(" 当前选中类型 "),u(ce,{style:{width:"90px"},size:"small",modelValue:V.value,"onUpdate:modelValue":s[11]||(s[11]=e=>V.value=e),onChange:Z},{default:c((()=>[(a(!0),o(h,null,m(I.value,(e=>(a(),t(N,{key:e.uuid,label:e.name,value:e.uuid},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),u(w,{onClick:$,disabled:!V.value,size:"small"},{default:c((()=>[u(y,null,{default:c((()=>[u(r(G))])),_:1})])),_:1},8,["disabled"]),u(w,{style:{"margin-left":"5px"},disabled:!V.value,size:"small",type:"danger",onClick:x(ue,["stop"])},{default:c((()=>[u(y,null,{default:c((()=>[u(r(C))])),_:1})])),_:1},8,["disabled"])]),d("div",Fn,[V.value?p("",!0):(a(),t(me,{key:0,style:{width:"280px"}},{template:c((()=>[u(he,{variant:"image",style:{width:"280px",height:"280px"}}),d("div",Xn,[u(he,{variant:"p",style:{width:"50%"}}),d("div",zn,[u(he,{variant:"text",style:{"margin-right":"16px"}}),u(he,{variant:"text",style:{width:"30%"}})])])])),_:1})),V.value&&E.value.imageUrl?(a(),t(ve,{key:1,src:E.value.imageUrl,style:{width:"280px",height:"280px"}},null,8,["src"])):p("",!0)])]),On,d("div",Wn,[u(z,null,{default:c((()=>[u(fe,{accordion:""},{default:c((()=>[(a(!0),o(h,null,m(R.value,(e=>(a(),t(pe,{key:e.uuid,name:e.uuid},{title:c((()=>[d("div",$n,[d("div",jn,g(I.value.find((({uuid:a})=>e.uuid===a))?I.value.find((({uuid:a})=>e.uuid===a)).name:"未分类"),1),Zn])])),default:c((()=>[(a(!0),o(h,null,m(e.layers,(e=>(a(),o("div",{class:"layer-item",key:e.uuid},[d("div",Hn,[v(" 图层名称: "),u(ge,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,size:"small",style:{width:"120px"},onChange:a=>J(e)},null,8,["modelValue","onUpdate:modelValue","onChange"]),u(w,{type:e.isShow?"success":"danger",size:"small",onClick:()=>{e.isShow=!e.isShow,J(e)}},{default:c((()=>[u(y,null,{default:c((()=>[e.isShow?(a(),t(r(Q),{key:0})):(a(),t(r(q),{key:1}))])),_:2},1024)])),_:2},1032,["type","onClick"])]),d("div",Nn,[v(" 所属类型: "),u(ce,{style:{width:"120px"},size:"small",modelValue:e.typeUUid,"onUpdate:modelValue":a=>e.typeUUid=a,onChange:a=>J(e)},{default:c((()=>[(a(!0),o(h,null,m(I.value,(e=>(a(),t(N,{key:e.uuid,label:e.name,value:e.uuid},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),u(w,{type:"danger",size:"small",onClick:a=>ee(e)},{default:c((()=>[u(y,null,{default:c((()=>[u(r(C))])),_:1})])),_:2},1032,["onClick"])]),d("div",Bn,[v(" 图层缩略: "),u(ve,{style:{width:"180px",height:"180px"},src:e.imageData},null,8,["src"])])])))),128))])),_:2},1032,["name"])))),128))])),_:1})])),_:1})])]),u(sn,{ref_key:"addLayerTypeDom",ref:k,onSetLayerType:j},null,512),u(nn,{ref_key:"genrationImageDom",ref:_,onSetResultImage:ie,onSetPrompt:le},null,512),u(xn,{ref_key:"reviewResultImageDom",ref:A,onReviewResultImage:se},null,512)])}}},[["__scopeId","data-v-05f5da2c"]]);const Qn="_AICLOTH_CONSOLE_",qn="_AICLOTH_CONSOLE__token";function Jn(e){localStorage.setItem(Qn+"USER",JSON.stringify(e))}function Kn(){const e=J.get(qn);return""!==e||void 0!==e||null!==e?e:null}function eo(e,a){localStorage.setItem(Qn+e,JSON.stringify(a))}const ao=w.create({baseURL:"http://www.weishih-ai.com:10010/dev-api",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function to(e){if(!e.response)return b.error({message:"请求超时",description:`${e.toString()}`}),Promise.reject(e);Kn();const a=e.response.status,t=e.response.data,{userStore:l}=no;return 401===a?(b.error({message:"登录失效, 请重新登陆"}),l.handleLogout().then((()=>{setTimeout((()=>{oo.replace("/login")}),1500)}))):400!==a&&500!==a||b.error({message:t.message}),Promise.reject(e)}ao.interceptors.request.use((e=>{const a=Kn()||"22";return a&&e.headers&&(e.headers["X-Auth-Token"]=a),e}),to),ao.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),to);const lo=K({id:"users",state:()=>({user:null,permissions:null,token:"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((a,t)=>{var l;(l=e,ao.post("/sso/api/v1/session/login",l)).then((e=>{const t=e.token;var l;this.token=t.token,this.user=t.user,this.workingTenant=t.working_tenant,eo("workingTenant",t.working_tenant),Jn(t.user),l=t.token,J.set(qn,l,{expires:1}),a({...t.user,needPasswd:e.need_passwd}),ao.get("/sso/api/v1/roles").then((e=>{eo("roles",e.roles||[])}))})).catch((e=>{t(e)}))}))},handleLogout(e=""){return new Promise(((e,a)=>{J.remove(qn),localStorage.removeItem(Qn+"USER"),this.user=null,this.permissions=null,this.token="",Jn(null),e(null)}))},getUserInfo(){return new Promise(((e,a)=>{ao.get("/sso/api/v1/accounts/get").then((a=>{const t=function(){const e=localStorage.getItem(Qn+"USER");return e&&"undefined"!==e?JSON.parse(e):null}()||{};Object.assign(t,a),this.user=t,Jn(t);const l=[].concat([t.sys_role]);window.localStorage.setItem("ROLE_PERMISSIONS_LIST",JSON.stringify(l)),this.permissions=l,e(t)})).catch((e=>{a(e)}))}))}}});const io={"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:lo,setupStore:function(e){return lo(e)}},Symbol.toStringTag,{value:"Module"}))},so=ee(),no={};Object.keys(io).forEach((e=>{const a=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];no[`${a}Store`]=io[e].setupStore(so)}));var oo=ae({history:te("/"),routes:[{path:"/",name:"home",component:_e,redirect:"/ImageGenerationImage",children:[{path:"imageSearch",name:"imageSearch",component:ti},{path:"enhanceImageGenerationImage",name:"enhanceImageGenerationImage",component:$a},{path:"gallery",name:"gallery",component:ki},{path:"superImageSearch",name:"superImageSearch",component:Fi},{path:"activationKeys",name:"activationKeys",component:Qi},{path:"ImageGenerationImage",name:"ImageGenerationImage",component:ha},{path:"swapFace",name:"swapFace",component:At},{path:"partialModifications",name:"partialModifications",component:Gt},{path:"trainModel",name:"trainModel",component:es},{path:"imageSearchTrainDataset",name:"imageSearchTrainDataset",component:Ws},{path:"searchImageTaskList",name:"searchImageTaskList",component:Qs},{path:"superImageSearch",name:"superImageSearch",component:Fi},{path:"activationKeys",name:"activationKeys",component:Qi},{path:"generationImageDrawBoard",name:"generationImageDrawBoard",component:Gn}]}]});if("undefined"!=typeof window){let e=function(){var e=document.body,a=document.getElementById("__svg__icons__dom__");a||((a=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",a.style.width="0",a.style.height="0",a.id="__svg__icons__dom__",a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),a.innerHTML="",e.insertBefore(a,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const ro=le(oe);ro.use(ee()),ro.use(oo),ro.use(ie,{locale:se}),ro.mount("#app");
