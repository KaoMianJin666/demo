import{r as e,I as a,e as l,c as t,g as s,h as n,j as i,w as d,f as u,J as o,u as v,a3 as m,a4 as r,b as c,i as p,a as f,n as g,D as _,a5 as b,a6 as y,S as V,F as h,A as k,q as w,U as x,Q as U,s as O,t as S,o as D,z as I}from"./lib.a58a7bed.js";import{_ as C,s as N,g as L,a as T,d as j,T as M}from"./index.5c67125e.js";const J={class:"setting-list-item"},E=["contenteditable",".innerHTML"];var H=C({__name:"settingItem",props:{name:{type:String,default:""},itemList:{type:Boolean,default:!1},needRemove:{type:Boolean,default:!1},col:{type:Number,default:0},needEdit:{type:Boolean,default:!1}},emits:["deleteItem"],setup(_,{emit:b}){const y=e(!1),V=b,h=_,k=e=>{e===Number(h.needEdit)&&(y.value=!y.value)},w=({target:e})=>{V("setName",e.innerHTML)};return(e,b)=>{const x=a("el-icon");return l(),t("div",J,[s("div",{class:"setting-item-title",onClick:b[2]||(b[2]=p((e=>k(0)),["stop"]))},[s("div",{class:n(["setting-handle-icon",{selected:y.value}]),onClick:b[0]||(b[0]=e=>k(1))},[i(x,null,{default:d((()=>[(l(),u(o(v(m))))])),_:1})],2),s("div",{class:"setting-name",contenteditable:h.needEdit,".innerHTML":_.name,onBlur:w},null,40,E),h.needRemove?(l(),t("div",{key:0,class:"settgin-remove-handle",onClick:b[1]||(b[1]=e=>V("deleteItem"))},[i(x,null,{default:d((()=>[i(v(r))])),_:1})])):c("",!0)]),s("div",{class:"setting-item-data-list",style:g({height:y.value?1.2*h.col+"rem":"0rem"})},[f(e.$slots,"default",{},void 0,!0)],4)])}}},[["__scopeId","data-v-71cf0196"]]);const B=e=>(O("data-v-089580f0"),e=e(),S(),e),$={class:"add-or-update"},A={class:"add-or-update-box"},F={class:"title"},R=B((()=>s("div",{class:"title-label"},"参数选择:",-1))),q=["contenteditable",".innerHTML"],z={class:"folder"},Q={class:"setting-list folder-list"},G={class:"setting-item-data"},K=B((()=>s("div",{class:"setting-item-data-name"}," 文件夹 ",-1))),P={class:"setting-item-data-value"},W={class:"setting-item-data"},X=B((()=>s("div",{class:"setting-item-data-name"}," 透明度 ",-1))),Y={class:"setting-item-data-value"},Z={class:"setting-handle"},ee={class:"setting-item-data-value"},ae={class:"setting-list params-list"},le={class:"setting-item-data"},te=B((()=>s("div",{class:"setting-item-data-name"},"value",-1))),se={class:"setting-item-data-value"},ne={class:"setting-item-data"},ie=B((()=>s("div",{class:"setting-item-data-name"},"value",-1))),de={class:"setting-item-data-value"},ue={class:"setting-item-data"},oe=B((()=>s("div",{class:"setting-item-data-name"},"预览图地址",-1))),ve={class:"setting-item-data-value"},me={class:"setting-item-data"},re=B((()=>s("div",{class:"setting-item-data-name"},"value",-1))),ce={class:"setting-item-data-value"},pe={class:"setting-item-data"},fe=B((()=>s("div",{class:"setting-item-data-name"},"参考图文件夹",-1))),ge={class:"setting-item-data-value"},_e={class:"setting-item-data"},be=B((()=>s("div",{class:"setting-item-data-name"},"参考图权重",-1))),ye={class:"setting-item-data-value"},Ve={class:"setting-item-data"},he=B((()=>s("div",{class:"setting-item-data-name"},"参考图文件夹",-1))),ke={class:"setting-item-data-value"},we={class:"setting-item-data"},xe=B((()=>s("div",{class:"setting-item-data-name"},"参考图权重",-1))),Ue={class:"setting-item-data-value"};var Oe=C({__name:"staticsSettingAddOrUpdate",emits:["review"],setup(n,{expose:m,emit:r}){const p=e("maskDom"),f=e(!1),O=e("add"),S=r,D=e(!1),I=e(null),C=e(!1),L=e(!1),T=e(!1);e(new Set([])),e(new Set([]));const j=e(null),M=e(""),J=e(""),E=e(!0),B=e(""),Oe=[{name:"横向二方连续",key:"tile_x"},{name:"纵向二方连续",key:"tile_y"},{name:"四方连续",key:"tile_f"}],Se=e({probability:20,value:""}),De=e({probability:20,value:""}),Ie=e([]),Ce=({target:e})=>{I.value=e.innerHTML},Ne=()=>{D.value=!D.value,D.value?M.value=M.value:M.value=I.value},Le=()=>{p.value.hide(),setTimeout((()=>{f.value=!1}),200)};return m({init:(e="add",a={})=>{if(f.value)return;f.value=!0,C.value=!1,L.value=!1,T.value=!1,M.value=a.name||"",B.value=a.preview||"",a.extra_params?(a.extra_params.ref_style.probability*=100,a.extra_params.ref_struct.probability*=100,J.value=a.extra_params.lora.value,Se.value=a.extra_params.ref_style,De.value=a.extra_params.ref_struct,E.value=a.extra_params.remove_bg.value,j.value=a.extra_params.tile.value):(J.value=a.extra_params?a.extra_params.lora:"",Se.value={probability:20,value:""},De.value={probability:20,value:""},E.value=!0,j.value=null);const l=a.folders||[],t=[];l.forEach((e=>{const a={uuid:x(),folder:e.folder,fusion_params:e.fusion_params};t.push(a)})),Ie.value=t,O.value=e,U((()=>{p.value.show()}))}}),(e,n)=>{const m=a("el-icon"),r=a("el-input"),U=a("el-scrollbar"),I=a("el-option"),C=a("el-select"),L=a("el-input-number"),T=a("t-mask");return l(),t("div",$,[f.value?(l(),u(T,{key:0,ref_key:"maskDom",ref:p},{default:d((()=>[s("div",A,[s("div",F,[R,s("div",{class:"title-name",contenteditable:D.value,".innerHTML":M.value,onBlur:Ce},null,40,q),s("div",{class:"title-handle-area",style:g({width:("add"===O.value?1.7:.8)+"rem"})},["add"===O.value?(l(),t("div",{key:0,class:"title-handle-btn",onClick:Ne},[i(m,null,{default:d((()=>[(l(),u(o(D.value?v(b):v(_))))])),_:1})])):c("",!0),s("div",{class:"title-handle-btn",onClick:n[0]||(n[0]=e=>(()=>{const e=JSON.parse(JSON.stringify(De.value));e.probability/=100;const a=JSON.parse(JSON.stringify(Se.value));a.probability/=100;const l={folders:[],extra_params:{lora:{value:J.value},ref_struct:e,ref_style:a,remove_bg:{value:E.value},tile:{value:j.value}}};Ie.value.forEach((e=>{const a={folder:e.folder,fusion_params:e.fusion_params};l.folders.push(a)}));const t=JSON.stringify(l),s=new Blob([t],{type:"application/json"}),n=new File([s],`${M.value}.json`,{type:"application/json",lastModified:Date.now()}),i=new FormData;i.append("file",n),N(i,"statics",M.value,B.value).then((e=>{Le(),S("review")}))})())},[i(m,null,{default:d((()=>[i(v(y))])),_:1})])],4),s("div",{class:"close-btn",onClick:Le},[i(m,null,{default:d((()=>[i(v(V))])),_:1})])]),s("div",z,[s("div",Q,[i(U,null,{default:d((()=>[(l(!0),t(h,null,k(Ie.value,(e=>(l(),u(H,{key:e.uuid,name:`文件夹: ${e.folder}`,col:2,"need-remove":"",onSetName:a=>{e.folder=a},onDeleteItem:()=>{(e=>{const a=Ie.value.findIndex((a=>a.uuid===e));Ie.value.splice(a,1)})(e.uuid)}},{default:d((()=>[s("div",G,[K,s("div",P,[i(r,{modelValue:e.folder,"onUpdate:modelValue":a=>e.folder=a},null,8,["modelValue","onUpdate:modelValue"])])]),s("div",W,[X,s("div",Y,[i(r,{modelValue:e.fusion_params.transparency,"onUpdate:modelValue":a=>e.fusion_params.transparency=a},null,8,["modelValue","onUpdate:modelValue"])])])])),_:2},1032,["name","onSetName","onDeleteItem"])))),128)),s("div",Z,[s("div",ee,[s("div",{class:"folder-input",onClick:n[1]||(n[1]=e=>(()=>{const e=x();Ie.value.push({uuid:e,folder:"",maxLength:0,fusion_params:{transparency:.2}})})())},"新增")])])])),_:1})]),s("div",ae,[i(U,null,{default:d((()=>[i(H,{name:"连续方式",col:1},{default:d((()=>[s("div",le,[te,s("div",se,[i(C,{modelValue:j.value,"onUpdate:modelValue":n[2]||(n[2]=e=>j.value=e),clearable:""},{default:d((()=>[(l(),t(h,null,k(Oe,(e=>i(I,{label:e.name,value:e.key,key:e.key},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])])])),_:1}),i(H,{name:"lora",col:1},{default:d((()=>[s("div",ne,[ie,s("div",de,[i(r,{modelValue:J.value,"onUpdate:modelValue":n[3]||(n[3]=e=>J.value=e)},null,8,["modelValue"])])])])),_:1}),i(H,{name:"预览图",col:1},{default:d((()=>[s("div",ue,[oe,s("div",ve,[i(r,{modelValue:B.value,"onUpdate:modelValue":n[4]||(n[4]=e=>B.value=e)},null,8,["modelValue"])])])])),_:1}),i(H,{name:"是否需要背景",col:1},{default:d((()=>[s("div",me,[re,s("div",ce,[i(C,{modelValue:E.value,"onUpdate:modelValue":n[5]||(n[5]=e=>E.value=e)},{default:d((()=>[i(I,{value:!0,label:"是"}),i(I,{value:!1,label:"否"})])),_:1},8,["modelValue"])])])])),_:1}),i(H,{name:"风格参考",col:2},{default:d((()=>[s("div",pe,[fe,s("div",ge,[i(r,{modelValue:Se.value.value,"onUpdate:modelValue":n[6]||(n[6]=e=>Se.value.value=e)},null,8,["modelValue"])])]),s("div",_e,[be,s("div",ye,[i(L,{controls:!1,modelValue:Se.value.probability,"onUpdate:modelValue":n[7]||(n[7]=e=>Se.value.probability=e)},null,8,["modelValue"]),w(" % ")])])])),_:1}),i(H,{name:"结构参考",col:2},{default:d((()=>[s("div",Ve,[he,s("div",ke,[i(r,{modelValue:De.value.value,"onUpdate:modelValue":n[8]||(n[8]=e=>De.value.value=e)},null,8,["modelValue"])])]),s("div",we,[xe,s("div",Ue,[i(L,{controls:!1,modelValue:De.value.probability,"onUpdate:modelValue":n[9]||(n[9]=e=>De.value.probability=e)},null,8,["modelValue"]),w(" % ")])])])),_:1})])),_:1})])])])])),_:1},512)):c("",!0)])}}},[["__scopeId","data-v-089580f0"]]);const Se={class:"statics-setting"},De={class:"statics-setting-info"};var Ie=C({__name:"staticsSetting",props:["class"],setup(o,{expose:v}){const m=e({}),r=e("addOrUpdateDom"),c=o,p=()=>{L("statics").then((e=>{m.value=e.templates}))},f=(...e)=>{r.value.init(...e)};return D((()=>{p()})),v({addOrUpdate:f}),(e,o)=>{const v=a("modelCard"),g=a("el-scrollbar");return l(),t("div",Se,[i(g,null,{default:d((()=>[s("div",De,[(l(!0),t(h,null,k(Object.keys(m.value),(e=>(l(),u(v,{class:n(c.class),key:e,data:{name:e,preview:m.value[e].preview},onToUpdate:()=>{(({name:e,preview:a})=>{T("statics",e).then((l=>{f("update",Object.assign({name:e,preview:a},l))}))})({name:e,preview:m.value[e].preview})},onDeleteItem:()=>{(({name:e})=>{j("statics",e).then((e=>{p()}))})({name:e})}},null,8,["class","data","onToUpdate","onDeleteItem"])))),128))])])),_:1}),i(Oe,{ref_key:"addOrUpdateDom",ref:r,onReview:p},null,512)])}}},[["__scopeId","data-v-75df05b8"]]);const Ce=e=>(O("data-v-e4c4d8f4"),e=e(),S(),e),Ne={class:"add-or-update"},Le={class:"add-or-update-box"},Te={class:"title"},je=Ce((()=>s("div",{class:"title-label"},"参数选择:",-1))),Me=["contenteditable",".innerHTML"],Je={class:"content"},Ee={class:"setting-list prompts-list"},He={class:"setting-item-data-name"},Be={class:"setting-item-data-value"},$e={class:"setting-item-data"},Ae=["onClick"],Fe=Ce((()=>s("div",{class:"setting-item-data-value"},null,-1))),Re={class:"setting-handle"},qe={class:"setting-item-data-value"},ze={class:"setting-list params-list"},Qe={class:"setting-item-data"},Ge=Ce((()=>s("div",{class:"setting-item-data-name"},"value",-1))),Ke={class:"setting-item-data-value"},Pe={class:"setting-item-data"},We=Ce((()=>s("div",{class:"setting-item-data-name"},"预览图地址",-1))),Xe={class:"setting-item-data-value"},Ye={class:"setting-item-data"},Ze=Ce((()=>s("div",{class:"setting-item-data-name"},"value",-1))),ea={class:"setting-item-data-value"},aa={class:"setting-item-data"},la=Ce((()=>s("div",{class:"setting-item-data-name"},"参考图文件夹",-1))),ta={class:"setting-item-data-value"},sa={class:"setting-item-data"},na=Ce((()=>s("div",{class:"setting-item-data-name"},"参考图权重",-1))),ia={class:"setting-item-data-value"},da={class:"setting-item-data"},ua=Ce((()=>s("div",{class:"setting-item-data-name"},"参考图文件夹",-1))),oa={class:"setting-item-data-value"},va={class:"setting-item-data"},ma=Ce((()=>s("div",{class:"setting-item-data-name"},"参考图权重",-1))),ra={class:"setting-item-data-value"};var ca=C({__name:"promptSettingAddOrUpdate",emits:["review"],setup(n,{expose:m,emit:r}){const p=e("maskDom"),f=e(!1),O=e("add"),S=r,D=e(!1),C=e(null),L=e(!1),T=e(!1),j=e(!1);e(new Set([])),e(new Set([]));const M=e(""),J=e(""),E=e(!0),B=e(""),$=e({probability:20,value:""}),A=e({probability:20,value:""}),F=e([]),R=({target:e})=>{C.value=e.innerHTML},q=()=>{D.value=!D.value,D.value?M.value=M.value:M.value=C.value},z=()=>{p.value.hide(),setTimeout((()=>{f.value=!1}),200)};return m({init:(e="add",a={})=>{if(f.value)return;f.value=!0,L.value=!1,T.value=!1,j.value=!1,M.value=a.name||"",B.value=a.preview||"",a.extra_params?(a.extra_params.ref_style.probability*=100,a.extra_params.ref_struct.probability*=100,J.value=a.extra_params.lora.value,$.value=a.extra_params.ref_style,A.value=a.extra_params.ref_struct,E.value=a.extra_params.remove_bg.value):(J.value=a.extra_params?a.extra_params.lora:"",$.value={probability:20,value:""},A.value={probability:20,value:""},E.value=!0);const l=a.contents||[],t=[];l.forEach((e=>{const a={uuid:x(),content:e.content,maxLength:0,elements:[]},l=[0,0];Object.keys(e).forEach((t=>{t.includes("elements")&&(l.push(Number(t.replaceAll("elements_",""))),a.elements.push({name:t,values:e[t]}))})),a.maxLength=Math.max(...l),t.push(a)})),F.value=t,O.value=e,U((()=>{p.value.show()}))}}),(e,n)=>{const m=a("el-icon"),r=a("el-select"),U=a("el-scrollbar"),C=a("el-input"),L=a("el-option"),T=a("el-input-number"),j=a("t-mask");return l(),t("div",Ne,[f.value?(l(),u(j,{key:0,ref_key:"maskDom",ref:p},{default:d((()=>[s("div",Le,[s("div",Te,[je,s("div",{class:"title-name",contenteditable:D.value,".innerHTML":M.value,onBlur:R},null,40,Me),s("div",{class:"title-handle-area",style:g({width:("add"===O.value?1.7:.8)+"rem"})},["add"===O.value?(l(),t("div",{key:0,class:"title-handle-btn",onClick:q},[i(m,null,{default:d((()=>[(l(),u(o(D.value?v(b):v(_))))])),_:1})])):c("",!0),s("div",{class:"title-handle-btn",onClick:n[0]||(n[0]=e=>(()=>{const e=JSON.parse(JSON.stringify(A.value));e.probability/=100;const a=JSON.parse(JSON.stringify($.value));a.probability/=100;const l={contents:[],extra_params:{lora:{value:J.value},ref_struct:e,ref_style:a,remove_bg:{value:E.value}}};F.value.forEach((e=>{const a={content:e.content};e.elements.forEach((e=>{a[e.name]=e.values})),l.contents.push(a)}));const t=JSON.stringify(l),s=new Blob([t],{type:"application/json"}),n=new File([s],`${M.value}.json`,{type:"application/json",lastModified:Date.now()}),i=new FormData;i.append("file",n),N(i,"prompts",M.value,B.value).then((e=>{z(),S("review")}))})())},[i(m,null,{default:d((()=>[i(v(y))])),_:1})])],4),s("div",{class:"close-btn",onClick:z},[i(m,null,{default:d((()=>[i(v(V))])),_:1})])]),s("div",Je,[s("div",Ee,[i(U,null,{default:d((()=>[(l(!0),t(h,null,k(F.value,(e=>(l(),u(H,{key:e.uuid,name:e.content,col:e.elements.length+1,"need-remove":"","need-edit":"",onSetName:a=>{e.content=a},onDeleteItem:()=>{(e=>{const a=F.value.findIndex((a=>a.uuid===e));F.value.splice(a,1)})(e.uuid)}},{default:d((()=>[(l(!0),t(h,null,k(e.elements,(a=>(l(),t("div",{class:"setting-item-data",key:a.name},[s("div",He,[w(I(a.name.replace("elements_","参数"))+" ",1),i(m,{onClick:l=>((e,a)=>{const l=F.value.findIndex((a=>a.uuid===e)),t=F.value[l].elements.findIndex((e=>e.name===a));F.value[l].content=F.value[l].content.replaceAll(`{${a}}`,""),F.value[l].elements.splice(t,1)})(e.uuid,a.name),class:"handle-btn"},{default:d((()=>[i(v(V))])),_:2},1032,["onClick"])]),s("div",Be,[i(r,{"reserve-keyword":!1,"default-first-option":"","allow-create":"",modelValue:a.values,"onUpdate:modelValue":e=>a.values=e,multiple:"",filterable:""},null,8,["modelValue","onUpdate:modelValue"])])])))),128)),s("div",$e,[s("div",{class:"setting-item-data-name pointer",onClick:a=>((e,a)=>{const l=F.value.findIndex((a=>a.uuid===e));F.value[l].maxLength+=1,F.value[l].content+=`{elements_${F.value[l].maxLength}}`,F.value[l].elements.push({name:`elements_${F.value[l].maxLength}`,values:[]})})(e.uuid)},"添加",8,Ae),Fe])])),_:2},1032,["name","col","onSetName","onDeleteItem"])))),128)),s("div",Re,[s("div",qe,[s("div",{class:"content-input",onClick:n[1]||(n[1]=e=>(()=>{const e=x();F.value.push({uuid:e,content:"",maxLength:0,elements:[]})})())},"添加提示词")])])])),_:1})]),s("div",ze,[i(U,null,{default:d((()=>[i(H,{name:"lora",col:1},{default:d((()=>[s("div",Qe,[Ge,s("div",Ke,[i(C,{modelValue:J.value,"onUpdate:modelValue":n[2]||(n[2]=e=>J.value=e)},null,8,["modelValue"])])])])),_:1}),i(H,{name:"预览图",col:1},{default:d((()=>[s("div",Pe,[We,s("div",Xe,[i(C,{modelValue:B.value,"onUpdate:modelValue":n[3]||(n[3]=e=>B.value=e)},null,8,["modelValue"])])])])),_:1}),i(H,{name:"是否需要背景",col:1},{default:d((()=>[s("div",Ye,[Ze,s("div",ea,[i(r,{modelValue:E.value,"onUpdate:modelValue":n[4]||(n[4]=e=>E.value=e)},{default:d((()=>[i(L,{value:!0,label:"是"}),i(L,{value:!1,label:"否"})])),_:1},8,["modelValue"])])])])),_:1}),i(H,{name:"风格参考",col:2},{default:d((()=>[s("div",aa,[la,s("div",ta,[i(C,{modelValue:$.value.value,"onUpdate:modelValue":n[5]||(n[5]=e=>$.value.value=e)},null,8,["modelValue"])])]),s("div",sa,[na,s("div",ia,[i(T,{controls:!1,modelValue:$.value.probability,"onUpdate:modelValue":n[6]||(n[6]=e=>$.value.probability=e)},null,8,["modelValue"]),w(" % ")])])])),_:1}),i(H,{name:"结构参考",col:2},{default:d((()=>[s("div",da,[ua,s("div",oa,[i(C,{modelValue:A.value.value,"onUpdate:modelValue":n[7]||(n[7]=e=>A.value.value=e)},null,8,["modelValue"])])]),s("div",va,[ma,s("div",ra,[i(T,{controls:!1,modelValue:A.value.probability,"onUpdate:modelValue":n[8]||(n[8]=e=>A.value.probability=e)},null,8,["modelValue"]),w(" % ")])])])),_:1})])),_:1})])])])])),_:1},512)):c("",!0)])}}},[["__scopeId","data-v-e4c4d8f4"]]);const pa={class:"prompt-setting"},fa={class:"prompt-setting-info"};var ga=C({__name:"promptSetting",props:["class"],setup(o,{expose:v}){const m=e({}),r=e("addOrUpdateDom"),c=o,p=()=>{L("prompts").then((e=>{m.value=e.templates}))},f=(...e)=>{r.value.init(...e)};return D((()=>{p()})),v({addOrUpdate:f}),(e,o)=>{const v=a("modelCard"),g=a("el-scrollbar");return l(),t("div",pa,[i(g,null,{default:d((()=>[s("div",fa,[(l(!0),t(h,null,k(Object.keys(m.value),(e=>(l(),u(v,{class:n(c.class),key:e,data:{name:e,preview:m.value[e].preview},onToUpdate:()=>{(({name:e,preview:a})=>{T("prompts",e).then((l=>{f("update",Object.assign({name:e,preview:a},l))}))})({name:e,preview:m.value[e].preview})},onDeleteItem:()=>{(({name:e})=>{j("prompts",e).then((e=>{p()}))})({name:e})}},null,8,["class","data","onToUpdate","onDeleteItem"])))),128))])])),_:1}),i(ca,{ref_key:"addOrUpdateDom",ref:r,onReview:p},null,512)])}}},[["__scopeId","data-v-66182dc4"]]);const _a={class:"prompt-setting-outer"},ba={class:"prompt-setting-handle-area"},ya={class:"change-setting-type-area"},Va=["onClick"],ha={class:"prompt-setting-component-area"};var ka=C({__name:"index",props:["class"],setup(v){const m=v,r=[{name:"静态层配置",component:Ie},{name:"prompt配置",component:ga}],c=e(0),p=e("componentDom");return D((()=>{window.loading||(window.loading=M()),setTimeout((()=>{window.loading.close(),window.loading=null}),300)})),(e,v)=>{const f=a("t-button");return l(),t("div",_a,[s("div",ba,[s("div",ya,[s("div",{class:"component-selected",style:g({left:3.2*c.value+.05+"rem"})},null,4),(l(),t(h,null,k(r,((e,a)=>s("div",{class:"component-item",onClick:e=>c.value=a,key:e.name},I(e.name),9,Va))),64))]),i(f,{style:{margin:"0",width:"2.5rem","text-align":"center"},type:"warn",onClick:v[0]||(v[0]=e=>{p.value.addOrUpdate()})},{default:d((()=>[w("新增")])),_:1})]),s("div",ha,[(l(),u(o(r[c.value].component),{class:n(m.class),ref_key:"componentDom",ref:p},null,8,["class"]))])])}}},[["__scopeId","data-v-3b559816"]]);export{ka as default};
