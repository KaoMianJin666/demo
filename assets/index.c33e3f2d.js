var e=Object.defineProperty,t=(t,a,l)=>(((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(t,"symbol"!=typeof a?a+"":a,l),l);import{d as a,C as l,r as s,o as n,c as i,a as o,n as r,b as d,e as u,f as c,w as h,g as m,h as v,i as p,j as g,u as y,E as f,k as w,l as b,m as x,p as D,q as E,s as C,t as k,v as T,x as I,y as _,z as L,A as S,F as A,T as O,B as R,D as M,G as P,H as z,I as U,J as N,K as G,L as j,M as H,N as Y,O as V,P as B,Q as X,R as W,S as F,U as $,V as J,W as Z,X as Q,Y as q}from"./lib.ecb25fce.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const K={},ee=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in K)return;K[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const l=document.createElement("link");return l.rel=t?"stylesheet":"modulepreload",t||(l.as="script",l.crossOrigin=""),l.href=e,document.head.appendChild(l),t?new Promise(((t,a)=>{l.addEventListener("load",t),l.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())):e()};const te=a({id:"public",state:()=>({rootDom:null,colorScheme:null,leftBarShowType:0,routePath:null}),getters:{getRootDom(){return this.rootDom},getColorScheme(){return this.colorScheme},getLeftBarShowType(){return this.leftBarShowType},getRoutePath(){return this.routePath}},actions:{setRootDom(e){this.rootDom=e},setRoutePath(e){this.routePath=e},setLeftBarShowType(e){this.leftBarShowType=e},setColorScheme(e){return new Promise((t=>{(e=(e=e||localStorage.getItem("colorScheme"))||"dark")&&function(e){switch(e){case"../../assets/style/animate.scss":return ee((()=>Promise.resolve({})),["assets/animate.ae85aa38.css"]);case"../../assets/style/dark.scss":return ee((()=>Promise.resolve({})),["assets/dark.147f7ff9.css"]);case"../../assets/style/global.scss":return ee((()=>Promise.resolve({})),["assets/global.3e2ab668.css"]);case"../../assets/style/light.scss":return ee((()=>Promise.resolve({})),["assets/light.25455dc6.css"]);case"../../assets/style/style.scss":return ee((()=>import("./style.0f4827d1.js")),[]);default:return new Promise((function(t,a){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`../../assets/style/${e}.scss`).then((a=>{this.colorScheme&&this.removeTheme(this.colorScheme);const l=document.createElement("style");l.id=`theme-${e}`,l.innerText=a.default,document.head.appendChild(l),this.colorScheme=e,localStorage.setItem("colorScheme",this.colorScheme),document.documentElement.className=this.colorScheme,t()}))}))},removeTheme(e){const t=document.getElementById(`theme-${e}`);t&&t.parentNode.removeChild(t)}}});var ae=Object.freeze(Object.defineProperty({__proto__:null,usePublicStore:te,setupStore:function(e){return te(e)}},Symbol.toStringTag,{value:"Module"}));const le="_AICLOTH_CONSOLE_",se="_AICLOTH_CONSOLE__token";function ne(){const e=localStorage.getItem(le+"USER");return e&&"undefined"!==e?JSON.parse(e):null}function ie(e){localStorage.setItem(le+"USER",JSON.stringify(e))}function oe(){const e=l.get(se);return""!==e||void 0!==e||null!==e?e:null}var re=(e,t)=>{const a=e.__vccOpts||e;for(const[l,s]of t)a[l]=s;return a};var de=re({__name:"tMask",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!1},destroy:{type:Function},close:{type:Function}},emits:["close"],setup(e,{expose:t,emit:a}){const l=s(!0),c=s(!1),h=e,m=()=>{h.maskClickHide&&(h.close?h.close():v())},v=()=>{c.value&&(c.value=!1,setTimeout((()=>{l.value=!1,h.destroy&&h.destroy()}),200))},p=()=>{l.value=!0,setTimeout((()=>{c.value=!0}))};return n((()=>{p()})),t({hide:v,show:p}),(e,t)=>l.value?(u(),i("div",{key:0,class:"mask",style:r({backgroundColor:h.bgColor,opacity:Number(c.value)}),onClick:m},[o(e.$slots,"default",{},void 0,!0)],4)):d("",!0)}},[["__scopeId","data-v-1477fffe"]]);const ue=e=>(C("data-v-5bef5db2"),e=e(),k(),e),ce=ue((()=>m("div",{class:"logo-area"},"Tart",-1))),he={class:"input-area"},me={class:"input-area"},ve=ue((()=>m("div",{class:"user-agreements-area"}," 用户协议 用户协议 ",-1))),pe={class:"login-btn-area"};var ge=re({__name:"loginBox",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!0},destroy:{type:Function}},setup(e){const{userStore:t}=Lt(),a=e,l=s("tMaskDom"),i=s(null),o=s(null),r=s(!1),d=()=>(r.value=!1,setTimeout((()=>{l.value.hide()}),400),!0),C=()=>{t.handleLogin({username:i.value}).then((()=>{location.reload(),d()}))};return n((()=>{i.value=null,o.value=null,setTimeout((()=>{r.value=!0}),200)})),(e,t)=>(u(),c(de,{ref_key:"tMaskDom",ref:l,bgColor:a.bgColor,maskClickHide:a.maskClickHide,destroy:a.destroy,close:d},{default:h((()=>[m("div",{class:v(["login-box",{animated:r.value}]),onClick:t[2]||(t[2]=p((()=>{}),["stop"]))},[ce,m("div",he,[g(y(f),{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:"login-box-input"},{prepend:h((()=>[m("div",null,[g(y(w),{class:"input-icon"},{default:h((()=>[g(y(b))])),_:1})])])),_:1},8,["modelValue"])]),m("div",me,[g(y(f),{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),class:"login-box-input",type:"password","show-password":""},{prepend:h((()=>[m("div",null,[g(y(w),{class:"input-icon"},{default:h((()=>[g(y(x))])),_:1})])])),_:1},8,["modelValue"])]),ve,m("div",pe,[g(y(D),{onClick:C},{default:h((()=>[E("登录")])),_:1})])],2)])),_:1},8,["bgColor","maskClickHide","destroy"]))}},[["__scopeId","data-v-5bef5db2"]]);let ye=!1,fe=null;const we=e=>{e=Object.assign({maskClickHide:!0},e);const t=oe();return new Promise((a=>{t?a():(a("unLogin"),(e=>{const{publicStore:t}=Lt(),a=t.rootDom;let l=document.createElement("div");a.appendChild(l),ye&&(fe&&T(null,l),ye=!1),Object.assign(e,{destroy:()=>{fe&&(T(null,l),a.removeChild(l)),ye=!1}}),fe=g(ge,Object.assign({isShow:!0},e)),T(fe,l),ye=!0})(e))}))};const be=e=>(C("data-v-e3e5d7ac"),e=e(),k(),e),xe={class:"nav-bar-body"},De={class:"logo-area"},Ee=["src"],Ce=be((()=>m("div",{class:"router-link-area"},null,-1))),ke={class:"handle-area"},Te={class:"user-phone-no"},Ie={class:"user-profile-image"},_e=[be((()=>m("span",null,"退出",-1)))],Le=[be((()=>m("span",null,"登录",-1)))];var Se=re({__name:"navBar",setup(e){const{userStore:t,publicStore:a}=Lt();I(),_(),s([]),s("ImageGenerationImage"),s(""),s(!1);const l=s(!1),o=()=>{t.handleLogout().then((()=>{}))};return n((()=>{a.setColorScheme().then((()=>{l.value="dark"===a.colorScheme}))})),(e,a)=>(u(),i("div",xe,[m("div",De,[m("img",{src:y("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAABSCAYAAAD6vuL9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFwmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyNC0wNi0xM1QwMDowMjoyMCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDgtMThUMjI6MTQ6NTQrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDgtMThUMjI6MTQ6NTQrMDg6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTlhYjU5ZGQtMmE4ZC0wZDRlLWEzN2ItZTFmN2E5ZWY0NmQ1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjE4QUY0REY0N0NCOTExRUU5Q0NBRDE2OEQ4QjU4NEZGIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjE3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjI3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiLz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTlhYjU5ZGQtMmE4ZC0wZDRlLWEzN2ItZTFmN2E5ZWY0NmQ1IiBzdEV2dDp3aGVuPSIyMDI0LTA4LTE4VDIyOjE0OjU0KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjUuMyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+pe30uAAABWVJREFUeJztnOFx4zYQhd+mAncQugO7gtAVxK4gSgXWVWC5Al8qoFOBfBXQqUDugE4FdAcvP0COKVgkARALUHN5Mzd3Q/GAp4/c5YJcCiTR/1mDSJYkaxodSP6R2xMADDmRPN6Q2VgxAGarIllk9rcucCQvSD6MALP1lAvgqsCRvCfZOkLr1TBD+K4CHI/zWKgaklcJPecDR5PH9guB2aqYIHyzgONnHmsjQxvqQe0LIAM4khuasEqhhkr5Lxk4mrOsTgTM1oGRw5cWuF9iDm5pA6BUHH9KVwAaKuY/TXC/K47tqg2Amgr5TxPcWlQA2DFy/vsZwPUqADzTlEPF0sF+JnC9bhEh/3mDo1km7WmumLehE69AG5j8Fxa+dCxHaJZJhxOX/nJk/zpedaGuhuTkxYy+5Qi72z0AapjLvK0UC+43AK8A3pXGLwC80CN8R8GxWyYBOCBfPQYAjyJyLSI3AK4BPCrOtYHJfw+zAHkiVGmWSa3jaV6NjFtHCKGXkbELks8Rxp9Sw0H+41So8jMsKwAXTsdIV2+nNorIu4hsANxAN3yfO4CF/aEdqhXyhqWt36Y+FJFXEbkE8Cd0AX6JKhtcqTR5qEqS27mdROQZ5uz7S8uHveEcCuAnOlT7XfhuAVwC+Fvb1DmAAzyq/UH+0wzfswHXawPHal9Enrv89w0KAM8NHHB8tXMB+B0m/0UNX01wH4pjA58AfcL3EmYFslia4H4ojj3UBo7VfgfwBjHyn1URh6ieGHsXOGaoGnrc7ej8tY5jjz+sCTTbzphLsTyy1dDxYbWHv+jgSIejzLSPCXtVdLzbQQNwzF9DJXCth8HthEEtOT+s4ekDfEslcKRHfmG+8HX1d0ED8J7djVoqgutV0S886kjzuurg6s/yqg6u15OrQa48/6UGR+qWB7H8OeU/JgY3NFg6Glxl/mMmcL0qxikPtLQf88fM4HotLQ+0VdECyBlwdUJzDf3Kg6zLN86AyxEeDf3CN0f+K+jSWEhzdJvEBiu6AywT+6vp2pHJPEe35Xrznxs4C+AhkbleDf2Wb98TePIDl+no9tpzPfkvDNzAYOqrG+mX/7QO8DJwiY7uKTX0W75tGRfgcnADc1eRzbmo4Uwvm9IBngbXTXZPj25LrqS6nwG41N9kAXxr7dzQ7+qWI/890AEgl8ObBDc2cO1ibmBwlfmPJjJCNQluThXzX92m1HDi6RbNmrcNHHsRuN7c1gVeRoBPE34OgWMuBter4bofzpz0xvA7QEeslrRAFAjr3XhZMKePSs3BY/SObGB6N54cAd5BuXcthWI23Wzh37v2CP2uJhXF7lYq8Nm7Vs7tLCI7mHcX1FtPY0urzauAOft889+7kp/o0u7I3OCzd+1iascOYB++q5cN7lVpnh2Ag2P+2yn6CNWbvcEGp/2iRZ//ipl9/1XyEKJ3AHf2xiNwicKlwHzr/a+K87vqA4bDtYi8f/l0WA1b21NU+y2thzN0/4GqOS15OW9PnwfSIxOluFnZ0HyhmPOMgdtP/J+a4y8u+y25ROQt0YtmZfe3tv45se0DwDcRuRGRV6dROHPGWfvmulkZopNnXPc9djRnd9v9+8KHE8/sYY2vRsGFiDHujgyq/TucUbUfU4tWDiLykiD/rVJRllyDF23PbrEeqmhr1Uw3K6f0qjo6Ay4OjuPmeNbQq6Hy78epgRtMuGO6TvKWjuVFwPdIC66bNEX5UmkAG3yH9OAGkxeMH741HV8FWOg9H7iBiRj5r2HCH1JeBbiBmZDlW0ulPDbjdT3gOkM++W/P/3/r/IuxktNNP2Vmf+sE14vH+a+lR5+KplYPrleukByTDe4/cYMrGGs5S3oAAAAASUVORK5CYII=")},null,8,Ee),E(" Teart ")]),Ce,m("div",ke,[m("div",Te,L(y(t).token?y(t).user:null),1),m("div",{class:"line",style:r({opacity:Number(Boolean(y(t).token))})},null,4),m("div",Ie,[y(t).token?(u(),i("img",{key:0,src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})):d("",!0)]),y(t).token?(u(),i("div",{key:0,class:"logout-btn",onClick:o},_e)):d("",!0),y(t).token?d("",!0):(u(),i("div",{key:1,class:"logout-btn",onClick:a[0]||(a[0]=e=>we())},Le))])]))}},[["__scopeId","data-v-e3e5d7ac"]]);const Ae="bi-arrow-left-circle",Oe="bi-arrow-repeat",Re="bi-eye",Me="bi-plus",Pe="bi-save",ze="bi-sliders",Ue="bi-trash",Ne="bi-x-circle",Ge="bi-back";const je={class:"loading-body"},He={class:"loading-animation-area"},Ye={class:"rainbow-text"};var Ve=re({__name:"tToading",setup(e,{expose:t}){const a=s(!1),l=s(!1),o=Array(8).fill("🌿");n((()=>{setTimeout((()=>{document.getElementById("main-inner").style.display="none",a.value=!0,setTimeout((()=>{l.value||(l.value=!0,document.getElementById("main-inner").style.display="block")}),300)}))}));return t({close:()=>(l.value=!1,new Promise((e=>{setTimeout((()=>{a.value=!1,setTimeout((()=>{e()}),300)}),300)})))}),(e,t)=>(u(),c(O,{to:"body"},[m("div",je,[m("div",He,[m("div",{class:v(["loading-left",{animate:a.value}])},null,2),m("div",{class:v(["loading-top",{animate:a.value}])},null,2),m("div",{class:v(["loading-right",{animate:a.value}])},null,2),m("div",{class:v(["loading-bottom",{animate:a.value}])},null,2)]),m("div",{class:"loading-inner",style:r({opacity:Number(l.value)})},[m("div",Ye,[(u(!0),i(A,null,S(y(o),((e,t)=>(u(),i("span",{key:t,style:r({animationDelay:t/8+"s"})},L(e),5)))),128))])],4)])]))}},[["__scopeId","data-v-095e7140"]]);const Be=e=>{let t=!1,a=null;const{publicStore:l}=Lt(),s=l.rootDom;let n=document.createElement("div");return s.appendChild(n),t&&(a&&T(null,n),t=!1),a=g(Ve,e),T(a,n),t=!0,{close:()=>{t&&a&&a.component.exposed.close().then((()=>{T(null,n),s.removeChild(n),a=null,t=!1}))}}};const Xe={class:"menu-icon"},We=(e=>(C("data-v-cc79abaa"),e=e(),k(),e))((()=>m("div",{class:"menu-name"},"收起面板",-1))),Fe={class:"menu-all"},$e=["onClick"],Je={class:"menu-icon"},Ze={class:"menu-name"};var Qe=re({__name:"leftBar",setup(e){const{publicStore:t}=Lt();s(t.routePath);const a=_(),l=I(),o=s([]),r=s(null),d=s(0);n((()=>{r.value=a.path,o.value=[{path:"/main",name:"模板仓库",includes:["/main","/generateImage"],icon:"bi-window-stack"},{path:"/modelMainEditor",name:"编辑模板",includes:["/modelEditor","/modelMainEditor"],icon:"bi-pencil-square"},{path:"/promptSetting",name:"参数设置",includes:["/promptSetting"],icon:ze},{path:"/gallery",name:"作品仓库",includes:["/gallery"],icon:"bi-folder2"}]}));return(e,s)=>(u(),i("div",{class:v(["left-bar-body",{expand:d.value}])},[m("div",{class:"menu-title",onClick:s[0]||(s[0]=e=>(d.value=Number(!d.value),void t.setLeftBarShowType(d.value)))},[m("div",Xe,[m("i",{class:v(["bi icon",y("bi-house-door")])},null,2)]),We]),m("div",Fe,[(u(!0),i(A,null,S(o.value,((e,s)=>(u(),i("div",{class:v(["menu-item",{selected:e.includes.findIndex((e=>e===y(t).routePath))>=0}]),key:s,onClick:t=>(({path:e})=>{a.path!==e&&we().then((()=>{window.loading=Be(),setTimeout((()=>{l.replace(e)}),300),r.value=e}))})(e)},[m("div",Je,[m("i",{class:v(["bi icon",e.icon])},null,2)]),m("div",Ze,L(e.name),1)],10,$e)))),128))])],2))}},[["__scopeId","data-v-cc79abaa"]]);const qe={class:"welcome-main-image"},Ke=["src"],et=["src"],tt={class:"welcome-carousel-area"},at={class:"carousel-image"};var lt=re({__name:"welcomePopup",setup(e){const t=s(!1),a=s(!1),l=()=>{localStorage.setItem("lastShownWelcomePopup",(new Date).toISOString()),a.value=!1,setTimeout((()=>{t.value=!1}),200)};return n((()=>{we().then((e=>{"unLogin"!==e&&((()=>{const e=localStorage.getItem("lastShownWelcomePopup");if(!e)return!1;const t=new Date(e),a=new Date;return t.toDateString()===a.toDateString()})()||(t.value=!0,R((()=>{a.value=!0}))))}))})),(e,s)=>{const n=M("el-image"),o=M("el-carousel-item"),r=M("el-carousel");return t.value?(u(),i("div",{key:0,class:"welcome-popup-body",onClick:s[1]||(s[1]=e=>l())},[m("div",{class:v(["welcome-popup show_start",{show_end:a.value}]),onClick:s[0]||(s[0]=p((()=>{}),["stop"]))},[m("div",qe,[m("img",{src:y("/assets/welcome.3e60bcd4.png")},null,8,Ke),m("img",{src:y("/assets/welcomeName.da89995f.png")},null,8,et),E(" 智慧平面设计 ")]),m("div",tt,[g(r,{trigger:"click",height:"20rem",arrow:"never"},{default:h((()=>[(u(),i(A,null,S(4,(e=>g(o,{key:e},{default:h((()=>[m("div",at,[g(n,{style:{height:"20rem"},fit:"cover",src:y("/assets/test.aae36215.png")},null,8,["src"])])])),_:2},1024))),64))])),_:1})]),m("div",{class:"everyday-tips-btn",onClick:l}," 每日Tips ")],2)])):d("",!0)}}},[["__scopeId","data-v-0eadc72e"]]);const st={class:"home-body"},nt={id:"main-inner"};var it=re({__name:"index",setup(e){const{publicStore:t}=Lt(),a=_();return(e,l)=>{const s=M("el-aside"),n=M("router-view"),o=M("el-main"),r=M("el-container");return u(),i("div",st,[g(Se),g(r,{class:"home-child-view"},{default:h((()=>[g(s,{class:"aside"},{default:h((()=>[g(Qe)])),_:1}),g(o,{class:"main"},{default:h((()=>[m("div",nt,[(u(),c(n,{key:a.path,class:v({expand:y(t).leftBarShowType})},null,8,["class"]))])])),_:1})])),_:1}),g(lt)])}}},[["__scopeId","data-v-efcd984e"]]);const ot={},rt=e=>(C("data-v-4b07d3ea"),e=e(),k(),e),dt={class:"cloud-body"},ut={class:"cloud-info"},ct=rt((()=>m("div",{class:"error-title"}," 404 ",-1))),ht=rt((()=>m("div",{class:"error-sub-title"}," 未找到当前地址 ",-1)));var mt=re(ot,[["render",function(e,t){const a=M("el-result");return u(),i("div",dt,[m("div",ut,[g(a,{icon:"error",style:{"--el-result-icon-font-size":"3rem"}},{title:h((()=>[ct])),"sub-title":h((()=>[ht])),_:1})])])}],["__scopeId","data-v-4b07d3ea"]]);function vt(e){return Et.post(`/teai/query_templates?template_type=${e}`)}function pt(e,t){return Et.post(`/teai/query_template?template_type=${e}&template_name=${t}`)}function gt(e,t,a,l){return Et.post(`/teai/upload_template?template_type=${t}&template_name=${a}&preview=${l}`,e)}function yt(e,t){return Et.post(`/teai/delete_template?template_type=${e}&template_name=${t}`)}const ft={class:"main-body"},wt={class:"module-list"};const bt=[{path:"/",name:"home",component:it,redirect:"/main",children:[{path:"main",name:"main",component:re({__name:"index",props:["class"],setup(e){const t=e,a=I(),l=s({}),o=()=>{vt("layouts").then((e=>{l.value=e.templates}))};return n((()=>{we().then((()=>{o()})),window.loading||(window.loading=Be()),setTimeout((()=>{window.loading.close(),window.loading=null}),300)})),(e,s)=>{const n=M("modelCard"),r=M("el-scrollbar");return u(),i("div",ft,[m("div",wt,[g(r,null,{default:h((()=>[(u(!0),i(A,null,S(Object.keys(l.value),(e=>(u(),c(n,{class:v(t.class),key:e,data:{name:e,preview:l.value[e].preview},onToUpdate:()=>{(({name:e})=>{window.loading=Be(),setTimeout((()=>{a.replace({path:"modelEditor",query:{file_name:e}})}),300)})({name:e,preview:l.value[e].preview})},onDeleteItem:()=>{(({name:e})=>{yt("layouts",e).then((e=>{o()}))})({name:e})},"need-go-handle":"",onGoHandle:()=>{var t;t=e,window.loading=Be(),setTimeout((()=>{a.replace({path:"generateImage",query:{file_name:t}})}),300)}},null,8,["class","data","onToUpdate","onDeleteItem","onGoHandle"])))),128))])),_:1})])])}}},[["__scopeId","data-v-436dcb2a"]])},{path:"modelEditor",name:"modelEditor",component:()=>ee((()=>import("./index.dab82679.js")),["assets/index.dab82679.js","assets/lib.ecb25fce.js","assets/lib.4ea63656.css"])},{path:"modelMainEditor",name:"modelMainEditor",component:()=>ee((()=>import("./index.dab82679.js")),["assets/index.dab82679.js","assets/lib.ecb25fce.js","assets/lib.4ea63656.css"])},{path:"generateImage",name:"generateImage",component:()=>ee((()=>import("./index.895be44a.js")),["assets/index.895be44a.js","assets/lib.ecb25fce.js","assets/lib.4ea63656.css"])},{path:"promptSetting",name:"promptSetting",component:()=>ee((()=>import("./index.91d2996d.js")),["assets/index.91d2996d.js","assets/index.2a9c17da.css","assets/lib.ecb25fce.js","assets/lib.4ea63656.css"])},{path:"gallery",name:"gallery",component:()=>ee((()=>import("./index.90748fd6.js")),["assets/index.90748fd6.js","assets/index.98273013.css","assets/lib.ecb25fce.js","assets/lib.4ea63656.css"])},{path:"404",name:"404",component:mt}]}],xt=P({history:z("/"),routes:bt});let Dt=[];bt.forEach((e=>{e.children&&e.children.length?Dt=Dt.concat(e.children.map((t=>`${"/"!==e.path?e.path:""}/${t.path}`))):Dt.push(e.path)})),xt.beforeEach(((e,t,a)=>{const{publicStore:l}=Lt();if(!Dt.find((t=>t===e.path))&&"/main"!==e.path)return l.setRoutePath("/404"),void a("/404");const s=oe();return"/main"===e.path||"/404"===e.path||s?(l.setRoutePath(e.path),void a()):(l.setRoutePath("/main"),void a("/main"))}));const Et=U.create({baseURL:"https://u248120-a5f1-770998cc.westb.seetacloud.com:8443",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function Ct(e){if(!e.response)return N.error({message:"请求超时"}),Promise.reject(e);300===e.response.status&&N.error({message:"文件或文件夹已存在"}),oe();const t=e.response.status,a=e.response.data,{userStore:l}=Lt();return 401===t?(N.error({message:"登录失效, 请重新登陆"}),l.handleLogout().then((()=>{setTimeout((()=>{xt.replace("/main")}),1500)}))):400===t||500===t?N.error({message:a.message}):403===t&&N.error({message:"无权限操作"}),Promise.reject(e)}Et.interceptors.request.use((e=>{const t=oe()||"22";return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e}),Ct),Et.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),Ct);const kt=a({id:"users",state:()=>({user:ne()||"***********",permissions:null,root:localStorage.getItem("root")||"",token:oe()||"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((t,a)=>{var s,n;this.token="TEST TOKEN",this.user=e.username,this.root="TEST ROOT",ie(this.user),s=this.token,l.set(se,s,{expires:1}),n=this.root,localStorage.setItem("root",n),t()}))},handleLogout(e=""){return new Promise(((e,t)=>{l.remove(se),localStorage.removeItem(le+"USER"),this.user=null,this.permissions=null,this.token="",ie(null),e(null)}))}}});const Tt={"./modules/public.js":ae,"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:kt,setupStore:function(e){return kt(e)}},Symbol.toStringTag,{value:"Module"}))},It=G(),_t={};function Lt(){return _t}Object.keys(Tt).forEach((e=>{const t=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];_t[`${t}Store`]=Tt[e].setupStore(It)}));const St={class:"view-body"},At={__name:"App",setup(e){const{publicStore:t}=Lt(),a=s(1920);s(1080);const l=s("rootDom"),o=()=>{const e=document.body.clientWidth;document.body.clientHeight,a.value=e;const t=a.value/50;document.documentElement.style.fontSize=`${t}px`,window.rootFont=t;const l=document.getElementById("theme-main");l&&l.parentNode.removeChild(l)};return n((()=>{document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.addEventListener("wheel",(function(e){(e.altKey||e.ctrlKey)&&(e.preventDefault(),e.stopPropagation())}),{passive:!1}),o(),window.onresize=()=>{o()},t.setRootDom(l.value)})),(e,t)=>{const a=M("RouterView");return u(),i("div",St,[m("div",{class:"view-body-info",id:"view-body-info",ref_key:"rootDom",ref:l},[g(a,{id:"main-view"})],512)])}}};if("undefined"!=typeof window){let e=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML="",e.insertBefore(t,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const Ot={key:0,class:"loading-area"},Rt={key:0};var Mt=re({__name:"tButton",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"Loading"}},setup(e){const t=e,a=s(!1),l=()=>{switch(t.type){case"info":return a.value=!1,"box-info";case"success":return a.value=!1,"box-success";case"error":return a.value=!1,"box-error";case"warn":return a.value=!1,"box-warn";case"text-success":return a.value=!0,"text-success";case"text-info":return a.value=!0,"text-info";case"text-warn":return a.value=!0,"text-warn";case"text-error":return a.value=!0,"text-error";default:return null}},n=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},c=()=>{switch(t.type){case"info":case"text-info":return"background:var(--t-info-hover-color)";case"success":case"text-success":return"background:var(--t-success-hover-color)";case"error":case"text-error":return"background:var(--t-error-hover-color)";case"warn":case"text-warn":return"background:var(--t-warn-hover-color)";default:return null}},h=()=>{const e={type:l(),size:n()};let t="";return Object.keys(e).forEach((a=>{e[a]&&(t+=`${e[a]} `)})),t};return(e,l)=>(u(),i("div",{class:v(`t-btn ${h()}`)},[m("div",{style:r(`opacity: ${Number(!a.value||a.value&&!t.loading)};`)},[o(e.$slots,"default",{},void 0,!0)],4),a.value&&t.loading?(u(),i("div",Ot,L(t.loadingText),1)):d("",!0),a.value?d("",!0):(u(),i("div",{key:1,class:v(["hover-area",{loading:t.loading}]),style:r(c())},[t.loading?(u(),i("div",Rt,L(t.loadingText),1)):d("",!0)],6))],2))}},[["__scopeId","data-v-071339ed"]]);var Pt=re({__name:"tTag",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"}},setup(e){const t=e,a=()=>{switch(t.type){case"info":default:return"box-info";case"success":return"box-success";case"error":return"box-error";case"warn":return"box-warn"}},l=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},s=()=>{const e={type:a(),size:l()};let t="";return Object.keys(e).forEach((a=>{e[a]&&(t+=`${e[a]} `)})),t};return(e,t)=>(u(),i("div",{class:v(`t-btn ${s()}`)},[o(e.$slots,"default",{},void 0,!0)],2))}},[["__scopeId","data-v-660ee02c"]]);const zt={class:"model-name"},Ut=(e=>(C("data-v-42820b3f"),e=e(),k(),e))((()=>m("div",{class:"model-handle-del-area-outer"},[m("div",{class:"model-handle-area"})],-1))),Nt={class:"model-handle-area-outer"};var Gt=re({__name:"modelCard",props:{data:{type:Object,default:()=>({preview:null,name:null})},class:{},needGoHandle:{type:Boolean,default:!1}},emits:["toUpdate","deleteItem","goHandle"],setup(e,{emit:t}){const a=t,l=e,n=s([]),o=s(!0),h=s("imageDom"),g=()=>{n.value=[]},f=()=>{j.confirm(`您将要删除"${l.data.name}"模板，是否继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{a("deleteItem")})).catch((()=>{N({type:"info",message:"取消删除"})}))};return(e,t)=>{const s=M("el-image");return u(),i("div",{class:v(["module-item",l.class])},[o.value?(u(),c(s,{key:0,ref_key:"imageDom",ref:h,"hide-on-click-modal":"",onClose:g,"preview-src-list":n.value,src:l.data.preview,class:"model-image",fit:"contain"},null,8,["preview-src-list","src"])):d("",!0),m("div",zt,L(l.data.name),1),Ut,m("div",Nt,[m("div",{class:"model-handle-area",style:r({width:l.needGoHandle?"3.6rem":"2.4rem"})},[m("div",{class:"handle-btn box-error",onClick:p(f,["stop"])},[m("i",{class:v(["bi icon",y(Ue)])},null,2)]),m("div",{class:"handle-btn box-warn",onClick:t[0]||(t[0]=e=>a("toUpdate"))},[m("i",{class:v(["bi icon",y("bi-pencil-square")])},null,2)]),l.needGoHandle?(u(),i("div",{key:0,class:"handle-btn box-main",onClick:t[1]||(t[1]=e=>a("goHandle"))},[m("i",{class:v(["bi icon",y("bi-play")])},null,2)])):d("",!0)],4)])],2)}}},[["__scopeId","data-v-42820b3f"]]);const jt="操作",Ht="绘制",Yt={NOMAL:"定位花",AGENT_X:"横向二方连续",AGENT_Y:"纵向二方连续",AGENT_F:"四方连续"},Vt="editor",Bt="explosion",Xt={statics:"静态层",prompts:"动态层",colors:"纯色层",texts:"文本层"};class Wt{constructor(e,t,a="",l=0){this.name=H(a),this.uuid=H(e),this.parentUuid=H(t),this.isShow=!0,this.children=[],this.zIndex=l}addChild(e){this.children.push(e)}changeParent(e){this.parentUuid=e}setData(e={}){Object.keys(e).forEach((t=>{this[t]=e[t]}))}hide(){this.isShow=!1}show(){this.isShow=!0}}const Ft={group:class extends Wt{constructor(e,t,a,l={}){super(e,t,a),this.prompts=l.prompts||null,this.statics=l.statics||null,this.colors=l.colors||null,this.texts=l.texts||null,this.type=l.type||null}},layer:class extends Wt{constructor(e,t,a,l={}){super(e,t,a),this.prompts=l.prompts||null,this.statics=l.statics||null,this.colors=l.colors||null,this.texts=l.texts||null,this.image=l.image||null,this.type=l.type||null,this.tileType=l.tileType||null,this.fontSetting=l.fontSetting||{content:"默认文本",font:"",fontFamily:"",font_color:[255,255,255,1],font_size:16}}},element:class extends Wt{constructor(e,t,a,l={}){super(e,t,a),this.x=l.x,this.y=l.y,this.width=l.width,this.height=l.height,this.image=l.image,this.rotate=l.rotate||0,this.type=l.type||null,this.tileType=l.tileType||null,this.lightness=l.lightness||0,this.opacity=l.opacity||1,this.xOverturn=l.xOverturn||!1,this.yOverturn=l.yOverturn||!1,this.colorGradation=l.colorGradation||1,this.hue=l.hue||1,this.saturation=l.saturation||1,this.fontSetting=l.fontSetting||{content:"默认文本",font:"",fontFamily:"",font_color:[255,255,255,1],font_size:16},this.color=l.color||[0,0,0,1],this.virtuallyElements=l.virtuallyElements||[]}}},$t={group:{parentType:null,childrenType:"layer"},layer:{parentType:"group",childrenType:"element"},element:{parentType:"layer",childrenType:null}};class Jt{constructor(){this.groups=H({}),this.layers=H({}),this.elements=H({}),this.showMap=H({groups:new Set,layers:new Set}),this.selectedMap=H({group:null,layer:null,element:null})}add(e,t,a,l={},s=null,n=null){const i=Ft[e],o=this.findParent(t),r=this[`${e}s`];if(!i)throw new Error(`Unknown type: ${e}`);if(s){if(r[s]=new i(s,t,a,l),t)o&&(o.addChild(s),r[s].zIndex=n||o.children.length);else{const e=this.getAllList();r[s].zIndex=n||e.length}if("element"===e){const e=this.findParent(t);a=`${e.name}-${e.children.length+1}`,l=Object.assign(l,{image:e.image,type:e.type})}}else{if(s=Y(),"element"===e){const e=this.findParent(t);a=`${e.name}-${e.children.length+1}`,l=Object.assign(l,{image:e.image,type:e.type})}if(r[s]=new i(s,t,a,l),t)o&&(o.addChild(s),r[s].zIndex=n||o.children.length);else{const e=this.getAllList();r[s].zIndex=n||e.length+1}"layer"===e&&"colors"===l.type&&(a=`${a}`,this.add("element",s,a,Object.assign({width:100,height:100,x:0,y:0},l)),this.reDraw()),"layer"===e&&"statics"===l.type&&l.tileType&&(a=`${a}`,this.add("element",s,a,Object.assign({width:100,height:100,x:0,y:0},l)),this.reDraw())}return s}setData(e,t,a={}){if(this[`${e}s`][t].setData(a),"layer"===e&&a.image){this.findData(e,t).children.forEach((e=>{this.setData("element",e,{image:a.image})}))}}delete(e,t){const a=this.findData(e,t);if(!a)return;const l=a.children;l.length&&l.forEach((t=>{this.delete($t[e].childrenType,t)}));const s=this[`${e}s`];if(a.parentUuid){const l=this.findParent(a.parentUuid,`${$t[e].parentType}s`);l.children=l.children.filter((l=>{const s=this.findData(e,l);return s.zIndex>a.zIndex&&(s.zIndex-=1),l!==t})),"group"===$t[e].parentType&&1===l.children.length&&this.unbindGroup({type:"layer",uuid:l.children[0]})}this.selectedMap[e]===t&&this.selectedMap[e],this.reDraw(),a&&a.tileType&&"element"===e&&this.delete("layer",a.parentUuid),delete s[t]}handleIsShow(e,t,a="show"){const l=this.findData(e,t);if(!l)return;const s=l.children;if(s.length?s.forEach((t=>{this.handleIsShow($t[e].childrenType,t,a)})):l[a](),l.parentUuid){const t=this.findData($t[e].parentType,l.parentUuid);t.children.every((t=>this.findData(e,t).isShow===("show"===a)))?t[a]():t.show()}this.reDraw()}findParent(e,t=""){for(const a of t?[t]:["groups","layers","elements"]){const t=this[a];if(t[e])return t[e]}return null}findData(e,t){return this[`${e}s`][t]}handleShowMap(e,t){this.showMap[`${e}s`].has(t)?this.showMap[`${e}s`].delete(t):this.showMap[`${e}s`].add(t)}isShowMapShow(e,t){return this.showMap[`${e}s`].has(t)}changeSelected(e){for(let t in e){t=Number(t);const a=e[t],l=Object.keys($t)[t];this.selectedMap[l]=a}this.reDraw()}isSelected(e,t){return this.selectedMap[e]===t}bindGroup({fromData:e,toData:t,zIndex:a}){if(e.uuid!==t.uuid){if(a||0===a){const a=this.findData(e.type,e.uuid),l=this.findData(t.type,t.uuid);if(a.parentUuid!==l.parentUuid)return;const s=a.zIndex,n=l.zIndex,i=this.getListByParentUuid(a.parentUuid);s>n?(i.forEach((e=>{const{dataType:t,uuid:a,zIndex:l}=e;l<s&&l>=n&&(this[`${t}s`][a].zIndex+=1)})),a.zIndex=n):(i.forEach((e=>{const{dataType:t,uuid:a,zIndex:l}=e;l<=n&&l>s&&(this[`${t}s`][a].zIndex-=1)})),a.zIndex=Math.min(n,i.length))}else{if("group"===e.type)return;const a=this.findData(e.type,e.uuid),l=this.findData(t.type,t.uuid);if("group"===t.type){if(!new Set(l.children).has(a.uuid)){if(!this.bindGroupCheck([e.uuid,l.children[0]]))return;if(l.addChild(a.uuid),a.parentUuid){const t=this.findParent(a.parentUuid);a.changeParent(l.uuid),a.zIndex=l.children.length,t.children=t.children.filter((t=>{const l=this.findData("layer",t);return l.zIndex>e.zIndex&&(l.zIndex-=1),t!==a.uuid}))}else{const t=this.getListByParentUuid(a.parentUuid);a.changeParent(l.uuid),a.zIndex=l.children.length,t.forEach((({dataType:t,uuid:a})=>{const l=this.findData(t,a);l.zIndex>e.zIndex&&(l.zIndex-=1)}))}}}else{const s=this.bindGroupCheck([e.uuid,t.uuid]);if(!s)return;const n=Object.assign({texts:[],statics:[],prompts:[],colors:[]},{[s.type]:s.typesInfo});let i=null;if(l.parentUuid){i=l.parentUuid;const t=this.findData("group",i);if(a.parentUuid)this.unbindGroup(e),a.changeParent(i),t.addChild(a.uuid),a.zIndex=t.children.length;else{this.getListByParentUuid(a.parentUuid).forEach((({dataType:e,uuid:t})=>{const l=this.findData(e,t);l.zIndex>a.zIndex&&(l.zIndex-=1)})),a.changeParent(i),t.addChild(a.uuid),a.zIndex=t.children.length}}else{i=this.add("group",null,`组-${Object.keys(this.groups).length+1}`,n);const t=this.findData("group",i);a.parentUuid&&this.unbindGroup(e),t.addChild(a.uuid),t.addChild(l.uuid),a.changeParent(i),l.changeParent(i),t.zIndex=l.zIndex,a.zIndex=2,l.zIndex=1}}}this.reDraw()}}unbindGroup(e){const{uuid:t,type:a}=e;if("group"===a)return;const l=this.findData(a,t);if(!l.parentUuid)return;const s=this.findParent(l.parentUuid);s.children=s.children.filter((e=>{const t=this.findData("layer",e);return t.zIndex>l.zIndex&&(t.zIndex-=1),e!==l.uuid})),0===s.children.length&&(this.delete("group",s.uuid),l.changeParent(null),l.zIndex=s.zIndex),1===s.children.length?(l.changeParent(null),l.zIndex=this.getAllList().length,this.unbindGroup({type:"layer",uuid:s.children[0]})):s.children.length>1&&(l.changeParent(null),l.zIndex=this.getAllList().length),this.reDraw()}getListByParentUuid(e){const t=[];return Object.keys($t).forEach((a=>{Object.keys(this[`${a}s`]).forEach((l=>{const s=this[`${a}s`][l];e===s.parentUuid&&(t[s.zIndex-1]=Object.assign({dataType:a},s))}))})),t}bindGroupCheck(e){let t=new Set,a=new Set,l=!0;return e.forEach(((e,s)=>{t.add(this.layers[e].type);const n=this.layers[e],i=n.type,o=new Set(n[i]);if(0===s)a=o;else{if(o.size!=o.size)return void(l=!1);for(let e of a)o.has(e)||(l=!1)}})),!([...t].length>1)&&(!!l&&{type:[...t][0],typesInfo:[...a]})}clearAllData(){this.groups={},this.layers={},this.elements={},this.showMap={groups:new Set,layers:new Set},this.selectedMap={group:null,layer:null,element:null}}getData(){return{groups:this.groups,layers:this.layers,elements:this.elements}}getAllList(){const e=Object.keys(this.groups).map((e=>({type:"group",uuid:e,zIndex:this.groups[e].zIndex}))),t=Object.keys(this.layers).filter((e=>!this.layers[e].parentUuid)).map((e=>({type:"layer",uuid:e,zIndex:this.layers[e].zIndex}))),a=[].concat(e,t),l=[];return a.forEach((e=>{const{zIndex:t}=e;l[t-1]=e})),l}copyData(e,t,a){const l=this.findData(t,e),s=l.image;a=a||l.parentUuid;const n=JSON.parse(JSON.stringify(l));n.parentUuid=null,s&&(n.image=s),!n.tileType&&"element"===t&&n.x&&n.y&&(n.x+=100,n.y+=100);const i=this.add(t,a||null,`${l.name}-${Math.round(1e3*Math.random())}`,n),o=this.findData(t,i);if(o.children=[],o.zIndex=null,l.children.length&&l.children.forEach((e=>{this.copyData(e,$t[t].childrenType,i)})),a){this.findData($t[t].parentType,a).addChild(i)}this.getListByParentUuid(a).forEach((e=>{const t=this.findData(e.dataType,e.uuid);"element"!==e.dataType?t.zIndex>=l.zIndex&&(t.zIndex+=1):t.zIndex>l.zIndex&&(t.zIndex+=1)})),o.zIndex="element"!==t?l.zIndex-1:l.zIndex+1,this.reDraw()}}class Zt{constructor(){this.listeners={}}addListener(e,t,a){e.addEventListener(t,a);const l=Y();return this.listeners[l]={element:e,eventType:t,listener:a},l}removeListenersByEventType(e){const{listeners:t}=this;Object.keys(t).filter((a=>t[a].eventType=e)).forEach((e=>{this.removeListenter(e)}))}removeAllListeners(){for(var e in this.listeners)this.removeListenter(e);this.listeners={}}removeListenter(e){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener),delete this.listeners[e]}}const Qt="edit",qt="generate",Kt={EFFECT:"效果调节",UPLOAD:"上传替换",TEXT_EDIT:"文本编辑",COLOR_EDIT:"颜色编辑",LAYER_EDIT:"图层编辑",GENERATE:"AI图生图",REPEAT:"重新生成",ELEMENT_DELETE:"删除元素",LAYER_DELETE:"删除图层",GROUP_DELETE:"删除组",COPY_ELEMENT:"复制元素",COPY_LAYER:"复制图层",COPY_GROUP:"复制组"};class ea{constructor(e=Qt){this.handelType=e,this.x=0,this.y=0,this.layerType=null,this.isShow=!1,this.dom=null,this.bindDom=null,this.isHasImage=!1,this.tileType=null}setHandle({uuid:e,type:t,tileType:a},{x:l,y:s},n,i=!1,o=document.body,r=null){return this.close(),this.bindDom=o,this.isHasImage=i,this.tileType=a,new Promise((a=>{this.x=l,this.y=s,this.handleUuid=e,this.elementType=t,this.layerType=n,this.createDom(r).then((e=>{a(e)}))}))}close(){this.isShow=!1,this.x=0,this.y=0,this.layerType=null,this.dom&&(this.bindDom.removeChild(this.dom),document.documentElement.onClick=()=>{},this.dom=null)}createDom(e=null){return new Promise((t=>{const a=document.createElement("div");a.className="editor-contextmenu-view",this.bindDom.appendChild(a),this.dom=a,document.documentElement.onclick=this.close.bind(this),this.createList(e).then((e=>{t(e)}))}))}createList(e=null){const t=this.getHandleList(this.type,this.elementType),{x:a,y:l,dom:s,bindDom:n}=this,i=(1.2*t.length-.2)*window.rootFont,o=n.getBoundingClientRect();let r=l+i>o.bottom?o.bottom-i-o.top:l-o.top;return s.style.top=`${r}px`,s.style.left=a-o.left+"px",new Promise((a=>{t.forEach((t=>{this.dom&&this.createItem(t,e).then((e=>{a(e)}))})),setTimeout((()=>{this.dom&&(this.dom.style.height=1.2*t.length-.2+"rem")}))}))}createItem({name:e,icon:t,type:a="button"},l=null){const{handleUuid:s}=this;return new Promise((n=>{const i=document.createElement("div");i.className="editor-contextmenu-item";const o=document.createElement("i");o.className="editor-contextmenu-item-icon",o.className=`editor-contextmenu-item-icon bi ${t}`;const r=document.createElement("div");if(r.className="editor-contextmenu-item-name",r.innerText=e,i.appendChild(o),i.appendChild(r),"upload"===a){const t=document.createElement("input");t.type="file",i.appendChild(t),t.onclick=e=>{e.stopPropagation()},t.onchange=t=>{t.stopPropagation();const{target:a}=t;n({file:a.files[0],handleUuid:s,name:e}),this.close()}}else i.onclick=t=>{t.stopPropagation(),n({handleUuid:s,name:e}),this.close()};this.dom.appendChild(i),("texts"===l&&e===Kt.TEXT_EDIT||"prompts"===l&&e===Kt.GENERATE)&&i.click()}))}getHandleList(e=Qt){let t=[];e=e||this.handelType;const{isHasImage:a,elementType:l,layerType:s,tileType:n}=this;switch(s){case"element":switch(e){case Qt:if(t=a?[{name:Kt.EFFECT,icon:ze,type:"button"},{name:Kt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Kt.COPY_ELEMENT,icon:Ge,type:"button"},{name:Kt.GENERATE,icon:"bi-stars",type:"button"},{name:Kt.REPEAT,icon:Oe},{name:Kt.ELEMENT_DELETE,icon:Ue,type:"button"}]:[{name:Kt.EFFECT,icon:ze,type:"button"},{name:Kt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Kt.COPY_ELEMENT,icon:Ge,type:"button"},{name:Kt.REPEAT,icon:Oe},{name:Kt.ELEMENT_DELETE,icon:Ue,type:"button"}],"texts"===l){const e=t.findIndex((({name:e})=>e===Kt.UPLOAD));t.splice(e,1,{name:Kt.TEXT_EDIT,icon:"bi-pencil-square",type:"button"})}else if("colors"===l){const e=t.findIndex((({name:e})=>e===Kt.UPLOAD));t.splice(e,1,{name:Kt.COLOR_EDIT,icon:"bi-pencil-square",type:"button"})}break;case qt:t=a?[{name:Kt.EFFECT,icon:ze,type:"button"},{name:Kt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Kt.GENERATE,icon:"bi-stars",type:"button"},{name:Kt.REPEAT,icon:Oe},{name:Kt.ELEMENT_DELETE,icon:Ue,type:"button"}]:[{name:Kt.UPLOAD,icon:"bi-upload",type:"upload"},{name:Kt.REPEAT,icon:Oe},{name:Kt.ELEMENT_DELETE,icon:Ue,type:"button"}]}break;case"layer":t=[{name:Kt.LAYER_EDIT,icon:"bi-pencil-square",type:"button"},{name:Kt.COPY_LAYER,icon:Ge,type:"button"},{name:Kt.LAYER_DELETE,icon:Ue,type:"button"}];break;case"group":t=[{name:Kt.GROUP_DELETE,icon:Ue,type:"button"},{name:Kt.COPY_GROUP,icon:Ge,type:"button"}]}if(n){const e=t.findIndex((({name:e})=>e===Kt.COPY_ELEMENT));t.splice(e,1);const a=t.findIndex((({name:e})=>e===Kt.EFFECT));t.splice(a,1)}return t}}function ta(e,t,a){const l=e.split(";base64,"),s=l[0].split(":")[1],n=atob(l[1]);let i=n.length;const o=new Uint8Array(i);for(;i--;)o[i]=n.charCodeAt(i);const r=aa(e,t,a);return new File([r],`${t}${d=a||s,{"image/jpeg":".jpg","image/png":".png","image/gif":".gif","application/pdf":".pdf"}[d]||".bin"}`,{type:a||s,lastModified:Date.now()});var d}function aa(e,t,a){const l=e.split(";base64,"),s=l[0].split(":")[1],n=atob(l[1]);let i=n.length;const o=new Uint8Array(i);for(;i--;)o[i]=n.charCodeAt(i);return new Blob([o],{type:a||s})}function la(e){return new Promise((t=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{t(a)},a.src=e}))}function sa(e){return new Promise((t=>{(function(e){return new Promise((t=>{const a=new FileReader;a.onload=({target:e})=>{t(e.result)},a.readAsDataURL(e)}))})(e).then((e=>{la(e).then((e=>{t(e)}))}))}))}function na(e){return new Promise((t=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{t(a)},a.onerror=()=>[t(null)],a.src=e}))}function ia(e,t){const a=JSON.stringify(e),l=new Blob([a],{type:"application/json"});return new File([l],`${t}.json`,{type:"application/json",lastModified:Date.now()})}function oa(e){const t=e.match(/\d+/g);return t?t.map(Number):[]}function ra(e){return`rgba(${e.join(",")})`}const da="编辑器",ua="操作",ca="绘制",ha="定位花",ma="横向二方连续",va="纵向二方连续",pa="四方连续",ga={outerWidth:100,innerWidth:20};class ya{constructor(){this.rootFont=H(window.rootFont),this.realWidth=H(2048),this.realHeight=H(2048),this.name=H(""),this.canvasOuterDom=H(null),this.canvasDom=H(null),this.ctx=H(null),this.zoomRatio=H(1),this.handleState=H(ua),this.listeners=new Zt,this.startX=H(0),this.startY=H(0),this.isDrawing=H(!1),this.moveType=H(null),this.drawType=H(ha),this.handleController=H(null);const e=new Image;this.rotateImage=null,this.viewType="editor",e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAiJJREFUWAntWO1xwjAMZYSO0FEYgRE6AhuUDWADGKEblA3oBnQDRnj1y0kXoTp2bMf90YvvOH9Elp+eJEdhs1nbysDKQB8GALwA2Ib+BOAG4IGxcfwpz3Z9EExoFWDvDtAILT66h2XueZ1Qu8wygH0EGNm6hsMvAA7yI6tc841A35ZB47QAOLrTCGBHRp3o05SAJATs9uOTUOsEwNloJ2PFcSVAyaC2cyuuYb9jjslQHUfc69hsY1KsVosJLunOOYxIklGXtv2cfb9kxFp1Cftq5rxy0a3XEvtyw4N5vBa0LZ55kmCq/+CNyM4BKHvXrHClgFzmBFnGorNucfbUHnfOVtezfYgJXrRDywo3CEjCaCyeZqsy1Hdzr4IxZ910Ldub19l8q7Ja4wIho/mKZHvEJSKrsoFdeXZF9KWW5N09HBmVk5LJYEoOP6JKGhazAKnbxEESHY1pwBLdahJy2sWSTXrvTYHs4m5DTjoh3evHg+wCTrynZ+UTciIe05ZFHTdv0RUj80o4qZrVqkWLBA/buPfunyXnEri9wbHS1lYeQkycpBUNDyXeNSm7ElEMU24MW7B2K0ZqwPmSP5+5xadUbpAbQt3K2LtUqspvk0znPwdJ94g7+e8DZW3ry1wA9m1PEwCsIfXDnZ+pBKW1nopzXveRlOdtlBAg1l0KYKonMILvdjOM6MxISnb9m8OyxfFXAMRndPHfAjMY1+HKwL9n4AeVBVerk24KcAAAAABJRU5ErkJggg==",this.handleLocked=!1,e.onload=()=>{this.rotateImage=e},this.position={left:0,top:0}}init(e,t={},a=da){return new Promise((l=>{this.canvasOuterDom=e,this.name=t.name||null,this.realWidth=t.width||2048,this.realHeight=t.height||2048,this.viewType="editor",this.drawType=t.drawType||ha,this.position={left:0,top:0},this.getCanvasSize().then((e=>{this.canvasDom=document.createElement("canvas"),this.canvasDom.style.position="absolute",this.canvasDom.style.margin="auto",this.canvasDom.style.left=`${this.position.left}px`,this.canvasDom.style.top=`${this.position.top}px`,this.canvasDom.style.right="0",this.canvasDom.style.bottom="0",this.canvasDom.style.border="solid 0.05rem var(--t-main-color)",this.canvasDom.style.backgroundColor="var(--t-main-sub-color)",this.canvasDom.style.width=`${e.width}px`,this.canvasDom.style.height=`${e.height}px`,this.canvasDom.width=e.width,this.canvasDom.height=e.height,this.zoomRatio=e.zoomRatio,this.canvasOuterDom.focus(),this.handleState=ua,this.canvasOuterDom.appendChild(this.canvasDom),this.ctx=this.canvasDom.getContext("2d"),this.handleController=new ea(a),this.bindCanvasHandleListener(),l()}))}))}bindMainMove(){this.listeners.addListener(this.canvasDom,"mousedown",(e=>{this.handle("mousedown",e)})),this.listeners.addListener(this.canvasDom,"mousemove",(e=>{this.handle("mousemove",e)})),this.listeners.addListener(this.canvasDom,"mouseup",(e=>{this.handle("mouseup",e)})),this.listeners.addListener(this.canvasDom,"mouseleave",(e=>{this.handle("mouseleave",e)}))}unBindMove(){this.listeners.removeListenersByEventType("mousedown"),this.listeners.removeListenersByEventType("mousemove"),this.listeners.removeListenersByEventType("mouseup"),this.listeners.removeListenersByEventType("mouseleave")}bindHandleMove(){this.listeners.addListener(this.canvasOuterDom,"mousedown",(e=>{this.handle("mousedown",e)})),this.listeners.addListener(this.canvasOuterDom,"mousemove",(e=>{this.handle("mousemove",e)})),this.listeners.addListener(this.canvasOuterDom,"mouseup",(e=>{this.handle("mouseup",e)}))}bindCanvasHandleListener(){this.bindMainMove(),this.listeners.addListener(this.canvasDom,"click",(e=>{this.handle("selected",e)})),this.listeners.addListener(this.canvasDom,"dblclick",(e=>{this.handle("dblclick",e)})),this.listeners.addListener(this.canvasDom,"contextmenu",(e=>{this.handle("contextmenu",e)})),this.listeners.addListener(this.canvasOuterDom,"keydown",(e=>{this.handle("keydown",e)})),this.listeners.addListener(this.canvasOuterDom,"keyup",(e=>{this.handle("keyup",e)})),this.listeners.addListener(this.canvasOuterDom,"wheel",(e=>{const t={width:this.canvasDom.width,height:this.canvasDom.height,zoomRatio:this.zoomRatio};e.deltaY>0?(t.zoomRatio=Math.round(t.zoomRatio/11*10*1e4)/1e4,t.width=Math.round(t.width/11*10),t.height=Math.round(t.height/11*10)):(t.zoomRatio=Math.round(11*t.zoomRatio/10*1e4)/1e4,t.width=Math.round(11*t.width/10),t.height=Math.round(11*t.height/10)),this.zoomRatio=t.zoomRatio,this.canvasDom.style.width=`${t.width}px`,this.canvasDom.style.height=`${t.height}px`,this.canvasDom.width=t.width,this.canvasDom.height=t.height,this.reDraw()}))}async resize(){const e=await this.getCanvasSize();this.canvasDom.style.width=`${e.width}px`,this.canvasDom.style.height=`${e.height}px`,this.canvasDom.width=e.width,this.canvasDom.height=e.height,this.zoomRatio=e.zoomRatio}lockHandle(e){"Space"===e.code&&(this.handleLocked=!0,this.canvasDom.className="canvas-key-down",this.unBindMove(),this.bindHandleMove())}unlockHandle(e){"Space"===e.code&&(this.handleLocked=!1,this.canvasDom.className="",this.unBindMove(),this.bindMainMove())}getCanvasSize(){const{realWidth:e,realHeight:t}=this,a=this.canvasOuterDom.getBoundingClientRect();return new Promise((l=>{if(a.width||a.height){const s=this.getZoomRatio(a.width,a.height,e,t);l(s)}else{const a=new ResizeObserver((s=>{for(let n of s){const{width:s,height:i}=n.contentRect;if(s&&i){const n=this.getZoomRatio(s,i,e,t);l(n),a.disconnect()}}}));a.observe(this.canvasOuterDom)}}))}getZoomRatio(e,t,a,l){let s=1;return e/t<a/l?(t=t*a/e,s=e/a,e=a):(e=e*l/t,s=t/l,t=l),{width:a*s,height:l*s,zoomRatio:s}}destory(){this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.name="",this.handleState=null,this.canvasOuterDom=null,this.canvasDom=null,this.ctx=null}getData(){return{name:this.name,realWidth:this.realWidth,realHeight:this.realHeight,drawType:this.drawType}}setData({name:e,realWidth:t,realHeight:a,drawType:l},s="init"){this.name=e,this.drawType=l,t!==this.realWidth||a!==this.realHeight?"edit"===s?j.confirm("修改尺寸将会清空所有元素，是否继续","警告",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((()=>{this.realWidth=t,this.realHeight=a,this.clearAllData(),this.resize().then((()=>{this.reDraw()}))})):(this.realWidth=t,this.realHeight=a,this.clearAllData(),this.resize().then((()=>{this.reDraw()}))):this.reDraw()}changeHandleType(e){this.handleState=e}handle(e,t){const{handleState:a,handleLocked:l,startX:s,startY:n,zoomRatio:i}=this;if(l){const{pageX:a,pageY:l}=t;switch(e){case"keyup":this.unlockHandle(t);break;case"mousedown":this.canvasDom.className="canvas-key-down-mousedown",this.isDrawing=!0,this.startX=a,this.startY=l;break;case"mousemove":if(!this.isDrawing)return;this.position.left+=a-s,this.position.top+=l-n,this.startX=a,this.startY=l,this.canvasDom.style.left=`${this.position.left}px`,this.canvasDom.style.top=`${this.position.top}px`;break;case"mouseup":this.canvasDom.className="canvas-key-down",this.isDrawing=!1}}else switch(a){case ua:this.handleEvent(e,t);break;case ca:this.drawingEvent(e,t)}}handleEvent(e,t){switch(e){case"dblclick":this.checkContextMenu(t,!0);break;case"mousedown":if(0!==t.button)return;this.handleController.close(),this.checkMove(t);break;case"click":this.handleController.close();break;case"mousemove":this.moving(t);break;case"mouseup":case"mouseleave":this.finishMove(t);break;case"contextmenu":this.checkContextMenu(t);break;case"selected":this.handleController.close(),this.selectedElement(t);break;case"keydown":this.lockHandle(t)}}drawingEvent(e,t){switch(this.handleController.close(),e){case"mousedown":if(0!==t.button)return;this.toDraw(t);break;case"click":case"contextmenu":case"selected":break;case"mousemove":this.drawMove(t);break;case"mouseup":case"mouseleave":this.finishDraw(t);break;case"keydown":this.lockHandle(t)}}startDraw(e){const{offsetX:t,offsetY:a}=e;this.startX=t,this.startY=a,this.isDrawing=!0}drawMove(e){if(!this.isDrawing)return;const t=this.getDrawingArea(e);this.reDraw(t)}finishDraw(e){if(!this.isDrawing)return;this.isDrawing=!1;const t=this.getDrawingArea(e);this.sendElement(t)}startMove(e,t){const{offsetX:a,offsetY:l}=e;this.startX=a,this.startY=l,this.isDrawing=!0,this.moveType=t}moving(e){if(!this.isDrawing)return;const{moveType:t,startX:a,startY:l,zoomRatio:s}=this,{offsetX:n,offsetY:i}=e,o=(n-this.startX)/s,r=(i-this.startY)/s;this.startX=n,this.startY=i;const d=[a/s,l/s];this.setElementMovingData({xFloat:o,yFloat:r,rotateFloat:d,moveType:t})}finishMove(){this.isDrawing&&(this.isDrawing=!1,this.moveType=null,this.moveEnd())}contextMenu(e,t,a=null){this.handleController.setHandle(t,{x:e.pageX,y:e.pageY},"element",Boolean(t.image),this.canvasOuterDom,a).then((e=>{this.contextmenuCallBack(e)}))}contextmenuCallBack(e){switch(e.name){case Kt.EFFECT:this.toElementSetting(e.handleUuid);break;case Kt.UPLOAD:sa(e.file).then((t=>{this.changeElementImage(e.handleUuid,t)}));break;case Kt.GENERATE:this.toImageGenerateView(e.handleUuid);break;case Kt.REPEAT:this.generateElement(e.handleUuid);break;case Kt.DELETE:this.deleteElement(e.handleUuid);break;case Kt.TEXT_EDIT:this.toTextEdit(e.handleUuid,"text");break;case Kt.COLOR_EDIT:this.toTextEdit(e.handleUuid,"color");break;case Kt.COPY_ELEMENT:this.copyData(e.handleUuid)}}getDrawingArea(e){const{offsetX:t,offsetY:a}=e,{startX:l,startY:s,zoomRatio:n}=this;let i=l>t?{startX:t,finishX:l}:{startX:l,finishX:t},o=s>a?{startY:a,finishY:s}:{startY:s,finishY:a};return{x:i.startX/n,y:o.startY/n,width:(i.finishX-i.startX)/n,height:(o.finishY-o.startY)/n}}clearAll(){const{ctx:e,canvasDom:t}=this;e.beginPath(),e.clearRect(0,0,t.width,t.height),e.closePath()}drawItem({x:e,y:t,width:a,height:l,rotate:s,image:n,tile:i,xOverturn:o,yOverturn:r,opacity:d}){const{ctx:u,zoomRatio:c}=this;(a||l)&&(e*=c,t*=c,a*=c,l*=c,u.beginPath(),u.save(),u.lineWidth=2,u.fillStyle="#222",u.translate(e+a/2,t+l/2),u.scale(o?-1:1,r?-1:1),u.globalAlpha=d,s&&u.rotate(s),n?u.drawImage(n,-a/2,-l/2,a,l):(u.rect(-a/2,-l/2,a,l),u.stroke(),u.fill()),s&&u.rotate(-s),u.globalAlpha=1,u.scale(o?-1:1,r?-1:1),u.translate(-(e+a/2),-(t+l/2)),u.restore(),u.closePath())}drawFullScreen(e){const{ctx:t,canvasDom:a}=this,{width:l,height:s}=a;t.beginPath(),t.save(),t.fillStyle=ra(e),t.fillRect(0,0,l,s),t.restore(),t.closePath()}drawTextItem({x:e,y:t,width:a,height:l,rotate:s,fontSetting:n,xOverturn:i,yOverturn:o,opacity:r}){const{content:d,font_color:u,font_size:c,fontFamily:h}=n,{ctx:m,zoomRatio:v}=this;e*=v,t*=v,a*=v,l*=v,m.beginPath(),m.save(),m.translate(e+a/2,t+l/2),m.scale(i?-1:1,o?-1:1),m.globalAlpha=r,s&&m.rotate(s),m.font=`${c*v}px ${h}`,m.fillStyle=ra(u);const p=m.measureText(d).width;m.fillText(d,-p/2,c*v/2),m.stroke(),s&&m.rotate(-s),m.scale(i?-1:1,o?-1:1),m.globalAlpha=1,m.translate(-(e+a/2),-(t+l/2)),m.restore(),m.closePath()}selectedElement(e){this.toSelectedElement(e)}checkIsInItem({x:e,y:t,width:a,height:l,rotate:s=0,type:n,tileType:i},o){const{offsetX:r,offsetY:d}=o,{ctx:u,zoomRatio:c,canvasDom:h}=this;e*=c,t*=c,a*=c,l*=c,"tile_x"===i?(e=0,a=h.width,s=0):"tile_y"===i?(t=0,l=h.height,s=0):"tile_xy"===i&&(e=0,a=h.width,t=0,l=h.height,s=0),u.beginPath(),u.save(),u.translate(e+a/2,t+l/2),s&&u.rotate(s),u.rect(-a/2,-l/2,a,l),u.translate(-(e+a/2),-(t+l/2)),s&&u.rotate(-s);let m=!!u.isPointInPath(r,d)&&"main";return u.restore(),u.closePath(),m}drawHandleArea({x:e,y:t,width:a,height:l,rotate:s,type:n,tileType:i,fontSetting:o}){const{zoomRatio:r,canvasDom:d,ctx:u}=this;e*=r,t*=r,a*=r,l*=r,"statics"!==n&&"colors"!==n||("tile_x"===i?(e=0,a=d.width,s=0):"tile_y"===i?(t=0,l=d.height,s=0):"tile_xy"===i&&(e=0,a=d.width,t=0,l=d.height,s=0));const c=10,h=10,m=[[0-a/2,-10-l/2,a,2],[a+5+5-a/2-1,0-l/2,2,l],[-10-a/2,0-l/2,2,l],[0-a/2,l+5+5-l/2-1,a,2]];[[-15-a/2,-15-l/2],[+a+5-a/2,-15-l/2],[+a+5-a/2,+l+5-l/2],[-15-a/2,+l+5-l/2]].forEach((n=>{this.drawHandlePoint(n,{x:e,y:t,width:a,height:l,rotate:s},h)})),m.forEach((n=>{this.drawHandleLine(n,{x:e,y:t,width:a,height:l,rotate:s})})),i&&i.includes("tile")||this.drawRotateArea({x:e,y:t,width:a,height:l,rotate:s},c)}drawRotateArea({x:e,y:t,width:a,height:l,rotate:s},n){const{rotateImage:i,ctx:o}=this;o.beginPath(),o.save(),o.translate(e+a/2,t+l/2),s&&o.rotate(s),o.drawImage(i,-10,-l/2-2*n-20,20,20),o.translate(-(e+a/2),-(t+l/2)),s&&o.rotate(-s),o.translate(-(e+a/2),-(t+l/2)),o.restore(),o.closePath()}drawHandlePoint([e,t],a,l){const{ctx:s}=this;s.beginPath(),s.save(),s.fillStyle="#fff",s.translate(a.x+a.width/2,a.y+a.height/2),a.rotate&&s.rotate(a.rotate),s.rect(e,t,l,l),s.translate(-(a.x+a.width/2),-(a.y+a.height/2)),a.rotate&&s.rotate(-a.rotate),s.fill(),s.restore(),s.closePath()}drawHandleLine([e,t,a,l],s){const{ctx:n}=this;n.beginPath(),n.save(),n.fillStyle="#fff",n.translate(s.x+s.width/2,s.y+s.height/2),s.rotate&&n.rotate(s.rotate),n.rect(e,t,a,l),n.translate(-(s.x+s.width/2),-(s.y+s.height/2)),s.rotate&&n.rotate(-s.rotate),n.fill(),n.restore(),n.closePath()}checkIsInHandleArea({x:e,y:t,width:a,height:l,rotate:s,type:n,tileType:i},o){const{zoomRatio:r,canvasDom:d}=this;e*=r,t*=r,a*=r,l*=r,"tile_xy"===i?(e=0,a=d.width,s=0):"tile_y"===i?(t=0,l=d.height,s=0):"tile_xy"===i&&(e=0,a=d.width,t=0,l=d.height,s=0);const u=10,c=10,h=[[-15-a/2,-15-l/2,"left-top"],[+a+5-a/2,-15-l/2,"right-top"],[+a+5-a/2,+l+5-l/2,"right-bottom"],[-15-a/2,+l+5-l/2,"left-bottom"]],m=[[0-a/2,-10-l/2,a,2,"top"],[a+5+5-a/2-1,0-l/2,2,l,"right"],[-10-a/2,0-l/2-1,2,l,"left"],[0-a/2,l+5+5-l/2,a,2,"bottom"]];let v=!1;if(v=this.checkIsInRotateArea({x:e,y:t,width:a,height:l,rotate:s},u,o),v||"texts"===n)return v;for(let p of h)if(v=this.checkIsInHanlePoint(p,{x:e,y:t,width:a,height:l,rotate:s},c,o),v)break;if(v)return v;for(let p of m)if(v=this.checkIsInHanleLine(p,{x:e,y:t,width:a,height:l,rotate:s},o),v)break;return v}checkIsInHanlePoint([e,t,a],l,s,{offsetX:n,offsetY:i}){const{ctx:o}=this;o.beginPath(),o.save(),o.fillStyle="#fff",o.translate(l.x+l.width/2,l.y+l.height/2),l.rotate&&o.rotate(l.rotate),o.rect(e,t,s,s),o.translate(-(l.x+l.width/2),-(l.y+l.height/2)),l.rotate&&o.rotate(-l.rotate);let r=!!o.isPointInPath(n,i)&&a;return o.restore(),o.closePath(),r}checkIsInHanleLine([e,t,a,l,s],n,{offsetX:i,offsetY:o}){const{ctx:r}=this;r.beginPath(),r.save(),r.fillStyle="#fff",r.translate(n.x+n.width/2,n.y+n.height/2),n.rotate&&r.rotate(n.rotate),r.rect(e,t,a,l),r.translate(-(n.x+n.width/2),-(n.y+n.height/2)),n.rotate&&r.rotate(-n.rotate);let d=!!r.isPointInPath(i,o)&&s;return r.restore(),r.closePath(),d}checkIsInRotateArea({x:e,y:t,width:a,height:l,rotate:s},n,{offsetX:i,offsetY:o}){const{ctx:r}=this;r.beginPath(),r.save(),r.translate(e+a/2,t+l/2),s&&r.rotate(s),r.rect(-10,-l/2-2*n-20,20,20),r.translate(-(e+a/2),-(t+l/2)),s&&r.rotate(-s),r.translate(-(e+a/2),-(t+l/2)),r.restore();let d=!!r.isPointInPath(i,o)&&"rotate";return r.closePath(),d}getData(){return{realWidth:this.realWidth,realHeight:this.realHeight,name:this.name,drawType:this.drawType}}getRealCanvas(){const{realWidth:e,realHeight:t}=this;this.canvasDom.width=e,this.canvasDom.height=t,this.zoomRatio=1}setViewType(e){this.viewType=e,"editor"===e&&(this.resize(),this.reDraw())}getTextWidth({content:e,fontFamily:t,font_size:a}){const{ctx:l}=this;l.beginPath(),l.save(),l.font=`${a}px ${t}`;var s=l.measureText(e).width;return l.restore(),l.closePath(),s}drawMeshLine(){const{canvasDom:e,zoomRatio:t}=this,{width:a,height:l}=e,{outerWidth:s}=ga,n=Math.ceil(a/t/s),i=Math.ceil(l/t/s),o={x:new Array(n),y:new Array(i)};this.drawMeshLineItem(o)}drawMeshLineItem(e){const{ctx:t,canvasDom:a,zoomRatio:l}=this,{outerWidth:s}=ga,{width:n,height:i}=a,{x:o,y:r}=e;for(let d=0;d<o.length;d++)t.beginPath(),t.save(),t.strokeStyle="#404040",t.moveTo(d*s*l,0),t.lineTo(d*s*l,i),t.stroke(),t.restore(),t.closePath(),this.drawMeshMin(d*s*l,0,0);for(let d=0;d<r.length;d++)t.beginPath(),t.save(),t.strokeStyle="#404040",t.moveTo(0,d*s*l),t.lineTo(n,d*s*l),t.stroke(),t.restore(),t.closePath(),this.drawMeshMin(0,d*s*l,1)}drawMeshMin(e,t,a=0){const{ctx:l,canvasDom:s,zoomRatio:n}=this,{width:i,height:o}=s,{innerWidth:r,outerWidth:d}=ga,u=Math.ceil(d/r);for(let c=0;c<u;c++)if(0!==c){switch(l.beginPath(),l.save(),l.strokeStyle="#343434",a){case 0:l.moveTo(e+c*r*n,0),l.lineTo(e+c*r*n,o);break;case 1:l.moveTo(0,t+c*r*n),l.lineTo(i,t+c*r*n)}l.stroke(),l.restore(),l.closePath()}}drawTileImage(e,t="tile_xy"){const{image:a}=e;if(!a)return void this.drawTileColor(e,t);const{canvasDom:l,zoomRatio:s,ctx:n}=this,{width:i,height:o}=a,r="tile_y"===t?1:Math.floor(l.width/i/s),d="tile_x"===t?1:Math.floor(l.height/o/s);let u=l.width/r,c=l.height/d;u="tile_y"===t?e.width*s:u,c="tile_x"===t?e.height*s:c;const h="tile_y"===t?e.x*s:0,m="tile_x"===t?e.y*s:0;n.beginPath();for(let v=0;v<r;v++)for(let e=0;e<d;e++)n.drawImage(a,h+v*u,m+e*c,u+1,c+1);n.closePath()}drawTileColor(e,t="tile_xy"){const{color:a}=e,{canvasDom:l,zoomRatio:s,ctx:n}=this;let i=l.width,o=l.height;i="tile_y"===t?e.width*s:l.width,o="tile_x"===t?e.height*s:l.height;const r={x:"tile_y"===t?e.x*s:0,y:"tile_x"===t?e.y*s:0};n.beginPath(),n.save(),n.fillStyle=ra(a),n.fillRect(r.x,r.y,i,o),n.fill(),n.restore(),n.closePath()}}const fa=(e,t=0,a=0,l=[])=>{const s=e[t];return new Promise((n=>{var i;(i=s,Et.post(`/teai/query_task?task_id=${i}`)).then((s=>{"error"===s.status?(a=0,t+=1,l.push("")):"processing"===s.status?++a>=30&&(a=0,t+=1,l.push("")):(a=0,t+=1,l.push(s)),((e,t)=>t===e.length)(e,t)?n(l):setTimeout((()=>{n(fa(e,t,a,l))}),2e3)}))}))};class wa{constructor(){t(this,"getGenerateResult",((e,t=0,a=0,l=[])=>fa(e,0,0,[]))),this.name=null}getGenrateTaskId(e,t){return new Promise((a=>{(function(e,t,a=1){return Et.post(`/teai/generate?layout_name=${e}&layer_name=${t}&num_images=${a}`)})(this.name,e,t).then((e=>{a(e)}))}))}getGroupTaskResult(e=[],t=0,a={}){const l=e[t],{children:s}=l;return new Promise((n=>{this.getGenrateTaskId(l.uuid,s.length).then((l=>{this.getGenerateResult(l).then((l=>{s.forEach(((e,t)=>{a[e]=l[t]})),++t===e.length?n(a):n(this.getGroupTaskResult(e,t,a))}))}))}))}getLayerTaskResult(e){const{uuid:t}=e;return new Promise((e=>{this.getGenrateTaskId(t,1).then((a=>{this.getGenerateResult(a).then((([a])=>{e({[t]:a})}))}))}))}getElementTaskResult(e,t,a=0){return new Promise((a=>{this.getGenrateTaskId(t,1).then((t=>{this.getGenerateResult(t).then((([t])=>{a({[e]:t})}))}))}))}setName(e){this.name=e}}function ba(e,t){return Et.post(`/teai/upload?file_id=${e}`,t)}function xa(e){return/^data:image\/\w+;base64,/.test(e)}function Da(e){return new Promise((t=>{const a=function(e){return`font-${e.split("/")[e.split("/").length-1].split(".")[0]}`}(e);let l=document.getElementById(a)||document.createElement("style");if(l.id)return void t(a);l.id=a;const s=new V(a);l.innerText=`@font-face {\n      font-family: ${a};\n      src: url('${e}');\n    }`,document.head.appendChild(l),s.load().then((()=>{t(a)}),(e=>{}))}))}function Ea(e){let t=-1;Ca||(Ca=function(){const e=new Int32Array(256);for(let t=0;t<256;t++){let a=t;for(let e=0;e<8;e++)a=1&a?3988292384^a>>>1:a>>>1;e[t]=a}return e}());for(let a=0;a<e.length;a++)t=Ca[255&(t^e[a])]^t>>>8;return-1^t}let Ca;const ka="image/png",Ta="image/jpeg",Ia="p".charCodeAt(0),_a="H".charCodeAt(0),La="Y".charCodeAt(0),Sa="s".charCodeAt(0);function Aa(e,t){const a=e.split(","),l=a[0],s=a[1];let n,i,o=!1;if(-1!==l.indexOf(ka)){n=ka;const e=function(e){let t=e.indexOf("AAlwSFlz");-1===t&&(t=e.indexOf("AAAJcEhZ"));-1===t&&(t=e.indexOf("AAAACXBI"));return t}(s);e>=0?(i=4*Math.ceil((e+28)/3),o=!0):i=44}-1!==l.indexOf(Ta)&&(n=Ta,i=24);const r=s.substring(0,i),d=s.substring(i),u=atob(r),c=new Uint8Array(u.length);for(let m=0;m<c.length;m++)c[m]=u.charCodeAt(m);const h=function(e,t,a,l){if(a===Ta)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(a===ka){const a=new Uint8Array(13);t*=39.3701,a[0]=Ia,a[1]=_a,a[2]=La,a[3]=Sa,a[4]=t>>>24,a[5]=t>>>16,a[6]=t>>>8,a[7]=255&t,a[8]=a[4],a[9]=a[5],a[10]=a[6],a[11]=a[7],a[12]=1;const s=Ea(a),n=new Uint8Array(4);if(n[0]=s>>>24,n[1]=s>>>16,n[2]=s>>>8,n[3]=255&s,l){const t=function(e){for(let t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===Ia&&e[t-2]===_a&&e[t-1]===La&&e[t]===Sa)return t-3}(e);return e.set(a,t),e.set(n,t+13),e}{const t=new Uint8Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=9;const l=new Uint8Array(54);return l.set(e,0),l.set(t,33),l.set(a,37),l.set(n,50),l}}}(c,t,n,o);return[l,",",btoa(String.fromCharCode(...h)),d].join("")}function Oa(e,t,a,l=0,s=0){const n=[[-e/2,-t/2],[e/2,-t/2],[e/2,t/2],[-e/2,t/2]].map((([e,t])=>{const n=Math.cos(a),i=Math.sin(a);return[l+(e*n-t*i),s+(e*i+t*n)]}));let i=1/0,o=-1/0,r=1/0,d=-1/0;return n.forEach((([e,t])=>{i=Math.min(i,e),o=Math.max(o,e),r=Math.min(r,t),d=Math.max(d,t)})),{width:o-i,height:d-r}}function Ra([e,t],[a,l]){return e>0&&e<a&&t>0&&t<l}const Ma=new class{constructor(){this.dataController=H(new Jt),this.canvasController=H(new ya),this.generationController=H(new wa),this.dataController.reDraw=this.reDraw.bind(this),this.canvasController.clearAllData=this.clearAllData.bind(this),this.canvasController.reDraw=this.reDraw.bind(this),this.canvasController.toDraw=this.toDraw.bind(this),this.canvasController.sendElement=this.sendElement.bind(this),this.canvasController.toSelectedElement=this.toSelectedElement.bind(this),this.canvasController.checkMove=this.checkMove.bind(this),this.canvasController.setElementMovingData=this.setElementMovingData.bind(this),this.canvasController.moveEnd=this.moveEnd.bind(this),this.canvasController.checkContextMenu=this.checkContextMenu.bind(this),this.canvasController.changeElementImage=this.changeElementImage.bind(this),this.canvasController.toImageGenerateView=this.toImageGenerateView.bind(this),this.canvasController.reGenerateElement=this.reGenerateElement.bind(this),this.canvasController.deleteElement=this.deleteElement.bind(this),this.canvasController.generateElement=this.generateElement.bind(this),this.canvasController.getLayerImage=this.getLayerImage.bind(this),this.canvasController.toTextEdit=this.toTextEdit.bind(this),this.canvasController.copyData=this.copyData.bind(this),this.canvasController.toElementSetting=this.toElementSetting.bind(this),this.movedElementUuid=null}save(){return new Promise((e=>{const t=Be();this.getSaveData().then((({jsonFile:a,preview:l,code:s,message:n})=>{if(200===s){const s=new FormData;s.append("file",a),gt(s,"layouts",a.name.replace(".json",""),l).then((a=>{N.success("保存成功"),t.close(),e()}))}else t.close(),N.error(n)}))}))}async getSaveData(){const e=this.canvasController.getData(),t=this.dataController.getData(),a=JSON.parse(JSON.stringify(t));if(!e.name)return{code:500,message:"请设置文件名称后操作"};const l=Y(),s=new Map;for(let d in a)for(let e in t[d])if(t[d][e].image&&xa(t[d][e].image.src))if(s.get(t[d][e].image.src)){const l=s.get(t[d][e].image.src);await this.setImage(d,e,l),a[d][e].image=l}else{const l=ta(t[d][e].image.src,e),n=new FormData;n.append("file",l);const i=await this.saveImage(e,n);s.set([t[d][e].image.src,i]),await this.setImage(d,e,i),a[d][e].image=i}else t[d][e].image&&t[d][e].image.src?a[d][e].image=t[d][e].image.src:a[d][e].image=null;const n=ta(this.getCanvasImage(),l),i=new FormData;i.append("file",n);const o=await this.saveImage(l,i),r={viewData:e,layerData:a};for(let d in t){if("elements"===d)break;for(let e in t[d])Object.assign(r,{[e]:{prompts:t[d][e].prompts,statics:t[d][e].statics,colors:t[d][e].colors,texts:t[d][e].texts}})}return{jsonFile:ia(r,e.name),preview:o,code:200}}saveImage(e,t){return new Promise((a=>{ba(e,t).then((e=>{a(e)}))}))}setImage(e,t,a){return new Promise((l=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{this.dataController[e][t].setData({image:s}),l()},s.onerror=()=>{l()},s.src=a}))}clearAllData(){this.dataController.clearAllData(),this.reDraw()}reDraw(e=null){const t=this.dataController.elements,a=this.dataController.groups,l=this.dataController.layers,s=new Set;Object.keys(t).forEach((e=>{this.recomputationPosition(t[e])})),Object.keys(a).forEach((e=>{a[e].children.forEach((e=>{l[e].children.forEach((e=>{t[e].isShow&&s.add(e)}))}))})),Object.keys(l).forEach((e=>{l[e].children.forEach((e=>{t[e].isShow&&s.add(e)}))}));let n=[];this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{this.dataController.findData("layer",e).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&n.push(t)}))}))}else{this.dataController.findData("layer",t).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&n.push(t)}))}})),e&&(e.image=this.dataController.findData("layer",this.dataController.selectedMap.layer).image,n.push(e)),this.canvasController.clearAll(),this.canvasController.drawMeshLine(),n.forEach((e=>{this.drawItem(e)}));const i=this.dataController.selectedMap.element;if(t&&i&&t[i].isShow){this.canvasController.drawHandleArea(t[i]);const{virtuallyElements:e}=t[i];e&&e.length&&e.forEach((e=>{const[a,l]=e,{width:s,height:n,rotate:o,image:r,type:d,tileType:u}=t[i],c={x:a,y:l,width:s,height:n,rotate:o,image:r,type:d,tileType:u};this.canvasController.drawHandleArea(c)}))}}drawItem(e){const{virtuallyElements:t,type:a,color:l,tileType:s}=e;switch(a){case"colors":switch(s){case"tile_xy":case"tile_x":case"tile_y":this.canvasController.drawTileColor(e,s);break;default:this.canvasController.drawTileColor(e,"tile_xy")}break;case"texts":this.canvasController.drawTextItem(e),t&&t.length&&t.forEach((t=>{const[a,l]=t,{width:s,height:n,rotate:i,fontSetting:o,type:r,tileType:d}=e,u={x:a,y:l,width:s,height:n,rotate:i,fontSetting:o,type:r,tileType:d};this.drawItem(u)}));break;case"statics":switch(s){case"tile_xy":case"tile_x":case"tile_y":this.canvasController.drawTileImage(e,s);break;default:this.canvasController.drawItem(e)}t&&t.length&&t.forEach((t=>{const[a,l]=t,{width:s,height:n,rotate:i,image:o,type:r,tileType:d}=e,u={x:a,y:l,width:s,height:n,rotate:i,image:o,type:r,tileType:d};this.drawItem(u)}));break;default:this.canvasController.drawItem(e),t&&t.length&&t.forEach((t=>{const[a,l]=t,{width:s,height:n,rotate:i,image:o,type:r,tileType:d}=e,u={x:a,y:l,width:s,height:n,rotate:i,image:o,type:r,tileType:d};this.drawItem(u)}))}}sendElement(e){const t=this.dataController.selectedMap.layer,a=this.dataController.findData("layer",t),{type:l}=a;if("texts"===l){const t=JSON.parse(JSON.stringify(a.fontSetting)),l=za.getTextWidth(t);e=Object.assign(e,{x:e.x+e.width/2-l/2,y:e.y+e.height/2-t.font_size/2,width:l,height:t.font_size,fontSetting:t})}this.dataController.add("element",t,null,e),this.reDraw()}toDraw(e){const t=this.dataController.selectedMap.layer;if(!t)return;const a=this.dataController.findData("layer",t);a&&a.tileType||this.canvasController.startDraw(e)}checkClickIsIn(e,t=!0){const a=this.dataController.elements,l=this.dataController.groups,s=this.dataController.layers,n=this.dataController.findData("element",this.dataController.selectedMap.element);let i=null;if(n&&t){if(this.canvasController.checkIsInItem(n,e))return{handleType:"main",data:n};if(i=this.canvasController.checkIsInHandleArea(n,e),i)return{handleType:i,data:n};const{virtuallyElements:t}=n;if(t&&t.length)for(let a of t){const[t,l]=a,{width:s,height:o,rotate:r,image:d,type:u,tileType:c}=n,h={x:t,y:l,width:s,height:o,rotate:r,image:d,type:u,tileType:c};if(i=this.canvasController.checkIsInHandleArea(h,e),i)return{handleType:i,data:n}}}const o=new Set;Object.keys(l).forEach((e=>{l[e].children.forEach((e=>{s[e].children.forEach((e=>{a[e].isShow&&o.add(e)}))}))})),Object.keys(s).forEach((e=>{s[e].children.forEach((e=>{a[e].isShow&&o.add(e)}))}));let r=[];this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{this.dataController.findData("layer",e).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&r.push(t)}))}))}else{this.dataController.findData("layer",t).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&r.push(t)}))}})),r=r.reverse();for(let d of r){const{virtuallyElements:t,type:a}=d,l=this.canvasController.checkIsInItem(d,e);if(t&&t.length)for(let s of t){const[t,a]=s,{width:l,height:n,rotate:o,image:r}=d,u={x:t,y:a,width:l,height:n,rotate:o,image:r};if(i=this.canvasController.checkIsInItem(u,e),i)return{handleType:"main",data:d}}if(l)return i="main",{handleType:i,data:d}}return{handleType:null,data:null}}toSelectedElement(e){const{data:t}=this.checkClickIsIn(e,!1);if(!t)return this.dataController.selectedMap={group:null,layer:null,element:null},void this.reDraw();const a=this.dataController.findData("layer",t.parentUuid),l=a?this.dataController.findData("group",a.parentUuid):null,s=[l?l.uuid:null,a.uuid||null,t.uuid];this.dataController.changeSelected(s),this.reDraw()}checkMove(e){const t=this.checkClickIsIn(e),a=t.data,l=t.handleType;a&&a.uuid===this.dataController.selectedMap.element&&(this.movedElementUuid=a.uuid,this.canvasController.startMove(e,l))}checkContextMenu(e,t=!1){const a=this.checkClickIsIn(e),l=a.data,s=a.handleType;l&&"main"===s&&(t?"texts"!==l.type&&"prompts"!==l.type||this.canvasController.contextMenu(e,l,l.type):this.canvasController.contextMenu(e,l))}setElementMovingData({xFloat:e,yFloat:t,rotateFloat:a,moveType:l}){const s=this.dataController.elements[this.movedElementUuid],n=s.rotate,i=Math.cos(-n),o=Math.sin(-n),r=e*i-e*o,d=e*o+t*i;switch(l){case"main":this.mainMove(s,e,t);break;case"left-top":this.leftTopMove(s,r,d);break;case"top":this.topMove(s,r,d);break;case"right-top":this.rightTopMove(s,r,d);break;case"right":this.rightMove(s,r,d);break;case"right-bottom":this.rightBottomMove(s,r,d);break;case"bottom":this.bottomMove(s,r,d);break;case"left-bottom":this.leftBottomMove(s,r,d);break;case"left":this.leftMove(s,r,d);break;case"rotate":this.rotateMove(s,e,t,a)}this.reDraw()}moveEnd(e){this.movedElementUuid=null}mainMove(e,t,a){e.setData({x:e.x+t,y:e.y+a}),this.recomputationPosition(e)}leftTopMove(e,t,a){let{width:l,height:s,x:n,y:i}=e;l-t<0||(l-=t,s-=a,n+=t,i+=a),s-a<0||(s-=a,i+=a),e.setData({x:n,y:i,width:l,height:s})}topMove(e,t,a){let{height:l,y:s}=e;l-a<0||(l-=a,s+=a),e.setData({y:s,height:l})}rightTopMove(e,t,a){let{width:l,height:s,y:n}=e;l+t<0||(l+=t),s-a<0||(s-=a,n+=a),e.setData({width:l,height:s,y:n})}rightMove(e,t,a){let{width:l}=e;l+t<0||(l+=t),e.setData({width:l})}rightBottomMove(e,t,a){let{width:l,height:s}=e;l+t<0||(l+=t),s+a<0||(s+=a),e.setData({width:l,height:s})}bottomMove(e,t,a){let{height:l}=e;l+a<0||(l+=a),e.setData({height:l})}leftBottomMove(e,t,a){let{width:l,height:s,x:n}=e;l-t<0||(l-=t,n+=t),s+a<0||(s+=a),e.setData({width:l,height:s,x:n})}leftMove(e,t,a){let{width:l,x:s}=e;l-t<0||(l-=t,s+=t),e.setData({x:s,width:l})}rotateMove(e,t,a,l){const{x:s,y:n,width:i,height:o,rotate:r}=e;let d=function([e,t],[a,l],[s,n]){const i=a-e,o=l-t,r=s-e,d=n-t;let u=(i*r+o*d)/(Math.sqrt(i*i+o*o)*Math.sqrt(r*r+d*d));if(isNaN(u))return 0;let c=Math.acos(u);return i*d-o*r<0&&(c=-c),isNaN(c)?Math.PI/1800:Number(c.toFixed(2))}([s+i/2,n+o/2],l,[l[0]+t,l[1]+a]);e.setData({rotate:r+d})}recomputationPosition(e){const{drawType:t}=this.canvasController,{realWidth:a,realHeight:l}=this.canvasController;switch(t){case ha:e.virtuallyElements=[],this.recomputationMainPosition(a,l,e);break;case ma:e.virtuallyElements=[],this.recomputationAgentXPosition(width,e),this.recomputationMainPosition(a,l,e);break;case va:e.virtuallyElements=[],this.recomputationAgentYPosition(height,e),this.recomputationMainPosition(a,l,e);break;case pa:e.virtuallyElements=[],this.recomputationAgentFPosition(a,l,e),this.recomputationMainPosition(a,l,e)}}recomputationMainPosition(e,t,a){const{virtuallyElements:l,x:s,y:n,width:i,height:o}=a;let r=JSON.parse(JSON.stringify(l));r.length&&(Ra([s+i/2,n+o/2],[e,t])||r.forEach(((l,d)=>{const[u,c]=l;Ra([u+i/2,c+o/2],[e,t])&&(r[d]=[s,n],a.setData({x:u,y:c,virtuallyElements:r}))})))}recomputationAgentXPosition(e,t){const{x:a,y:l,virtuallyElements:s,width:n,height:i,rotate:o}=t;let r=n;o&&(r=Oa(n,i,o).width),a+n/2+r/2>e?s.push([a-e,l]):a+n/2-r/2<0&&s.push([e+a,l]),t.setData({virtuallyElements:s})}recomputationAgentYPosition(e,t){const{x:a,y:l,virtuallyElements:s,width:n,height:i,rotate:o}=t;let r=i;o&&(r=Oa(n,i,o).height),l+i/2+r/2>e?s.push([a,l-e]):l+i/2-r/2<0&&s.push([a,e+l]),t.setData({virtuallyElements:s})}recomputationAgentFPosition(e,t,a){this.recomputationAgentXPosition(e,a),this.recomputationAgentYPosition(t,a);const{virtuallyElements:l,x:s,drawY:n,width:i,height:o}=a;2===l.length&&(s===l[0][0]?l.push([l[1][0],l[0][1]]):l.push([l[0][0],l[1][1]])),a.setData({virtuallyElements:l})}deleteElement(e){this.dataController.delete("element",e),this.reDraw()}reGenerateElement(e){}toImageGenerateView(e){}toElementSetting(e){this.toElementSetting(e)}changeElementImage(e,t){this.dataController.elements[e].setData({image:t}),this.reDraw()}getCanvasImage(){this.canvasController.getRealCanvas();const e=this.dataController.elements,t=this.dataController.groups,a=this.dataController.layers,l=new Set;Object.keys(e).forEach((t=>{this.recomputationPosition(e[t])})),Object.keys(t).forEach((s=>{t[s].children.forEach((t=>{a[t].children.forEach((t=>{e[t].isShow&&l.add(t)}))}))})),Object.keys(a).forEach((t=>{a[t].children.forEach((t=>{e[t].isShow&&l.add(t)}))}));let s=[];this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{this.dataController.findData("layer",e).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&s.push(t)}))}))}else{this.dataController.findData("layer",t).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&s.push(t)}))}})),this.canvasController.clearAll(),s.forEach((e=>{this.drawItem(e)}));const n=Aa(this.canvasController.canvasDom.toDataURL("image/png"),300);return this.canvasController.resize().then((()=>{this.reDraw()})),n}async generateAll(){const e=Be(),t=Object.keys(this.dataController.groups).map((e=>this.dataController.groups[e])),a=this.dataController.layers,l=Object.keys(a).filter((e=>!this.dataController.layers[e].parentUuid)).map((e=>this.dataController.layers[e]));if(t.length){const e=await this.generationController.getGroupTaskResult(t);for(let t in e){const a=this.dataController.findData("layer",t),{type:l}=a;switch(l){case"texts":this.setResultText(a,e[t].result);break;case"colors":this.setResultColor(a,e[t].result);break;default:await this.setResultImage(a,e[t].result)}}}if(l.length){for(let e of l){const t=await this.generationController.getLayerTaskResult(e),{uuid:a,type:l}=e;switch(l){case"texts":this.setResultText(e,t[a].result);break;case"colors":this.setResultColor(e,t[a].result);break;default:await this.setResultImage(e,t[a].result)}}this.reDraw(),e.close(),N.success("生成完成")}}async setResultImage(e,t){const{uuid:a}=e,l=await na(t);this.dataController.layers[a].setData({image:l}),e.children.forEach((e=>{this.dataController.elements[e].setData({image:l})}))}async setResultText(e,t){const a=t,l=await Da(a.font);a.fontFamily=l,e.setData({fontSetting:a}),e.children.forEach((e=>{const t=this.dataController.elements[e],l={fontSetting:a,width:this.canvasController.getTextWidth(a),height:a.font_size};t.setData(l)}))}setResultColor(e,t){e.children.forEach((e=>{this.dataController.elements[e].setData({color:t})}))}async generateGroup(e){await this.save();const t=Be(),a=this.dataController.findData("group",e),l=await this.generationController.getGroupTaskResult([a]);for(let s in l){const e=this.dataController.findData("layer",s),{type:t}=e;switch(t){case"texts":this.setResultText(e,l[s].result);break;case"colors":this.setResultColor(e,l[s].result);break;default:await this.setResultImage(e,l[s].result)}}this.reDraw(),t.close()}async generateLayer(e){await this.save();const t=Be(),a=this.dataController.findData("layer",e),{uuid:l}=a,s=await this.generationController.getLayerTaskResult(a),{type:n}=a;switch(n){case"texts":this.setResultText(a,s[l].result);break;case"colors":this.setResultColor(a,s[l].result);break;default:await this.setResultImage(a,s[l].result)}this.reDraw(),t.close()}async generateElement(e){await this.save();const t=this.dataController.findData("element",e),a=this.dataController.findData("layer",t.parentUuid),l=Be(),{type:s}=a,n=await this.generationController.getElementTaskResult(e,a.uuid);switch(s){case"texts":const t=n[e].result,a=await Da(t.font);t.fontFamily=a;const l={fontSetting:t,width:this.canvasController.getTextWidth(t),height:t.font_size};this.dataController.findData("element",e).setData(l);break;case"colors":this.dataController.findData("element",e).setData({color:n[e].result});break;default:const s=await na(n[e].result);this.dataController.findData("element",e).setData({image:s})}this.reDraw(),l.close()}toImageGenerateView(e){const t=this.dataController.findData("element",e),{image:a,uuid:l}=t;this.toImageGenerateView({image:a.src,uuid:l})}async getLayerImage(){await this.canvasController.resize(),this.reDraw();const e=this.dataController.elements,t=this.dataController.groups,a=this.dataController.layers,l=new Set;Object.keys(e).forEach((t=>{this.recomputationPosition(e[t])})),Object.keys(t).forEach((e=>{t[e].children.forEach((e=>{a[e].isShow&&l.add(e)}))})),Object.keys(a).forEach((e=>{a[e].children.forEach((t=>{a[e].isShow&&l.add(e)}))}));const s=[];let n=[];return this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{const t=this.dataController.findData("layer",e);t.isShow&&n.push(t)}))}else{const e=this.dataController.findData("layer",t);if(!e.isShow)return;n.push(e)}})),n.forEach((t=>{this.canvasController.clearAll(),t.children.forEach((t=>{const a=e[t];this.drawItem(a)})),s.push({name:t.name,uuid:t.uuid,image:this.canvasController.canvasDom.toDataURL("image/png")})})),"editor"===this.canvasController.viewType&&await this.canvasController.resize(),this.reDraw(),s.reverse()}toTextEdit(e,t="text"){const a=this.dataController.findData("element",e);this.toTextEditView(a,t)}copyData(e){this.dataController.copyData(e,"element")}},Pa=H(Ma.dataController),za=H(Ma.canvasController),Ua=H(Ma.generationController);const Na={class:"element-item"},Ga={class:"element-name"},ja={class:"element-handle-area"};var Ha=re({__name:"elementLayers",props:{data:{},editorType:{},editorLayersDom:{},groupUuid:{default:null},layerUuid:{default:null}},emits:["toLayerInfo"],setup(e,{emit:t}){const a=s(Pa),l=s(Ma),n=s(za),o=e,r=t,c=(...e)=>{r("toLayerInfo",...e)};return(e,t)=>(u(),i("div",Na,[m("div",{class:v(["element-title",{selected:a.value.isSelected("element",o.data.uuid)}]),onContextmenu:t[3]||(t[3]=e=>((e,t,l)=>{const s=a.value.findData(e,t),{pageX:i,pageY:r}=l;n.value.handleController.setHandle(s,{x:i,y:r},e,Boolean(s.image),o.editorLayersDom).then((l=>{const{name:i}=l;switch(e){case"element":n.value.contextmenuCallBack(l);break;case"layer":switch(i){case Kt.LAYER_DELETE:a.value.delete(e,t);break;case Kt.LAYER_EDIT:c(s);break;case Kt.COPY_LAYER:a.value.copyData(t,e)}break;case"group":switch(i){case Kt.GROUP_DELETE:a.value.delete(e,t);break;case Kt.COPY_GROUP:a.value.copyData(t,e)}}}))})("element",o.data.uuid,e)),onClick:t[4]||(t[4]=e=>a.value.changeSelected([o.groupUuid,o.layerUuid,o.data.uuid]))},[m("div",Ga,L(a.value.elements[o.data.uuid].name),1),m("div",ja,[m("div",{class:v(["pointer icon bi",y(Oe)]),onClick:t[0]||(t[0]=p((e=>((...e)=>{l.value.generateElement(...e)})(o.data.uuid)),["stop"]))},null,2),m("div",{class:v(["pointer icon bi",a.value.elements[o.data.uuid].isShow?y(Re):y("bi-eye-slash")]),onClick:t[1]||(t[1]=p((()=>{a.value.handleIsShow("element",o.data.uuid,a.value.elements[o.data.uuid].isShow?"hide":"show"),r("setDiagramImage")}),["stop"]))},null,2),"edit"===o.editorType?(u(),i("div",{key:0,class:v(["pointer icon bi",y(Ne)]),onClick:t[2]||(t[2]=p((e=>a.value.delete("element",o.data.uuid)),["stop"]))},null,2)):d("",!0)])],34)]))}},[["__scopeId","data-v-6b7c252f"]]);const Ya={class:"layer-list"},Va=["id"],Ba={class:"layer-name"},Xa={class:"layer-handle-area"};var Wa=re({__name:"layerLayers",props:{data:{},editorType:{},editorLayersDom:{},groupUuid:{default:null},isLast:{},dropType:{default:"layer"}},emits:["toLayerInfo"],setup(e,{emit:t}){const a=s(Pa),l=s(Ma),n=s(za),o=s(!1),r=s(null),h=e,g=s(!1),f=s(!1),w=t,b=()=>{const{uuid:e}=h.data;if(!e)return[];const t=a.value.findData("layer",e),l=[];return t.children.forEach((e=>{const t=a.value.findData("element",e);l[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),l},x=(...e)=>{w("toLayerInfo",...e)},D=(e,t,l,s=null)=>{l.preventDefault(),g.value=!1,f.value=!1,o.value=!1,window.dragDomId=null;const n=JSON.parse(l.dataTransfer.getData("text/plain")),i={uuid:e,type:t};a.value.bindGroup({fromData:n,toData:i,zIndex:s})};return(e,t)=>(u(),i("div",Ya,[m("div",{class:v(["drop-to-line",{droped:g.value}]),onDragover:t[0]||(t[0]=p((e=>g.value=!0),["prevent"])),onDragleave:t[1]||(t[1]=p((e=>g.value=!1),["prevent"])),onDrop:t[2]||(t[2]=p((e=>D(h.data.uuid,h.data.type,e,h.data.zIndex)),["stop"]))},null,34),m("div",{class:v(["layer-title",{selected:a.value.isSelected("layer",h.data.uuid)&&!o.value,dropover:o.value}]),ref_key:"dropOverDom",ref:r,id:`${h.data.type}_${h.data.uuid}`,onClick:t[7]||(t[7]=e=>a.value.changeSelected([h.groupUuid,h.data.uuid,null])),onDragover:t[8]||(t[8]=p((e=>(h.data.uuid,h.data.type,void(r.value.id!==window.dragDomId&&(o.value=!0)))),["prevent"])),onDragleave:t[9]||(t[9]=p((e=>o.value=!1),["prevent"])),onContextmenu:t[10]||(t[10]=e=>((e,t,l)=>{const s=a.value.findData(e,t),{pageX:i,pageY:o}=l;n.value.handleController.setHandle(s,{x:i,y:o},e,Boolean(s.image),h.editorLayersDom).then((l=>{const{name:i}=l;switch(e){case"element":n.value.contextmenuCallBack(l);break;case"layer":switch(i){case Kt.LAYER_DELETE:a.value.delete(e,t);break;case Kt.LAYER_EDIT:x(s);break;case Kt.COPY_LAYER:a.value.copyData(t,e)}break;case"group":switch(i){case Kt.GROUP_DELETE:a.value.delete(e,t);break;case Kt.COPY_GROUP:a.value.copyData(t,e)}}}))})("layer",h.data.uuid,e)),onDrop:t[11]||(t[11]=p((e=>D(h.data.uuid,h.data.type,e)),["stop"])),draggable:"true",onDragstart:t[12]||(t[12]=e=>{return t=h.data.uuid,a=h.data.type,l=e,window.dragDomId=r.value.id,void l.dataTransfer.setData("text/plain",JSON.stringify({uuid:t,type:a}));var t,a,l})},[m("div",Ba,[m("div",{class:v(["icon bi",`${y("bi-caret-right")} ${a.value.isShowMapShow("layer",h.data.uuid)?"selected":""}`]),onClick:t[3]||(t[3]=p((()=>{a.value.handleShowMap("layer",h.data.uuid)}),["stop"]))},null,2),E(" "+L(a.value.layers[h.data.uuid].name),1)]),m("div",Xa,[m("div",{class:v(["pointer icon bi",y(Oe)]),onClick:t[4]||(t[4]=p((e=>((...e)=>{l.value.generateLayer(...e)})(h.data.uuid)),["stop"]))},null,2),m("div",{class:v(["pointer icon bi",a.value.layers[h.data.uuid].isShow?y(Re):y("bi-eye-slash")]),onClick:t[5]||(t[5]=p((()=>{a.value.handleIsShow("layer",h.data.uuid,a.value.layers[h.data.uuid].isShow?"hide":"show"),w("setDiagramImage")}),["stop"]))},null,2),"edit"===h.editorType?(u(),i("div",{key:0,class:v(["pointer icon bi",y(Ne)]),onClick:t[6]||(t[6]=p((e=>a.value.delete("layer",h.data.uuid)),["stop"]))},null,2)):d("",!0)])],42,Va),a.value.isShowMapShow("layer",h.data.uuid)?(u(!0),i(A,{key:0},S(b(),(e=>(u(),c(Ha,{layerUuid:h.data.uuid,groupUuid:h.groupUuid,onToLayerInfo:x,editorType:h.editorType,editorLayersDom:h.editorLayersDom,data:e,key:e.uuid},null,8,["layerUuid","groupUuid","editorType","editorLayersDom","data"])))),128)):d("",!0),h.isLast?(u(),i("div",{key:1,class:v(["drop-to-line",{droped:f.value}]),onDragover:t[13]||(t[13]=p((e=>f.value=!0),["prevent"])),onDragleave:t[14]||(t[14]=p((e=>f.value=!1),["prevent"])),onDrop:t[15]||(t[15]=p((e=>D(h.data.uuid,h.data.type,e,h.data.zIndex+1)),["stop"]))},null,34)):d("",!0)]))}},[["__scopeId","data-v-0fddfebe"]]);const Fa={class:"group-list"},$a=["id"],Ja={class:"group-name"},Za={class:"group-handle-area"};var Qa=re({__name:"groupLayers",props:{data:{},editorType:{},editorLayersDom:{},isLast:{}},emits:["toLayerInfo"],setup(e,{emit:t}){const a=s(Pa),l=s(Ma),n=s(za),o=s(!1),r=s(!1),h=e,g=s(!1),f=s(null),w=t,b=()=>{const{uuid:e}=h.data;if(!e)return[];const t=a.value.findData("group",e),l=[];return t.children.forEach((e=>{const t=a.value.findData("layer",e);l[t.zIndex-1]={type:"layer",uuid:t.uuid,zIndex:t.zIndex}})),l},x=(e,t,l,s=null)=>{l.preventDefault(),o.value=!1,r.value=!1,g.value=!1,window.dragDomId=null;const n=JSON.parse(l.dataTransfer.getData("text/plain")),i={uuid:e,type:t};a.value.bindGroup({fromData:n,toData:i,zIndex:s})},D=(...e)=>{w("toLayerInfo",...e)};return(e,t)=>(u(),i("div",Fa,[m("div",{class:v(["drop-to-line",{droped:o.value}]),onDragover:t[0]||(t[0]=p((e=>o.value=!0),["prevent"])),onDragleave:t[1]||(t[1]=p((e=>o.value=!1),["prevent"])),onDrop:t[2]||(t[2]=p((e=>x(h.data.uuid,h.data.type,e,h.data.zIndex)),["stop"]))},null,34),m("div",{class:v(["group-title",{selected:a.value.isSelected("group",h.data.uuid)&&!g.value,dropover:g.value}]),ref_key:"dropOverDom",ref:f,id:`${h.data.type}_${h.data.uuid}`,onDragover:t[7]||(t[7]=p((e=>(h.data.uuid,h.data.type,void(f.value.id!==window.dragDomId&&(g.value=!0)))),["prevent"])),onDragleave:t[8]||(t[8]=p((e=>g.value=!1),["prevent"])),onContextmenu:t[9]||(t[9]=e=>((e,t,l)=>{const s=a.value.findData(e,t),{pageX:i,pageY:o}=l;n.value.handleController.setHandle(s,{x:i,y:o},e,Boolean(s.image),h.editorLayersDom).then((l=>{const{name:i}=l;switch(e){case"element":n.value.contextmenuCallBack(l);break;case"layer":switch(i){case Kt.LAYER_DELETE:a.value.delete(e,t);break;case Kt.LAYER_EDIT:D(s);break;case Kt.COPY_LAYER:a.value.copyData(t,e)}break;case"group":switch(i){case Kt.GROUP_DELETE:a.value.delete(e,t);break;case Kt.COPY_GROUP:a.value.copyData(t,e)}}}))})("group",h.data.uuid,e)),onDrop:t[10]||(t[10]=p((e=>x(h.data.uuid,"group",e)),["stop"])),onClick:t[11]||(t[11]=e=>a.value.changeSelected([h.data.uuid,null,null])),draggable:"true",onDragstart:t[12]||(t[12]=e=>{return t=h.data.uuid,a=h.data.type,l=e,window.dragDomId=f.value.id,void l.dataTransfer.setData("text/plain",JSON.stringify({uuid:t,type:a}));var t,a,l})},[m("div",Ja,[m("div",{class:v(["icon bi",`${y("bi-caret-right")} ${a.value.isShowMapShow("group",h.data.uuid)?"selected":""}`]),onClick:t[3]||(t[3]=p((()=>{a.value.handleShowMap("group",h.data.uuid)}),["stop"]))},null,2),E(" "+L(a.value.groups[h.data.uuid].name),1)]),m("div",Za,[m("div",{class:v(["pointer icon bi",y(Oe)]),onClick:t[4]||(t[4]=p((e=>((...e)=>{l.value.generateGroup(...e)})(h.data.uuid)),["stop"]))},null,2),m("div",{class:v(["pointer icon bi",a.value.groups[h.data.uuid].isShow?y(Re):y("bi-eye-slash")]),onClick:t[5]||(t[5]=p((()=>{a.value.handleIsShow("group",h.data.uuid,a.value.groups[h.data.uuid].isShow?"hide":"show"),w("setDiagramImage")}),["stop"]))},null,2),"edit"===h.editorType?(u(),i("div",{key:0,class:v(["pointer icon bi",y(Ne)]),onClick:t[6]||(t[6]=p((e=>a.value.delete("group",h.data.uuid)),["stop"]))},null,2)):d("",!0)])],42,$a),a.value.isShowMapShow("group",h.data.uuid)?(u(!0),i(A,{key:0},S(b(),((e,t)=>(u(),c(Wa,{groupUuid:h.data.uuid,onToLayerInfo:D,editorType:h.editorType,editorLayersDom:h.editorLayersDom,isLast:t===b().length-1,data:e,key:t},null,8,["groupUuid","editorType","editorLayersDom","isLast","data"])))),128)):d("",!0),h.isLast?(u(),i("div",{key:1,class:v(["drop-to-line",{droped:r.value}]),onDragover:t[13]||(t[13]=p((e=>r.value=!0),["prevent"])),onDragleave:t[14]||(t[14]=p((e=>r.value=!1),["prevent"])),onDrop:t[15]||(t[15]=p((e=>x(h.data.uuid,h.data.type,e,h.data.zIndex+1)),["stop"]))},null,34)):d("",!0)]))}},[["__scopeId","data-v-b3704d78"]]);const qa={class:"editor-layers-title"},Ka=(e=>(C("data-v-4250826b"),e=e(),k(),e))((()=>m("div",{class:"title-name"},"图层",-1)));var el=re({__name:"editorLayers",props:{viewType:{type:String,default:"编辑器"},typeList:{type:Array,default:()=>[]},groupList:{type:Array,default:()=>[]},editorType:{}},emits:["toLayerInfo","setSelectedLayer","deleteGroup","deleteLayer","deleteElement","setGroup","hideLayer","reGenerateGroup","reGenerateLayer","reGenerateElement","setDiagramImage"],setup(e,{expose:t,emit:a}){const l=s(Pa);s(Ma),s(za);const n=e,o=a,r=s(null),f=(...e)=>{o("toLayerInfo",...e)};return t({setSelectedElement:e=>{const t=n.typeList.find((t=>new Set(Object.keys(t.layerInfo)).has(e))),a=t?t.uuid:null,l=n.groupList.find((e=>new Set(e.layers).has(a))),s=l?l.uuid:null;selectedElement(e,a,s)}}),(t,a)=>{const s=M("el-scrollbar");return u(),i("div",{class:"editor-layers",ref_key:"editorLayersDom",ref:r},[m("div",qa,[Ka,"generate"!==e.editorType?(u(),i("i",{key:0,class:v(["pointer icon bi",y("bi-plus")]),onClick:a[0]||(a[0]=e=>f())},null,2)):d("",!0)]),m("div",{class:"list-outer",onDragover:a[1]||(a[1]=p((()=>{}),["prevent"])),onDrop:a[2]||(a[2]=e=>(e=>{e.preventDefault();const t=JSON.parse(e.dataTransfer.getData("text/plain")),{type:a,uuid:s}=t;if(l.value.findData(a,s).parentUuid)l.value.unbindGroup(t);else{const e=l.value.getAllList().reverse();l.value.bindGroup({fromData:t,toData:e[e.length-1],zIndex:e[e.length-1].zIndex+1})}})(e))},[g(s,null,{default:h((()=>[(u(!0),i(A,null,S(l.value.getAllList().reverse(),((e,t)=>(u(),i(A,null,[e&&"group"===e.type?(u(),c(Qa,{isLast:t===l.value.getAllList().length-1,onToLayerInfo:f,editorType:n.editorType,data:e,key:e?e.uuid:t},null,8,["isLast","editorType","data"])):d("",!0),e&&"layer"===e.type?(u(),c(Wa,{isLast:t===l.value.getAllList().length-1,onToLayerInfo:f,editorType:n.editorType,data:e,key:e?e.uuid:t},null,8,["isLast","editorType","data"])):d("",!0)],64)))),256))])),_:1})],32)],512)}}},[["__scopeId","data-v-4250826b"]]);const tl={class:"menu-icon"},al=["src"],ll=(e=>(C("data-v-cd8cb274"),e=e(),k(),e))((()=>m("div",{class:"menu-name"},null,-1))),sl={class:"menu-all"},nl=["onClick"],il={class:"menu-icon"},ol={class:"menu-name"};var rl=re({__name:"editorHandle",props:["editorType"],emits:["changeHandleType","exportImage","changeViewType","toGenrateGroup","save"],setup(e,{emit:t}){const{publicStore:a}=Lt(),l=s(za),o=s(Ma),r=_();I();const d=s([]),c=s(null),p=s(0),f=s(0),w=e,b=t,x=()=>{const e=D(),t=E();return[].concat(e,t)},D=()=>l.value.handleState===jt&&"edit"===w.editorType?[{name:"绘制模式",icon:"bi-grid",click(){l.value.changeHandleType(Ht)}}]:l.value.handleState===Ht&&"edit"===w.editorType?[{name:"操作模式",icon:"bi-bounding-box-circles",click(){l.value.changeHandleType(jt)}}]:[],E=()=>{let e=[{name:"下载图片",icon:"bi-download",click(){const e=aa(o.value.getCanvasImage()),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="下载.png",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}},{name:"上传模板",icon:"bi-cloud-arrow-up",click(){if(!l.value.name)return N.error("请在设置模板名称后操作"),void b("toCanvasSetting");o.value.save()}},{name:"效果调节",icon:ze,click(){}},{name:"测试生成",icon:f.value?Oe:"bi-play",click(){if(!l.value.name)return N.error("请在设置模板名称后操作"),void b("toCanvasSetting");f.value++,o.value.save().then((()=>{N.success("开始生成"),o.value.generateAll()}))}},{name:"分层展示",icon:"bi-layers",click(){b("changeViewType")}}];return"edit"===w.editorType&&(e=e.concat([{name:"画板设置",icon:"bi-gear",click(){b("toCanvasSetting")}}])),e};return n((()=>{c.value=r.path,d.value=[]})),(e,t)=>{const l=M("el-icon");return u(),i("div",{class:v(["left-bar-body",{expand:p.value}])},[m("div",{class:"menu-title",onClick:t[0]||(t[0]=e=>(p.value=Number(!p.value),void a.setLeftBarShowType(p.value)))},[m("div",tl,[g(l,{class:"icon"},{default:h((()=>[m("img",{src:y("/assets/menu.2082884d.svg")},null,8,al)])),_:1})]),ll]),m("div",sl,[(u(!0),i(A,null,S(x(),((e,t)=>(u(),i("div",{class:"menu-item",key:t,onClick:t=>e.click()},[m("div",il,[m("i",{class:v(["bi icon",e.icon])},null,2)]),m("div",ol,L(e.name),1)],8,nl)))),128))])],2)}}},[["__scopeId","data-v-cd8cb274"]]);const dl=e=>(C("data-v-746d3948"),e=e(),k(),e),ul={class:"editor-draw-board-setting-box"},cl={class:"editor-draw-board-setting-title"},hl={class:"editor-draw-board-setting-handle-area"},ml={class:"setting-item"},vl=dl((()=>m("div",{class:"setting-item-label"},"模板名称",-1))),pl={class:"setting-item-value"},gl={class:"setting-item"},yl=dl((()=>m("div",{class:"setting-item-label"},"宽度W",-1))),fl={class:"setting-item-value"},wl=dl((()=>m("div",{class:"setting-item-label"},"高度H",-1))),bl={class:"setting-item-value"},xl={class:"setting-item"},Dl=dl((()=>m("div",{class:"setting-item-label"},"绘制方式",-1))),El={class:"setting-item-value"};var Cl=re({__name:"editorDrawBoardSetting",props:["editorType"],setup(e,{expose:t}){const a=_(),l=e,n="/modelMainEditor"===a.path,o=s(!1);s(null);const r=s({}),d=s(za),p=s(Ua),f=()=>{o.value=!1};return t({show:e=>{o.value?f():(r.value=za.getData(),o.value=!0)}}),(e,t)=>{const a=M("el-input"),s=M("el-input-number"),w=M("el-option"),b=M("el-select");return u(),i("div",{class:v(["editor-draw-board-setting",{show:o.value}])},[m("div",ul,[m("div",cl,[E(" 画板设置 "),m("div",hl,[m("div",{class:"editor-draw-board-setting-handle",onClick:t[0]||(t[0]=e=>f())},[m("i",{class:v(`bi ${y(Ae)}`)},null,2)]),m("div",{class:"editor-draw-board-setting-handle",onClick:t[1]||(t[1]=e=>(o.value=!1,d.value.setData(r.value,"edit"),void p.value.setName(r.value.name)))},[m("i",{class:v(`bi ${y(Pe)}`)},null,2)])])]),m("div",ml,[vl,m("div",pl,[g(a,{modelValue:r.value.name,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.name=e),disabled:"edit"!==l.editorType||!n},null,8,["modelValue","disabled"])])]),m("div",gl,[yl,m("div",fl,[g(s,{style:{width:"2rem"},disabled:"edit"!==l.editorType,modelValue:r.value.realWidth,"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.realWidth=e),controls:!1},null,8,["disabled","modelValue"])]),wl,m("div",bl,[g(s,{style:{width:"2rem"},disabled:"edit"!==l.editorType,modelValue:r.value.realHeight,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.realHeight=e),controls:!1},null,8,["disabled","modelValue"])])]),m("div",xl,[Dl,m("div",El,[g(b,{modelValue:r.value.drawType,"onUpdate:modelValue":t[5]||(t[5]=e=>r.value.drawType=e),disabled:"edit"!==l.editorType},{default:h((()=>[(u(!0),i(A,null,S(Object.keys(y(Yt)),(e=>(u(),c(w,{key:e,value:y(Yt)[e],label:y(Yt)[e]},null,8,["value","label"])))),128))])),_:1},8,["modelValue","disabled"])])])])],2)}}},[["__scopeId","data-v-746d3948"]]);const kl=e=>(C("data-v-e3f0db90"),e=e(),k(),e),Tl={class:"editor-layer-setting-box"},Il={class:"editor-layer-setting-title"},_l={class:"editor-layer-setting-handle-area"},Ll={class:"setting-value-box"},Sl={key:0,class:"setting-item"},Al=kl((()=>m("div",{class:"setting-item-label"},"图层名称",-1))),Ol={class:"setting-item-value"},Rl={class:"setting-item",style:{"justify-content":"space-between"}},Ml=["label","onClick","value"],Pl=kl((()=>m("i",{class:"bi bi-bookmark-check",style:{"margin-left":"0.1rem"}},null,-1))),zl={key:1,class:"setting-item"},Ul=kl((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Nl={class:"setting-item-value"},Gl={key:2,class:"setting-item"},jl=kl((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Hl={class:"setting-item-value"},Yl={key:3,class:"setting-item"},Vl=kl((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Bl={class:"setting-item-value"},Xl={key:4,class:"setting-item"},Wl=kl((()=>m("div",{class:"setting-item-label"},"模板选择",-1))),Fl={class:"setting-item-value"},$l={key:5,class:"setting-item"},Jl=kl((()=>m("div",{class:"setting-item-label"},"图片",-1))),Zl={class:"setting-item-value"};var Ql=re({__name:"editorLayerSetting",props:{staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]}},emits:["save"],setup(e,{expose:t,emit:a}){const l=s(Pa),n=e,o=s(!1),f=s(null),w=s([]),b=s([]),x=s([]),D=s([]),C=s(null),k=s(null),T=s(null),I=s("layer"),_=s(null),O=()=>{o.value=!1},R=()=>{k.value=null,T.value=null},P=e=>{if("image/png"!==e.type)return void N.error("请上传png格式图片");const t=new FileReader;return t.onload=({target:e})=>{const t=new Image;t.src=e.result,t.onload=()=>{T.value=t,k.value=e.result}},t.readAsDataURL(e),!1},z=()=>{let e=[];const t=w.value.length?w.value[0]:"";if(t.includes("tile")){let a="";t.includes("tile_xy")?a="tile_xy":t.includes("tile_x")?a="tile_x":t.includes("tile_y")&&(a="tile_y"),e=n.staticsList.filter((e=>e.includes(a)))}else e=n.staticsList;return e};return t({show:(e=null)=>{o.value?O():(o.value=!0,f.value=e?e.name:"",w.value=e?e.statics:[],b.value=e?e.prompts:[],D.value=e?e.texts:[],x.value=e?e.colors:[],C.value=e?e.uuid:null,T.value=e?e.image:null,_.value=e?e.type:null,k.value=T.value?T.value.src:null)}}),(e,t)=>{const a=M("el-input"),s=M("el-option"),U=M("el-select"),G=M("el-button"),j=M("el-image"),H=M("el-upload"),Y=M("el-scrollbar");return u(),i("div",{class:v(["editor-layer-setting",{show:o.value}]),style:r({height:"layer"===I.value?"9.3rem":"7rem"})},[m("div",Tl,[m("div",Il,[E(L("layer"===I.value?"图层":"组")+"设置 ",1),m("div",_l,[m("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>O())},[m("i",{class:v(`bi ${y(Ae)}`)},null,2)]),m("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>(()=>{if(!f.value&&"layer"===I.value)return void N.error("请输入图层名称后保存");if(!_.value)return void N.error("请选择图层类型后操作");if(!(w.value.length||b.value.length||x.value.length||D.value.length))return void N.error("请选择模板后操作");let e="";const t=w.value.length?w.value[0]:"",a=x.value.length?x.value[0]:"";if(t.includes("tile_xy")?e="tile_xy":t.includes("tile_x")?e="tile_x":t.includes("tile_y")&&(e="tile_y"),a.includes("tile_xy")?e="tile_xy":a.includes("tile_x")?e="tile_x":a.includes("tile_y")&&(e="tile_y"),o.value=!1,C.value){const t=l.value.findData("layer",C.value),{children:a}=t,s={prompts:b.value,statics:w.value,colors:x.value,texts:D.value,image:T.value,type:_.value,tileType:e};t.setData(s),a.forEach(((n,i)=>{e&&i?t.children.splice(i,a.length-1):l.value.findData("element",n).setData(s)})),l.value.reDraw()}else{const t={prompts:b.value,statics:w.value,colors:x.value,texts:D.value,image:T.value,type:_.value,tileType:e};l.value.add("layer",null,f.value,t)}})())},[m("i",{class:v(`bi ${y(Pe)}`)},null,2)])])]),m("div",Ll,[g(Y,null,{default:h((()=>["layer"===I.value?(u(),i("div",Sl,[Al,m("div",Ol,[g(a,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e)},null,8,["modelValue"])])])):d("",!0),m("div",Rl,[(u(!0),i(A,null,S(Object.keys(y(Xt)),(e=>(u(),i("div",{class:v(["setting-item-value",{selected:e===_.value}]),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"},key:e,label:y(Xt)[e],onClick:t=>{return a=e,w.value=[],x.value=[],D.value=[],b.value=[],k.value=null,T.value=null,void(_.value=a);var a},value:e},[E(L(y(Xt)[e])+" ",1),Pl],10,Ml)))),128))]),"statics"===_.value?(u(),i("div",zl,[Ul,m("div",Nl,[g(U,{multiple:"",modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e)},{default:h((()=>[(u(!0),i(A,null,S(z(),(e=>(u(),c(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):d("",!0),"prompts"===_.value?(u(),i("div",Gl,[jl,m("div",Hl,[g(U,{multiple:"",modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value=e)},{default:h((()=>[(u(!0),i(A,null,S(n.promptsList,(e=>(u(),c(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):d("",!0),"colors"===_.value?(u(),i("div",Yl,[Vl,m("div",Bl,[g(U,{multiple:"",modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=e=>x.value=e)},{default:h((()=>[(u(!0),i(A,null,S(n.colorsList,(e=>(u(),c(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):d("",!0),"texts"===_.value?(u(),i("div",Xl,[Wl,m("div",Fl,[g(U,{multiple:"",modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=e=>D.value=e)},{default:h((()=>[(u(!0),i(A,null,S(n.textsList,(e=>(u(),c(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):d("",!0),"statics"===_.value||"prompts"===_.value?(u(),i("div",$l,[Jl,m("div",Zl,[g(H,{style:{width:"100%"},"before-upload":P,accept:".png","show-file-list":!1,action:""},{default:h((()=>[k.value?d("",!0):(u(),c(G,{key:0,style:{width:"6.8rem",height:"3.5rem",padding:"0"}},{default:h((()=>[E("上传图片")])),_:1})),k.value?(u(),c(G,{key:1,style:{width:"6.8rem",height:"3.5rem",padding:"0",position:"relative"}},{default:h((()=>[g(j,{fit:"cover",style:{width:"6.8rem",height:"3.5rem"},src:k.value},null,8,["src"]),m("div",{class:"remove-image-btn",onClick:p(R,["stop"])},[m("div",{class:v(["bi",y(Ne)])},null,2)])])),_:1})):d("",!0)])),_:1})])])):d("",!0)])),_:1})])])],6)}}},[["__scopeId","data-v-e3f0db90"]]);var ql=re({},[["render",function(e,t){return u(),i("div")}]]);const Kl={class:"image-like"},es={class:"slider-area"},ts=(e=>(C("data-v-50613eb8"),e=e(),k(),e))((()=>m("div",{class:"slider-name"},"相似度",-1))),as={class:"slider-handle"},ls={class:"image-area"},ss={class:"image-item"},ns=["src"],is={class:"image-item"},os=["src"];var rs=re({__name:"imageLike",props:{imageUrl:{type:String,default:""}},emits:["setNewImageUrl"],setup(e,{emit:t}){const a=e,l=t,n=s(50),o=s(null),r=()=>{const e=Be();(function(e,t){return Et.post(`/teai/img2img?image_url=${e}&similarity=${t}`)})(a.imageUrl,n.value/100).then((t=>{fa(t).then((t=>{t.length&&(e.close(),o.value=t[0].result,l("setNewImageUrl",o.value))}))}))};return(e,t)=>{const l=M("el-slider");return u(),i("div",Kl,[m("div",es,[ts,m("div",as,[g(l,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),min:0,max:100},null,8,["modelValue"])]),m("div",{class:"slider-btn-area"},[m("div",{onClick:r},"生成")])]),m("div",ls,[m("div",ss,[m("img",{src:a.imageUrl},null,8,ns)]),m("div",is,[m("img",{src:o.value},null,8,os)])])])}}},[["__scopeId","data-v-50613eb8"]]);var ds=re({},[["render",function(e,t){return u(),i("div")}]]);const us={class:"image-generate-setting-handle-area"},cs={class:"change-setting-type-area"},hs=["onClick"],ms={class:"handle-btn-area"},vs={class:"image-generate-setting-component-area"};var ps=re({__name:"imageGenerate",emits:["replaceImage"],setup(e,{expose:t,emit:a}){const l=[{name:"相似生成",component:rs},{name:"融合图像",component:ql},{name:"文本控制",component:ds}],n=s(0),o=s(Pa),h=s(Ma),g=s(!1),f=s(null),w=s(null),b=s(null),x=s("element"),D=s(!1),E=()=>{D.value=!1,setTimeout((()=>{g.value=!1}),200)},C=e=>{b.value=e};return t({init:(e,t="element")=>{if(xa(e.image)){const a=ta(e.image,`element_${e.uuid}`),l=new FormData;l.append("file",a),ba(`element_${e.uuid}`,l).then((a=>{f.value=a,w.value=e.uuid,x.value=t,b.value=null,g.value=!0,R((()=>{D.value=!0}))}))}else f.value=e.image,w.value=e.uuid,x.value=t,b.value=null,g.value=!0,R((()=>{D.value=!0}))}}),(e,t)=>g.value?(u(),i("div",{key:0,class:"image-generate-outer",onClick:t[3]||(t[3]=e=>E())},[m("div",{class:v(["image-generate show_start",{show_end:D.value}]),onClick:t[2]||(t[2]=p((()=>{}),["stop"]))},[m("div",us,[m("div",cs,[m("div",{class:"component-selected",style:r({left:3.2*n.value+.05+"rem"})},null,4),(u(),i(A,null,S(l,((e,t)=>m("div",{class:"component-item",onClick:e=>n.value=t,key:e.name},L(e.name),9,hs))),64))]),m("div",ms,[m("div",{class:"handle-btn",onClick:t[0]||(t[0]=e=>E())},[m("i",{class:v(`bi ${y(Ae)}`)},null,2)]),m("div",{class:"handle-btn",onClick:t[1]||(t[1]=e=>(async()=>{g.value=!1;const e=await la(b.value);o.value.findData(x.value,w.value).setData({image:e}),h.value.reDraw()})())},[m("i",{class:v(`bi ${y(Pe)}`)},null,2)])])]),m("div",vs,[g.value?(u(),c(B(l[n.value].component),{key:0,imageUrl:f.value,onSetNewImageUrl:C,ref:"componentDom"},null,40,["imageUrl"])):d("",!0)])],2)])):d("",!0)}},[["__scopeId","data-v-7c435eda"]]);const gs=e=>(C("data-v-514fac87"),e=e(),k(),e),ys={class:"editor-text-setting-title"},fs=gs((()=>m("div",{class:"editor-text-setting-content"},"编辑文本",-1))),ws={class:"editor-text-setting-close-area"},bs={class:"editor-text-setting-inner"},xs={class:"editor-text-setting"},Ds=gs((()=>m("div",{class:"editor-text-setting-name"},"文本内容",-1))),Es={class:"editor-text-setting-value"},Cs={class:"editor-text-setting"},ks=gs((()=>m("div",{class:"editor-text-setting-name"},"文本颜色",-1))),Ts={class:"editor-text-setting-value"},Is={class:"editor-text-setting"},_s=gs((()=>m("div",{class:"editor-text-setting-name"},"文本字号",-1))),Ls={class:"editor-text-setting-value"};var Ss=re({__name:"editorTextSetting",setup(e,{expose:t}){const a=s(!1),l=s(Pa),n=s(null),o=s({}),r=s(!1),c=()=>{r.value=!1,setTimeout((()=>{a.value=!1}),200)};return t({init:e=>{const{fontSetting:t}=e;n.value=e.uuid,a.value=!0;const l=JSON.parse(JSON.stringify(t));l.font_color=ra(l.font_color),o.value=l,R((()=>{r.value=!0}))}}),(e,t)=>{const s=M("el-input"),h=M("el-color-picker"),f=M("el-input-number");return a.value?(u(),i("div",{key:0,class:"editor-text-setting-outer",onClick:t[6]||(t[6]=e=>c())},[m("div",{class:v(["editor-text-setting-box show_start",{show_end:r.value}]),onClick:t[5]||(t[5]=p((()=>{}),["stop"]))},[m("div",ys,[fs,m("div",ws,[m("div",{onClick:t[0]||(t[0]=e=>c())},[m("i",{class:v(`bi ${y(Ae)}`)},null,2)]),m("div",{onClick:t[1]||(t[1]=e=>(()=>{const e=l.value.findData("element",n.value),t=JSON.parse(JSON.stringify(o.value));t.font_color=oa(t.font_color);const a=za.getTextWidth(t);e.setData({x:e.x+e.width/2-a/2,width:a,height:t.font_size,fontSetting:t}),l.value.reDraw(),c()})())},[m("i",{class:v(`bi ${y(Pe)}`)},null,2)])])]),m("div",bs,[m("div",xs,[Ds,m("div",Es,[g(s,{modelValue:o.value.content,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.content=e)},null,8,["modelValue"])])]),m("div",Cs,[ks,m("div",Ts,[g(h,{style:{width:"100%"},"color-format":"rgba","show-alpha":"",modelValue:o.value.font_color,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.font_color=e)},null,8,["modelValue"])])]),m("div",Is,[_s,m("div",Ls,[g(f,{controls:!1,modelValue:o.value.font_size,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.font_size=e)},null,8,["modelValue"]),E(" px ")])])])],2)])):d("",!0)}}},[["__scopeId","data-v-514fac87"]]);const As=e=>(C("data-v-5a0402fe"),e=e(),k(),e),Os={class:"editor-text-setting-title"},Rs=As((()=>m("div",{class:"editor-text-setting-content"}," 编辑颜色 ",-1))),Ms={class:"editor-text-setting-close-area"},Ps={class:"editor-text-setting-inner"},zs={class:"editor-text-setting"},Us=As((()=>m("div",{class:"editor-text-setting-name"}," 纯色层颜色 ",-1))),Ns={class:"editor-text-setting-value"};var Gs=re({__name:"editorColorSetting",setup(e,{expose:t}){const a=s(!1),l=s(Pa),n=s(null),o=s({}),r=s(!1),c=()=>{r.value=!1,setTimeout((()=>{a.value=!1}),200)};return t({init:e=>{const{color:t}=e;n.value=e.uuid,a.value=!0;const l={color:ra(t)};o.value=l,R((()=>{r.value=!0}))}}),(e,t)=>{const s=M("el-color-picker");return a.value?(u(),i("div",{key:0,class:"editor-text-setting-outer",onClick:t[4]||(t[4]=e=>c())},[m("div",{class:v(["editor-text-setting-box show_start",{show_end:r.value}]),onClick:t[3]||(t[3]=p((()=>{}),["stop"]))},[m("div",Os,[Rs,m("div",Ms,[m("div",{onClick:t[0]||(t[0]=e=>c())},[m("i",{class:v(`bi ${y(Ae)}`)},null,2)]),m("div",{onClick:t[1]||(t[1]=e=>(()=>{const e=l.value.findData("element",n.value),t=JSON.parse(JSON.stringify(o.value));t.color=oa(t.color),e.setData(t),l.value.reDraw(),c()})())},[m("i",{class:v(`bi ${y(Pe)}`)},null,2)])])]),m("div",Ps,[m("div",zs,[Us,m("div",Ns,[g(s,{style:{width:"100%"},"color-format":"rgba","show-alpha":"",modelValue:o.value.color,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.color=e)},null,8,["modelValue"])])])])],2)])):d("",!0)}}},[["__scopeId","data-v-5a0402fe"]]);const js=e=>(C("data-v-02ec3f14"),e=e(),k(),e),Hs={class:"editor-layer-setting-box"},Ys={class:"editor-layer-setting-title"},Vs={class:"editor-layer-setting-handle-area"},Bs={class:"setting-value-box"},Xs={class:"setting-item",style:{"justify-content":"space-between"}},Ws=js((()=>m("i",{class:"bi bi-arrow-90deg-left",style:{"margin-left":"0.1rem"}},null,-1))),Fs=js((()=>m("i",{class:"bi bi-arrow-90deg-right",style:{"margin-left":"0.1rem"}},null,-1))),$s=js((()=>m("i",{class:"bi bi-arrows-expand-vertical",style:{"margin-left":"0.1rem"}},null,-1))),Js=js((()=>m("i",{class:"bi bi-arrows-expand",style:{"margin-left":"0.1rem"}},null,-1))),Zs={class:"setting-item",style:{border:"none",margin:"0"}},Qs=js((()=>m("div",{class:"setting-item-label"},"位置X",-1))),qs={class:"setting-item-value"},Ks=js((()=>m("div",{class:"setting-item-label"},"位置Y",-1))),en={class:"setting-item-value"},tn={class:"setting-item",style:{border:"none",margin:"0"}},an=js((()=>m("div",{class:"setting-item-label"},"宽度W",-1))),ln={class:"setting-item-value"},sn=js((()=>m("div",{class:"setting-item-label"},"高度H",-1))),nn={class:"setting-item-value"},on={class:"setting-item"},rn=js((()=>m("div",{class:"setting-item-label"},"透明度",-1))),dn={class:"setting-item-value",style:{padding:"0 0.4rem"}},un=js((()=>m("div",{class:"setting-item",style:{border:"none",margin:"0"}},[m("div",{class:"editor-layer-setting-title"},"高级参数")],-1))),cn=js((()=>m("div",{class:"setting-item"},[m("div",{class:"setting-item-value"})],-1)));var hn=re({__name:"editorElementSetting",emits:["save"],setup(e,{expose:t,emit:a}){const l=s(Pa),n=s(!1),o=s(null);s([]);const r=s(null),d=s(0),c=s(0),p=s(0),f=s(0),w=s(100),b=s(0),x=s(!1),D=s(!1),C=s(new Zt),k=s(null);let T=null;const I=(e=null)=>{const t=l.value.findData("element",e);r.value&&r.value!==e&&S(),T||(T=JSON.parse(JSON.stringify(t))),n.value=!0,o.value=t?t.name:"",r.value=t?t.uuid:null,d.value=t.x||0,c.value=t.y||0,p.value=t.width||0,f.value=t.height||0,w.value=100*t.opacity,b.value=t.rotate||0,x.value=t.xOverturn||!1,D.value=t.yOverturn||!1},_=(e="right")=>{"right"===e?b.value+=Math.PI/2:b.value-=Math.PI/2,A()},L=(e="x")=>{"x"===e?x.value=!x.value:D.value=!D.value,A()},S=()=>{const e={name:T.name,uuid:T.uuid,x:T.x,y:T.y,width:T.width,height:T.height,opacity:T.opacity,rotate:T.rotate,xOverturn:T.xOverturn,yOverturn:T.yOverturn};l.value.findData("element",r.value).setData(e),l.value.reDraw(),T=null},A=()=>{const e={name:o.value,uuid:r.value,x:d.value,y:c.value,width:p.value,height:f.value,opacity:w.value/100,rotate:b.value,xOverturn:x.value,yOverturn:D.value};l.value.findData("element",r.value).setData(e),l.value.reDraw(),I(r.value)};return t({show:I}),(e,t)=>{const a=M("el-input-number"),l=M("el-slider"),s=M("el-scrollbar");return u(),i("div",{class:v(["editor-layer-setting",{show:n.value}])},[m("div",Hs,[m("div",Ys,[E(" 参数调节 "),m("div",Vs,[m("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>(S(),r.value=null,void(n.value=!1)))},[m("i",{class:v(`bi ${y(Ae)}`)},null,2)]),m("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>{o.value?(A(),n.value=!1):N.error("请输入名称后保存")})},[m("i",{class:v(`bi ${y(Pe)}`)},null,2)])])]),m("div",Bs,[g(s,null,{default:h((()=>[m("div",Xs,[m("div",{class:"setting-item-value handle-btn",onClick:t[2]||(t[2]=e=>_("left")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[E(" 左转 "),Ws]),m("div",{class:"setting-item-value handle-btn",onClick:t[3]||(t[3]=e=>_("right")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[E(" 右转 "),Fs]),m("div",{class:"setting-item-value handle-btn",onClick:t[4]||(t[4]=e=>L("x")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[E(" 水平翻转 "),$s]),m("div",{class:"setting-item-value handle-btn",onClick:t[5]||(t[5]=e=>L("y")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[E(" 垂直翻转 "),Js])]),m("div",Zs,[m("div",{class:v(["setting-item-min",{handing:"x"===k.value,handingLock:k.value}]),onMousedown:t[8]||(t[8]=e=>(e=>{let t=e.pageX;C.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX?d.value--:t<e.pageX&&d.value++,t=e.pageX,A()})),k.value="x",C.value.addListener(document.documentElement,"mouseup",(e=>{C.value.removeAllListeners(),k.value=null}))})(e))},[Qs,m("div",qs,[g(a,{style:{width:"2rem"},modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=e=>d.value=e),onChange:t[7]||(t[7]=e=>A()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34),m("div",{class:v(["setting-item-min",{handing:"y"===k.value,handingLock:k.value}]),onMousedown:t[11]||(t[11]=e=>(e=>{let t=e.pageX;C.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX?c.value--:t<e.pageX&&c.value++,t=e.pageX,A()})),k.value="y",C.value.addListener(document.documentElement,"mouseup",(e=>{C.value.removeAllListeners(),k.value=null}))})(e))},[Ks,m("div",en,[g(a,{style:{width:"2rem"},modelValue:c.value,"onUpdate:modelValue":t[9]||(t[9]=e=>c.value=e),onChange:t[10]||(t[10]=e=>A()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34)]),m("div",tn,[m("div",{class:v(["setting-item-min",{handing:"width"===k.value,handingLock:k.value}]),onMousedown:t[14]||(t[14]=e=>(e=>{let t=e.pageX;C.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX&&p.value>1?p.value--:t<e.pageX&&p.value>1&&p.value++,t=e.pageX,A()})),k.value="width",C.value.addListener(document.documentElement,"mouseup",(e=>{C.value.removeAllListeners(),k.value=null}))})(e))},[an,m("div",ln,[g(a,{style:{width:"2rem"},modelValue:p.value,"onUpdate:modelValue":t[12]||(t[12]=e=>p.value=e),onChange:t[13]||(t[13]=e=>A()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34),m("div",{class:v(["setting-item-min",{handing:"height"===k.value,handingLock:k.value}]),onMousedown:t[17]||(t[17]=e=>(e=>{let t=e.pageX;C.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX&&f.value>1?f.value--:t<e.pageX&&f.value>1&&f.value++,t=e.pageX,A()})),k.value="height",C.value.addListener(document.documentElement,"mouseup",(e=>{C.value.removeAllListeners(),k.value=null}))})(e))},[sn,m("div",nn,[g(a,{style:{width:"2rem"},modelValue:f.value,"onUpdate:modelValue":t[15]||(t[15]=e=>f.value=e),onChange:t[16]||(t[16]=e=>A()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34)]),m("div",on,[rn,m("div",dn,[g(l,{onInput:t[18]||(t[18]=e=>A()),style:{"--el-slider-button-size":"0.5rem","--el-slider-button-wrapper-size":"0.8rem",height:"0.8rem","--el-slider-button-wrapper-offset":"-0.3rem"},max:100,min:0,modelValue:w.value,"onUpdate:modelValue":t[19]||(t[19]=e=>w.value=e)},null,8,["modelValue"])])]),un,cn])),_:1})])])],2)}}},[["__scopeId","data-v-02ec3f14"]]);const mn=["onClick"],vn={key:0,class:"explosion-line-1"},pn={class:"explosion-prompt-item"},gn={class:"explosion-item-name"},yn={class:"explosion-prompt-edit-btn"},fn={key:0,class:"explosion-prompt-info"},wn={key:1,class:"explosion-prompt-info"},bn={class:"explosion-diagram-item"},xn={key:0,class:"explosion-name"},Dn=["onClick"],En={class:"explosion-image"},Cn=["src"];var kn=re({__name:"explosionDiagram",props:{data:{type:Array,default:()=>[]},widthPrompt:{type:Boolean,default:()=>!1},explosionStyle:{type:Object,default:()=>({width:"5rem",height:"7rem"})}},setup(e,{expose:t}){const a=e,l=s(null),o=s(null),c=s(null),f=s(null),w=s(null),b=s(""),x={COMMENCE:"commence",INCORPORATION:"incorporation"},D=s(x.INCORPORATION),C=e=>{x.hasOwnProperty(e)||"CHANGE"===e?(o.value=null,"CHANGE"===e?D.value===x.COMMENCE?D.value=x.INCORPORATION:D.value=x.COMMENCE:D.value=x[e]):N.error("非法参数")},k=e=>D.value===x.COMMENCE?Object.assign({left:2*e-a.data.length+"rem",top:-.5*e+.5+"rem",zIndex:a.data.length-e-1},a.explosionStyle):Object.assign({left:"0rem",top:"0rem",transform:"skewY(0deg)",zIndex:a.data.length-e-1,backgroundColor:e===a.data.length-1?"var(--t-sub-color)":"transparent"},a.explosionStyle),T=e=>c.value===e?{hiding:!0}:f.value===e?{showing:!0}:l.value===e?{show:!0}:l.value!==e?{hide:!0}:void 0;return n((()=>{a.data.length&&(l.value=0),setTimeout((()=>{C("COMMENCE")}))})),t({changeExplosionType:C}),(t,s)=>{const n=M("el-icon"),I=M("t-button");return u(),i("div",{class:"explosion-diagram-body",style:r({paddingTop:(D.value,x.COMMENCE,0)+"rem"})},[m("div",{class:"explosion-all",style:r(a.explosionStyle)},[(u(!0),i(A,null,S(a.data,((t,_)=>(u(),i(A,null,[o.value===_||D.value===x.COMMENCE||!o.value&&0!==o.value&&D.value===x.INCORPORATION?(u(),i("div",{class:v(["explosion-item",{selected:D.value===x.COMMENCE&&l.value===_}]),key:t.uuid,onClick:e=>(e=>new Promise((t=>{D.value===x.COMMENCE&&l.value!==e?(w.value=null,null!==l.value&&(c.value=l.value),f.value=e,setTimeout((()=>{l.value=f.value,f.value=null})),setTimeout((()=>{c.value=null,t()}),200)):t()})))(_),style:r(k(_))},[D.value===x.COMMENCE||null!==o.value?(u(),i("div",{key:0,class:v(["explosion-diagram-handle-area",Object.assign(T(_),{nomal:null!==o.value})])},[e.widthPrompt?(u(),i("div",vn)):d("",!0),e.widthPrompt?(u(),i("div",{key:1,class:"explosion-line-2",style:r({width:1.5*(D.value===x.COMMENCE||null===o.value?a.data.length-_:1)+"rem"})},null,4)):d("",!0),e.widthPrompt?(u(),i("div",{key:2,class:"explosion-prompt-area",style:r({left:1.5*(D.value===x.COMMENCE||null===o.value?a.data.length-_:1)+1+"rem"})},[m("div",pn,[m("div",gn,[E(L(t.name)+" ",1),m("div",yn,[g(n,{class:"explosion-prompt-edit-item",onClick:p((e=>(e=>{b.value=a.data[e].prompt,w.value=e})(_)),["stop"])},{default:h((()=>[g(y(X))])),_:2},1032,["onClick"])])]),w.value!==_?(u(),i("div",fn,L(t.prompt),1)):d("",!0),w.value===_?(u(),i("div",wn,[W(m("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>b.value=e)},null,512),[[F,b.value]])])):d("",!0),m("div",{class:"explosion-prompt-save-handle-area",style:r({height:w.value===_?"0.8rem":"0rem"})},[g(I,{type:"info",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"},onClick:s[1]||(s[1]=e=>w.value=null)},{default:h((()=>[E("取消")])),_:1}),g(I,{type:"success",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"}},{default:h((()=>[E("生成")])),_:1})],4)])],4)):d("",!0)],2)):d("",!0),m("div",bn,[D.value===x.COMMENCE?(u(),i("div",xn,L(t.name),1)):d("",!0),null!==o.value||D.value===x.COMMENCE?(u(),i("div",{key:1,class:"show-explosion-item-handle-btn",onClick:p((e=>(e=>{null===o.value&&D.value===x.COMMENCE?(C("INCORPORATION"),o.value=e):null!==o.value&&(C("COMMENCE"),o.value=null),l.value=e})(_)),["stop"]),style:r({top:(D.value===x.COMMENCE?"1.2":"0.2")+"rem"})},L(null!==o.value?"隐藏":"展示"),13,Dn)):d("",!0),m("div",En,[m("img",{src:t.image},null,8,Cn)])])],14,mn)):d("",!0)],64)))),256))],4)],4)}}},[["__scopeId","data-v-ae7efb16"]]);const Tn={class:"model-draw-board"},In={key:0,class:"model-draw-area"},_n={class:"model-handle-area"};var Ln=re({__name:"modelDrawBoard",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]},layerData:{},editorType:{}},emits:["setTypeList","setGroupList","setSelectedElement","layerData"],setup(e,{expose:t,emit:a}){const l=e,o=a,r=s(null),c=s(null),h=s(null),v=s(null),p=s(null),f=s(null),w=s(null),b=s(null),x=s(null);s("editor");const D=s([]),E=s({width:0,height:0}),C=s(null),k=s(za),T=s(Pa),I=s(Ma);s(Object.assign({name:l.setting.name},l.setting.canvasData));const _=s(null),L=async()=>{k.value.viewType===Vt?(k.value.setViewType(Bt),await S()):(v.value.changeExplosionType("INCORPORATION"),k.value.setViewType(Vt),await S()),E.value={width:k.value.realWidth*k.value.zoomRatio*.8+"px",height:k.value.realHeight*k.value.zoomRatio*.8+"px"}},S=async()=>{D.value=await I.value.getLayerImage()},A=e=>{_.value=C.value.changeHandleType(e)},O=()=>{c.value.show()},R=()=>{C.value.exportImage()},M=(e,t)=>{switch(t){case"text":w.value.init(e);break;case"color":b.value.init(e)}},P=async()=>{const e=["groups","layers","elements"];for(let t of e)for(let e in l.layerData[t]){const a=l.layerData[t][e];if(a.image){const e=await na(a.image);a.image=e}if("texts"===a.type&&a.fontSetting&&a.fontSetting.font){const e=await Da(a.fontSetting.font);a.fontSetting.fontFamily=e}T.value.add(t.slice(0,-1),a.parentUuid,a.name,a,e,a.zIndex),T.value.reDraw()}},z=(e=null)=>{e=e||C.value.setTypeList();const t=Object.keys(e).map((t=>({uuid:t,name:e[t].name,image:e[t].image,loraInfo:e[t].loraInfo,layerInfo:e[t].layerInfo})));o("setTypeList",t)},U=e=>{o("setGroupList",e)},N=(...e)=>{p.value.init(...e)},G=(e,t,a)=>{const l=Be();na(e).then((e=>{C.value.elementsList[t].setImage(e),C.value.reDraw(),l.close()}))},j=e=>{const{uuid:t}=e;delete e.uuid,t||C.value.addType({name:e.name,prompts:e.prompts,statics:e.statics,image:e.image}).then((e=>{z(e)}))},H=()=>{T.value.clearAllData(),I.value.toTextEditView=M,I.value.toImageGenerateView=N,I.value.toElementSetting=Y,I.value.generationController.setName(l.setting.name),k.value.init(r.value,l.setting,l.editorType).then((()=>{P().then((()=>{I.value.reDraw()}))}))},Y=(...e)=>{x.value.show(...e)};return n((()=>{H()})),t({toSettingLayer:(...e)=>{h.value.show(...e)},setSelectedLayer:(...e)=>{C.value.setTypeUuid(...e)},deleteGroup:e=>{C.value.deleteGroup(e)},deleteLayer:e=>{C.value.deleteType(e).then((({typeList:e,groups:t})=>{U(t),z(e)}))},deleteElement:e=>{C.value.deleteElement(e),z(typeList)},setGroup:e=>{const{layerUuids:t,groupUuid:a}=e;if(a){if(1===t.length&&a){const e=C.value.getGroupItem(a).layers.concat(t),l=C.value.updateGroup(a,{layers:[...new Set(e)]});U(l)}}else f.value.show(null,"group",e)},hideLayer:e=>{C.value.setHideLayer(e),new Promise((e=>{C.value.getAllLayerImage().then((t=>{D.value=Object.keys(t).map((e=>Object.assign({uuid:e,imageSrc:t[e].imageBase64},t[e]))).reverse(),e()}))}))},setDiagramImage:S}),(e,t)=>(u(),i("div",Tn,[W(m("div",{class:"model-draw-area",ref_key:"modelEditorDom",ref:r,tabindex:"0"},null,512),[[$,"editor"===y(za).viewType]]),"explosion"===y(za).viewType?(u(),i("div",In,[g(kn,{explosionStyle:E.value,data:D.value,ref_key:"explosionDiagramDom",ref:v},null,8,["explosionStyle","data"])])):d("",!0),m("div",_n,[g(rl,{handleType:_.value,onToCanvasSetting:O,onChangeHandleType:A,onExportImage:R,onChangeViewType:L,onToGenrateGroup:e.toGenrateGroup,editorType:l.editorType},null,8,["handleType","onToGenrateGroup","editorType"])]),g(Cl,{ref_key:"editorDrawBoardSettingDom",ref:c,editorType:l.editorType,onSave:e.canvasResize},null,8,["editorType","onSave"]),g(Ql,{ref_key:"editorLayerSettingDom",ref:h,staticsList:l.staticsList,promptsList:l.promptsList,colorsList:l.colorsList,textsList:l.textsList,onSave:j,onSaveGroup:e.saveGroup},null,8,["staticsList","promptsList","colorsList","textsList","onSaveGroup"]),g(ps,{onReplaceImage:G,ref_key:"imageGenerateDom",ref:p},null,512),g(Ss,{ref_key:"editorTextSettingDom",ref:w},null,512),g(Gs,{ref_key:"editorColorSettingDom",ref:b},null,512),g(hn,{ref_key:"editorElementSettingDom",ref:x},null,512)]))}},[["__scopeId","data-v-0c14cad4"]]);const Sn={class:"model-editor"};var An={tButton:Mt,tTag:Pt,tMask:de,modelCard:Gt,modelEditor:re({__name:"index",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]},layerData:{},editorType:{}},setup(e){s(Pa);const t=e,a=s(null),l=s(null),n=s([]),o=s([]),r=e=>{n.value=e},d=(...e)=>{a.value.setSelectedLayer(...e)},c=e=>{o.value=e},h=(...e)=>{a.value.toSettingLayer(...e)},m=e=>{a.value.deleteGroup(e)},v=e=>{a.value.deleteLayer(e)},p=e=>{a.value.deleteElement(e)},y=e=>{a.value.setGroup(e)},f=e=>{a.value.hideLayer(e)},w=(...e)=>{a.value.reGenerateGroup(...e)},b=(...e)=>{a.value.reGenerateLayer(...e)},x=(...e)=>{a.value.reGenerateElement(...e)},D=(...e)=>{l.value.setSelectedElement(...e)},E=()=>{a.value.setDiagramImage()};return(e,s)=>(u(),i("div",Sn,[g(Ln,{staticsList:t.staticsList,promptsList:t.promptsList,colorsList:t.colorsList,textsList:t.textsList,ref_key:"modelDrawBoardDom",ref:a,onSetTypeList:r,onSetGroupList:c,onSetSelectedElement:D,setting:t.setting,editorType:t.editorType,layerData:t.layerData},null,8,["staticsList","promptsList","colorsList","textsList","setting","editorType","layerData"]),g(el,{ref_key:"editorLayersDom",ref:l,typeList:n.value,groupList:o.value,onToLayerInfo:h,onSetSelectedLayer:d,onDeleteGroup:m,onDeleteLayer:v,onDeleteElement:p,onSetGroup:y,onHideLayer:f,onReGenerateGroup:w,onReGenerateLayer:b,onReGenerateElement:x,onSetDiagramImage:E,editorType:t.editorType},null,8,["typeList","groupList","editorType"])]))}},[["__scopeId","data-v-a26723b0"]])};const On=J(At);On.use(G()),On.use(xt),On.use(Z,{locale:Q}),On.use(q,{Options:{url:"data-source",inline:!0,button:!0,transition:!0}}),Object.keys(An).forEach((e=>{On.component(e,An[e])})),On.mount("#app");export{Be as T,re as _,pt as a,ra as b,we as c,yt as d,vt as g,Me as p,oa as r,gt as s};
