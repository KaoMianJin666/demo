var e=Object.defineProperty,t=(t,a,l)=>(((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(t,"symbol"!=typeof a?a+"":a,l),l);import{d as a,C as l,r as n,a as i,o as s,c as o,b as r,e as d,w as u,n as c,f as h,t as m,g as v,h as p,i as g,u as y,j as f,k as w,p as b,l as k,m as x,v as D,E as I,q as _,s as C,x as T,y as E,F as M,T as S,z as A,A as L,B as R,D as O,G as z,H as P,I as U,J as G,K as N,L as j,M as V,N as H,O as Y,P as B,Q as F,R as W,S as X,U as $,V as Z,W as J,X as Q,Y as q}from"./lib.b70eb088.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const K={},ee=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in K)return;K[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const l=document.createElement("link");return l.rel=t?"stylesheet":"modulepreload",t||(l.as="script",l.crossOrigin=""),l.href=e,document.head.appendChild(l),t?new Promise(((t,a)=>{l.addEventListener("load",t),l.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())):e()};const te=a({id:"public",state:()=>({rootDom:null,colorScheme:null,leftBarShowType:0,routePath:null}),getters:{getRootDom(){return this.rootDom},getColorScheme(){return this.colorScheme},getLeftBarShowType(){return this.leftBarShowType},getRoutePath(){return this.routePath}},actions:{setRootDom(e){this.rootDom=e},setRoutePath(e){this.routePath=e},setLeftBarShowType(e){this.leftBarShowType=e},setColorScheme(e){return new Promise((t=>{(e=(e=e||localStorage.getItem("colorScheme"))||"dark")&&function(e){switch(e){case"../../assets/style/animate.scss":return ee((()=>Promise.resolve({})),["assets/animate.003851da.css"]);case"../../assets/style/dark.scss":return ee((()=>Promise.resolve({})),["assets/dark.e97013b5.css"]);case"../../assets/style/global.scss":return ee((()=>Promise.resolve({})),["assets/global.0abb9cb0.css"]);case"../../assets/style/light.scss":return ee((()=>Promise.resolve({})),["assets/light.25455dc6.css"]);case"../../assets/style/style.scss":return ee((()=>import("./style.0f4827d1.js")),[]);default:return new Promise((function(t,a){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`../../assets/style/${e}.scss`).then((a=>{this.colorScheme&&this.removeTheme(this.colorScheme);const l=document.createElement("style");l.id=`theme-${e}`,l.innerText=a.default,document.head.appendChild(l),this.colorScheme=e,localStorage.setItem("colorScheme",this.colorScheme),document.documentElement.className=this.colorScheme,t()}))}))},removeTheme(e){const t=document.getElementById(`theme-${e}`);t&&t.parentNode.removeChild(t)}}});var ae=Object.freeze(Object.defineProperty({__proto__:null,usePublicStore:te,setupStore:function(e){return te(e)}},Symbol.toStringTag,{value:"Module"}));const le="_AICLOTH_CONSOLE_",ne="_AICLOTH_CONSOLE__token";function ie(){const e=localStorage.getItem(le+"USER");return e&&"undefined"!==e?JSON.parse(e):null}function se(e){localStorage.setItem(le+"USER",JSON.stringify(e))}function oe(){const e=l.get(ne);return""!==e||void 0!==e||null!==e?e:null}var re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAABSCAYAAAD6vuL9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFwmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyNC0wNi0xM1QwMDowMjoyMCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDgtMThUMjI6MTQ6NTQrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDgtMThUMjI6MTQ6NTQrMDg6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTlhYjU5ZGQtMmE4ZC0wZDRlLWEzN2ItZTFmN2E5ZWY0NmQ1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjE4QUY0REY0N0NCOTExRUU5Q0NBRDE2OEQ4QjU4NEZGIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjE3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjI3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiLz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTlhYjU5ZGQtMmE4ZC0wZDRlLWEzN2ItZTFmN2E5ZWY0NmQ1IiBzdEV2dDp3aGVuPSIyMDI0LTA4LTE4VDIyOjE0OjU0KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjUuMyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+pe30uAAABWVJREFUeJztnOFx4zYQhd+mAncQugO7gtAVxK4gSgXWVWC5Al8qoFOBfBXQqUDugE4FdAcvP0COKVgkARALUHN5Mzd3Q/GAp4/c5YJcCiTR/1mDSJYkaxodSP6R2xMADDmRPN6Q2VgxAGarIllk9rcucCQvSD6MALP1lAvgqsCRvCfZOkLr1TBD+K4CHI/zWKgaklcJPecDR5PH9guB2aqYIHyzgONnHmsjQxvqQe0LIAM4khuasEqhhkr5Lxk4mrOsTgTM1oGRw5cWuF9iDm5pA6BUHH9KVwAaKuY/TXC/K47tqg2Amgr5TxPcWlQA2DFy/vsZwPUqADzTlEPF0sF+JnC9bhEh/3mDo1km7WmumLehE69AG5j8Fxa+dCxHaJZJhxOX/nJk/zpedaGuhuTkxYy+5Qi72z0AapjLvK0UC+43AK8A3pXGLwC80CN8R8GxWyYBOCBfPQYAjyJyLSI3AK4BPCrOtYHJfw+zAHkiVGmWSa3jaV6NjFtHCKGXkbELks8Rxp9Sw0H+41So8jMsKwAXTsdIV2+nNorIu4hsANxAN3yfO4CF/aEdqhXyhqWt36Y+FJFXEbkE8Cd0AX6JKhtcqTR5qEqS27mdROQZ5uz7S8uHveEcCuAnOlT7XfhuAVwC+Fvb1DmAAzyq/UH+0wzfswHXawPHal9Enrv89w0KAM8NHHB8tXMB+B0m/0UNX01wH4pjA58AfcL3EmYFslia4H4ojj3UBo7VfgfwBjHyn1URh6ieGHsXOGaoGnrc7ej8tY5jjz+sCTTbzphLsTyy1dDxYbWHv+jgSIejzLSPCXtVdLzbQQNwzF9DJXCth8HthEEtOT+s4ekDfEslcKRHfmG+8HX1d0ED8J7djVoqgutV0S886kjzuurg6s/yqg6u15OrQa48/6UGR+qWB7H8OeU/JgY3NFg6Glxl/mMmcL0qxikPtLQf88fM4HotLQ+0VdECyBlwdUJzDf3Kg6zLN86AyxEeDf3CN0f+K+jSWEhzdJvEBiu6AywT+6vp2pHJPEe35Xrznxs4C+AhkbleDf2Wb98TePIDl+no9tpzPfkvDNzAYOqrG+mX/7QO8DJwiY7uKTX0W75tGRfgcnADc1eRzbmo4Uwvm9IBngbXTXZPj25LrqS6nwG41N9kAXxr7dzQ7+qWI/890AEgl8ObBDc2cO1ibmBwlfmPJjJCNQluThXzX92m1HDi6RbNmrcNHHsRuN7c1gVeRoBPE34OgWMuBter4bofzpz0xvA7QEeslrRAFAjr3XhZMKePSs3BY/SObGB6N54cAd5BuXcthWI23Wzh37v2CP2uJhXF7lYq8Nm7Vs7tLCI7mHcX1FtPY0urzauAOft889+7kp/o0u7I3OCzd+1iascOYB++q5cN7lVpnh2Ag2P+2yn6CNWbvcEGp/2iRZ//ipl9/1XyEKJ3AHf2xiNwicKlwHzr/a+K87vqA4bDtYi8f/l0WA1b21NU+y2thzN0/4GqOS15OW9PnwfSIxOluFnZ0HyhmPOMgdtP/J+a4y8u+y25ROQt0YtmZfe3tv45se0DwDcRuRGRV6dROHPGWfvmulkZopNnXPc9djRnd9v9+8KHE8/sYY2vRsGFiDHujgyq/TucUbUfU4tWDiLykiD/rVJRllyDF23PbrEeqmhr1Uw3K6f0qjo6Ay4OjuPmeNbQq6Hy78epgRtMuGO6TvKWjuVFwPdIC66bNEX5UmkAG3yH9OAGkxeMH741HV8FWOg9H7iBiRj5r2HCH1JeBbiBmZDlW0ulPDbjdT3gOkM++W/P/3/r/IuxktNNP2Vmf+sE14vH+a+lR5+KplYPrleukByTDe4/cYMrGGs5S3oAAAAASUVORK5CYII=",de=(e,t)=>{const a=e.__vccOpts||e;for(const[l,n]of t)a[l]=n;return a};const ue={class:"tab-hide-view"},ce={class:"tab-hide-view-main"},he={class:"tab-hide-view-other"};var me=de({__name:"navbarTab",props:{name:{type:String,default:"default"},height:{type:String,default:"4rem"},icon:{type:String,default:""},num:{type:Number,default:0}},setup(e){const t=e,a=n(!1);return(l,n)=>{const y=i("el-badge");return s(),o("div",{class:c(["tab-outer",{show:a.value}]),onMouseleave:n[1]||(n[1]=e=>{a.value=!1}),onClick:n[2]||(n[2]=e=>{a.value=!a.value}),style:g(a.value?{height:t.height}:{height:"1rem"})},[r("div",ue,[r("div",ce,[d(y,{value:e.num,class:"item","show-zero":!1},{default:u((()=>[r("i",{class:c(["bi",`bi-${e.icon}`])},null,2)])),_:1},8,["value"]),h(" "+m(e.name),1)]),r("div",he,[v(l.$slots,"other",{},void 0,!0)])]),r("div",{class:"tab-show-view",onClick:n[0]||(n[0]=p((()=>{}),["stop"])),style:g(a.value?{height:Number(t.height.replaceAll("rem",""))-1.5+"rem"}:{height:"0rem"})},[v(l.$slots,"default",{},void 0,!0)],4)],38)}}},[["__scopeId","data-v-77b23592"]]);const ve=e=>(b("data-v-6044c65a"),e=e(),k(),e),pe={class:"task-item"},ge={class:"task-item-main"},ye={class:"task-data"},fe=ve((()=>r("div",{class:"task-icon"},[r("i",{class:"bi bi-badge-hd-fill"})],-1))),we={class:"task-name-area"},be={class:"task-name"},ke={class:"task-progress-name"},xe={class:"task-handle-area"},De=[ve((()=>r("i",{class:"bi bi-eye-fill"},null,-1)))],Ie={key:1,class:"handle-btn"},_e=[ve((()=>r("i",{class:"bi bi-caret-right-fill"},null,-1)))],Ce={key:2,class:"handle-btn"},Te=[ve((()=>r("i",{class:"bi bi-pause-fill"},null,-1)))],Ee={key:3,class:"handle-btn"},Me=[ve((()=>r("i",{class:"bi bi-square-fill"},null,-1)))],Se={key:4,class:"handle-btn line"},Ae={key:5,class:"handle-btn"},Le=[ve((()=>r("i",{class:"bi bi-gear-fill"},null,-1)))],Re={class:"task-item-progress-bar"};var Oe=de({__name:"taskItem",props:{progress:{type:Number,default:0},name:{type:String,default:""},subName:{type:String,default:""},template_name:{},template_id:{},fromPath:{}},setup(e){const t=y(),a=e;return f((()=>{})),(l,n)=>(s(),o("div",pe,[r("div",ge,[r("div",ye,[fe,r("div",we,[r("div",be,m(e.name),1),r("div",ke,m(e.subName),1)])]),r("div",xe,[100===e.progress?(s(),o("div",{key:0,class:"handle-btn",onClick:n[0]||(n[0]=e=>{t.push({path:a.fromPath,query:{file_name:a.template_name,template_id:a.template_id}})})},De)):w("",!0),100!==e.progress?(s(),o("div",Ie,_e)):w("",!0),100!==e.progress?(s(),o("div",Ce,Te)):w("",!0),100!==e.progress?(s(),o("div",Ee,Me)):w("",!0),100!==e.progress?(s(),o("div",Se)):w("",!0),100!==e.progress?(s(),o("div",Ae,Le)):w("",!0)])]),r("div",{class:c(["task-item-progress-bar-box",{succsss:100===e.progress}])},[r("div",{class:"task-item-progress-bar-num",style:g(`left:calc(${e.progress}% - ${.4*(a.progress<10?0:a.progress>=10&&a.progress<=95?1:a.progress>95?4.5:void 0)}rem)`)},m(100!==e.progress?e.progress+"%":"生成完成"),5),r("div",Re,[r("div",{class:"task-item-progress-bar-info",style:g(`width:${e.progress}%`)},null,4)])],2)]))}},[["__scopeId","data-v-6044c65a"]]);const ze=(e,t)=>t===e.length,Pe=(e,t=0,a=0,l=[])=>{const n=e[t];return new Promise((i=>{var s;(s=n,an.post(`/teai/query_task?task_id=${s}`)).then((n=>{"error"===n.data.task_status?(a=0,t+=1,l.push("")):"processing"===n.data.task_status?++a>=30&&(a=0,t+=1,l.push("")):(a=0,t+=1,l.push(n.data)),ze(e,t)?i(l):setTimeout((()=>{i(Pe(e,t,a,l))}),2e3)})).catch((n=>{ze(e,t+=1)?i(l):setTimeout((()=>{i(Pe(e,t,a,l))}),2e3)}))}))};class Ue{constructor(e=null,a=null){t(this,"getGenerateResult",((e,t=0,a=0,l=[])=>Pe(e,0,0,[]))),this.name=e,this.template_id=a}getGenrateTaskId(e,t){return new Promise((a=>{(function(e,t,a,l=1){return an.post(`/teai/generate?template_id=${e}&layout_name=${t}&layer_name=${a}&num_images=${l}`)})(this.template_id,this.name,e,t).then((e=>{a(e.data)})).catch((e=>{a(null)}))}))}getGroupTaskResult(e=[],t=0,a={}){const l=e[t],{children:n}=l;return new Promise((i=>{this.getGenrateTaskId(l.uuid,n.length).then((l=>{this.getGenerateResult(l).then((l=>{n.forEach(((e,t)=>{a[e]=l[t]})),++t===e.length?i(a):i(this.getGroupTaskResult(e,t,a))}))})).catch((e=>{i(a)}))}))}getLayerTaskResult(e){const{uuid:t}=e;return new Promise((e=>{this.getGenrateTaskId(t,1).then((a=>{this.getGenerateResult(a).then((([a])=>{e({[t]:a})}))})).catch((t=>{e({})}))}))}getElementTaskResult(e,t,a=0){return new Promise((a=>{this.getGenrateTaskId(t,1).then((t=>{this.getGenerateResult(t).then((([t])=>{a({[e]:t})})).catch((()=>{a({[e]:null})}))}))}))}imgGenerateImg(e,t){return new Promise((a=>{(function(e,t){return an.post(`/teai/img2img?image_url=${e}&similarity=${t}`)})(e,t).then((e=>{this.getGenerateResult(e.data).then((([e])=>{a({image:e})})).catch((()=>{a({image:null})}))}))}))}setName(e){this.name=e}setId(e){this.template_id=e}}class Ge{constructor(e,t,a="",l=0){this.name=x(a),this.uuid=x(e),this.parentUuid=x(t),this.isShow=!0,this.children=[],this.zIndex=l}addChild(e){this.children.push(e)}changeParent(e){this.parentUuid=e}setData(e={}){Object.keys(e).forEach((t=>{this[t]=e[t]}))}hide(){this.isShow=!1}show(){this.isShow=!0}}const Ne={group:class extends Ge{constructor(e,t,a,l={}){super(e,t,a),this.prompts=l.prompts||null,this.statics=l.statics||null,this.colors=l.colors||null,this.texts=l.texts||null,this.type=l.type||null}},layer:class extends Ge{constructor(e,t,a,l={}){super(e,t,a),this.prompts=l.prompts||null,this.statics=l.statics||null,this.colors=l.colors||null,this.texts=l.texts||null,this.image=l.image||null,this.type=l.type||null,this.tileType=l.tileType||null,this.fontSetting=l.fontSetting||{content:"默认文本",font:"",fontFamily:"PingFangSC",font_color:[255,255,255,1],font_size:64}}},element:class extends Ge{constructor(e,t,a,l={}){super(e,t,a),this.x=l.x,this.y=l.y,this.width=l.width,this.height=l.height,this.image=l.image,this.rotate=l.rotate||0,this.type=l.type||null,this.tileType=l.tileType||null,this.lightness=l.lightness||0,this.opacity=l.opacity||1,this.xOverturn=l.xOverturn||!1,this.yOverturn=l.yOverturn||!1,this.colorGradation=l.colorGradation||1,this.hue=Array.isArray(l.hue)?l.hue:null,this.saturation=l.saturation||1,this.edgeFeather=l.edgeFeather||0,this.fontSetting=l.fontSetting||{content:"默认文本",font:"",fontFamily:"PingFangSC",font_color:[255,255,255,1],font_size:64},this.color=l.color||[0,0,0,1],this.handleImage=l.handleImage||null,this.virtuallyElements=l.virtuallyElements||[]}}},je={group:{parentType:null,childrenType:"layer"},layer:{parentType:"group",childrenType:"element"},element:{parentType:"layer",childrenType:null}};class Ve{constructor(){this.groups=x({}),this.layers=x({}),this.elements=x({}),this.showMap=x({groups:new Set,layers:new Set}),this.selectedMap=x({group:null,layer:null,element:null})}async add(e,t,a,l={},n=null,i=null){const s=Ne[e],o=this.findParent(t),r=this[`${e}s`];if(!s)throw new Error(`Unknown type: ${e}`);if(n){if(r[n]=new s(n,t,a,l),t)o&&(o.addChild(n),r[n].zIndex=i||o.children.length);else{const e=this.getAllList();r[n].zIndex=i||e.length}if("element"===e){const e=this.findParent(t);a=`${e.name}-${e.children.length+1}`,l=Object.assign(l,{image:e.image,type:e.type})}}else{if(n=D(),"element"===e){const e=this.findParent(t);a=`${e.name}-${e.children.length+1}`,l=Object.assign(l,{image:e.image,type:e.type})}if(r[n]=new s(n,t,a,l),t)o&&(o.addChild(n),r[n].zIndex=i||o.children.length);else{const e=this.getAllList();r[n].zIndex=i||e.length+1}"layer"===e&&"colors"===l.type&&(a=`${a}`,await this.add("element",n,a,Object.assign({width:100,height:100,x:0,y:0},l)),this.reDraw()),"layer"===e&&"statics"===l.type&&l.tileType&&(a=`${a}`,await this.add("element",n,a,Object.assign({width:100,height:100,x:0,y:0},l)),this.reDraw())}return n}setData(e,t,a={}){if(this[`${e}s`][t].setData(a),"layer"===e&&a.image){this.findData(e,t).children.forEach((e=>{this.setData("element",e,{image:a.image})}))}}delete(e,t){if(ba.checkInTask())return void I.error("该模板当前有在进行中的生成队列请在队列完成后操作");const a=this.findData(e,t);if(!a)return;const l=a.children;l.length&&l.forEach((t=>{this.delete(je[e].childrenType,t)}));const n=this[`${e}s`];if(a.parentUuid){const l=this.findParent(a.parentUuid,`${je[e].parentType}s`);l.children=l.children.filter((l=>{const n=this.findData(e,l);return n.zIndex>a.zIndex&&(n.zIndex-=1),l!==t})),"group"===je[e].parentType&&1===l.children.length&&this.unbindGroup({type:"layer",uuid:l.children[0]})}this.selectedMap[e]===t&&(this.selectedMap[e]=null),this.reDraw(),a&&a.tileType&&"element"===e&&this.delete("layer",a.parentUuid),delete n[t]}handleIsShow(e,t,a="show"){const l=this.findData(e,t);if(!l)return;const n=l.children;if(n.length?n.forEach((t=>{this.handleIsShow(je[e].childrenType,t,a)})):l[a](),l.parentUuid){const t=this.findData(je[e].parentType,l.parentUuid);t.children.every((t=>this.findData(e,t).isShow===("show"===a)))?t[a]():t.show()}this.reDraw()}findParent(e,t=""){for(const a of t?[t]:["groups","layers","elements"]){const t=this[a];if(t[e])return t[e]}return null}findData(e,t){return this[`${e}s`][t]}handleShowMap(e,t){this.showMap[`${e}s`].has(t)?this.showMap[`${e}s`].delete(t):this.showMap[`${e}s`].add(t)}isShowMapShow(e,t){return this.showMap[`${e}s`].has(t)}changeSelected(e){for(let t in e){t=Number(t);const a=e[t],l=Object.keys(je)[t];a&&"element"!==l&&this.showMap[`${l}s`].add(a),this.selectedMap[l]=a}this.reDraw()}isSelected(e,t){return this.selectedMap[e]===t}async bindGroup({fromData:e,toData:t,zIndex:a}){if(e.uuid!==t.uuid){if(a||0===a){const l=this.findData(e.type,e.uuid),n=this.findData(t.type,t.uuid);if(l.parentUuid!==n.parentUuid)return;const i=l.zIndex;let s=n.zIndex;const o=this.getListByParentUuid(l.parentUuid);i>s?(s=a+1,o.forEach((e=>{const{dataType:t,uuid:a}=e,l=e.zIndex;l<i&&l>=s&&(this[`${t}s`][a].zIndex+=1)})),l.zIndex=s):(o.forEach((e=>{const{dataType:t,uuid:a,zIndex:l}=e;l<=s&&l>i&&(this[`${t}s`][a].zIndex-=1)})),l.zIndex=Math.min(s,o.length))}else{if("group"===e.type)return;const a=this.findData(e.type,e.uuid),l=this.findData(t.type,t.uuid);if("group"===t.type){if(!new Set(l.children).has(a.uuid)){if(!this.bindGroupCheck([e.uuid,l.children[0]]))return;if(l.addChild(a.uuid),a.parentUuid){const t=this.findParent(a.parentUuid);a.changeParent(l.uuid),a.zIndex=l.children.length,t.children=t.children.filter((t=>{const l=this.findData("layer",t);return l.zIndex>e.zIndex&&(l.zIndex-=1),t!==a.uuid}))}else{const t=this.getListByParentUuid(a.parentUuid);a.changeParent(l.uuid),a.zIndex=l.children.length,t.forEach((({dataType:t,uuid:a})=>{const l=this.findData(t,a);l.zIndex>e.zIndex&&(l.zIndex-=1)}))}}}else{const n=this.bindGroupCheck([e.uuid,t.uuid]);if(!n)return;const i=Object.assign({texts:[],statics:[],prompts:[],colors:[]},{[n.type]:n.typesInfo});let s=null;if(l.parentUuid){s=l.parentUuid;const t=this.findData("group",s);if(a.parentUuid)this.unbindGroup(e),a.changeParent(s),t.addChild(a.uuid),a.zIndex=t.children.length;else{this.getListByParentUuid(a.parentUuid).forEach((({dataType:e,uuid:t})=>{const l=this.findData(e,t);l.zIndex>a.zIndex&&(l.zIndex-=1)})),a.changeParent(s),t.addChild(a.uuid),a.zIndex=t.children.length}}else{s=await this.add("group",null,`组-${Object.keys(this.groups).length+1}`,i);const t=this.findData("group",s);a.parentUuid&&this.unbindGroup(e),t.addChild(a.uuid),t.addChild(l.uuid),a.changeParent(s),l.changeParent(s),t.zIndex=l.zIndex,a.zIndex=2,l.zIndex=1}}}this.reDraw()}}unbindGroup(e){const{uuid:t,type:a}=e;if("group"===a)return;const l=this.findData(a,t);if(!l.parentUuid)return;const n=this.findParent(l.parentUuid);n.children=n.children.filter((e=>{const t=this.findData("layer",e);return t.zIndex>l.zIndex&&(t.zIndex-=1),e!==l.uuid})),0===n.children.length&&(this.delete("group",n.uuid),l.changeParent(null),l.zIndex=n.zIndex),1===n.children.length?(l.changeParent(null),l.zIndex=this.getAllList().length,this.unbindGroup({type:"layer",uuid:n.children[0]})):n.children.length>1&&(l.changeParent(null),l.zIndex=this.getAllList().length),this.reDraw()}getListByParentUuid(e){const t=[];return Object.keys(je).forEach((a=>{Object.keys(this[`${a}s`]).forEach((l=>{const n=this[`${a}s`][l];e===n.parentUuid&&(t[n.zIndex-1]=Object.assign({dataType:a},n))}))})),t}bindGroupCheck(e){let t=new Set,a=new Set,l=!0;return e.forEach(((e,n)=>{t.add(this.layers[e].type);const i=this.layers[e],s=i.type,o=new Set(i[s]);if(0===n)a=o;else{if(o.size!=o.size)return void(l=!1);for(let e of a)o.has(e)||(l=!1)}})),!([...t].length>1)&&(!!l&&{type:[...t][0],typesInfo:[...a]})}clearAllData(){this.groups={},this.layers={},this.elements={},this.showMap={groups:new Set,layers:new Set},this.selectedMap={group:null,layer:null,element:null}}getData(){return{groups:this.groups,layers:this.layers,elements:this.elements}}getAllList(){const e=Object.keys(this.groups).map((e=>({type:"group",uuid:e,zIndex:this.groups[e].zIndex}))),t=Object.keys(this.layers).filter((e=>!this.layers[e].parentUuid)).map((e=>({type:"layer",uuid:e,zIndex:this.layers[e].zIndex}))),a=[].concat(e,t),l=[];return a.forEach((e=>{const{zIndex:t}=e;l[t-1]=e})),l}async copyData(e,t,a){const l=this.findData(t,e),n=l.image;a=a||l.parentUuid;const i=JSON.parse(JSON.stringify(l));i.handleImage=l.handleImage,i.parentUuid=null,!i.tileType&&"element"===t&&i.x&&i.y&&(i.x+=100,i.y+=100);const s=await this.add(t,a||null,`${l.name}-${Math.round(1e3*Math.random())}`,i),o=this.findData(t,s);n&&o.setData({image:n}),o.children=[],o.zIndex=null,l.children.length&&l.children.forEach((async e=>{await this.copyData(e,je[t].childrenType,s)}));this.getListByParentUuid(a).forEach((e=>{const t=this.findData(e.dataType,e.uuid);"element"!==e.dataType?t.zIndex>=l.zIndex&&(t.zIndex+=1):t.zIndex>l.zIndex&&(t.zIndex+=1)})),o.zIndex="element"!==t?l.zIndex-1:l.zIndex+1,this.reDraw()}}class He{constructor(){this.listeners={}}addListener(e,t,a){e.addEventListener(t,a);const l=D();return this.listeners[l]={element:e,eventType:t,listener:a},l}removeListenersByEventType(e){const{listeners:t}=this;Object.keys(t).filter((a=>t[a].eventType===e)).forEach((e=>{this.removeListenter(e)}))}removeAllListeners(){for(var e in this.listeners)this.removeListenter(e);this.listeners={}}removeListenter(e){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener),delete this.listeners[e]}}const Ye="bi-arrow-left-circle",Be="bi-arrow-repeat",Fe="bi-eye",We="bi-pencil-square",Xe="bi-plus",$e="bi-save",Ze="bi-sliders",Je="bi-trash",Qe="bi-x-circle",qe="bi-back",Ke="edit",et="generate",tt="gallery",at="效果调节",lt="上传替换",nt="文本编辑",it="颜色编辑",st="图层编辑",ot="AI图生图",rt="重新生成",dt="删除元素",ut="删除图层",ct="删除组",ht="复制元素",mt="复制图层",vt="复制组";class pt{constructor(e=Ke){this.handelType=e,this.x=0,this.y=0,this.layerType=null,this.isShow=!1,this.dom=null,this.bindDom=null,this.isHasImage=!1,this.tileType=null}setHandle({uuid:e,type:t,tileType:a},{x:l,y:n},i,s=!1,o=document.body,r=null){return this.close(),this.bindDom=o,this.isHasImage=s,this.tileType=a,new Promise((a=>{this.x=l,this.y=n,this.handleUuid=e,this.elementType=t,this.layerType=i,this.createDom(r).then((e=>{a(e)}))}))}close(){this.isShow=!1,this.x=0,this.y=0,this.layerType=null,this.dom&&(this.bindDom.removeChild(this.dom),document.documentElement.onClick=()=>{},this.dom=null)}createDom(e=null){return new Promise((t=>{const a=document.createElement("div");a.className="editor-contextmenu-view",this.bindDom.appendChild(a),this.dom=a,document.documentElement.onclick=this.close.bind(this),this.createList(e).then((e=>{t(e)}))}))}createList(e=null){const t=this.getHandleList(this.handelType),{x:a,y:l,dom:n,bindDom:i}=this,s=(1.2*t.length-.2)*window.rootFont,o=i.getBoundingClientRect();let r=l+s>o.bottom?o.bottom-s-o.top:l-o.top;return n.style.top=`${r}px`,n.style.left=a-o.left+"px",new Promise((a=>{t.forEach((t=>{this.dom&&this.createItem(t,e).then((e=>{a(e)}))})),setTimeout((()=>{this.dom&&(this.dom.style.height=1.2*t.length-.2+"rem",this.dom.style.transform="scale(1, 1)")}))}))}createItem({name:e,icon:t,type:a="button"},l=null){const{handleUuid:n}=this;return new Promise((i=>{const s=document.createElement("div");s.className="editor-contextmenu-item";const o=document.createElement("i");o.className="editor-contextmenu-item-icon",o.className=`editor-contextmenu-item-icon bi ${t}`;const r=document.createElement("div");if(r.className="editor-contextmenu-item-name",r.innerText=e,s.appendChild(o),s.appendChild(r),"upload"===a){const t=document.createElement("input");t.type="file",s.appendChild(t),t.onclick=e=>{e.stopPropagation()},t.onchange=t=>{t.stopPropagation();const{target:a}=t;i({file:a.files[0],handleUuid:n,name:e}),this.close()}}else s.onclick=t=>{t.stopPropagation(),i({handleUuid:n,name:e}),this.close()};this.dom.appendChild(s),("texts"===l&&e===nt||"prompts"===l&&e===ot)&&s.click()}))}getHandleList(e=Ke){let t=[];e=e||this.handelType;const{isHasImage:a,elementType:l,layerType:n,tileType:i}=this;switch(n){case"element":switch(e){case Ke:if(t=a?[{name:at,icon:Ze,type:"button"},{name:lt,icon:"bi-upload",type:"upload"},{name:ht,icon:qe,type:"button"},{name:ot,icon:"bi-stars",type:"button"},{name:rt,icon:Be},{name:dt,icon:Je,type:"button"}]:[{name:at,icon:Ze,type:"button"},{name:lt,icon:"bi-upload",type:"upload"},{name:ht,icon:qe,type:"button"},{name:rt,icon:Be},{name:dt,icon:Je,type:"button"}],"texts"===l){const e=t.findIndex((({name:e})=>e===lt));t.splice(e,1,{name:nt,icon:We,type:"button"});const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}else if("colors"===l){const e=t.findIndex((({name:e})=>e===lt));t.splice(e,1,{name:it,icon:We,type:"button"});const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}break;case et:if(t=a?[{name:at,icon:Ze,type:"button"},{name:lt,icon:"bi-upload",type:"upload"},{name:ht,icon:qe,type:"button"},{name:ot,icon:"bi-stars",type:"button"},{name:rt,icon:Be},{name:dt,icon:Je,type:"button"}]:[{name:lt,icon:"bi-upload",type:"upload"},{name:rt,icon:Be},{name:dt,icon:Je,type:"button"}],"texts"===l){const e=t.findIndex((({name:e})=>e===lt));t.splice(e,1,{name:nt,icon:We,type:"button"});const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}else if("colors"===l){const e=t.findIndex((({name:e})=>e===lt));t.splice(e,1,{name:it,icon:We,type:"button"});const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}break;case tt:if(t=a?[{name:at,icon:Ze,type:"button"},{name:lt,icon:"bi-upload",type:"upload"},{name:ht,icon:qe,type:"button"},{name:dt,icon:Je,type:"button"}]:[{name:lt,icon:"bi-upload",type:"upload"},{name:ht,icon:qe,type:"button"},{name:dt,icon:Je,type:"button"}],"texts"===l){const e=t.findIndex((({name:e})=>e===lt));t.splice(e,1,{name:nt,icon:We,type:"button"});const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}else if("colors"===l){const e=t.findIndex((({name:e})=>e===lt));t.splice(e,1,{name:it,icon:We,type:"button"});const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}}break;case"layer":switch(e){case et:t=[{name:mt,icon:qe,type:"button"},{name:ut,icon:Je,type:"button"}];break;case Ke:t=[{name:st,icon:We,type:"button"},{name:mt,icon:qe,type:"button"},{name:ut,icon:Je,type:"button"}];break;case tt:t=[{name:mt,icon:qe,type:"button"},{name:ut,icon:Je,type:"button"}]}break;case"group":switch(e){case et:case tt:case Ke:t=[{name:vt,icon:qe,type:"button"},{name:ct,icon:Je,type:"button"}]}}if(i){const e=t.findIndex((({name:e})=>e===ht));t.splice(e,1);const a=t.findIndex((({name:e})=>e===at));t.splice(a,1)}return t}}function gt(e,t,a){const l=e.split(";base64,"),n=l[0].split(":")[1],i=atob(l[1]);let s=i.length;const o=new Uint8Array(s);for(;s--;)o[s]=i.charCodeAt(s);const r=yt(e,t,a);return new File([r],`${t}${d=a||n,{"image/jpeg":".jpg","image/png":".png","image/gif":".gif","application/pdf":".pdf"}[d]||".bin"}`,{type:a||n,lastModified:Date.now()});var d}function yt(e,t,a){const l=e.split(";base64,"),n=l[0].split(":")[1],i=atob(l[1]);let s=i.length;const o=new Uint8Array(s);for(;s--;)o[s]=i.charCodeAt(s);return new Blob([o],{type:a||n})}function ft(e){return new Promise((t=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{t(a)},a.src=e}))}function wt(e){return new Promise((t=>{(function(e){return new Promise((t=>{const a=new FileReader;a.onload=({target:e})=>{t(e.result)},a.readAsDataURL(e)}))})(e).then((e=>{ft(e).then((e=>{t(e)}))}))}))}function bt(e){return new Promise((t=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{t(a)},a.onerror=()=>[t(null)],a.src=e}))}function kt(e,t){const a=JSON.stringify(e),l=new Blob([a],{type:"application/json"});return new File([l],`${t}.json`,{type:"application/json",lastModified:Date.now()})}function xt(e){const t=e.match(/\d+/g);return t?t.map(Number):[]}function Dt(e){return`rgba(${e.join(",")})`}function It(e){return`rgb(${e.join(",")})`}const _t="编辑器",Ct="操作",Tt="绘制",Et="定位花",Mt="横向二方连续",St="纵向二方连续",At="四方连续",Lt={outerWidth:100,innerWidth:20};class Rt{constructor(){this.rootFont=x(window.rootFont),this.realWidth=x(2048),this.realHeight=x(2048),this.name=x(""),this.canvasOuterDom=x(null),this.canvasDom=x(null),this.ctx=x(null),this.zoomRatio=x(1),this.handleState=x(Ct),this.listeners=new He,this.startX=x(0),this.startY=x(0),this.isDrawing=x(!1),this.moveType=x(null),this.drawType=x(Et),this.handleController=x(null);const e=new Image;this.rotateImage=null,this.viewType="editor",e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE7mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjMgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyNC0wOS0xOVQyMDozNjo1NCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTlUMjA6Mzg6MDcrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTlUMjA6Mzg6MDcrMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI0ZWM4ZGEzLTEyMzYtODc0MC05ZjM3LTYxYTEzYjJjZGMzYSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyNGVjOGRhMy0xMjM2LTg3NDAtOWYzNy02MWExM2IyY2RjM2EiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyNGVjOGRhMy0xMjM2LTg3NDAtOWYzNy02MWExM2IyY2RjM2EiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjI0ZWM4ZGEzLTEyMzYtODc0MC05ZjM3LTYxYTEzYjJjZGMzYSIgc3RFdnQ6d2hlbj0iMjAyNC0wOS0xOVQyMDozNjo1NCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI1LjMgKFdpbmRvd3MpIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgYbnyIAAANaSURBVFiF7ZhBbuowEIb/ZJFNtskaIV8hyopL9ByRIm7BKlIPwB286AHKCcoqq1ZqRCXKE6qi8uQsQI3fAk/fNC+BQM1rFx3JG4jtz2PP+B87Wmt8Z3O/GuCY/QB+lQ0AjAHMAVQAagC60WoApflm0ndgrfWHdg7YLQE5jvMmhFhmWbbI83yjlNJKKZ3n+SZJkkIIsXRdd2uAd6bv6FKAksCCIHghoGOmlNJSylUQBC8MdGob8A6A9n3/lYORt9I0fYzjeBGG4ToMw7UQYpmm6SN5lIN6nlcZ0DtbgPcA9HA4fOaTpWn6yLaPztsD9meuNL9rz/OqLMsWvO9wOHw2/99/FvAOgI6i6ImfLwZWYh8Ag47+U+yDSHueV0kpVzROFEVPaPHkKYBT7jmllM6ybME81jsyzVg7AJq82fCkPBVwBGDneV7VAlfhSCQeGLNqQvq+/4r9ggenAN4C0FLKldZaSylXDK5rO/vYgCDzPN9orXWe5xsz9uwUwF0QBC+0ShN5O5znuaaNANSu625p/DAM1zBe7AM4AfNemqaPZoWduesMmwDQSZIUDS+O+wDO+eqM90qLcGQln8dxnDcA8z6ApRBiSTkL9r1HNgE7i0KIJYCqD2BNrmfbewkb8LlMlqj7ADZXdYntJSvjOF7wc9gG2JRJ7/enia7m/88WAR/CMFzz49QEdB3HqZVS4I2sKIqA/351dVVYhAOA330+0kmSFMekE4s0mx58D8hDW1zC5L0uSJZMNfZK2pbpRkC2BskA5iKn4DgAN7MINwU77xSQXVE8AlA7jvPGvUi67wJwAFByMWIk3MFEPYZRzdSJiQTbqWYKtr1snsmxPCgBaCHEknWyJRLI/pFy5gjtgH5qZm4+3l4A7l1utUi5WV9AGoiaLWsVrE0p1xfQto3RIvlN5H4QIzYAJfZBQ61L6dDrQwlT5POiKY5jKiHmvJMNwJ3v+69JkhSsxqVIn2NfSpZgrw/8pmp47qE5uBXAm5ubXzSZUkrTMwcV7lEUPSVJUrQV+aZI+sdzVgHDMFwfuhqbN1Ge5xt2G9VgZeYlAGcwB9513S09czQfj66vrxdCiKURGAQ2w5HMYDOKJ/j7zNH1/FaZb8bHwLoAnf+Za86xb//C+gP4WfsDkHE+0dPTz/8AAAAASUVORK5CYII=",this.handleLocked=!1,this.templateId=null,this.template_level="normal",this.template_filter="normal",this.points=1,this.hue=null,this.edgeFeather=0,this.drawX=0,this.drawY=0,e.onload=()=>{this.rotateImage=e},this.position={left:0,top:0}}init(e,t={},a=_t,l,{template_level:n,template_filter:i,points:s}){return new Promise((o=>{this.canvasOuterDom=e,this.name=t.name||null,this.realWidth=t.realWidth||2048,this.realHeight=t.realHeight||2048,this.viewType="editor",this.drawType=t.drawType||Et,this.position={left:0,top:0},this.templateId=l||null,this.template_level=n,this.template_filter=i,this.points=s,this.getCanvasSize().then((e=>{this.canvasDom=document.createElement("canvas"),this.canvasDom.width=e.outerWidth,this.canvasDom.height=e.outerHeight,this.drawX=(e.outerWidth-e.width)/2,this.drawY=(e.outerHeight-e.height)/2,this.zoomRatio=e.zoomRatio,this.canvasOuterDom.focus(),this.handleState=Ct,this.canvasOuterDom.appendChild(this.canvasDom),this.ctx=this.canvasDom.getContext("2d"),this.handleController=new pt(a),this.bindCanvasHandleListener(),o()}))}))}bindMainMove(){this.listeners.addListener(this.canvasDom,"mousedown",(e=>{this.handle("mousedown",e)})),this.listeners.addListener(this.canvasDom,"mousemove",(e=>{this.handle("mousemove",e)})),this.listeners.addListener(this.canvasDom,"mouseup",(e=>{this.handle("mouseup",e)})),this.listeners.addListener(this.canvasDom,"mouseleave",(e=>{this.handle("mouseleave",e)}))}unBindMove(){this.listeners.removeListenersByEventType("mousedown"),this.listeners.removeListenersByEventType("mousemove"),this.listeners.removeListenersByEventType("mouseup"),this.listeners.removeListenersByEventType("mouseleave")}bindHandleMove(){this.listeners.addListener(this.canvasOuterDom,"mousedown",(e=>{this.handle("mousedown",e)})),this.listeners.addListener(this.canvasOuterDom,"mousemove",(e=>{this.handle("mousemove",e)})),this.listeners.addListener(this.canvasOuterDom,"mouseup",(e=>{this.handle("mouseup",e)}))}bindCanvasHandleListener(){this.bindMainMove(),this.listeners.addListener(this.canvasDom,"click",(e=>{this.handle("selected",e)})),this.listeners.addListener(this.canvasDom,"dblclick",(e=>{this.handle("dblclick",e)})),this.listeners.addListener(this.canvasDom,"contextmenu",(e=>{this.handle("contextmenu",e)})),this.listeners.addListener(this.canvasOuterDom,"keydown",(e=>{this.handle("keydown",e)})),this.listeners.addListener(this.canvasOuterDom,"keyup",(e=>{this.handle("keyup",e)})),this.listeners.addListener(this.canvasOuterDom,"wheel",(e=>{const{drawX:t,drawY:a,realWidth:l,realHeight:n,zoomRatio:i}=this,s={width:this.canvasDom.width,height:this.canvasDom.height,zoomRatio:this.zoomRatio};if(e.deltaY>0){s.zoomRatio=Math.round(s.zoomRatio/11*10*1e4)/1e4;const e=l*(i-s.zoomRatio),t=n*(i-s.zoomRatio);this.drawX+=e/2,this.drawY+=t/2}else{s.zoomRatio=Math.round(11*s.zoomRatio/10*1e4)/1e4;const e=l*(s.zoomRatio-i),t=n*(s.zoomRatio-i);this.drawX-=e/2,this.drawY-=t/2}this.zoomRatio=s.zoomRatio,this.reDraw()}))}async resize(){const e=await this.getCanvasSize();this.canvasDom.width=e.outerWidth,this.canvasDom.height=e.outerHeight,this.drawX=(e.outerWidth-e.width)/2,this.drawY=(e.outerHeight-e.height)/2,this.zoomRatio=e.zoomRatio}lockHandle(e){this.handleState!==Tt&&"Space"===e.code&&(this.handleLocked=!0,this.canvasDom.className="canvas-key-down",this.unBindMove(),this.bindHandleMove())}unlockHandle(e){"Space"===e.code&&(this.handleLocked=!1,this.canvasDom.className="",this.unBindMove(),this.bindMainMove())}getCanvasSize(){const{realWidth:e,realHeight:t}=this,a=this.canvasOuterDom.getBoundingClientRect();return new Promise((l=>{if(a.width||a.height){const n=this.getZoomRatio(a.width,a.height,e,t);l(n)}else{const a=new ResizeObserver((n=>{for(let i of n){const{width:n,height:s}=i.contentRect;if(n&&s){const i=this.getZoomRatio(n,s,e,t);l(i),a.disconnect()}}}));a.observe(this.canvasOuterDom)}}))}getZoomRatio(e,t,a,l){const n=e,i=t;let s=1;return e/t<a/l?(t=t*a/e,s=e/a,e=a):(e=e*l/t,s=t/l,t=l),{outerWidth:n,outerHeight:i,width:a*s,height:l*s,zoomRatio:s}}destory(){this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.name="",this.handleState=null,this.canvasOuterDom=null,this.canvasDom=null,this.ctx=null}setData({name:e,realWidth:t,realHeight:a,drawType:l,template_filter:n,template_level:i,points:s},o="init"){this.name=e,this.drawType=l,this.template_filter=n,this.template_level=i,this.points=s,t!==this.realWidth||a!==this.realHeight?"edit"===o?_.confirm("修改尺寸将会清空所有元素，是否继续","警告",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((()=>{this.realWidth=t,this.realHeight=a,this.clearAllData(),this.resize().then((()=>{this.reDraw()}))})):(this.realWidth=t,this.realHeight=a,this.clearAllData(),this.resize().then((()=>{this.reDraw()}))):this.reDraw()}changeHandleType(e){this.handleState=e,this.canvasDom.style.cursor=e===Tt?"crosshair":"auto"}handle(e,t){const{handleState:a,handleLocked:l,startX:n,startY:i,zoomRatio:s}=this;if(l){const{pageX:a,pageY:l}=t;switch(e){case"keyup":this.unlockHandle(t);break;case"mousedown":this.canvasDom.className="canvas-key-down-mousedown",this.isDrawing=!0,this.startX=a,this.startY=l;break;case"mousemove":if(!this.isDrawing)return;const e=a-n,s=l-i;this.startX=a,this.startY=l,this.drawX+=e,this.drawY+=s,this.reDraw();break;case"mouseup":switch(t.button){case 0:this.canvasDom.className="canvas-key-down",this.isDrawing=!1;break;case 1:this.isDrawing=!1,this.unlockHandle({code:"Space"})}}}else switch(a){case Ct:this.handleEvent(e,t);break;case Tt:this.drawingEvent(e,t)}}handleEvent(e,t){switch(e){case"dblclick":this.checkContextMenu(t,!0);break;case"mousedown":switch(t.button){case 0:this.handleController.close(),this.checkMove(t);break;case 1:this.lockHandle({code:"Space"})}break;case"click":this.handleController.close();break;case"mousemove":this.moving(t);break;case"mouseup":switch(this.finishMove(t),t.button){case 0:this.finishMove(t);break;case 1:this.unlockHandle({code:"Space"})}break;case"contextmenu":this.checkContextMenu(t);break;case"selected":this.handleController.close(),this.selectedElement(t);break;case"mouseleave":this.finishMove(t);break;case"keydown":this.lockHandle(t)}}drawingEvent(e,t){switch(this.handleController.close(),e){case"mousedown":if(0!==t.button)return;this.toDraw(t);break;case"click":case"contextmenu":case"selected":break;case"mousemove":this.drawMove(t);break;case"mouseup":case"mouseleave":this.finishDraw(t);break;case"keydown":this.lockHandle(t)}}startDraw(e){const{offsetX:t,offsetY:a}=e;this.startX=t,this.startY=a,this.isDrawing=!0}drawMove(e){if(!this.isDrawing)return;const t=this.getDrawingArea(e);this.reDraw(t)}finishDraw(e){if(!this.isDrawing)return;this.isDrawing=!1;const t=this.getDrawingArea(e);this.sendElement(t)}startMove(e,t){const{offsetX:a,offsetY:l}=e;this.startX=a,this.startY=l,this.isDrawing=!0,this.moveType=t}moving(e){if(!this.isDrawing)return;const{moveType:t,startX:a,startY:l,zoomRatio:n,drawX:i,drawY:s}=this,{offsetX:o,offsetY:r}=e,d=(o-this.startX)/n,u=(r-this.startY)/n;this.startX=o,this.startY=r;const c=[(a-i)/n,(l-s)/n];this.setElementMovingData({xFloat:d,yFloat:u,rotateFloat:c,moveType:t},e.shiftKey)}finishMove(){this.isDrawing&&(this.isDrawing=!1,this.moveEnd())}contextMenu(e,t,a=null,l=null){this.handleController.setHandle(t,{x:e.pageX,y:e.pageY},"element",Boolean(t.image),this.canvasOuterDom,a).then((e=>{this.contextmenuCallBack(e,l)}))}contextmenuCallBack(e,t=null){switch(e.name){case at:this.toElementSetting(e.handleUuid);break;case lt:wt(e.file).then((t=>{this.changeElementImage(e.handleUuid,t)}));break;case ot:this.toImageGenerateView(e.handleUuid,t);break;case rt:this.generateElement(e.handleUuid);break;case dt:this.deleteElement(e.handleUuid);break;case nt:this.toTextEdit(e.handleUuid,"text");break;case it:this.toTextEdit(e.handleUuid,"color");break;case ht:this.copyData(e.handleUuid)}}getDrawingArea(e){const{offsetX:t,offsetY:a}=e,{startX:l,startY:n,zoomRatio:i,drawX:s,drawY:o}=this;let r=l>t?{startX:t,finishX:l}:{startX:l,finishX:t},d=n>a?{startY:a,finishY:n}:{startY:n,finishY:a};return{x:(r.startX-s)/i,y:(d.startY-o)/i,width:(r.finishX-r.startX)/i,height:(d.finishY-d.startY)/i}}clearAll(){const{ctx:e,canvasDom:t}=this;e.beginPath(),e.clearRect(0,0,t.width,t.height),e.closePath()}drawItem({name:e,x:t,y:a,width:l,height:n,rotate:i,image:s,tile:o,xOverturn:r,yOverturn:d,opacity:u,handleImage:c}){const{ctx:h,zoomRatio:m,drawX:v,drawY:p}=this;if(l||n){if(t*=m,a*=m,t+=v,a+=p,l*=m,n*=m,h.beginPath(),h.save(),h.lineWidth=2,h.fillStyle="#222",h.translate(t+l/2,a+n/2),h.scale(r?-1:1,d?-1:1),h.globalAlpha=u,i&&h.rotate(i),s){const e=c||s;h.drawImage(e,-l/2,-n/2,l,n)}else h.rect(-l/2,-n/2,l,n),h.stroke(),h.fill();i&&h.rotate(-i),h.globalAlpha=1,h.scale(r?-1:1,d?-1:1),h.translate(-(t+l/2),-(a+n/2)),h.restore(),h.closePath()}}drawFullScreen(e){const{ctx:t,canvasDom:a,drawX:l,drawY:n,zoomRatio:i,realHeight:s,realWidth:o}=this;t.beginPath(),t.save(),t.fillStyle=Dt(e),t.fillRect(l,n,o*i,s*i),t.restore(),t.closePath()}clearOther(){const{drawX:e,drawY:t,zoomRatio:a,realWidth:l,realHeight:n,ctx:i,canvasDom:s}=this;i.beginPath(),i.clearRect(0,0,e,s.height),i.clearRect(e,t+n*a,s.width,s.height),i.clearRect(0,0,s.width,t),i.clearRect(e+l*a,t,s.width,s.height),i.closePath()}drawTextItem({x:e,y:t,width:a,height:l,rotate:n,fontSetting:i,xOverturn:s,yOverturn:o,opacity:r}){const{content:d,font_color:u,font_size:c,fontFamily:h}=i,{ctx:m,zoomRatio:v,drawX:p,drawY:g}=this;e*=v,t*=v,e+=p,t+=g,a*=v,l*=v,m.beginPath(),m.save(),m.translate(e+a/2,t+l/2),m.scale(s?-1:1,o?-1:1),m.globalAlpha=r,n&&m.rotate(n),m.font=`${c*v}px ${h}`,m.fillStyle=Dt(u);const y=m.measureText(d).width;m.fillText(d,-y/2,c*v/2),m.stroke(),n&&m.rotate(-n),m.scale(s?-1:1,o?-1:1),m.globalAlpha=1,m.translate(-(e+a/2),-(t+l/2)),m.restore(),m.closePath()}selectedElement(e){this.toSelectedElement(e)}checkIsInItem({x:e,y:t,width:a,height:l,rotate:n=0,type:i,tileType:s},o){const{offsetX:r,offsetY:d}=o,{ctx:u,zoomRatio:c,realWidth:h,realHeight:m,drawX:v,drawY:p}=this;e*=c,t*=c,e+=v,t+=p,a*=c,l*=c,"tile_x"===s?(e=v,a=h*c,n=0):"tile_y"===s?(t=p,l=m*c,n=0):"tile_xy"===s&&(e=v,a=h*c,t=p,l=m*c,n=0),u.beginPath(),u.save(),u.translate(e+a/2,t+l/2),n&&u.rotate(n),u.rect(-a/2,-l/2,a,l),u.translate(-(e+a/2),-(t+l/2)),n&&u.rotate(-n);let g=!!u.isPointInPath(r,d)&&"main";return u.restore(),u.closePath(),g}drawHandleArea({x:e,y:t,width:a,height:l,rotate:n,type:i,tileType:s,fontSetting:o}){const{zoomRatio:r,ctx:d,realHeight:u,realWidth:c,drawX:h,drawY:m}=this;e*=r,t*=r,e+=h,t+=m,a*=r,l*=r,"statics"!==i&&"colors"!==i||("tile_x"===s?(e=h,a=c*r,n=0):"tile_y"===s?(t=m,l=u*r,n=0):"tile_xy"===s&&(e=h,a=c*r,t=m,l=u*r,n=0));const v=10,p=10,g=[[0-a/2,-10-l/2,a,2],[a+5+5-a/2-1,0-l/2,2,l],[-10-a/2,0-l/2,2,l],[0-a/2,l+5+5-l/2-1,a,2]];[[-15-a/2,-15-l/2],[+a+5-a/2,-15-l/2],[+a+5-a/2,+l+5-l/2],[-15-a/2,+l+5-l/2]].forEach((i=>{this.drawHandlePoint(i,{x:e,y:t,width:a,height:l,rotate:n},p)})),g.forEach((i=>{this.drawHandleLine(i,{x:e,y:t,width:a,height:l,rotate:n})})),s&&s.includes("tile")||this.drawRotateArea({x:e,y:t,width:a,height:l,rotate:n},v)}drawRotateArea({x:e,y:t,width:a,height:l,rotate:n},i){const{rotateImage:s,ctx:o}=this;o.beginPath(),o.save(),o.translate(e+a/2,t+l/2),n&&o.rotate(n),o.drawImage(s,-10,-l/2-2*i-20,20,20),o.translate(-(e+a/2),-(t+l/2)),n&&o.rotate(-n),o.translate(-(e+a/2),-(t+l/2)),o.restore(),o.closePath()}drawHandlePoint([e,t],a,l){const{ctx:n}=this;n.beginPath(),n.save(),n.fillStyle="#fff",n.translate(a.x+a.width/2,a.y+a.height/2),a.rotate&&n.rotate(a.rotate),n.rect(e,t,l,l),n.translate(-(a.x+a.width/2),-(a.y+a.height/2)),a.rotate&&n.rotate(-a.rotate),n.stroke(),n.fill(),n.restore(),n.closePath()}drawHandleLine([e,t,a,l],n){const{ctx:i}=this;i.beginPath(),i.save(),i.fillStyle="#fff",i.translate(n.x+n.width/2,n.y+n.height/2),n.rotate&&i.rotate(n.rotate),i.rect(e,t,a,l),i.translate(-(n.x+n.width/2),-(n.y+n.height/2)),n.rotate&&i.rotate(-n.rotate),i.stroke(),i.fill(),i.restore(),i.closePath()}checkIsInHandleArea({x:e,y:t,width:a,height:l,rotate:n,type:i,tileType:s},o){const{zoomRatio:r,canvasDom:d,drawX:u,drawY:c,realWidth:h,realHeight:m}=this;e*=r,t*=r,e+=u,t+=c,a*=r,l*=r,"tile_xy"===s?(e=u,a=h*r,n=0):"tile_y"===s?(t=c,l=m*r,n=0):"tile_xy"===s&&(e=u,a=h*r,t=c,l=m*r,n=0);const v=10,p=10,g=[[-15-a/2,-15-l/2,"left-top"],[+a+5-a/2,-15-l/2,"right-top"],[+a+5-a/2,+l+5-l/2,"right-bottom"],[-15-a/2,+l+5-l/2,"left-bottom"]],y=[[0-a/2,-10-l/2,a,2,"top"],[a+5+5-a/2-1,0-l/2,2,l,"right"],[-10-a/2,0-l/2-1,2,l,"left"],[0-a/2,l+5+5-l/2,a,2,"bottom"]];let f=!1;if(f=this.checkIsInRotateArea({x:e,y:t,width:a,height:l,rotate:n},v,o),f||"texts"===i)return f;for(let w of g)if(f=this.checkIsInHanlePoint(w,{x:e,y:t,width:a,height:l,rotate:n},p,o),f)break;if(f)return f;for(let w of y)if(f=this.checkIsInHanleLine(w,{x:e,y:t,width:a,height:l,rotate:n},o),f)break;return f}checkIsInHanlePoint([e,t,a],l,n,{offsetX:i,offsetY:s}){const{ctx:o}=this;o.beginPath(),o.save(),o.fillStyle="#fff",o.translate(l.x+l.width/2,l.y+l.height/2),l.rotate&&o.rotate(l.rotate),o.rect(e,t,n,n),o.translate(-(l.x+l.width/2),-(l.y+l.height/2)),l.rotate&&o.rotate(-l.rotate);let r=!!o.isPointInPath(i,s)&&a;return o.restore(),o.closePath(),r}checkIsInHanleLine([e,t,a,l,n],i,{offsetX:s,offsetY:o}){const{ctx:r}=this;r.beginPath(),r.save(),r.fillStyle="#fff",r.translate(i.x+i.width/2,i.y+i.height/2),i.rotate&&r.rotate(i.rotate),r.rect(e,t,a,l),r.translate(-(i.x+i.width/2),-(i.y+i.height/2)),i.rotate&&r.rotate(-i.rotate);let d=!!r.isPointInPath(s,o)&&n;return r.restore(),r.closePath(),d}checkIsInRotateArea({x:e,y:t,width:a,height:l,rotate:n},i,{offsetX:s,offsetY:o}){const{ctx:r}=this;r.beginPath(),r.save(),r.translate(e+a/2,t+l/2),n&&r.rotate(n),r.rect(-10,-l/2-2*i-20,20,20),r.translate(-(e+a/2),-(t+l/2)),n&&r.rotate(-n),r.translate(-(e+a/2),-(t+l/2)),r.restore();let d=!!r.isPointInPath(s,o)&&"rotate";return r.closePath(),d}getData(){return{name:this.name,realWidth:this.realWidth,realHeight:this.realHeight,drawType:this.drawType,points:this.points,template_level:this.template_level,template_filter:this.template_filter,hue:this.hue,edgeFeather:this.edgeFeather}}getRealCanvas(){this.zoomRatio=1}setViewType(e){this.viewType=e,"editor"===e&&(this.resize(),this.reDraw())}getTextWidth({content:e,fontFamily:t,font_size:a}){const{ctx:l}=this;l.beginPath(),l.save(),l.font=`${a}px ${t}`;var n=l.measureText(e).width;return l.restore(),l.closePath(),n}drawMeshLine(){const{canvasDom:e,zoomRatio:t}=this,{width:a,height:l}=e,{outerWidth:n}=Lt,i=Math.ceil(a/t/n),s=Math.ceil(l/t/n),o={x:new Array(i),y:new Array(s)};this.drawMeshLineItem(o)}drawMeshLineItem(e){const{ctx:t,canvasDom:a,zoomRatio:l}=this,{outerWidth:n}=Lt,{width:i,height:s}=a,{x:o,y:r}=e;for(let d=0;d<o.length;d++)t.beginPath(),t.save(),t.strokeStyle="#404040",t.moveTo(d*n*l,0),t.lineTo(d*n*l,s),t.stroke(),t.restore(),t.closePath(),this.drawMeshMin(d*n*l,0,0);for(let d=0;d<r.length;d++)t.beginPath(),t.save(),t.strokeStyle="#404040",t.moveTo(0,d*n*l),t.lineTo(i,d*n*l),t.stroke(),t.restore(),t.closePath(),this.drawMeshMin(0,d*n*l,1)}drawMeshMin(e,t,a=0){const{ctx:l,canvasDom:n,zoomRatio:i}=this,{width:s,height:o}=n,{innerWidth:r,outerWidth:d}=Lt,u=Math.ceil(d/r);if(!(d*i<20))for(let c=0;c<u;c++)if(0!==c){switch(l.beginPath(),l.save(),l.strokeStyle="#343434",a){case 0:l.moveTo(e+c*r*i,0),l.lineTo(e+c*r*i,o);break;case 1:l.moveTo(0,t+c*r*i),l.lineTo(s,t+c*r*i)}l.stroke(),l.restore(),l.closePath()}}drawTileImage(e,t="tile_xy"){const{image:a}=e;if(!a)return void this.drawTileColor(e,t);const{zoomRatio:l,ctx:n,drawX:i,drawY:s,realWidth:o,realHeight:r}=this,{width:d,height:u}=a,c="tile_y"===t?1:Math.floor(o*l/d/l),h="tile_x"===t?1:Math.floor(r*l/u/l);let m=o*l/c,v=r*l/h;m="tile_y"===t?e.width*l:m,v="tile_x"===t?e.height*l:v;const p="tile_y"===t?e.x*l:0,g="tile_x"===t?e.y*l:0;n.beginPath();for(let y=0;y<c;y++)for(let e=0;e<h;e++)n.drawImage(a,i+p+y*m,s+g+e*v,m+1,v+1);n.closePath()}drawTileColor(e,t="tile_xy"){const{color:a}=e,{canvasDom:l,zoomRatio:n,ctx:i,realWidth:s,realHeight:o,drawX:r,drawY:d}=this;let u=s*n,c=o*n;u="tile_y"===t?e.width*n:s*n,c="tile_x"===t?e.height*n:o*n;const h="tile_y"===t?e.x*n:0,m="tile_x"===t?e.y*n:0;i.beginPath(),i.save(),i.fillStyle=Dt(a),i.fillRect(h+r,m+d,u,c),i.fill(),i.restore(),i.closePath()}}function Ot(e,t){return an.post(`/teai/upload?file_id=${e}`,t)}function zt(e){return an.post(`/teai/query_templates?template_type=${e}`)}function Pt(e){return an.post(`/teai/query_template?template_id=${e}`)}function Ut(e,t,a,l,n="normal",i="normal",s=1){return an.post(`/teai/upload_template?template_type=${t}&template_name=${a}&preview=${l}&template_filter=${i}&template_level=${n}&points=${s}`,e)}function Gt(e,t,a,l,n,i="normal",s="normal",o=1){return an.post(`/teai/update_template?template_id=${e}&template_type=${a}&template_name=${l}&preview=${n}&template_filter=${s}&template_level=${i}&points=${o}`,t)}function Nt(e,t,a){return an.post(`/teai/delete_template?template_id=${e}&template_type=${t}&template_name=${a}`)}function jt(){return an.post("/teai/query_artworks")}function Vt(e){return an.post(`/teai/query_artwork?artwork_id=${e}`)}function Ht(e,t,a){return an.post(`/teai/delete_artwork?artwork_id=${e}&artwork_name=${t}&artwork_level=${a}`)}function Yt(e){return/^data:image\/\w+;base64,/.test(e)}const Bt={class:"loading-body"},Ft={class:"loading-animation-area"},Wt={class:"rainbow-text"};var Xt=de({__name:"tToading",setup(e,{expose:t}){const a=n(!1),l=n(!1),i=Array(8).fill("🌿");f((()=>{setTimeout((()=>{document.getElementById("main-inner").style.display="none",a.value=!0,setTimeout((()=>{l.value||(l.value=!0,document.getElementById("main-inner").style.display="block")}),300)}))}));return t({close:()=>(l.value=!1,new Promise((e=>{setTimeout((()=>{a.value=!1,setTimeout((()=>{e()}),300)}),300)})))}),(e,t)=>(s(),C(S,{to:"body"},[r("div",Bt,[r("div",Ft,[r("div",{class:c(["loading-left",{animate:a.value}])},null,2),r("div",{class:c(["loading-top",{animate:a.value}])},null,2),r("div",{class:c(["loading-right",{animate:a.value}])},null,2),r("div",{class:c(["loading-bottom",{animate:a.value}])},null,2)]),r("div",{class:"loading-inner",style:g({opacity:Number(l.value)})},[r("div",Wt,[(s(!0),o(M,null,T(E(i),((e,t)=>(s(),o("span",{key:t,style:g({animationDelay:t/8+"s"})},m(e),5)))),128))])],4)])]))}},[["__scopeId","data-v-095e7140"]]);const $t=e=>{let t=Boolean(window.loading),a=null;const{publicStore:l}=dn(),n=l.rootDom;let i=document.createElement("div");return n.appendChild(i),t?window.loading:(a=d(Xt,e),A(a,i),t=!0,{close:()=>{t&&a&&a.component.exposed.close().then((()=>{A(null,i),n.removeChild(i),a=null,t=!1}))}})};function Zt(e){return new Promise((t=>{const a=function(e){return`font-${e.split("/")[e.split("/").length-1].split(".")[0]}`}(e);let l=document.getElementById(a)||document.createElement("style");if(l.id)return void t(a);l.id=a;const n=new L(a);l.innerText=`@font-face {\n      font-family: ${a};\n      src: url('${e}');\n    }`,document.head.appendChild(l),n.load().then((()=>{t(a)}),(e=>{}))}))}function Jt(e){const t=document.createElement("canvas"),a=t.getContext("2d");return t.width=e.width,t.height=e.height,{canvas:t,ctx:a}}async function Qt(e,t){const{canvas:a,ctx:l}=Jt(e);l.drawImage(e,0,0);let n=l.getImageData(0,0,a.width,a.height),i=new ImageData(new Uint8ClampedArray(n.data),a.width,a.height),s=i.data;for(let o=0;o<s.length;o+=4){let e=(s[o]+s[o+1]+s[o+2])/3;s[o]=e,s[o+1]=e,s[o+2]=e}return function(e,t){let a=e.data;for(let l=0;l<a.length;l+=4){let e=3*a[l];a[l]=t[e],a[l+1]=t[e+1],a[l+2]=t[e+2]}}(i,function(e,t=256){let a=new Uint8ClampedArray(3*t);for(let l=0;l<t;l++){let n=Math.round(e[0]+(255-e[0])*(l/(t-1))),i=Math.round(e[1]+(255-e[1])*(l/(t-1))),s=Math.round(e[2]+(255-e[2])*(l/(t-1)));a[3*l]=n,a[3*l+1]=i,a[3*l+2]=s}return a}(t)),l.putImageData(i,0,0),a.toDataURL()}const qt=[[-1,0,1],[-2,0,2],[-1,0,1]],Kt=[[-1,-2,-1],[0,0,0],[1,2,1]];function ea(e,t){const{data:a,width:l,height:n}=e,i=t.length,s=Math.floor(i/2),o=new Float32Array(l*n);for(let r=0;r<n;r++)for(let e=0;e<l;e++){let d=0;for(let o=0;o<i;o++)for(let u=0;u<i;u++){const i=r+o-s,c=e+u-s;i>=0&&i<n&&c>=0&&c<l&&(d+=a[i*l+c]*t[o][u])}o[r*l+e]=d}return{data:o,width:l,height:n}}const ta=(e,t=null,a=!0)=>{const l=(e=>{const{ctx:t}=Jt(e);return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)})(e);if(!t&&a){const e=function(e){const t=e.data,a=e.width,l=e.height,n=new Uint8Array(a*l);for(let i=0;i<t.length;i+=4)n[i/4]=t[i+3];return{data:n,width:a,height:l}}(l),a=function(e,t){const{data:a,width:l,height:n}=e,{data:i}=t,s=new Float32Array(l*n);for(let o=0;o<s.length;o++)s[o]=Math.sqrt(a[o]**2+i[o]**2);return{data:s,width:l,height:n}}(ea(e,qt),ea(e,Kt)),n=function(e,t){const{data:a,width:l,height:n}=e;let i=0;for(let r=0;r<a.length;r++)i=Math.max(a[r],i);const s=t*i,o=new Uint8Array(l*n);for(let r=0;r<a.length;r++)o[r]=a[r]>s?1:0;return{data:o,width:l,height:n}}(a,.1);t=function(e){const{data:t,width:a,height:l}=e,n=new Float32Array(a*l),i=[];for(let o=0;o<t.length;o++)1===t[o]?(n[o]=0,i.push(o)):n[o]=1/0;const s=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(;i.length>0;){const e=i.shift(),t=e%a,o=Math.floor(e/a);for(const r of s){const s=t+r.dx,d=o+r.dy;if(s>=0&&s<a&&d>=0&&d<l){const t=d*a+s,l=n[e]+1;l<n[t]&&(n[t]=l,i.push(t))}}}return{data:n,width:a,height:l}}(n)}return{imageData:l,transformedDistance:t}},aa={image:"u_plus_image",image_info:"u_plus_image_info",message:"u_plus_message",message_info:"u_plus_message_info",message_data:"u_plus_message_data"};const la=new class{constructor(){this.SQL_NAME="u_plus",this.DB_NAME_LIST=["u_plus_image","u_plus_image_info","u_plus_message","u_plus_message_info","u_plus_message_data"],this.db={},this.request=null,this.init()}init(){const{SQL_NAME:e,DB_NAME_LIST:t}=this;return new Promise(((a,l)=>{this.request=window.indexedDB.open(e,1),this.request.onerror=e=>{l(e)},this.request.onsuccess=e=>{a(e.target.result),this.db=e.target.result},this.request.onupgradeneeded=e=>{this.db=e.target.result,t.forEach((e=>{if(!this.db.objectStoreNames.contains(e)){this.db.createObjectStore(e,{keyPath:"uuid",unique:!0}).createIndex("content","content",{unique:!1})}}))}}))}async get(e,t){const a=aa[e];return new Promise(((e,l)=>{const n=this.db.transaction([a],"readonly").objectStore(a).get(t);n.onsuccess=function(){e(n.result)},n.onerror=l}))}async add(e,t){const a=aa[e],{uuid:l}=t;return new Promise(((e,n)=>{const i=this.db.transaction([a],"readwrite").objectStore(a).add({uuid:l,content:t});i.onsuccess=t=>{e(t.target.result)},i.onerror=n}))}async update(e,t){const a=aa[e],{uuid:l}=t;return new Promise(((e,n)=>{const i=this.db.transaction([a],"readwrite").objectStore(a).put({uuid:l,content:t});i.onsuccess=t=>{e(t.target.result)},i.onerror=n}))}async getAll(e){const t=aa[e];return new Promise(((e,a)=>{const l=this.db.transaction([t],"readonly"),n=l.objectStore(t),i=[];n.openCursor().onsuccess=function(t){const a=t.target.result;a?(i.push(a.value.content),a.continue()):e(i)},l.oncomplete=function(){},l.onerror=function(){}}))}};class na{constructor(e,t,a=!0){this.uuid=e,this.image=null,this.handleImage=null,this.init(t,a),this.hasDB=!1}init(e,t=!0){this.image=e,this.handleImage=e}async grayToColor(e=[255,0,0]){const t=await Qt(this.image,e),a=await bt(t);return this.handleImage=a,a}async edgeFeather(e=0){const{uuid:t,image:a}=this;if(!a)return a;const l=await la.get("image",t);let n=null;if(l){const{content:e}=l;if(e.image!==a.src);else{const e=await la.get("image_info",t);e&&(n=e.content.transformedDistance)}}else;let{imageRes:i,transformedDistance:s}=await(async(e,t,a=null)=>{const l=new Worker("/assets/imageProcessor.worker.3e8d89c2.js");t+=.01;const n=ta(e,a),i=n.imageData;return a=n.transformedDistance,new Promise((e=>{l.postMessage({transformedDistance:a,originalImageData:i,spreadFactor:t}),l.onmessage=({data:t})=>{const{canvas:n,ctx:i}=Jt(t),s=i,o=new ImageData(t.data,t.width,t.height);s.putImageData(o,0,0);const r=ft(n.toDataURL());e({imageRes:r,transformedDistance:a}),l.terminate()}}))})(this.handleImage,e,n);if(n=null,l){const{content:e}=l;e.image!==a.src&&(await la.update("image",{uuid:t,image:a.src}),await la.update("image_info",{uuid:t,transformedDistance:s}))}else await la.add("image",{uuid:t,image:a.src}),await la.add("image_info",{uuid:t,transformedDistance:s});return s=null,i}}function ia(e,t,a,l=0,n=0){const i=[[-e/2,-t/2],[e/2,-t/2],[e/2,t/2],[-e/2,t/2]].map((([e,t])=>{const i=Math.cos(a),s=Math.sin(a);return[l+(e*i-t*s),n+(e*s+t*i)]}));let s=1/0,o=-1/0,r=1/0,d=-1/0;return i.forEach((([e,t])=>{s=Math.min(s,e),o=Math.max(o,e),r=Math.min(r,t),d=Math.max(d,t)})),{width:o-s,height:d-r}}function sa([e,t],[a,l]){return e>0&&e<a&&t>0&&t<l}const oa=new class{constructor(){this.dataController=x(new Ve),this.canvasController=x(new Rt),this.generationController=x(new Ue),this.dataController.reDraw=this.reDraw.bind(this),this.canvasController.clearAllData=this.clearAllData.bind(this),this.canvasController.reDraw=this.reDraw.bind(this),this.canvasController.toDraw=this.toDraw.bind(this),this.canvasController.sendElement=this.sendElement.bind(this),this.canvasController.toSelectedElement=this.toSelectedElement.bind(this),this.canvasController.checkMove=this.checkMove.bind(this),this.canvasController.setElementMovingData=this.setElementMovingData.bind(this),this.canvasController.moveEnd=this.moveEnd.bind(this),this.canvasController.checkContextMenu=this.checkContextMenu.bind(this),this.canvasController.changeElementImage=this.changeElementImage.bind(this),this.canvasController.toImageGenerateView=this.toImageGenerateView.bind(this),this.canvasController.reGenerateElement=this.reGenerateElement.bind(this),this.canvasController.deleteElement=this.deleteElement.bind(this),this.canvasController.generateElement=this.generateElement.bind(this),this.canvasController.getLayerImage=this.getLayerImage.bind(this),this.canvasController.toTextEdit=this.toTextEdit.bind(this),this.canvasController.copyData=this.copyData.bind(this),this.canvasController.toElementSetting=this.toElementSetting.bind(this),this.movedElementUuid=null}save(e=0){return new Promise(((t,a)=>{const l=en.currentRoute;if("/generateImage"===l.value.path&&!e)return void t();const n=$t();this.getSaveData().then((({jsonFile:e,preview:i,code:s,message:o})=>{if(200===s){const s=new FormData;s.append("file",e),"/generateImage"===l.value.path||"/galleryUpdate"===l.value.path?this.saveOrUpdateArtWork(s,e.name.replace(".json",""),i).then((()=>{n.close()})).catch((e=>{450===e.code&&I.error("模板名称重复"),n.close(),a(e)})):this.saveOrUpdateTemplate(s,e.name.replace(".json",""),i).then((()=>{n.close(),t()})).catch((e=>{450===e.code&&I.error("模板名称重复"),n.close(),a(e)}))}else n.close(),I.error(o)}))}))}saveOrUpdateTemplate(e,t,a){const{templateId:l,template_level:n,template_filter:i,points:s}=this.canvasController;return new Promise(((o,r)=>{l?Gt(l,e,"layouts",t,a,n,i,s).then((e=>{I.success("保存成功"),o()})):Ut(e,"layouts",t,a,n,i,s).then((e=>{this.canvasController.templateId=e.info.template_id,I.success("保存成功"),o()})).catch((e=>{r(e)}))}))}saveOrUpdateArtWork(e,t,a){const{templateId:l,template_level:n,template_filter:i,points:s}=this.canvasController;return new Promise((o=>{"/generateImage"===en.currentRoute.value.path?_.prompt("请输入作品名称","作品名称",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:t})=>{(function(e,t,a,l="normal",n="normal",i=1){return an.post(`/teai/upload_artwork?artwork_name=${t}&preview=${a}&artwork_filter=${n}&artwork_level=${l}&points=${i}`,e)})(e,t,a,n,i,s).then((e=>{I.success("保存成功"),o(),en.replace({path:"/galleryUpdate",query:{file_name:t,artwork_id:e.info.artwork_id}})})).catch((e=>{reject(e)}))})).catch((()=>{I({type:"info",message:"取消保存"})})):function(e,t,a,l,n="normal",i="normal",s=1){return an.post(`/teai/update_artwork?artwork_id=${e}&artwork_name=${a}&preview=${l}&artwork_filter=${i}&artwork_level=${n}&points=${s}`,t)}(l,e,t,a,n,i,s).then((()=>{I.success("保存成功")})).catch((e=>{})),o()}))}async getSaveData(){const e=this.canvasController.getData(),t=this.dataController.getData(),a=JSON.parse(JSON.stringify(t));if(!e.name)return{code:500,message:"请设置文件名称后操作"};const l=D(),n=new Map;for(let d in a)for(let e in t[d])if("groups"!==d&&"texts"!==t[d][e].type&&(delete a[d][e].fontSetting,delete a[d][e].handleImage),"colors"!==d&&"texts"!==t[d][e].type&&delete a[d][e].color,"elements"===d&&(delete a[d][e].virtuallyElements,delete a[d][e].zIndex,delete a[d][e].children),t[d][e].image&&Yt(t[d][e].image.src))if(n.get(t[d][e].image.src)){const l=n.get(t[d][e].image.src);await this.setImage(d,e,l),a[d][e].image=l}else{const l=gt(t[d][e].image.src,e),i=new FormData;i.append("file",l);const s=(await this.saveImage(e,i)).data;n.set([t[d][e].image.src,s]),await this.setImage(d,e,s),a[d][e].image=s}else t[d][e].image&&t[d][e].image.src?a[d][e].image=t[d][e].image.src:a[d][e].image=null;const i=gt(await this.getCanvasImage(),l),s=new FormData;s.append("file",i);const o=await this.saveImage(l,s),r={viewData:e,layerData:a};for(let d in t){const e=t[d];if("elements"===d)break;for(let t in e)Object.assign(r,{[t]:{prompts:e[t].prompts,statics:e[t].statics,colors:e[t].colors,texts:e[t].texts}})}return{jsonFile:kt(r,e.name),preview:o.data,code:200}}saveImage(e,t){return new Promise((a=>{Ot(e,t).then((e=>{a(e)}))}))}setImage(e,t,a){return new Promise((l=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{this.dataController[e][t].setData({image:n}),l()},n.onerror=()=>{l()},n.src=a}))}clearAllData(){this.dataController.clearAllData(),this.reDraw()}reDraw(e=null){const t=this.dataController.elements,a=this.dataController.groups,l=this.dataController.layers,n=new Set;Object.keys(t).forEach((e=>{this.recomputationPosition(t[e])})),Object.keys(a).forEach((e=>{a[e].children.forEach((e=>{l[e].children.forEach((e=>{t[e].isShow&&n.add(e)}))}))})),Object.keys(l).forEach((e=>{l[e].children.forEach((e=>{t[e].isShow&&n.add(e)}))}));let i=[];this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{this.dataController.findData("layer",e).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&i.push(t)}))}))}else{this.dataController.findData("layer",t).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&i.push(t)}))}})),e&&(e.image=this.dataController.findData("layer",this.dataController.selectedMap.layer).image,i.push(e)),this.canvasController.clearAll(),i.forEach((e=>{this.drawItem(e)}));const s=this.dataController.selectedMap.element;if(t&&s&&t[s].isShow){this.canvasController.drawHandleArea(t[s]);const{virtuallyElements:e}=t[s];e&&e.length&&e.forEach((e=>{const[a,l]=e,{width:n,height:i,rotate:o,image:r,type:d,tileType:u}=t[s],c={x:a,y:l,width:n,height:i,rotate:o,image:r,type:d,tileType:u};this.canvasController.drawHandleArea(c)}))}this.canvasController.clearOther(),this.canvasController.ctx.globalCompositeOperation="destination-over",this.canvasController.drawMeshLine(),this.canvasController.ctx.globalCompositeOperation="source-over"}drawItem(e){const{virtuallyElements:t,type:a,color:l,tileType:n}=e;switch(a){case"colors":switch(n){case"tile_xy":case"tile_x":case"tile_y":this.canvasController.drawTileColor(e,n);break;default:this.canvasController.drawTileColor(e,"tile_xy")}break;case"texts":this.canvasController.drawTextItem(e),t&&t.length&&t.forEach((t=>{const[a,l]=t,{width:n,height:i,rotate:s,fontSetting:o,type:r,tileType:d}=e,u={x:a,y:l,width:n,height:i,rotate:s,fontSetting:o,type:r,tileType:d};this.drawItem(u)}));break;case"statics":switch(n){case"tile_xy":case"tile_x":case"tile_y":this.canvasController.drawTileImage(e,n);break;default:this.canvasController.drawItem(e)}t&&t.length&&t.forEach((t=>{const[a,l]=t,{width:n,height:i,rotate:s,image:o,type:r,tileType:d}=e,u={x:a,y:l,width:n,height:i,rotate:s,image:o,type:r,tileType:d};this.drawItem(u)}));break;default:this.canvasController.drawItem(e),t&&t.length&&t.forEach((t=>{const[a,l]=t,{width:n,height:i,rotate:s,image:o,type:r,tileType:d,handleImage:u,xOverturn:c,yOverturn:h,opacity:m}=e,v={x:a,y:l,width:n,height:i,rotate:s,image:o,type:r,tileType:d,handleImage:u,xOverturn:c,yOverturn:h,opacity:m};this.drawItem(v)}))}}sendElement(e){const t=this.dataController.selectedMap.layer,a=this.dataController.findData("layer",t),{type:l}=a;if("texts"===l){const t=JSON.parse(JSON.stringify(a.fontSetting)),l=da.getTextWidth(t);e=Object.assign(e,{x:e.x+e.width/2-l/2,y:e.y+e.height/2-t.font_size/2,width:l,height:t.font_size,fontSetting:t})}this.dataController.add("element",t,null,e),this.reDraw()}toDraw(e){const t=this.dataController.selectedMap.layer;if(!t)return void I.error("请在选中图层后操作");const a=this.dataController.findData("layer",t);a&&a.tileType||this.canvasController.startDraw(e)}checkClickIsIn(e,t=!0){const a=this.dataController.elements,l=this.dataController.groups,n=this.dataController.layers,i=this.dataController.findData("element",this.dataController.selectedMap.element);let s=null;if(i&&t){if(this.canvasController.checkIsInItem(i,e))return{handleType:"main",data:i};if(s=this.canvasController.checkIsInHandleArea(i,e),s)return{handleType:s,data:i};const{virtuallyElements:t}=i;if(t&&t.length)for(let a of t){const[t,l]=a,{width:n,height:o,rotate:r,image:d,type:u,tileType:c}=i,h={x:t,y:l,width:n,height:o,rotate:r,image:d,type:u,tileType:c};if(s=this.canvasController.checkIsInHandleArea(h,e),s)return{handleType:s,data:i}}}const o=new Set;Object.keys(l).forEach((e=>{l[e].children.forEach((e=>{n[e].children.forEach((e=>{a[e].isShow&&o.add(e)}))}))})),Object.keys(n).forEach((e=>{n[e].children.forEach((e=>{a[e].isShow&&o.add(e)}))}));let r=[];this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{this.dataController.findData("layer",e).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&r.push(t)}))}))}else{this.dataController.findData("layer",t).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&r.push(t)}))}})),r=r.reverse();for(let d of r){const{virtuallyElements:t,type:a}=d,l=this.canvasController.checkIsInItem(d,e);if(t&&t.length)for(let n of t){const[t,a]=n,{width:l,height:i,rotate:o,image:r}=d,u={x:t,y:a,width:l,height:i,rotate:o,image:r};if(s=this.canvasController.checkIsInItem(u,e),s)return{handleType:"main",data:d}}if(l)return s="main",{handleType:s,data:d}}return{handleType:null,data:null}}toSelectedElement(e){const{data:t}=this.checkClickIsIn(e,!1);if(!t)return this.dataController.selectedMap={group:null,layer:null,element:null},void this.reDraw();const a=this.dataController.findData("layer",t.parentUuid),l=a?this.dataController.findData("group",a.parentUuid):null,n=[l?l.uuid:null,a.uuid||null,t.uuid];this.dataController.changeSelected(n),this.reDraw()}checkMove(e){const t=this.checkClickIsIn(e),a=t.data,l=t.handleType;a&&a.uuid===this.dataController.selectedMap.element&&(this.movedElementUuid=a.uuid,this.canvasController.startMove(e,l))}checkContextMenu(e,t=!1){const a=this.checkClickIsIn(e),l=a.data;if(!l)return;const n=a.handleType,i=l.uuid,s=l.parentUuid,o=this.dataController.findData("layer",s).parentUuid||null;this.dataController.changeSelected([o,s,i]),l&&"main"===n&&(t?"texts"!==l.type&&"prompts"!==l.type||this.canvasController.contextMenu(e,l,l.type):this.canvasController.contextMenu(e,l))}setElementMovingData({xFloat:e,yFloat:t,rotateFloat:a,moveType:l},n){const i=this.dataController.elements[this.movedElementUuid],s=i.rotate,o=Math.cos(-s),r=Math.sin(-s);let{width:d,height:u}=i,c=e*o-e*r,h=e*r+t*o;switch(d=Math.round(100*d)/100,u=Math.round(100*u)/100,c=Math.round(100*c)/100,h=Math.round(100*h)/100,l){case"main":this.mainMove(i,e,t);break;case"left-top":if(n){let e=d/u;e=Math.round(100*e)/100,h=c/e,h=Math.round(100*h)/100}this.leftTopMove(i,c,h);break;case"top":if(n){let e=d/u;e=Math.round(100*e)/100,c=h*e,c=Math.round(100*c)/100,c=-c}else c=0;this.rightTopMove(i,c,h);break;case"right-top":if(n){let e=d/u;e=Math.round(100*e)/100,h=c/e,h=Math.round(100*h)/100,h=-h}this.rightTopMove(i,c,h);break;case"right":if(n){let e=d/u;e=Math.round(100*e)/100,h=c/e,h=Math.round(100*c)/100}else h=0;this.rightBottomMove(i,c,h);break;case"right-bottom":if(n){let e=d/u;e=Math.round(100*e)/100,h=c/e,h=Math.round(100*h)/100}this.rightBottomMove(i,c,h);break;case"bottom":if(n){let e=d/u;e=Math.round(100*e)/100,c=h*e,c=Math.round(100*c)/100}else c=0;this.rightBottomMove(i,c,h);break;case"left-bottom":if(n){let e=d/u;e=Math.round(100*e)/100,h=c/e,h=Math.round(100*h)/100,h=-h}this.leftBottomMove(i,c,h);break;case"left":if(n){let e=d/u;e=Math.round(100*e)/100,h=c/e,h=Math.round(100*h)/100,h=-h}else h=0;this.leftBottomMove(i,c,h);break;case"rotate":this.rotateMove(i,e,t,a)}this.reDraw()}moveEnd(e){this.movedElementUuid=null}mainMove(e,t,a){e.setData({x:e.x+t,y:e.y+a}),this.recomputationPosition(e)}leftTopMove(e,t,a){let{width:l,height:n,x:i,y:s}=e;l-t<0||(l-=t,n-=a/2,i+=t,s+=a/2),n-a<0||(n-=a/2,s+=a/2),e.setData({x:i,y:s,width:l,height:n})}topMove(e,t,a){let{height:l,y:n}=e;l-a<0||(l-=a,n+=a),e.setData({y:n,height:l})}rightTopMove(e,t,a){let{width:l,height:n,y:i}=e;l+t<0||(l+=t),n-a<0||(n-=a,i+=a),e.setData({width:l,height:n,y:i})}rightMove(e,t,a){let{width:l}=e;l+t<0||(l+=t),e.setData({width:l})}rightBottomMove(e,t,a){let{width:l,height:n}=e;l+t<0||(l+=t),n+a<0||(n+=a),e.setData({width:l,height:n})}bottomMove(e,t,a){let{height:l}=e;l+a<0||(l+=a),e.setData({height:l})}leftBottomMove(e,t,a){let{width:l,height:n,x:i}=e;l-t<0||(l-=t,i+=t),n+a<0||(n+=a),e.setData({width:l,height:n,x:i})}leftMove(e,t,a){let{width:l,x:n}=e;l-t<0||(l-=t,n+=t),e.setData({x:n,width:l})}rotateMove(e,t,a,l){const{x:n,y:i,width:s,height:o,rotate:r}=e;let d=function([e,t],[a,l],[n,i]){const s=a-e,o=l-t,r=n-e,d=i-t;let u=(s*r+o*d)/(Math.sqrt(s*s+o*o)*Math.sqrt(r*r+d*d));if(isNaN(u))return 0;let c=Math.acos(u);return s*d-o*r<0&&(c=-c),isNaN(c)?Math.PI/1800:Number(c.toFixed(2))}([n+s/2,i+o/2],l,[l[0]+t,l[1]+a]);e.setData({rotate:r+d})}recomputationPosition(e){const{drawType:t}=this.canvasController,{realWidth:a,realHeight:l}=this.canvasController;switch(t){case Et:e.virtuallyElements=[],this.recomputationMainPosition(a,l,e);break;case Mt:e.virtuallyElements=[],this.recomputationAgentXPosition(width,e),this.recomputationMainPosition(a,l,e);break;case St:e.virtuallyElements=[],this.recomputationAgentYPosition(height,e),this.recomputationMainPosition(a,l,e);break;case At:e.virtuallyElements=[],this.recomputationAgentFPosition(a,l,e),this.recomputationMainPosition(a,l,e)}}recomputationMainPosition(e,t,a){const{virtuallyElements:l,x:n,y:i,width:s,height:o}=a;let r=JSON.parse(JSON.stringify(l));r.length&&(sa([n+s/2,i+o/2],[e,t])||r.forEach(((l,d)=>{const[u,c]=l;sa([u+s/2,c+o/2],[e,t])&&(r[d]=[n,i],a.setData({x:u,y:c,virtuallyElements:r}))})))}recomputationAgentXPosition(e,t){const{x:a,y:l,virtuallyElements:n,width:i,height:s,rotate:o}=t;let r=i;o&&(r=ia(i,s,o).width),a+i/2+r/2>e?n.push([a-e,l]):a+i/2-r/2<0&&n.push([e+a,l]),t.setData({virtuallyElements:n})}recomputationAgentYPosition(e,t){const{x:a,y:l,virtuallyElements:n,width:i,height:s,rotate:o}=t;let r=s;o&&(r=ia(i,s,o).height),l+s/2+r/2>e?n.push([a,l-e]):l+s/2-r/2<0&&n.push([a,e+l]),t.setData({virtuallyElements:n})}recomputationAgentFPosition(e,t,a){this.recomputationAgentXPosition(e,a),this.recomputationAgentYPosition(t,a);const{virtuallyElements:l,x:n,drawY:i,width:s,height:o}=a;2===l.length&&(n===l[0][0]?l.push([l[1][0],l[0][1]]):l.push([l[0][0],l[1][1]])),a.setData({virtuallyElements:l})}deleteElement(e){this.dataController.delete("element",e),this.reDraw()}reGenerateElement(e){}toImageGenerateView(e){}toElementSetting(e){this.toElementSetting(e)}async changeElementImage(e,t){const a=this.dataController.findData("element",e);let l=new na(e,t,Boolean(a.edgeFeather)),n=null;a.hue&&Array.isArray(a.hue)&&(n=await l.grayToColor(a.hue)),a.edgeFeather&&(n=await l.edgeFeather(a.edgeFeather/100)),l=null,this.dataController.elements[e].setData({image:t,handleImage:n}),this.reDraw()}async getCanvasImage(){await this.canvasController.resize();const{zoomRatio:e,realWidth:t,realHeight:a,drawX:l,drawY:n}=this.canvasController;this.reDraw();const i=this.dataController.elements,s=this.dataController.groups,o=this.dataController.layers,r=new Set;Object.keys(i).forEach((e=>{this.recomputationPosition(i[e])})),Object.keys(s).forEach((e=>{s[e].children.forEach((e=>{o[e].children.forEach((e=>{i[e].isShow&&r.add(e)}))}))})),Object.keys(o).forEach((e=>{o[e].children.forEach((e=>{i[e].isShow&&r.add(e)}))}));let d=[];this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{this.dataController.findData("layer",e).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&d.push(t)}))}))}else{this.dataController.findData("layer",t).children.forEach((e=>{const t=this.dataController.findData("element",e);t.isShow&&d.push(t)}))}})),this.canvasController.clearAll(),d.forEach((e=>{this.drawItem(e)}));const u=t*e,c=a*e,h=this.canvasController.ctx.getImageData(l,n,u,c),{canvas:m,ctx:v}=Jt({width:u,height:c});v.putImageData(h,0,0);const p=m.toDataURL("image/png");return this.canvasController.resize().then((()=>{this.reDraw()})),p}async generateAll(){const e=$t(),t=Object.keys(this.dataController.groups).map((e=>this.dataController.groups[e])),a=this.dataController.layers,l=Object.keys(a).filter((e=>!this.dataController.layers[e].parentUuid)).map((e=>this.dataController.layers[e])),n=[];if(!t.length&&!l.length)return e.close(),void I.error("请在添加图层后生成");if(t.length&&t.forEach((e=>{n.push({type:"Group",name:e.name,generateUuid:e.uuid,children:e.children,uuid:e.uuid})})),l.length){for(let e of l)n.push({type:"Layer",name:e.name,generateUuid:e.uuid,uuid:e.uuid});const{templateId:t,name:a}=this.canvasController;ba.addTask(t,a,"All",n),e.close(),I.success("生成任务已提交")}}async setGroupGenerateResult(e){const t=Object.keys(e);for(let a=0;a<t.length;a++)await this.setLayerGenerateResult({[t[a]]:e[t[a]]})}async setLayerGenerateResult(e){const t=Object.keys(e);for(let a=0;a<t.length;a++){const l=this.dataController.findData("layer",t[a]),{type:n}=l;if(!e[t[a]])break;switch(n){case"texts":await this.setResultText(l,e[t[a]].task_result);break;case"colors":this.setResultColor(l,e[t[a]].task_result);break;default:await this.setResultImage(l,e[t[a]].task_result)}}this.reDraw()}async setElemenyGenerateResult(e,t){const a=Object.keys(e);for(let l=0;l<a.length;l++){const n=this.dataController.findData("element",t),{type:i}=n;switch(i){case"texts":const i=e[a[l]].task_result,s=await Zt(i.font);i.fontFamily=s;const o={fontSetting:i,width:this.canvasController.getTextWidth(i),height:i.font_size};n.setData(o);break;case"colors":n.setData({color:e[a[l]].task_result});break;default:const r=await bt(e[a[l]].task_result);if(n.setData({image:r}),n.hue&&Array.isArray(n.hue)){const e=new na(t,r),a=await e.grayToColor(n.hue);n.setData({handleImage:a})}}}this.reDraw()}async setResultImage(e,t){const{uuid:a}=e,l=await bt(t);this.dataController.layers[a].setData({image:l});for(let n=0;n<e.children.length;n++){const t=e.children[n],a=this.dataController.findData("element",t);if(a.setData({image:l}),a.hue&&Array.isArray(a.hue)){const e=new na(t,l),n=await e.grayToColor(a.hue);a.setData({handleImage:n})}}}async setResultText(e,t){const a=t,l=await Zt(a.font);a.fontFamily=l,e.setData({fontSetting:a}),e.children.forEach((e=>{const t=this.dataController.elements[e],l={fontSetting:a,width:this.canvasController.getTextWidth(a),height:a.font_size};t.setData(l)}))}setResultColor(e,t){e.children.forEach((e=>{this.dataController.elements[e].setData({color:t})}))}async generateGroup(e){await this.save();const t=$t(),a=this.dataController.findData("group",e),l=[];l.push({type:"Group",name:a.name,generateUuid:a.uuid,uuid:a.uuid,children:a.children});const{templateId:n,name:i}=this.canvasController;ba.addTask(n,i,"Group",l),this.reDraw(),t.close()}async generateLayer(e){await this.save();const t=$t(),a=this.dataController.findData("layer",e),l=[];l.push({type:"Layer",name:a.name,generateUuid:a.uuid,uuid:a.uuid});const{templateId:n,name:i}=this.canvasController;ba.addTask(n,i,"Layer",l),this.reDraw(),t.close()}async generateElement(e){await this.save();const t=this.dataController.findData("element",e),a=this.dataController.findData("layer",t.parentUuid),l=$t(),n=[];n.push({type:"Element",name:t.name,generateUuid:a.uuid,uuid:t.uuid});const{templateId:i,name:s}=this.canvasController;ba.addTask(i,s,"Element",n),this.reDraw(),l.close()}toImageGenerateView(e,t){const a=this.dataController.findData("element",e),{image:l,uuid:n}=a;this.toImageGenerateView({image:l.src,uuid:n},t)}async getLayerImage(e=!1){await this.canvasController.resize();const{zoomRatio:t,realWidth:a,realHeight:l,drawX:n,drawY:i}=this.canvasController;this.reDraw(),e&&this.canvasController.getRealCanvas();const s=this.dataController.elements,o=this.dataController.groups,r=this.dataController.layers,d=new Set;Object.keys(s).forEach((e=>{this.recomputationPosition(s[e])})),Object.keys(o).forEach((e=>{o[e].children.forEach((e=>{r[e].isShow&&d.add(e)}))})),Object.keys(r).forEach((e=>{r[e].children.forEach((t=>{r[e].isShow&&d.add(e)}))}));const u=[];let c=[];return this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{const t=this.dataController.findData("layer",e);t.isShow&&c.push(t)}))}else{const e=this.dataController.findData("layer",t);if(!e.isShow)return;c.push(e)}})),c.forEach((e=>{this.canvasController.clearAll(),e.children.forEach((e=>{const t=s[e];this.drawItem(t)}));const o=a*t,r=l*t,d=this.canvasController.ctx.getImageData(n,i,o,r),{canvas:c,ctx:h}=Jt({width:o,height:r});h.putImageData(d,0,0),u.push({name:e.name,uuid:e.uuid,image:c.toDataURL("image/png")})})),"editor"===this.canvasController.viewType&&await this.canvasController.resize(),this.reDraw(),u.reverse()}async getAllImage(){this.canvasController.getRealCanvas();const{zoomRatio:e,realWidth:t,realHeight:a,drawX:l,drawY:n,canvasDom:i}=this.canvasController;this.reDraw();const s=Math.floor(Math.min(i.width,i.height)),o=this.dataController.elements,r=this.dataController.groups,d=this.dataController.layers,u=new Set;Object.keys(o).forEach((e=>{this.recomputationPosition(o[e])})),Object.keys(r).forEach((e=>{r[e].children.forEach((e=>{d[e].isShow&&u.add(e)}))})),Object.keys(d).forEach((e=>{d[e].children.forEach((t=>{d[e].isShow&&u.add(e)}))}));const c=[];let h=[];return this.dataController.getAllList().forEach((({type:e,uuid:t})=>{if("group"===e){const e=this.dataController.findData("group",t),a=[];e.children.forEach((e=>{const t=this.dataController.findData("layer",e);a[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}})),a.forEach((({uuid:e})=>{const t=this.dataController.findData("layer",e);t.isShow&&h.push(t)}))}else{const e=this.dataController.findData("layer",t);if(!e.isShow)return;h.push(e)}})),h.forEach((e=>{const l=[];for(let n=0;n<Math.ceil(t/s);n++){this.canvasController.drawX=-n*s,l[n]=[];let i=s;s*(n+1)>t&&(i=t%s);for(let t=0;t<Math.ceil(a/s);t++){this.canvasController.drawY=-t*s;let r=s;s*(t+1)>a&&(r=a%s),this.canvasController.clearAll(),e.children.forEach((e=>{const t=o[e];this.drawItem(t)}));const d=this.canvasController.ctx.getImageData(0,0,i,r),{canvas:u,ctx:c}=Jt({width:i,height:r});c.putImageData(d,0,0),l[n].push(u.toDataURL("image/png"))}}c.push({name:e.name,uuid:e.uuid,image:l})})),await this.canvasController.resize(),this.reDraw(),c.reverse()}toTextEdit(e,t="text"){const a=this.dataController.findData("element",e);this.toTextEditView(a,t)}copyData(e){this.dataController.copyData(e,"element")}},ra=x(oa.dataController),da=x(oa.canvasController),ua=x(oa.generationController),ca="操作",ha="绘制",ma={NOMAL:"定位花",AGENT_X:"横向二方连续",AGENT_Y:"纵向二方连续",AGENT_F:"四方连续"},va="editor",pa="explosion",ga={statics:"静态层",prompts:"动态层",colors:"纯色层",texts:"文本层"},ya={All:"全部生成",Layer:"单层生成",Element:"单元素生成",Group:"单组生成"},fa="正常模式",wa="图生图";const ba=new class{constructor(){this.taskList=x([]),this.activeUuid=null}addTask(e,t,a,l=[],n=fa){const i=D(),s=en.currentRoute,o=x({uuid:i,template_id:e,template_name:t,name:`${t}-${n===fa?ya[a]:wa}`,taskType:a,progress:0,subTaskIndex:0,generateType:n,isFinish:!1,fromPath:s.value.path});l.length?(l.forEach((e=>{e.result=null})),o.subTask=l):(o.subTask=[o],o.subTask[0].result=null),this.taskList.push(o),this.activeUuid||(this.activeUuid=i,this.startTask()),I.success("任务已添加至队列")}async startTask(){if(!this.activeUuid)return;const e=this.taskList.find((({uuid:e})=>e===this.activeUuid)),{generateType:t,subTask:a,template_id:l,template_name:n}=e,i=new Ue(n,l);for(let r=0;r<a.length;r++){e.subTaskIndex=r;const{type:l}=a[r];let n=null;if(t===fa){if("Group"===l)try{n=await i.getGroupTaskResult([a[r]])}catch(o){}else if("Layer"===l)try{n=await i.getLayerTaskResult(a[r])}catch(o){}else if("Element"===l)try{n=await i.getElementTaskResult(a[r].uuid,a[r].generateUuid)}catch(o){}}else if(t===wa){const e=a[r],{imageUrl:t,similarity:l}=e;n=await i.imgGenerateImg(t,l)}a[r].result=n,e.progress=Math.round((r+1)/a.length*100)}e.isFinish=!0;const s=this.taskList.findIndex((({uuid:e})=>e===this.activeUuid));s<this.taskList.length-1?(this.activeUuid=this.taskList[s+1].uuid,this.startTask()):this.activeUuid=null,await this.setTaskResult([e])}async setTaskResult(e=this.taskList){let t=[];for(let a=0;a<e.length;a++){const l=e[a],{generateType:n,subTask:i,template_id:s,uuid:o}=l,r=en.currentRoute;if(!l.isFinish)break;if(n===fa){if(!("/modelEditor"!==r.value.path&&"/generateImage"!==r.value.path&&"/modelMainEditor"!==r.value.path||r.value.query.template_id!==s&&da.templateId!==s)){I.success(`${l.name} 生成完成，更新页面`);for(let e=0;e<i.length;e++){const{type:t}=i[e];switch(t){case"Group":await oa.setGroupGenerateResult(i[e].result);break;case"Layer":await oa.setLayerGenerateResult(i[e].result);break;case"Element":await oa.setElemenyGenerateResult(i[e].result,i[e].uuid)}}da.changeHandleType(ca),t.push(o)}}else if(n===wa&&!("/modelEditor"!==r.value.path&&"/generateImage"!==r.value.path&&"/modelMainEditor"!==r.value.path||r.value.query.template_id!==s&&da.templateId!==s)){I.success(`${l.name} 生成完成，更新页面`);const[e]=i,{uuid:a,result:n}=e,s=ra.findData("element",a);t.push(a),da.contextMenu({},s,"prompts",n.image.task_result),da.changeHandleType(ca)}}t.forEach((e=>{const t=this.taskList.findIndex((t=>t.uuid=e));this.taskList.splice(t,1)}))}checkInTask(){const e=en.currentRoute;return("/modelEditor"===e.value.path||"/generateImage"===e.value.path||"/modelMainEditor"===e.value.path)&&Boolean(this.taskList.length&&this.taskList.find((({template_id:e})=>da.templateId===e)))}getTaskList(){return this.taskList}};const ka=e=>(b("data-v-76f5dce2"),e=e(),k(),e),xa={class:"task-box"},Da={class:"task-list"},Ia={class:"data-statistics"},_a=ka((()=>r("div",{class:"cell-item"},"目前状态",-1))),Ca=ka((()=>r("div",{class:"cell-item"},"任务数量",-1))),Ta=ka((()=>r("div",{class:"cell-item"},"剩余时间",-1))),Ea=ka((()=>r("div",{class:"cell-item"},"消耗时间",-1))),Ma=ka((()=>r("div",{class:"cell-item"},"排队优先级",-1))),Sa=ka((()=>r("div",{class:"cell-item"},"任务类型",-1))),Aa=ka((()=>r("div",{class:"cell-item"},"节点数量",-1))),La=ka((()=>r("div",{class:"cell-item"},"内存使用",-1))),Ra=ka((()=>r("hr",null,null,-1))),Oa=ka((()=>r("div",{class:"title"},[h(" 费用统计 "),r("div",{class:"type-item success"},"完成"),r("div",{class:"type-item wait"},"队列"),r("div",{class:"type-item error"},"失败")],-1))),za={class:"data-statistics"},Pa=ka((()=>r("div",{class:"cell-item"},"已使用费用",-1))),Ua=ka((()=>r("b",null,"1.24 积分",-1))),Ga=ka((()=>r("div",{class:"cell-item"},"待使用费用",-1))),Na=ka((()=>r("b",null,"1.24 积分",-1))),ja=ka((()=>r("div",{class:"cell-item"},"返回费用",-1))),Va=ka((()=>r("b",null,"1.24 积分",-1))),Ha=ka((()=>r("div",{class:"cell-item"},"预估费用",-1))),Ya=ka((()=>r("b",null,"1.24 积分",-1)));var Ba=de({__name:"index",setup(e){const t=n(null),a=n(null),l=n(ba);return f((()=>{R((()=>{a.value=O(t.value),a.value.setOption({title:{text:""},tooltip:{},xAxis:{type:"category",silent:!1,splitLine:{show:!1},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},data:["a","b","c","d","e","f","a","b","c","d","e","f"]},yAxis:{splitLine:{show:!1},splitArea:{show:!1},axisLabel:{color:"#000000",fontSize:10,fontStyle:"normal"}},series:[{name:"积分",type:"bar",data:[{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#A5A5A5"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#A5A5A5"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#A5A5A5"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#A5A5A5"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#A5A5A5"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#A5A5A5"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#FF8686"}},{value:Math.round(100*Math.random()),itemStyle:{color:"#000000"}}],barWidth:"100%",barGap:"0%",barCategoryGap:"0%"}],grid:{left:"3%",top:"10%",bottom:"10%",containLabel:!0}})}))})),(e,a)=>{const n=i("el-scrollbar"),c=i("el-descriptions-item"),m=i("el-descriptions");return s(),o("div",xa,[r("div",Da,[d(n,null,{default:u((()=>[(s(!0),o(M,null,T(l.value.taskList,(e=>(s(),C(Oe,{key:e.uuid,progress:e.progress,name:e.name,template_name:e.template_name,template_id:e.template_id,fromPath:e.fromPath,subName:e.subTask[e.subTaskIndex].name},null,8,["progress","name","template_name","template_id","fromPath","subName"])))),128))])),_:1})]),r("div",Ia,[d(m,{direction:"vertical",title:"任务统计",column:4,size:"small"},{default:u((()=>[d(c,{width:"25%"},{label:u((()=>[_a])),default:u((()=>[h(" 任务处理中 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[Ca])),default:u((()=>[h(" 21/90 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[Ta])),default:u((()=>[h(" 00:14:40 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[Ea])),default:u((()=>[h(" 00:05:31 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[Ma])),default:u((()=>[h(" 高优先处理 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[Sa])),default:u((()=>[h(" GPU-普通模型 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[Aa])),default:u((()=>[h(" 15/15 ")])),_:1}),d(c,{width:"25%"},{label:u((()=>[La])),default:u((()=>[h(" min.64GB ")])),_:1})])),_:1}),Ra,Oa,r("div",{class:"echarts-area",ref_key:"echartsDom",ref:t},null,512),r("div",za,[d(m,{direction:"vertical",title:"",column:4,size:"small"},{default:u((()=>[d(c,{width:"25%",align:"center"},{label:u((()=>[Pa])),default:u((()=>[Ua])),_:1}),d(c,{width:"25%",align:"center"},{label:u((()=>[Ga])),default:u((()=>[Na])),_:1}),d(c,{width:"25%",align:"center"},{label:u((()=>[ja])),default:u((()=>[Va])),_:1}),d(c,{width:"25%",align:"center"},{label:u((()=>[Ha])),default:u((()=>[Ya])),_:1})])),_:1})])])])}}},[["__scopeId","data-v-76f5dce2"]]);var Fa=de({__name:"tMask",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!1},destroy:{type:Function},close:{type:Function}},emits:["close"],setup(e,{expose:t,emit:a}){const l=n(!0),i=n(!1),r=e,d=()=>{r.maskClickHide&&(r.close?r.close():u())},u=()=>{i.value&&(i.value=!1,setTimeout((()=>{l.value=!1,r.destroy&&r.destroy()}),200))},c=()=>{l.value=!0,setTimeout((()=>{i.value=!0}))};return f((()=>{c()})),t({hide:u,show:c}),(e,t)=>l.value?(s(),o("div",{key:0,class:"mask",style:g({backgroundColor:r.bgColor,opacity:Number(i.value)}),onClick:d},[v(e.$slots,"default",{},void 0,!0)],4)):w("",!0)}},[["__scopeId","data-v-1477fffe"]]);const Wa=e=>(b("data-v-03e321c0"),e=e(),k(),e),Xa={class:"login-outer"},$a={class:"login-box-image"},Za={class:"login-input-area"},Ja=[Wa((()=>r("i",{class:"bi bi-arrow-left"},null,-1)))],Qa={class:"logo-area"},qa=["src"],Ka={class:"main-title"},el={class:"sub-title"},tl={key:1,class:"input-box"},al={class:"input-item"},ll={key:0,class:"input-item"},nl={key:1,class:"input-item"},il={class:"input-handle"},sl={key:2,class:"input-box"},ol={class:"input-item"},rl=Wa((()=>r("label",null,m("手机号"),-1))),dl={key:0,class:"input-item"},ul=Wa((()=>r("label",null,"验证码",-1))),cl={class:"input-item"},hl=Wa((()=>r("label",null,"新的密码",-1))),ml={class:"input-item"},vl=Wa((()=>r("label",null,"确认密码",-1))),pl={key:3,class:"button-box"},gl={key:4,class:"button-box"},yl=[Wa((()=>r("div",{class:"login-btn"},"重置密码",-1)))],fl=Wa((()=>r("div",{class:"agreement-box"},"相关用户协议（注册登录后即代表您同意相关协议）",-1)));var wl=de({__name:"loginBox",props:{bgColor:{type:String,default:"var(--t-bg-opacity-color)"},maskClickHide:{type:Boolean,default:!0},destroy:{type:Function}},setup(e){const{userStore:t}=dn();n("tMaskDom");const a=n(null),l=n(null),i=n(!1),u=n(!1),h=n("widthCaptcha"),v=n(!1),p=n("获取验证码"),g=n(!1),y=n(null),b=()=>{h.value="widthPwd"===h.value?"widthCaptcha":"widthPwd",localStorage.setItem("loginType",h.value)},k=()=>{if(v.value)return;const e=(new Date).getTime()+3e4;localStorage.setItem("captchaGettingTime",e),x(e)},x=e=>{if(!e)return;e=Number(e);const t=(new Date).getTime();t>e?p.value="获取验证码":(p.value=`${Math.ceil((e-t)/1e3)}秒后可发送`,setTimeout((()=>{x(e)}),1e3))},D=e=>{"Enter"===e.code&&_()},_=()=>{a.value&&/^1[3-9]\d{9}$/.test(a.value)?l.value?t.handleLogin({username:a.value,password:l.value}).then((()=>{location.reload()})):I.error("请输入密码"):I.error("请输入正确的手机号")};return f((()=>{a.value=null,l.value=null;const e=localStorage.getItem("captchaGettingTime");x(e),h.value=localStorage.getItem("loginType")||"widthPwd",R((()=>{i.value=!0}))})),(e,t)=>(s(),o("div",Xa,[r("div",{class:c(["login-box show_start",{show_end:i.value}])},[r("div",$a,[d(E(z),{style:{width:"100%",height:"100%"},src:"widthPwd"===h.value?E("/assets/login-image_0.8afc8d0d.png"):E("/assets/login-image_1.bcdf127f.png")},null,8,["src"])]),r("div",Za,[g.value?(s(),o("div",{key:0,class:"to-login",onClick:t[0]||(t[0]=e=>g.value=!1)},Ja)):w("",!0),r("div",Qa,[r("img",{src:E(re),class:"login-logo"},null,8,qa)]),r("div",Ka,m(g.value?"你好，请重置密码！":"你好，欢迎回来！"),1),r("div",el,m(g.value?"请输入重置账户信息":"请输入登录账户信息"),1),g.value?w("",!0):(s(),o("div",tl,[r("div",al,[r("label",{class:c({hide:0===y.value})},m("widthPwd"===h.value?"手机账号":"手机号"),3),d(E(P),{clearable:"",modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value=e),placeholder:"新用户登录即注册",onFocus:t[2]||(t[2]=e=>y.value=0),onBlur:t[3]||(t[3]=e=>y.value=null)},null,8,["modelValue"])]),"widthPwd"===h.value?(s(),o("div",ll,[r("label",{class:c({hide:1===y.value})},"登录密码",2),d(E(P),{onKeydown:D,clearable:"",modelValue:l.value,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value=e),type:"password","show-password":"",onFocus:t[5]||(t[5]=e=>y.value=1),onBlur:t[6]||(t[6]=e=>y.value=null)},null,8,["modelValue"])])):w("",!0),"widthPwd"!==h.value?(s(),o("div",nl,[r("label",{class:c({hide:2===y.value})},"验证码",2),d(E(P),{clearable:"",modelValue:l.value,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value=e),onFocus:t[8]||(t[8]=e=>y.value=2),onBlur:t[9]||(t[9]=e=>y.value=null)},null,8,["modelValue"]),r("div",{class:c(["get-captcha",{disable:"获取验证码"===p.value}]),onClick:k},m(p.value),3)])):w("",!0),r("div",il,[d(E(U),{modelValue:u.value,"onUpdate:modelValue":t[10]||(t[10]=e=>u.value=e),label:"30天内记住密码",value:!0,size:"large"},null,8,["modelValue"]),r("div",{class:"forget-pwd",onClick:t[11]||(t[11]=e=>g.value=!0)}," 忘记密码 ")])])),g.value?(s(),o("div",sl,[r("div",ol,[rl,d(E(P),{clearable:"",modelValue:a.value,"onUpdate:modelValue":t[12]||(t[12]=e=>a.value=e),placeholder:"",onFocus:t[13]||(t[13]=e=>y.value=0),onBlur:t[14]||(t[14]=e=>y.value=null)},null,8,["modelValue"])]),"widthPwd"!==h.value?(s(),o("div",dl,[ul,d(E(P),{clearable:"",modelValue:l.value,"onUpdate:modelValue":t[15]||(t[15]=e=>l.value=e),onFocus:t[16]||(t[16]=e=>y.value=1),onBlur:t[17]||(t[17]=e=>y.value=null)},null,8,["modelValue"]),r("div",{class:c(["get-captcha",{disable:"获取验证码"===p.value}]),onClick:k},m(p.value),3)])):w("",!0),r("div",cl,[hl,d(E(P),{clearable:"",modelValue:l.value,"onUpdate:modelValue":t[18]||(t[18]=e=>l.value=e),type:"password","show-password":"",onFocus:t[19]||(t[19]=e=>y.value=2),onBlur:t[20]||(t[20]=e=>y.value=null)},null,8,["modelValue"])]),r("div",ml,[vl,d(E(P),{clearable:"",modelValue:l.value,"onUpdate:modelValue":t[21]||(t[21]=e=>l.value=e),type:"password","show-password":"",onFocus:t[22]||(t[22]=e=>y.value=3),onBlur:t[23]||(t[23]=e=>y.value=null)},null,8,["modelValue"])])])):w("",!0),g.value?w("",!0):(s(),o("div",pl,[r("div",{class:"login-btn",onClick:_},"登录账户"),r("div",{class:"login-btn change-login-type",onClick:b},m("widthPwd"===h.value?"验证码登录":"密码登录"),1)])),g.value?(s(),o("div",gl,yl)):w("",!0),fl])],2)]))}},[["__scopeId","data-v-03e321c0"]]);let bl=!1,kl=null;const xl=e=>{e=Object.assign({maskClickHide:!0},e);const t=oe();return new Promise((a=>{t?a():(a("unLogin"),(e=>{const{publicStore:t}=dn(),a=t.rootDom;let l=document.createElement("div");a.appendChild(l),bl&&(kl&&A(null,l),bl=!1),Object.assign(e,{destroy:()=>{kl&&(A(null,l),a.removeChild(l)),bl=!1}}),kl=d(wl,Object.assign({isShow:!0},e)),A(kl,l),bl=!0})(e))}))};const Dl=e=>(b("data-v-38d4c4ea"),e=e(),k(),e),Il={class:"nav-bar-body"},_l={class:"logo-area"},Cl=["src"],Tl=Dl((()=>r("div",{class:"router-link-area"},null,-1))),El={class:"handle-area"},Ml={key:0,class:"logout-btn"},Sl=[Dl((()=>r("span",null,"未登录",-1)))],Al={class:""};var Ll=de({__name:"navBar",setup(e){const{userStore:t,publicStore:a}=dn(),l=n(ba);y(),G(),n([]),n("ImageGenerationImage"),n(""),n(!1);const i=n(!1);return f((()=>{a.setColorScheme().then((()=>{i.value="dark"===a.colorScheme}))})),(e,a)=>(s(),o("div",Il,[r("div",_l,[r("img",{src:E(re)},null,8,Cl),h(" Teart ")]),Tl,r("div",El,[E(t).token?w("",!0):(s(),o("div",Ml,Sl)),E(t).token?(s(),C(me,{key:1,name:"任务队列",num:l.value.getTaskList().length,icon:"clouds",height:"17.8rem"},{default:u((()=>[d(Ba)])),_:1},8,["num"])):w("",!0),E(t).token?(s(),C(me,{key:2,name:"个人信息",icon:"person",height:"8rem"},{other:u((()=>[r("div",Al,[r("i",{class:c(["bi","bi-moon-stars"])}),h(" 300 ")])])),default:u((()=>[h(" 暂定 ")])),_:1})):w("",!0)])]))}},[["__scopeId","data-v-38d4c4ea"]]);const Rl={class:"menu-icon"},Ol=(e=>(b("data-v-968b46d2"),e=e(),k(),e))((()=>r("div",{class:"menu-name"},"收起面板",-1))),zl={class:"menu-all"},Pl=["onClick"],Ul={class:"menu-icon"},Gl={class:"menu-name"};var Nl=de({__name:"leftBar",setup(e){const{publicStore:t}=dn();n(t.routePath);const a=G(),l=y(),i=n([]),d=n(null),u=n(0);f((()=>{d.value=a.path,i.value=[{path:"/main",name:"模板仓库",includes:["/main","/generateImage"],icon:"bi-window-stack"},{path:"/modelMainEditor",name:"编辑模板",includes:["/modelEditor","/modelMainEditor"],icon:We},{path:"/promptSetting",name:"参数设置",includes:["/promptSetting"],icon:Ze},{path:"/gallery",name:"作品仓库",includes:["/gallery","/galleryUpdate"],icon:"bi-folder2"}]}));return(e,n)=>(s(),o("div",{class:c(["left-bar-body",{expand:u.value}])},[r("div",{class:"menu-title",onClick:n[0]||(n[0]=e=>(u.value=Number(!u.value),void t.setLeftBarShowType(u.value)))},[r("div",Rl,[r("i",{class:c(["bi icon",E("bi-house-door")])},null,2)]),Ol]),r("div",zl,[(s(!0),o(M,null,T(i.value,((e,n)=>(s(),o("div",{class:c(["menu-item",{selected:e.includes.findIndex((e=>e===E(t).routePath))>=0}]),key:n,onClick:t=>(({path:e})=>{a.path!==e&&xl().then((()=>{window.loading=$t(),setTimeout((()=>{l.push(e)}),300),d.value=e}))})(e)},[r("div",Ul,[r("i",{class:c(["bi icon",e.icon])},null,2)]),r("div",Gl,m(e.name),1)],10,Pl)))),128))])],2))}},[["__scopeId","data-v-968b46d2"]]);const jl={class:"home-body"},Vl={id:"main-inner"},Hl={class:"view-area"};var Yl=de({__name:"index",setup(e){const{publicStore:t}=dn(),a=G();return(e,l)=>{const n=i("el-aside"),h=i("router-view"),m=i("el-main"),v=i("el-container");return s(),o("div",jl,[d(Ll),d(v,{class:"home-child-view"},{default:u((()=>[d(n,{class:"aside"},{default:u((()=>[d(Nl)])),_:1}),d(m,{class:"main"},{default:u((()=>[r("div",Vl,[r("div",Hl,[(s(),C(h,{key:a.path,class:c({expand:E(t).leftBarShowType})},null,8,["class"]))])])])),_:1})])),_:1})])}}},[["__scopeId","data-v-52d80d36"]]);const Bl={},Fl=e=>(b("data-v-4b07d3ea"),e=e(),k(),e),Wl={class:"cloud-body"},Xl={class:"cloud-info"},$l=Fl((()=>r("div",{class:"error-title"}," 404 ",-1))),Zl=Fl((()=>r("div",{class:"error-sub-title"}," 未找到当前地址 ",-1)));var Jl=de(Bl,[["render",function(e,t){const a=i("el-result");return s(),o("div",Wl,[r("div",Xl,[d(a,{icon:"error",style:{"--el-result-icon-font-size":"3rem"}},{title:u((()=>[$l])),"sub-title":u((()=>[Zl])),_:1})])])}],["__scopeId","data-v-4b07d3ea"]]);const Ql={class:"main-body"},ql={class:"module-list"};const Kl=[{path:"/",name:"home",component:Yl,redirect:"/main",children:[{path:"main",name:"main",component:de({__name:"index",props:["class"],setup(e){const t=e,a=y(),l=n({}),h=()=>{zt("layouts").then((e=>{l.value=e.data}))};return f((()=>{xl().then((()=>{h()})),window.loading||(window.loading=$t()),setTimeout((()=>{window.loading.close(),window.loading=null}),300)})),(e,n)=>{const m=i("modelCard"),v=i("el-scrollbar");return s(),o("div",Ql,[r("div",ql,[d(v,null,{default:u((()=>[(s(!0),o(M,null,T(l.value,(e=>(s(),C(m,{class:c(t.class),key:e.template_id,data:{name:e.template_name,preview:e.preview},onToUpdate:()=>{(({template_name:e,template_id:t})=>{window.loading=$t(),setTimeout((()=>{a.push({path:"modelEditor",query:{file_name:e,template_id:t}})}),300)})(e)},onDeleteItem:()=>{(({name:e,template_id:t})=>{Nt(t,"layouts",e).then((e=>{h()}))})({name:e.template_name,template_id:e.template_id})},"need-go-handle":"",onGoHandle:()=>{(({template_name:e,template_id:t})=>{window.loading=$t(),setTimeout((()=>{a.push({path:"generateImage",query:{file_name:e,template_id:t}})}),300)})(e)}},null,8,["class","data","onToUpdate","onDeleteItem","onGoHandle"])))),128))])),_:1})])])}}},[["__scopeId","data-v-d87e9c7e"]])},{path:"modelEditor",name:"modelEditor",component:()=>ee((()=>import("./index.376571c9.js")),["assets/index.376571c9.js","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"modelMainEditor",name:"modelMainEditor",component:()=>ee((()=>import("./index.376571c9.js")),["assets/index.376571c9.js","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"generateImage",name:"generateImage",component:()=>ee((()=>import("./index.77374eb3.js")),["assets/index.77374eb3.js","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"promptSetting",name:"promptSetting",component:()=>ee((()=>import("./index.a1cead31.js")),["assets/index.a1cead31.js","assets/index.dbb678cb.css","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"gallery",name:"gallery",component:()=>ee((()=>import("./index.a453bcfa.js")),["assets/index.a453bcfa.js","assets/index.fbf316b0.css","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"galleryUpdate",name:"galleryUpdate",component:()=>ee((()=>import("./index.49276c02.js")),["assets/index.49276c02.js","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"conversation",name:"conversation",component:()=>ee((()=>import("./index.03c7ac59.js")),["assets/index.03c7ac59.js","assets/index.5632a8dd.css","assets/lib.b70eb088.js","assets/lib.4ea63656.css"])},{path:"404",name:"404",component:Jl}]}],en=N({history:j("/"),routes:Kl});let tn=[];Kl.forEach((e=>{e.children&&e.children.length?tn=tn.concat(e.children.map((t=>`${"/"!==e.path?e.path:""}/${t.path}`))):tn.push(e.path)})),en.beforeEach(((e,t,a)=>{const{publicStore:l}=dn();if(!tn.find((t=>t===e.path))&&"/main"!==e.path)return l.setRoutePath("/404"),void a("/404");const n=oe();return"/main"===e.path||"/404"===e.path||n?(l.setRoutePath(e.path),void a()):(l.setRoutePath("/main"),void a("/main"))}));const an=V.create({baseURL:"https://u248120-a5f1-770998cc.westb.seetacloud.com:8443",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function ln(e){if(!e.response)return I.error({message:"请求超时"}),Promise.reject(e);oe();const t=e.response.status,a=e.response.data,{userStore:l}=dn();return 401===t?(I.error({message:"登录失效, 请重新登陆"}),l.handleLogout().then((()=>{setTimeout((()=>{en.push("/main")}),1500)}))):400===t||500===t?I.error({message:a.message}):403===t&&I.error({message:"无权限操作"}),Promise.reject(e)}an.interceptors.request.use((e=>{const t=oe();if(t&&e.headers){const a=ie();e.headers.Authorization=`Bearer ${t}`,e.headers.user_id=a}return e}),ln),an.interceptors.response.use((e=>200===e.status&&200===e.data.code?e.data:Promise.reject(e.data)),ln);const nn=a({id:"users",state:()=>({user:ie()||"***********",permissions:null,token:oe()||"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((t,a)=>{(function({username:e,password:t}){return an.post(`/teai/login?phone_number=${e}&password=${t}`)})(e).then((a=>{var n;this.token=a.token,this.user=e.username,se(this.user),n=this.token,l.set(ne,n,{expires:1}),t()})).catch((e=>{a(e)}))}))},handleLogout(e=""){return new Promise(((e,t)=>{l.remove(ne),localStorage.removeItem(le+"USER"),this.user=null,this.permissions=null,this.token="",se(null),e(null)}))}}});const sn={"./modules/public.js":ae,"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:nn,setupStore:function(e){return nn(e)}},Symbol.toStringTag,{value:"Module"}))},on=H(),rn={};function dn(){return rn}Object.keys(sn).forEach((e=>{const t=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];rn[`${t}Store`]=sn[e].setupStore(on)}));const un={class:"view-body"},cn={__name:"App",setup(e){const{publicStore:t}=dn(),a=n(1920);n(1080);const l=n("rootDom"),u=()=>{const e=document.body.clientWidth;document.body.clientHeight,a.value=e;const t=a.value/50;document.documentElement.style.fontSize=`${t}px`,window.rootFont=t;const l=document.getElementById("theme-main");l&&l.parentNode.removeChild(l)};return f((()=>{document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.addEventListener("wheel",(function(e){(e.altKey||e.ctrlKey)&&(e.preventDefault(),e.stopPropagation())}),{passive:!1}),u(),window.onresize=()=>{u()},t.setRootDom(l.value)})),(e,t)=>{const a=i("RouterView");return s(),o("div",un,[r("div",{class:"view-body-info",id:"view-body-info",ref_key:"rootDom",ref:l},[d(a,{id:"main-view"})],512)])}}};if("undefined"!=typeof window){let e=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML="",e.insertBefore(t,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const hn={key:0,class:"loading-area"},mn={key:0};var vn=de({__name:"tButton",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"Loading"}},setup(e){const t=e,a=n(!1),l=()=>{switch(t.type){case"info":return a.value=!1,"box-info";case"success":return a.value=!1,"box-success";case"error":return a.value=!1,"box-error";case"warn":return a.value=!1,"box-warn";case"text-success":return a.value=!0,"text-success";case"text-info":return a.value=!0,"text-info";case"text-warn":return a.value=!0,"text-warn";case"text-error":return a.value=!0,"text-error";default:return null}},i=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},d=()=>{switch(t.type){case"info":case"text-info":return"background:var(--t-info-hover-color)";case"success":case"text-success":return"background:var(--t-success-hover-color)";case"error":case"text-error":return"background:var(--t-error-hover-color)";case"warn":case"text-warn":return"background:var(--t-warn-hover-color)";default:return null}},u=()=>{const e={type:l(),size:i()};let t="";return Object.keys(e).forEach((a=>{e[a]&&(t+=`${e[a]} `)})),t};return(e,l)=>(s(),o("div",{class:c(`t-btn ${u()}`)},[r("div",{style:g(`opacity: ${Number(!a.value||a.value&&!t.loading)};`)},[v(e.$slots,"default",{},void 0,!0)],4),a.value&&t.loading?(s(),o("div",hn,m(t.loadingText),1)):w("",!0),a.value?w("",!0):(s(),o("div",{key:1,class:c(["hover-area",{loading:t.loading}]),style:g(d())},[t.loading?(s(),o("div",mn,m(t.loadingText),1)):w("",!0)],6))],2))}},[["__scopeId","data-v-071339ed"]]);var pn=de({__name:"tTag",props:{type:{type:String,default:"error"},size:{type:String,default:"nomal"}},setup(e){const t=e,a=()=>{switch(t.type){case"info":default:return"box-info";case"success":return"box-success";case"error":return"box-error";case"warn":return"box-warn"}},l=()=>{switch(t.size){case"min":return"min-text";case"nomal":return"nomal-text";case"large":return"large-text";default:return null}},n=()=>{const e={type:a(),size:l()};let t="";return Object.keys(e).forEach((a=>{e[a]&&(t+=`${e[a]} `)})),t};return(e,t)=>(s(),o("div",{class:c(`t-btn ${n()}`)},[v(e.$slots,"default",{},void 0,!0)],2))}},[["__scopeId","data-v-660ee02c"]]);const gn={class:"model-name"},yn=(e=>(b("data-v-7b9efddc"),e=e(),k(),e))((()=>r("div",{class:"model-handle-del-area-outer"},[r("div",{class:"model-handle-area"})],-1))),fn={class:"model-handle-area-outer"};var wn=de({__name:"modelCard",props:{data:{type:Object,default:()=>({preview:null,name:null})},class:{},needGoHandle:{type:Boolean,default:!1},needEdit:{type:Boolean,default:!0}},emits:["toUpdate","deleteItem","goHandle"],setup(e,{emit:t}){const a=t,l=e,d=n([]),u=n(!0),h=n("imageDom"),v=()=>{d.value=[]},y=()=>{_.confirm(`您将要删除"${l.data.name}"模板，是否继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{a("deleteItem")})).catch((()=>{I({type:"info",message:"取消删除"})}))};return(e,t)=>{const n=i("el-image");return s(),o("div",{class:c(["module-item",l.class])},[u.value?(s(),C(n,{key:0,ref_key:"imageDom",ref:h,"hide-on-click-modal":"",onClose:v,"preview-src-list":d.value,src:l.data.preview,class:"model-image",fit:"contain"},null,8,["preview-src-list","src"])):w("",!0),r("div",gn,m(l.data.name),1),yn,r("div",fn,[r("div",{class:"model-handle-area",style:g({width:l.needGoHandle&&l.needEdit?"3.6rem":"2.4rem"})},[r("div",{class:"handle-btn box-error",onClick:p(y,["stop"])},[r("i",{class:c(["bi icon",E(Je)])},null,2)]),l.needEdit?(s(),o("div",{key:0,class:"handle-btn box-warn",onClick:t[0]||(t[0]=e=>a("toUpdate"))},[r("i",{class:c(["bi icon",E(We)])},null,2)])):w("",!0),l.needGoHandle?(s(),o("div",{key:1,class:"handle-btn box-main",onClick:t[1]||(t[1]=e=>a("goHandle"))},[r("i",{class:c(["bi icon",E("bi-play")])},null,2)])):w("",!0)],4)])],2)}}},[["__scopeId","data-v-7b9efddc"]]);const bn={class:"element-item"},kn=["title"],xn={class:"element-handle-area"};var Dn=de({__name:"elementLayers",props:{data:{},editorType:{},editorLayersDom:{},groupUuid:{default:null},layerUuid:{default:null}},emits:["toLayerInfo"],setup(e,{emit:t}){const a=n(ra),l=n(oa),i=n(da),d=e,u=t,h=(...e)=>{u("toLayerInfo",...e)};return(t,n)=>(s(),o("div",bn,[r("div",{class:c(["element-title",{selected:a.value.isSelected("element",d.data.uuid)}]),onContextmenu:n[3]||(n[3]=e=>((e,t,l)=>{const n=a.value.findData(e,t),{pageX:s,pageY:o}=l;i.value.handleController.setHandle(n,{x:s,y:o},e,Boolean(n.image),d.editorLayersDom).then((l=>{const{name:s}=l;switch(e){case"element":i.value.contextmenuCallBack(l);break;case"layer":switch(s){case ut:a.value.delete(e,t);break;case st:h(n);break;case mt:a.value.copyData(t,e)}break;case"group":switch(s){case ct:a.value.delete(e,t);break;case vt:a.value.copyData(t,e)}}}))})("element",d.data.uuid,e)),onClick:n[4]||(n[4]=e=>a.value.changeSelected([d.groupUuid,d.layerUuid,d.data.uuid]))},[r("div",{class:"element-name",title:a.value.elements[d.data.uuid].name},m(a.value.elements[d.data.uuid].name),9,kn),r("div",xn,["gallery"!==e.editorType?(s(),o("div",{key:0,class:c(["pointer icon bi",E(Be)]),onClick:n[0]||(n[0]=p((e=>((...e)=>{l.value.generateElement(...e)})(d.data.uuid)),["stop"]))},null,2)):w("",!0),r("div",{class:c(["pointer icon bi",a.value.elements[d.data.uuid].isShow?E(Fe):E("bi-eye-slash")]),onClick:n[1]||(n[1]=p((()=>{a.value.handleIsShow("element",d.data.uuid,a.value.elements[d.data.uuid].isShow?"hide":"show"),u("setDiagramImage")}),["stop"]))},null,2),"edit"===d.editorType?(s(),o("div",{key:1,class:c(["pointer icon bi",E(Qe)]),onClick:n[2]||(n[2]=p((e=>a.value.delete("element",d.data.uuid)),["stop"]))},null,2)):w("",!0)])],34)]))}},[["__scopeId","data-v-d30d777a"]]);const In={class:"layer-list"},_n=["id"],Cn=["title"],Tn={class:"layer-handle-area"};var En=de({__name:"layerLayers",props:{data:{},editorType:{},editorLayersDom:{},groupUuid:{default:null},isLast:{},dropType:{default:"layer"}},emits:["toLayerInfo","setChildLength"],setup(e,{emit:t}){const a=n(ra),l=n(oa),i=n(da),d=n(!1),u=n(null),v=e,y=n(!1),f=n(!1),b=t,k=()=>{const{uuid:e}=v.data;if(!e)return[];const t=a.value.findData("layer",e),l=[];t.children.forEach((e=>{const t=a.value.findData("element",e);l[t.zIndex-1]={name:t.name,uuid:t.uuid,zIndex:t.zIndex}}));for(let a=0;a<l.length;a++)if(!l[a])return[];return b("setChildLength",{uuid:v.data.uuid,length:x(l)}),l},x=e=>a.value.isShowMapShow("layer",v.data.uuid)?e.length:0,D=(...e)=>{b("toLayerInfo",...e)},I=(e,t,l,n=null)=>{l.preventDefault(),y.value=!1,f.value=!1,d.value=!1,window.dragDomId=null;const i=JSON.parse(l.dataTransfer.getData("text/plain")),s={uuid:e,type:t};a.value.bindGroup({fromData:i,toData:s,zIndex:n})};return(t,n)=>(s(),o("div",In,[r("div",{class:c(["drop-to-line",{droped:y.value}]),onDragover:n[0]||(n[0]=p((e=>y.value=!0),["prevent"])),onDragleave:n[1]||(n[1]=p((e=>y.value=!1),["prevent"])),onDrop:n[2]||(n[2]=p((e=>I(v.data.uuid,v.data.type,e,v.data.zIndex)),["stop"]))},null,34),r("div",{class:c(["layer-title",{selected:a.value.isSelected("layer",v.data.uuid)&&!d.value,dropover:d.value}]),ref_key:"dropOverDom",ref:u,id:`${v.data.type}_${v.data.uuid}`,onClick:n[7]||(n[7]=e=>a.value.changeSelected([v.groupUuid,v.data.uuid,null])),onDragover:n[8]||(n[8]=p((e=>(v.data.uuid,v.data.type,void(u.value.id!==window.dragDomId&&(d.value=!0)))),["prevent"])),onDragleave:n[9]||(n[9]=p((e=>d.value=!1),["prevent"])),onContextmenu:n[10]||(n[10]=e=>((e,t,l)=>{const n=a.value.findData(e,t),{pageX:s,pageY:o}=l;i.value.handleController.setHandle(n,{x:s,y:o},e,Boolean(n.image),v.editorLayersDom).then((l=>{const{name:s}=l;switch(e){case"element":i.value.contextmenuCallBack(l);break;case"layer":switch(s){case ut:a.value.delete(e,t);break;case st:D(n);break;case mt:a.value.copyData(t,e)}break;case"group":switch(s){case ct:a.value.delete(e,t);break;case vt:a.value.copyData(t,e)}}}))})("layer",v.data.uuid,e)),onDrop:n[11]||(n[11]=p((e=>I(v.data.uuid,v.data.type,e)),["stop"])),draggable:"true",onDragstart:n[12]||(n[12]=e=>{return t=v.data.uuid,a=v.data.type,l=e,window.dragDomId=u.value.id,void l.dataTransfer.setData("text/plain",JSON.stringify({uuid:t,type:a}));var t,a,l})},[r("div",{class:"layer-name",title:a.value.layers[v.data.uuid].name},[r("div",{class:c(["icon bi",`${E("bi-caret-right")} ${a.value.isShowMapShow("layer",v.data.uuid)?"selected":""}`]),onClick:n[3]||(n[3]=p((()=>{a.value.handleShowMap("layer",v.data.uuid)}),["stop"]))},null,2),h(" "+m(a.value.layers[v.data.uuid].name),1)],8,Cn),r("div",Tn,["gallery"!==e.editorType?(s(),o("div",{key:0,class:c(["pointer icon bi",E(Be)]),onClick:n[4]||(n[4]=p((e=>((...e)=>{l.value.generateLayer(...e)})(v.data.uuid)),["stop"]))},null,2)):w("",!0),r("div",{class:c(["pointer icon bi",a.value.layers[v.data.uuid].isShow?E(Fe):E("bi-eye-slash")]),onClick:n[5]||(n[5]=p((()=>{a.value.handleIsShow("layer",v.data.uuid,a.value.layers[v.data.uuid].isShow?"hide":"show"),b("setDiagramImage")}),["stop"]))},null,2),"edit"===v.editorType?(s(),o("div",{key:1,class:c(["pointer icon bi",E(Qe)]),onClick:n[6]||(n[6]=p((e=>a.value.delete("layer",v.data.uuid)),["stop"]))},null,2)):w("",!0)])],42,_n),r("div",{class:"child-list",style:g({maxHeight:a.value.isShowMapShow("layer",v.data.uuid)?1.1*k().length+"rem":"0rem"})},[(s(!0),o(M,null,T(k(),(e=>(s(),C(Dn,{layerUuid:v.data.uuid,groupUuid:v.groupUuid,onToLayerInfo:D,editorType:v.editorType,editorLayersDom:v.editorLayersDom,data:e,key:e.uuid},null,8,["layerUuid","groupUuid","editorType","editorLayersDom","data"])))),128))],4),v.isLast?(s(),o("div",{key:0,class:c(["drop-to-line",{droped:f.value}]),onDragover:n[13]||(n[13]=p((e=>f.value=!0),["prevent"])),onDragleave:n[14]||(n[14]=p((e=>f.value=!1),["prevent"])),onDrop:n[15]||(n[15]=p((e=>I(v.data.uuid,v.data.type,e,0)),["stop"]))},null,34)):w("",!0)]))}},[["__scopeId","data-v-6d7e943a"]]);const Mn={class:"group-list"},Sn=["id"],An=["title"],Ln={class:"group-handle-area"};var Rn=de({__name:"groupLayers",props:{data:{},editorType:{},editorLayersDom:{},isLast:{}},emits:["toLayerInfo"],setup(e,{emit:t}){const a=n(ra),l=n(oa),i=n(da),d=n(!1),u=n(!1),v=e,y=n(new Map),f=n(!1),b=n(null),k=t,x=()=>{const{uuid:e}=v.data;if(!e)return[];const t=a.value.findData("group",e),l=[];return t.children.forEach((e=>{const t=a.value.findData("layer",e);l[t.zIndex-1]={type:"layer",uuid:t.uuid,zIndex:t.zIndex}})),l},D=({uuid:e,length:t})=>{y.value.set(e,t)},I=e=>{if(!a.value.isShowMapShow("group",v.data.uuid))return 0;let t=e.length;for(let[a,l]of y.value)t+=l;return t},_=(e,t,l,n=null)=>{l.preventDefault(),d.value=!1,u.value=!1,f.value=!1,window.dragDomId=null;const i=JSON.parse(l.dataTransfer.getData("text/plain")),s={uuid:e,type:t};a.value.bindGroup({fromData:i,toData:s,zIndex:n})},S=(...e)=>{k("toLayerInfo",...e)};return(t,n)=>(s(),o("div",Mn,[r("div",{class:c(["drop-to-line",{droped:d.value}]),onDragover:n[0]||(n[0]=p((e=>d.value=!0),["prevent"])),onDragleave:n[1]||(n[1]=p((e=>d.value=!1),["prevent"])),onDrop:n[2]||(n[2]=p((e=>_(v.data.uuid,v.data.type,e,v.data.zIndex)),["stop"]))},null,34),r("div",{class:c(["group-title",{selected:a.value.isSelected("group",v.data.uuid)&&!f.value,dropover:f.value}]),ref_key:"dropOverDom",ref:b,id:`${v.data.type}_${v.data.uuid}`,onDragover:n[7]||(n[7]=p((e=>(v.data.uuid,v.data.type,void(b.value.id!==window.dragDomId&&(f.value=!0)))),["prevent"])),onDragleave:n[8]||(n[8]=p((e=>f.value=!1),["prevent"])),onContextmenu:n[9]||(n[9]=e=>((e,t,l)=>{const n=a.value.findData(e,t),{pageX:s,pageY:o}=l;i.value.handleController.setHandle(n,{x:s,y:o},e,Boolean(n.image),v.editorLayersDom).then((l=>{const{name:s}=l;switch(e){case"element":i.value.contextmenuCallBack(l);break;case"layer":switch(s){case ut:a.value.delete(e,t);break;case st:S(n);break;case mt:a.value.copyData(t,e)}break;case"group":switch(s){case ct:a.value.delete(e,t);break;case vt:a.value.copyData(t,e)}}}))})("group",v.data.uuid,e)),onDrop:n[10]||(n[10]=p((e=>_(v.data.uuid,"group",e)),["stop"])),onClick:n[11]||(n[11]=e=>a.value.changeSelected([v.data.uuid,null,null])),draggable:"true",onDragstart:n[12]||(n[12]=e=>{return t=v.data.uuid,a=v.data.type,l=e,window.dragDomId=b.value.id,void l.dataTransfer.setData("text/plain",JSON.stringify({uuid:t,type:a}));var t,a,l})},[r("div",{class:"group-name",title:a.value.groups[v.data.uuid].name},[r("div",{class:c(["icon bi",`${E("bi-caret-right")} ${a.value.isShowMapShow("group",v.data.uuid)?"selected":""}`]),onClick:n[3]||(n[3]=p((()=>{a.value.handleShowMap("group",v.data.uuid)}),["stop"]))},null,2),h(" "+m(a.value.groups[v.data.uuid].name),1)],8,An),r("div",Ln,["gallery"!==e.editorType?(s(),o("div",{key:0,class:c(["pointer icon bi",E(Be)]),onClick:n[4]||(n[4]=p((e=>((...e)=>{l.value.generateGroup(...e)})(v.data.uuid)),["stop"]))},null,2)):w("",!0),r("div",{class:c(["pointer icon bi",a.value.groups[v.data.uuid].isShow?E(Fe):E("bi-eye-slash")]),onClick:n[5]||(n[5]=p((()=>{a.value.handleIsShow("group",v.data.uuid,a.value.groups[v.data.uuid].isShow?"hide":"show"),k("setDiagramImage")}),["stop"]))},null,2),"edit"===v.editorType?(s(),o("div",{key:1,class:c(["pointer icon bi",E(Qe)]),onClick:n[6]||(n[6]=p((e=>a.value.delete("group",v.data.uuid)),["stop"]))},null,2)):w("",!0)])],42,Sn),r("div",{class:"child-list",style:g({maxHeight:1.1*I(x())+"rem"})},[(s(!0),o(M,null,T(x(),((e,t)=>(s(),C(En,{groupUuid:v.data.uuid,onToLayerInfo:S,onSetChildLength:D,editorType:v.editorType,editorLayersDom:v.editorLayersDom,isLast:t===x().length-1,data:e,key:t},null,8,["groupUuid","editorType","editorLayersDom","isLast","data"])))),128))],4),v.isLast?(s(),o("div",{key:0,class:c(["drop-to-line",{droped:u.value}]),onDragover:n[13]||(n[13]=p((e=>u.value=!0),["prevent"])),onDragleave:n[14]||(n[14]=p((e=>u.value=!1),["prevent"])),onDrop:n[15]||(n[15]=p((e=>_(v.data.uuid,v.data.type,e,0)),["stop"]))},null,34)):w("",!0)]))}},[["__scopeId","data-v-23e32a93"]]);const On={class:"editor-layers-title"},zn=(e=>(b("data-v-1a5e9a63"),e=e(),k(),e))((()=>r("div",{class:"title-name"},[r("i",{class:"bi bi-layers"}),h(" 图层 ")],-1)));var Pn=de({__name:"editorLayers",props:{viewType:{type:String,default:"编辑器"},typeList:{type:Array,default:()=>[]},groupList:{type:Array,default:()=>[]},editorType:{}},emits:["toLayerInfo","setSelectedLayer","deleteGroup","deleteLayer","deleteElement","setGroup","hideLayer","reGenerateGroup","reGenerateLayer","reGenerateElement","setDiagramImage"],setup(e,{expose:t,emit:a}){const l=n(ra);n(oa),n(da);const h=e,m=a,v=n(null),g=(...e)=>{m("toLayerInfo",...e)};return t({setSelectedElement:e=>{const t=h.typeList.find((t=>new Set(Object.keys(t.layerInfo)).has(e))),a=t?t.uuid:null,l=h.groupList.find((e=>new Set(e.layers).has(a))),n=l?l.uuid:null;selectedElement(e,a,n)}}),(t,a)=>{const n=i("el-scrollbar");return s(),o("div",{class:"editor-layers",ref_key:"editorLayersDom",ref:v},[r("div",On,[zn,"generate"!==e.editorType&&"gallery"!==e.editorType?(s(),o("i",{key:0,class:c(["pointer icon bi",E("bi-plus")]),onClick:a[0]||(a[0]=e=>g())},null,2)):w("",!0)]),r("div",{class:"list-outer",onDragover:a[1]||(a[1]=p((()=>{}),["prevent"])),onDrop:a[2]||(a[2]=e=>(e=>{e.preventDefault();const t=JSON.parse(e.dataTransfer.getData("text/plain")),{type:a,uuid:n}=t;if(l.value.findData(a,n).parentUuid)l.value.unbindGroup(t);else{const e=l.value.getAllList().reverse();l.value.bindGroup({fromData:t,toData:e[e.length-1],zIndex:e[e.length-1].zIndex+1})}})(e))},[d(n,null,{default:u((()=>[(s(!0),o(M,null,T(l.value.getAllList().reverse(),((e,t)=>(s(),o(M,null,[e&&"group"===e.type?(s(),C(Rn,{isFirst:0===t,isLast:t===l.value.getAllList().length-1,onToLayerInfo:g,editorType:h.editorType,data:e,key:e?e.uuid:t},null,8,["isFirst","isLast","editorType","data"])):w("",!0),e&&"layer"===e.type?(s(),C(En,{isFirst:0===t,isLast:t===l.value.getAllList().length-1,onToLayerInfo:g,editorType:h.editorType,data:e,key:e?e.uuid:t},null,8,["isFirst","isLast","editorType","data"])):w("",!0)],64)))),256))])),_:1})],32)],512)}}},[["__scopeId","data-v-1a5e9a63"]]);const Un={class:"menu-icon"},Gn=["src"],Nn=(e=>(b("data-v-d5615a8a"),e=e(),k(),e))((()=>r("div",{class:"menu-name"},null,-1))),jn={class:"menu-all"},Vn=["onClick"],Hn={class:"menu-icon"},Yn={class:"menu-name"};var Bn=de({__name:"editorHandle",props:["editorType"],emits:["changeHandleType","exportImage","changeViewType","toGenrateGroup","toAdvancedSettingDom","save"],setup(e,{emit:t}){const{publicStore:a}=dn(),l=n(da),h=n(oa),v=G();y();const p=n([]),g=n(null),w=n(0),b=n(0),k=e,x=t,_=()=>{const e=C(),t=S();return[].concat(e,t)},C=()=>l.value.handleState===ca&&"edit"===k.editorType?[{name:"绘制模式",icon:"bi-grid",click(){l.value.changeHandleType(ha),ra.selectedMap.element=null,da.reDraw()}}]:l.value.handleState===ha&&"edit"===k.editorType?[{name:"操作模式",icon:"bi-bounding-box-circles",click(){l.value.changeHandleType(ca)}}]:[],S=()=>{let e=[{name:"下载图片",icon:"bi-download",async click(){(await h.value.getAllImage()).forEach((({name:e,image:t})=>{const a=`${D()}`;"aaaaa"!==e&&t.forEach(((t,l)=>{t.forEach(((t,n)=>{const i=yt(t),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=`${a}_${e}_${l}_${n}.png`,document.body.appendChild(o),o.click(),URL.revokeObjectURL(i),document.body.removeChild(o)}))}))}))}},{name:"/generateImage"===v.path?"作品保存":"模板保存",icon:"bi-cloud-arrow-up",click(){if(!l.value.name)return I.error("请在设置模板名称后操作"),void x("toCanvasSetting");h.value.save(1)}},{name:"效果调节",icon:Ze,click(){x("toAdvancedSettingDom")}},{name:"测试生成",icon:b.value?Be:"bi-play",click(){if(!l.value.name)return I.error("请在设置模板名称后操作"),void x("toCanvasSetting");b.value++,h.value.save().then((()=>{h.value.generateAll()}))}},{name:"分层展示",icon:"bi-layers",click(){x("changeViewType")}}];if("edit"===k.editorType&&(e=e.concat([{name:"画板设置",icon:"bi-gear",click(){x("toCanvasSetting")}}])),"gallery"===k.editorType){const t=e.findIndex((e=>"测试生成"===e.name));e.splice(t,1)}return e};return f((()=>{g.value=v.path,p.value=[]})),(e,t)=>{const l=i("el-icon");return s(),o("div",{class:c(["left-bar-body",{expand:w.value}])},[r("div",{class:"menu-title",onClick:t[0]||(t[0]=e=>(w.value=Number(!w.value),void a.setLeftBarShowType(w.value)))},[r("div",Un,[d(l,{class:"icon"},{default:u((()=>[r("img",{src:E("/assets/menu.2082884d.svg")},null,8,Gn)])),_:1})]),Nn]),r("div",jn,[(s(!0),o(M,null,T(_(),((e,t)=>(s(),o("div",{class:"menu-item",key:t,onClick:t=>e.click()},[r("div",Hn,[r("i",{class:c(["bi icon",e.icon])},null,2)]),r("div",Yn,m(e.name),1)],8,Vn)))),128))])],2)}}},[["__scopeId","data-v-d5615a8a"]]);const Fn=e=>(b("data-v-10a1f3dc"),e=e(),k(),e),Wn={class:"editor-draw-board-setting-box"},Xn={class:"editor-draw-board-setting-title"},$n={class:"editor-draw-board-setting-handle-area"},Zn={class:"setting-item"},Jn=Fn((()=>r("div",{class:"setting-item-label"},"模板名称",-1))),Qn={class:"setting-item-value"},qn={class:"setting-item"},Kn=Fn((()=>r("div",{class:"setting-item-label"},"宽度W",-1))),ei={class:"setting-item-value"},ti=Fn((()=>r("div",{class:"setting-item-label"},"高度H",-1))),ai={class:"setting-item-value"},li={class:"setting-item"},ni=Fn((()=>r("div",{class:"setting-item-label"},"绘制方式",-1))),ii={class:"setting-item-value"},si={class:"setting-item"},oi=Fn((()=>r("div",{class:"setting-item-label"},"模板分类",-1))),ri={class:"setting-item-value"},di={class:"setting-item"},ui=Fn((()=>r("div",{class:"setting-item-label"},"模板等级",-1))),ci={class:"setting-item-value"},hi={class:"setting-item"},mi=Fn((()=>r("div",{class:"setting-item-label"},"售卖点数",-1))),vi={class:"setting-item-value"};var pi=de({__name:"editorDrawBoardSetting",props:["editorType"],setup(e,{expose:t}){const a=G(),l=e,m="/modelMainEditor"===a.path,v=n(!1);n(null);const p=n({}),g=n(da),y=n(ua),f=[{name:"普通",key:"normal"},{name:"高级",key:"high"},{name:"顶级",key:"top"}],w=[{name:"普通",key:"normal"},{name:"高级",key:"high"},{name:"顶级",key:"top"}],b=()=>{v.value=!1};return t({show:e=>{v.value?b():(p.value=da.getData(),v.value=!0)}}),(e,t)=>{const a=i("el-input"),n=i("el-input-number"),k=i("el-option"),x=i("el-select");return s(),o("div",{class:c(["editor-draw-board-setting",{show:v.value}])},[r("div",Wn,[r("div",Xn,[h(" 画板设置 "),r("div",$n,[r("div",{class:"editor-draw-board-setting-handle",onClick:t[0]||(t[0]=e=>b())},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{class:"editor-draw-board-setting-handle",onClick:t[1]||(t[1]=e=>{p.value.points?(v.value=!1,g.value.setData(p.value,"edit"),y.value.setName(p.value.name)):I.error("请输入售卖点数后操作")})},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",Zn,[Jn,r("div",Qn,[d(a,{modelValue:p.value.name,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value.name=e),disabled:"edit"!==l.editorType||!m},null,8,["modelValue","disabled"])])]),r("div",qn,[Kn,r("div",ei,[d(n,{style:{width:"2rem"},disabled:"edit"!==l.editorType,modelValue:p.value.realWidth,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value.realWidth=e),controls:!1},null,8,["disabled","modelValue"])]),ti,r("div",ai,[d(n,{style:{width:"2rem"},disabled:"edit"!==l.editorType,modelValue:p.value.realHeight,"onUpdate:modelValue":t[4]||(t[4]=e=>p.value.realHeight=e),controls:!1},null,8,["disabled","modelValue"])])]),r("div",li,[ni,r("div",ii,[d(x,{modelValue:p.value.drawType,"onUpdate:modelValue":t[5]||(t[5]=e=>p.value.drawType=e),disabled:"edit"!==l.editorType},{default:u((()=>[(s(!0),o(M,null,T(Object.keys(E(ma)),(e=>(s(),C(k,{key:e,value:E(ma)[e],label:E(ma)[e]},null,8,["value","label"])))),128))])),_:1},8,["modelValue","disabled"])])]),r("div",si,[oi,r("div",ri,[d(x,{modelValue:p.value.template_filter,"onUpdate:modelValue":t[6]||(t[6]=e=>p.value.template_filter=e),disabled:"edit"!==l.editorType},{default:u((()=>[(s(),o(M,null,T(w,(e=>d(k,{key:e.key,value:e.key,label:e.name},null,8,["value","label"]))),64))])),_:1},8,["modelValue","disabled"])])]),r("div",di,[ui,r("div",ci,[d(x,{modelValue:p.value.template_level,"onUpdate:modelValue":t[7]||(t[7]=e=>p.value.template_level=e),disabled:"edit"!==l.editorType},{default:u((()=>[(s(),o(M,null,T(f,(e=>d(k,{key:e.key,value:e.key,label:e.name},null,8,["value","label"]))),64))])),_:1},8,["modelValue","disabled"])])]),r("div",hi,[mi,r("div",vi,[d(n,{style:{width:"100%","text-align":"left"},precision:0,step:1,controls:!1,modelValue:p.value.points,"onUpdate:modelValue":t[8]||(t[8]=e=>p.value.points=e),min:1},null,8,["modelValue"])])])])],2)}}},[["__scopeId","data-v-10a1f3dc"]]);const gi=e=>(b("data-v-4357ff56"),e=e(),k(),e),yi={class:"editor-layer-setting-box"},fi={class:"editor-layer-setting-title"},wi={class:"editor-layer-setting-handle-area"},bi={class:"setting-value-box"},ki={key:0,class:"setting-item"},xi=gi((()=>r("div",{class:"setting-item-label"},"图层名称",-1))),Di={class:"setting-item-value"},Ii={class:"setting-item",style:{"justify-content":"space-between"}},_i=["label","onClick","value"],Ci=gi((()=>r("i",{class:"bi bi-bookmark-check",style:{"margin-left":"0.1rem"}},null,-1))),Ti={key:1,class:"setting-item"},Ei=gi((()=>r("div",{class:"setting-item-label"},"模板选择",-1))),Mi={class:"setting-item-value"},Si={key:2,class:"setting-item"},Ai=gi((()=>r("div",{class:"setting-item-label"},"模板选择",-1))),Li={class:"setting-item-value"},Ri={key:3,class:"setting-item"},Oi=gi((()=>r("div",{class:"setting-item-label"},"模板选择",-1))),zi={class:"setting-item-value"},Pi={key:4,class:"setting-item"},Ui=gi((()=>r("div",{class:"setting-item-label"},"模板选择",-1))),Gi={class:"setting-item-value"},Ni={key:5,class:"setting-item"},ji=gi((()=>r("div",{class:"setting-item-label"},"图片",-1))),Vi={class:"setting-item-value"};var Hi=de({__name:"editorLayerSetting",props:{staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]}},emits:["save"],setup(e,{expose:t,emit:a}){const l=n(ra),v=e,y=n(!1),f=n(null),b=n([]),k=n([]),x=n([]),D=n([]),_=n(null),S=n(null),A=n(null),L=n("layer"),R=n(null),O=()=>{y.value=!1},z=()=>{S.value=null,A.value=null},P=e=>{if("image/png"!==e.type)return void I.error("请上传png格式图片");const t=new FileReader;return t.onload=({target:e})=>{const t=new Image;t.src=e.result,t.onload=()=>{A.value=t,S.value=e.result}},t.readAsDataURL(e),!1},U=()=>{let e=[];const t=b.value.map((e=>v.staticsList.find((t=>e===t.template_name)).template_name)).join("");if(b.value.length&&t.includes("tile")){let a="";t.includes("tile_xy")?a="tile_xy":t.includes("tile_x")?a="tile_x":t.includes("tile_y")&&(a="tile_y"),e=v.staticsList.filter((e=>e.template_name.includes(a)))}else e=b.value.length&&!t.includes("tile")?v.staticsList.filter((e=>!e.template_name.includes("tile"))):v.staticsList;return e};return t({show:(e=null)=>{y.value?O():(y.value=!0,f.value=e?e.name:"",b.value=e?e.statics:[],k.value=e?e.prompts:[],D.value=e?e.texts:[],x.value=e?e.colors:[],_.value=e?e.uuid:null,A.value=e?e.image:null,R.value=e?e.type:"statics",S.value=A.value?A.value.src:null)}}),(e,t)=>{const a=i("el-input"),n=i("el-option"),G=i("el-select"),N=i("el-button"),j=i("el-image"),V=i("el-upload"),H=i("el-scrollbar");return s(),o("div",{class:c(["editor-layer-setting",{show:y.value}]),style:g({height:"layer"===L.value?"9.3rem":"7rem"})},[r("div",yi,[r("div",fi,[h(m("layer"===L.value?"图层":"组")+"设置 ",1),r("div",wi,[r("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>O())},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>(async()=>{if(!f.value&&"layer"===L.value)return void I.error("请输入图层名称后保存");if(!R.value)return void I.error("请选择图层类型后操作");if(!(b.value.length||k.value.length||x.value.length||D.value.length))return void I.error("请选择模板后操作");let e="";const t=b.value.length?b.value[0]:"",a=x.value.length?x.value[0]:"";if(t.includes("tile_xy")?e="tile_xy":t.includes("tile_x")?e="tile_x":t.includes("tile_y")&&(e="tile_y"),a.includes("tile_xy")?e="tile_xy":a.includes("tile_x")?e="tile_x":a.includes("tile_y")&&(e="tile_y"),y.value=!1,_.value){const t=l.value.findData("layer",_.value),{children:a}=t,n={prompts:k.value,statics:b.value,colors:x.value,texts:D.value,type:R.value,name:f.value,tileType:e};A.value&&(n.image=A.value),t.setData(n),delete n.name,a.forEach(((i,s)=>{e&&s?t.children.splice(s,a.length-1):l.value.findData("element",i).setData(n)})),l.value.reDraw()}else{const t={prompts:k.value,statics:b.value,colors:x.value,texts:D.value,type:R.value,name:f.value,tileType:e};A.value&&(t.image=A.value);const a=await l.value.add("layer",null,f.value,t);l.value.changeSelected([null,a,null]),l.value.reDraw()}})())},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",bi,[d(H,null,{default:u((()=>["layer"===L.value?(s(),o("div",ki,[xi,r("div",Di,[d(a,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e)},null,8,["modelValue"])])])):w("",!0),r("div",Ii,[(s(!0),o(M,null,T(Object.keys(E(ga)),(e=>(s(),o("div",{class:c(["setting-item-value",{selected:e===R.value}]),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"},key:e,label:E(ga)[e],onClick:t=>{return a=e,void(_.value?I.error("图层类型不可改变"):(b.value=[],x.value=[],D.value=[],k.value=[],S.value=null,A.value=null,R.value=a));var a},value:e},[h(m(E(ga)[e])+" ",1),Ci],10,_i)))),128)),r("div",{class:"setting-item-selected",style:g({left:2.1*Object.keys(ga).findIndex((e=>e===R.value))+"rem"})},null,4)]),"statics"===R.value?(s(),o("div",Ti,[Ei,r("div",Mi,[d(G,{multiple:"",modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=e=>b.value=e)},{default:u((()=>[(s(!0),o(M,null,T(U(),(e=>(s(),C(n,{key:e.template_id,label:e.template_name,value:e.template_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):w("",!0),"prompts"===R.value?(s(),o("div",Si,[Ai,r("div",Li,[d(G,{multiple:"",modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=e=>k.value=e)},{default:u((()=>[(s(!0),o(M,null,T(v.promptsList,(e=>(s(),C(n,{key:e.template_id,label:e.template_name,value:e.template_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):w("",!0),"colors"===R.value?(s(),o("div",Ri,[Oi,r("div",zi,[d(G,{multiple:"",modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=e=>x.value=e)},{default:u((()=>[(s(!0),o(M,null,T(v.colorsList,(e=>(s(),C(n,{key:e.template_id,label:e.template_name,value:e.template_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):w("",!0),"texts"===R.value?(s(),o("div",Pi,[Ui,r("div",Gi,[d(G,{multiple:"",modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=e=>D.value=e)},{default:u((()=>[(s(!0),o(M,null,T(v.textsList,(e=>(s(),C(n,{key:e.template_id,label:e.template_name,value:e.template_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):w("",!0),"statics"===R.value||"prompts"===R.value?(s(),o("div",Ni,[ji,r("div",Vi,[d(V,{style:{width:"100%"},"before-upload":P,accept:".png","show-file-list":!1,action:""},{default:u((()=>[S.value?w("",!0):(s(),C(N,{key:0,style:{width:"6.8rem",height:"3.5rem",padding:"0"}},{default:u((()=>[h("上传图片")])),_:1})),S.value?(s(),C(N,{key:1,style:{width:"6.8rem",height:"3.5rem",padding:"0",position:"relative"}},{default:u((()=>[d(j,{fit:"cover",style:{width:"6.8rem",height:"3.5rem"},src:S.value},null,8,["src"]),r("div",{class:"remove-image-btn",onClick:p(z,["stop"])},[r("div",{class:c(["bi",E(Qe)])},null,2)])])),_:1})):w("",!0)])),_:1})])])):w("",!0)])),_:1})])])],6)}}},[["__scopeId","data-v-4357ff56"]]);var Yi=de({},[["render",function(e,t){return s(),o("div")}]]);const Bi={class:"image-like"},Fi={class:"slider-area"},Wi=(e=>(b("data-v-799384ce"),e=e(),k(),e))((()=>r("div",{class:"slider-name"},"相似度",-1))),Xi={class:"slider-handle"},$i={class:"image-area"},Zi={class:"image-item"},Ji=["src"],Qi={class:"image-item"},qi=["src"];var Ki=de({__name:"imageLike",props:{imageUrl:{type:String,default:""},uuid:{type:Number,default:0},generateImageReviewUrl:{type:String,default:null}},emits:["setNewImageUrl"],setup(e,{emit:t}){const a=e,l=n(50),u=n(null),c=()=>{const{templateId:e,name:t}=da;ba.addTask(e,t,"element",[{imageUrl:a.imageUrl,similarity:l.value/100,uuid:a.uuid}],wa)};return(t,n)=>{const h=i("el-slider");return s(),o("div",Bi,[r("div",Fi,[Wi,r("div",Xi,[d(h,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),min:0,max:100},null,8,["modelValue"])]),r("div",{class:"slider-btn-area"},[r("div",{onClick:c},"生成")])]),r("div",$i,[r("div",Zi,[r("img",{src:a.imageUrl},null,8,Ji)]),r("div",Qi,[r("img",{src:u.value||e.generateImageReviewUrl},null,8,qi)])])])}}},[["__scopeId","data-v-799384ce"]]);var es=de({},[["render",function(e,t){return s(),o("div")}]]);const ts={class:"image-generate-setting-handle-area"},as={class:"change-setting-type-area"},ls=["onClick"],ns={class:"handle-btn-area"},is={class:"image-generate-setting-component-area"};var ss=de({__name:"imageGenerate",emits:["replaceImage"],setup(e,{expose:t,emit:a}){const l=[{name:"相似生成",component:Ki},{name:"融合图像",component:Yi},{name:"文本控制",component:es}],i=n(0),d=n(ra),u=n(oa),h=n(!1),v=n(null),y=n(null),f=n(null),b=n(null),k=n("element"),x=n(!1),D=()=>{x.value=!1,setTimeout((()=>{h.value=!1}),200)},I=e=>{f.value=e};return t({init:(e,t=null,a="element")=>{if(Yt(e.image)){const l=gt(e.image,`element_${e.uuid}`),n=new FormData;n.append("file",l),Ot(`element_${e.uuid}`,n).then((l=>{v.value=l,y.value=e.uuid,k.value=a,b.value=t,f.value=null,h.value=!0,R((()=>{x.value=!0}))}))}else v.value=e.image,y.value=e.uuid,k.value=a,b.value=t,f.value=null,h.value=!0,R((()=>{x.value=!0}))}}),(e,t)=>h.value?(s(),o("div",{key:0,class:"image-generate-outer",onClick:t[3]||(t[3]=e=>D())},[r("div",{class:c(["image-generate show_start",{show_end:x.value}]),onClick:t[2]||(t[2]=p((()=>{}),["stop"]))},[r("div",ts,[r("div",as,[r("div",{class:"component-selected",style:g({left:3.2*i.value+.05+"rem"})},null,4),(s(),o(M,null,T(l,((e,t)=>r("div",{class:"component-item",onClick:e=>i.value=t,key:e.name},m(e.name),9,ls))),64))]),r("div",ns,[r("div",{class:"handle-btn",onClick:t[0]||(t[0]=e=>D())},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{class:"handle-btn",onClick:t[1]||(t[1]=e=>(async()=>{h.value=!1;const e=await ft(b.value);d.value.findData(k.value,y.value).setData({image:e}),u.value.reDraw()})())},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",is,[h.value?(s(),C(Y(l[i.value].component),{key:0,imageUrl:v.value,uuid:y.value,generateImageReviewUrl:b.value,onSetNewImageUrl:I,ref:"componentDom"},null,40,["imageUrl","uuid","generateImageReviewUrl"])):w("",!0)])],2)])):w("",!0)}},[["__scopeId","data-v-7219dc6c"]]);const os=e=>(b("data-v-514fac87"),e=e(),k(),e),rs={class:"editor-text-setting-title"},ds=os((()=>r("div",{class:"editor-text-setting-content"},"编辑文本",-1))),us={class:"editor-text-setting-close-area"},cs={class:"editor-text-setting-inner"},hs={class:"editor-text-setting"},ms=os((()=>r("div",{class:"editor-text-setting-name"},"文本内容",-1))),vs={class:"editor-text-setting-value"},ps={class:"editor-text-setting"},gs=os((()=>r("div",{class:"editor-text-setting-name"},"文本颜色",-1))),ys={class:"editor-text-setting-value"},fs={class:"editor-text-setting"},ws=os((()=>r("div",{class:"editor-text-setting-name"},"文本字号",-1))),bs={class:"editor-text-setting-value"};var ks=de({__name:"editorTextSetting",setup(e,{expose:t}){const a=n(!1),l=n(ra),u=n(null),m=n({}),v=n(!1),g=()=>{v.value=!1,setTimeout((()=>{a.value=!1}),200)};return t({init:e=>{const{fontSetting:t}=e;u.value=e.uuid,a.value=!0;const l=JSON.parse(JSON.stringify(t));l.font_color=Dt(l.font_color),m.value=l,R((()=>{v.value=!0}))}}),(e,t)=>{const n=i("el-input"),y=i("el-color-picker"),f=i("el-input-number");return a.value?(s(),o("div",{key:0,class:"editor-text-setting-outer",onClick:t[6]||(t[6]=e=>g())},[r("div",{class:c(["editor-text-setting-box show_start",{show_end:v.value}]),onClick:t[5]||(t[5]=p((()=>{}),["stop"]))},[r("div",rs,[ds,r("div",us,[r("div",{onClick:t[0]||(t[0]=e=>g())},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{onClick:t[1]||(t[1]=e=>(()=>{const e=l.value.findData("element",u.value),t=JSON.parse(JSON.stringify(m.value));t.font_color=xt(t.font_color);const a=da.getTextWidth(t);e.setData({x:e.x+e.width/2-a/2,width:a,height:t.font_size,fontSetting:t}),l.value.reDraw(),g()})())},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",cs,[r("div",hs,[ms,r("div",vs,[d(n,{modelValue:m.value.content,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value.content=e)},null,8,["modelValue"])])]),r("div",ps,[gs,r("div",ys,[d(y,{style:{width:"100%"},"color-format":"rgba","show-alpha":"",modelValue:m.value.font_color,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value.font_color=e)},null,8,["modelValue"])])]),r("div",fs,[ws,r("div",bs,[d(f,{controls:!1,modelValue:m.value.font_size,"onUpdate:modelValue":t[4]||(t[4]=e=>m.value.font_size=e)},null,8,["modelValue"]),h(" px ")])])])],2)])):w("",!0)}}},[["__scopeId","data-v-514fac87"]]);const xs=e=>(b("data-v-5a0402fe"),e=e(),k(),e),Ds={class:"editor-text-setting-title"},Is=xs((()=>r("div",{class:"editor-text-setting-content"}," 编辑颜色 ",-1))),_s={class:"editor-text-setting-close-area"},Cs={class:"editor-text-setting-inner"},Ts={class:"editor-text-setting"},Es=xs((()=>r("div",{class:"editor-text-setting-name"}," 纯色层颜色 ",-1))),Ms={class:"editor-text-setting-value"};var Ss=de({__name:"editorColorSetting",setup(e,{expose:t}){const a=n(!1),l=n(ra),u=n(null),h=n({}),m=n(!1),v=()=>{m.value=!1,setTimeout((()=>{a.value=!1}),200)};return t({init:e=>{const{color:t}=e;u.value=e.uuid,a.value=!0;const l={color:Dt(t)};h.value=l,R((()=>{m.value=!0}))}}),(e,t)=>{const n=i("el-color-picker");return a.value?(s(),o("div",{key:0,class:"editor-text-setting-outer",onClick:t[4]||(t[4]=e=>v())},[r("div",{class:c(["editor-text-setting-box show_start",{show_end:m.value}]),onClick:t[3]||(t[3]=p((()=>{}),["stop"]))},[r("div",Ds,[Is,r("div",_s,[r("div",{onClick:t[0]||(t[0]=e=>v())},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{onClick:t[1]||(t[1]=e=>(()=>{const e=l.value.findData("element",u.value),t=JSON.parse(JSON.stringify(h.value));t.color=xt(t.color),e.setData(t),l.value.reDraw(),v()})())},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",Cs,[r("div",Ts,[Es,r("div",Ms,[d(n,{style:{width:"100%"},"color-format":"rgba","show-alpha":"",modelValue:h.value.color,"onUpdate:modelValue":t[2]||(t[2]=e=>h.value.color=e)},null,8,["modelValue"])])])])],2)])):w("",!0)}}},[["__scopeId","data-v-5a0402fe"]]);const As=e=>(b("data-v-1a15ac9d"),e=e(),k(),e),Ls={class:"editor-layer-setting-box"},Rs={class:"editor-layer-setting-title"},Os={class:"editor-layer-setting-handle-area"},zs={class:"setting-value-box"},Ps={class:"setting-item",style:{"justify-content":"space-between"}},Us=As((()=>r("i",{class:"bi bi-arrow-90deg-left",style:{"margin-left":"0.1rem"}},null,-1))),Gs=As((()=>r("i",{class:"bi bi-arrow-90deg-right",style:{"margin-left":"0.1rem"}},null,-1))),Ns=As((()=>r("i",{class:"bi bi-arrows-expand-vertical",style:{"margin-left":"0.1rem"}},null,-1))),js=As((()=>r("i",{class:"bi bi-arrows-expand",style:{"margin-left":"0.1rem"}},null,-1))),Vs={class:"setting-item",style:{border:"none",margin:"0"}},Hs=As((()=>r("div",{class:"setting-item-label"},"位置X",-1))),Ys={class:"setting-item-value"},Bs=As((()=>r("div",{class:"setting-item-label"},"位置Y",-1))),Fs={class:"setting-item-value"},Ws={class:"setting-item",style:{border:"none",margin:"0"}},Xs=As((()=>r("div",{class:"setting-item-label"},"宽度W",-1))),$s={class:"setting-item-value"},Zs=As((()=>r("div",{class:"setting-item-label"},"高度H",-1))),Js={class:"setting-item-value"},Qs={class:"setting-item"},qs=As((()=>r("div",{class:"setting-item-label"},"透明度",-1))),Ks={class:"setting-item-value",style:{padding:"0 0.4rem"}},eo=As((()=>r("div",{class:"setting-item",style:{border:"none",margin:"0"}},[r("div",{class:"editor-layer-setting-title"},"高级参数")],-1))),to={class:"setting-item"},ao={class:"setting-item-value"},lo=As((()=>r("div",{class:"setting-item-label",style:{width:"1.5rem"}},"单色相",-1))),no={class:"setting-item-value"},io={class:"setting-item"},so=As((()=>r("div",{class:"setting-item-label",style:{width:"1.5rem"}},"边缘羽化",-1))),oo={class:"setting-item-value",style:{padding:"0 0.4rem"}};var ro=de({__name:"editorElementSetting",emits:["save"],setup(e,{expose:t,emit:a}){const l=n(ra),m=n(!1),v=n(null);n([]);const p=n(null),g=n(0),y=n(0),f=n(0),w=n(0),b=n(100),k=n(0),x=n(!1),D=n(!1),I=n(new He),_=n(null),C=n(null),T=n(null),M=n(null),S=n(null),A=n(0),L=n(null);let R=null;B(C,(async e=>{m.value&&(await z(),N())}));const O=e=>{C.value=e},z=async()=>{let e=null;C.value&&(e=await S.value.grayToColor(xt(C.value))),A.value&&(e=await S.value.edgeFeather(A.value/1e3)),M.value=e,N()},P=(e="right")=>{"right"===e?k.value+=Math.PI/2:k.value-=Math.PI/2,N()},U=(e="x")=>{"x"===e?x.value=!x.value:D.value=!D.value,N()},G=()=>{const e={name:R.name,uuid:R.uuid,x:R.x,y:R.y,width:R.width,height:R.height,opacity:R.opacity,rotate:R.rotate,xOverturn:R.xOverturn,yOverturn:R.yOverturn,hue:R.hue,handleImage:R.handleImage,edgeFeather:R.edgeFeather};l.value.findData("element",p.value).setData(e),l.value.reDraw(),R=null},N=()=>{const e={name:v.value,uuid:p.value,x:g.value,y:y.value,width:f.value,height:w.value,opacity:b.value/100,rotate:k.value,xOverturn:x.value,yOverturn:D.value,hue:C.value?xt(C.value):null,handleImage:M.value,edgeFeather:A.value};l.value.findData("element",p.value).setData(e),l.value.reDraw()};return t({show:(e=null)=>{const t=l.value.findData("element",e);p.value&&p.value!==e&&G(),R||(R=JSON.parse(JSON.stringify(t)),R.image=t.image,R.handleImage=t.handleImage),m.value=!0,v.value=t?t.name:"",L.value=t.hue?It(t.hue):null,p.value=t?t.uuid:null,g.value=t.x||0,y.value=t.y||0,f.value=t.width||0,w.value=t.height||0,b.value=100*t.opacity,k.value=t.rotate||0,x.value=t.xOverturn||!1,D.value=t.yOverturn||!1,A.value=t.edgeFeather||0,C.value=t.hue?It(t.hue):null,T.value=t.image,M.value=t.handleImage,S.value=new na(p.value,t.image)}}),(e,t)=>{const a=i("el-input-number"),l=i("el-slider"),n=i("el-color-picker"),v=i("el-scrollbar");return s(),o("div",{class:c(["editor-layer-setting",{show:m.value}])},[r("div",Ls,[r("div",Rs,[h(" 参数调节 "),r("div",Os,[r("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>(S.value=null,G(),p.value=null,void(m.value=!1)))},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>(N(),m.value=!1,p.value=null,void(R=null)))},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",zs,[d(v,null,{default:u((()=>[r("div",Ps,[r("div",{class:"setting-item-value handle-btn",onClick:t[2]||(t[2]=e=>P("left")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[h(" 左转 "),Us]),r("div",{class:"setting-item-value handle-btn",onClick:t[3]||(t[3]=e=>P("right")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[h(" 右转 "),Gs]),r("div",{class:"setting-item-value handle-btn",onClick:t[4]||(t[4]=e=>U("x")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[h(" 水平翻转 "),Ns]),r("div",{class:"setting-item-value handle-btn",onClick:t[5]||(t[5]=e=>U("y")),style:{flex:"none","align-items":"center","justify-content":"center",cursor:"pointer"}},[h(" 垂直翻转 "),js])]),r("div",Vs,[r("div",{class:c(["setting-item-min",{handing:"x"===_.value,handingLock:_.value}]),onMousedown:t[8]||(t[8]=e=>(e=>{let t=e.pageX;I.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX?g.value--:t<e.pageX&&g.value++,t=e.pageX,N()})),_.value="x",I.value.addListener(document.documentElement,"mouseup",(e=>{I.value.removeAllListeners(),_.value=null}))})(e))},[Hs,r("div",Ys,[d(a,{style:{width:"2rem"},modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=e=>g.value=e),onChange:t[7]||(t[7]=e=>N()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34),r("div",{class:c(["setting-item-min",{handing:"y"===_.value,handingLock:_.value}]),onMousedown:t[11]||(t[11]=e=>(e=>{let t=e.pageX;I.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX?y.value--:t<e.pageX&&y.value++,t=e.pageX,N()})),_.value="y",I.value.addListener(document.documentElement,"mouseup",(e=>{I.value.removeAllListeners(),_.value=null}))})(e))},[Bs,r("div",Fs,[d(a,{style:{width:"2rem"},modelValue:y.value,"onUpdate:modelValue":t[9]||(t[9]=e=>y.value=e),onChange:t[10]||(t[10]=e=>N()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34)]),r("div",Ws,[r("div",{class:c(["setting-item-min",{handing:"width"===_.value,handingLock:_.value}]),onMousedown:t[14]||(t[14]=e=>(e=>{let t=e.pageX;I.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX&&f.value>1?f.value--:t<e.pageX&&f.value>1&&f.value++,t=e.pageX,N()})),_.value="width",I.value.addListener(document.documentElement,"mouseup",(e=>{I.value.removeAllListeners(),_.value=null}))})(e))},[Xs,r("div",$s,[d(a,{style:{width:"2rem"},modelValue:f.value,"onUpdate:modelValue":t[12]||(t[12]=e=>f.value=e),onChange:t[13]||(t[13]=e=>N()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34),r("div",{class:c(["setting-item-min",{handing:"height"===_.value,handingLock:_.value}]),onMousedown:t[17]||(t[17]=e=>(e=>{let t=e.pageX;I.value.addListener(document.documentElement,"mousemove",(e=>{t>e.pageX&&w.value>1?w.value--:t<e.pageX&&w.value>1&&w.value++,t=e.pageX,N()})),_.value="height",I.value.addListener(document.documentElement,"mouseup",(e=>{I.value.removeAllListeners(),_.value=null}))})(e))},[Zs,r("div",Js,[d(a,{style:{width:"2rem"},modelValue:w.value,"onUpdate:modelValue":t[15]||(t[15]=e=>w.value=e),onChange:t[16]||(t[16]=e=>N()),precision:0,step:1,controls:!1},null,8,["modelValue"])])],34)]),r("div",Qs,[qs,r("div",Ks,[d(l,{onInput:t[18]||(t[18]=e=>N()),style:{"--el-slider-button-size":"0.5rem","--el-slider-button-wrapper-size":"0.8rem",height:"0.8rem","--el-slider-button-wrapper-offset":"-0.3rem"},max:100,min:0,modelValue:b.value,"onUpdate:modelValue":t[19]||(t[19]=e=>b.value=e)},null,8,["modelValue"])])]),eo,r("div",to,[r("div",ao,[lo,r("div",no,[d(n,{style:{flex:"1","margin-top":"-0.25rem"},"color-format":"rgb",modelValue:L.value,"onUpdate:modelValue":t[20]||(t[20]=e=>L.value=e),onActiveChange:O},null,8,["modelValue"])])])]),r("div",io,[so,r("div",oo,[d(l,{onInput:t[21]||(t[21]=e=>z()),style:{"--el-slider-button-size":"0.5rem","--el-slider-button-wrapper-size":"0.8rem",height:"0.8rem","--el-slider-button-wrapper-offset":"-0.3rem"},max:100,min:0,modelValue:A.value,"onUpdate:modelValue":t[22]||(t[22]=e=>A.value=e)},null,8,["modelValue"])])])])),_:1})])])],2)}}},[["__scopeId","data-v-1a15ac9d"]]);const uo=e=>(b("data-v-1a6f7ab8"),e=e(),k(),e),co={class:"editor-layer-setting-box"},ho={class:"editor-layer-setting-title"},mo={class:"editor-layer-setting-handle-area"},vo={class:"setting-value-box"},po={class:"setting-item"},go={class:"setting-item-value"},yo=uo((()=>r("div",{class:"setting-item-label",style:{width:"1.5rem"}},"单色相",-1))),fo={class:"setting-item-value"},wo={class:"setting-item"},bo=uo((()=>r("div",{class:"setting-item-label",style:{width:"1.5rem"}},"边缘羽化",-1))),ko={class:"setting-item-value",style:{padding:"0 0.4rem"}};var xo=de({__name:"editorAdvancedSetting",emits:["save"],setup(e,{expose:t,emit:a}){n(ra);const l=n(!1);n(null),n(null),n(100),n(new He),n(null);const m=n(null);n(null),n(null);const v=n(0),p=n(null);let g=null,y={};const f=async(e=!1)=>{const t=Object.keys(y);for(let a=0;a<t.length;a++){const l=t[a],n=y[l],i=n.colorHandle;let s=null;m.value&&(s=await i.grayToColor(xt(m.value))),v.value&&(s=await i.edgeFeather(v.value/100));const o=ra.findData("element",l);e&&delete n.colorHandle,o.setData({handleImage:s,hue:m.value?xt(m.value):null,edgeFeather:v.value})}da.edgeFeather=v.value,da.hue=m.value?xt(m.value):null,da.reDraw()};B(m,(async e=>{l.value&&f()}));const w=e=>{m.value=e},b=()=>{const e=Object.keys(y);for(let t=0;t<e.length;t++){const a=e[t],l=y[a];delete l.colorHandle;const{image:n,handleImage:i,hue:s,edgeFeather:o}=l;ra.findData("element",a).setData({image:n,handleImage:i,hue:s,edgeFeather:o})}da.edgeFeather=g.edgeFeather,da.hue=g.hue,da.reDraw()};return t({show:()=>{l.value=!0,g=da.getData(),m.value=g.hue?It(g.hue):null,p.value=m.value,v.value=g.edgeFeather,Object.keys(ra.elements).forEach((e=>{const t=ra.findData("element",e);"texts"!==t.type&&(y[e]={image:t.image,hue:t.hue,handleImage:t.handleImage,edgeFeather:t.edgeFeather,colorHandle:new na(e,t.image,Boolean(t.edgeFeather))})}))}}),(e,t)=>{const a=i("el-color-picker"),n=i("el-slider"),m=i("el-scrollbar");return s(),o("div",{class:c(["editor-layer-setting",{show:l.value}])},[r("div",co,[r("div",ho,[h(" 参数调节 "),r("div",mo,[r("div",{class:"editor-layer-setting-handle",onClick:t[0]||(t[0]=e=>(b(),void(l.value=!1)))},[r("i",{class:c(`bi ${E(Ye)}`)},null,2)]),r("div",{class:"editor-layer-setting-handle",onClick:t[1]||(t[1]=e=>(f(!0),void(l.value=!1)))},[r("i",{class:c(`bi ${E($e)}`)},null,2)])])]),r("div",vo,[d(m,null,{default:u((()=>[r("div",po,[r("div",go,[yo,r("div",fo,[d(a,{style:{flex:"1","margin-top":"-0.25rem"},onActiveChange:w,"color-format":"rgb",modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e)},null,8,["modelValue"])])])]),r("div",wo,[bo,r("div",ko,[d(n,{onInput:t[3]||(t[3]=e=>f()),style:{"--el-slider-button-size":"0.5rem","--el-slider-button-wrapper-size":"0.8rem",height:"0.8rem","--el-slider-button-wrapper-offset":"-0.3rem"},max:100,min:0,modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=e=>v.value=e)},null,8,["modelValue"])])])])),_:1})])])],2)}}},[["__scopeId","data-v-1a6f7ab8"]]);const Do=["onClick"],Io={key:0,class:"explosion-line-1"},_o={class:"explosion-prompt-item"},Co={class:"explosion-item-name"},To={class:"explosion-prompt-edit-btn"},Eo={key:0,class:"explosion-prompt-info"},Mo={key:1,class:"explosion-prompt-info"},So={class:"explosion-diagram-item"},Ao={key:0,class:"explosion-name"},Lo=["onClick"],Ro={class:"explosion-image"},Oo=["src"];var zo=de({__name:"explosionDiagram",props:{data:{type:Array,default:()=>[]},widthPrompt:{type:Boolean,default:()=>!1},explosionStyle:{type:Object,default:()=>({width:"5rem",height:"7rem"})}},setup(e,{expose:t}){const a=e,l=n(null),v=n(null),y=n(null),b=n(null),k=n(null),x=n(""),D={COMMENCE:"commence",INCORPORATION:"incorporation"},_=n(D.INCORPORATION),C=e=>{D.hasOwnProperty(e)||"CHANGE"===e?(v.value=null,"CHANGE"===e?_.value===D.COMMENCE?_.value=D.INCORPORATION:_.value=D.COMMENCE:_.value=D[e]):I.error("非法参数")},S=e=>_.value===D.COMMENCE?Object.assign({left:2*e-a.data.length+"rem",top:-.5*e+.5+"rem",zIndex:a.data.length-e-1},a.explosionStyle):Object.assign({left:"0rem",top:"0rem",transform:"skewY(0deg)",zIndex:a.data.length-e-1,backgroundColor:e===a.data.length-1?"var(--t-sub-color)":"transparent"},a.explosionStyle),A=e=>y.value===e?{hiding:!0}:b.value===e?{showing:!0}:l.value===e?{show:!0}:l.value!==e?{hide:!0}:void 0;return f((()=>{a.data.length&&(l.value=0),setTimeout((()=>{C("COMMENCE")}))})),t({changeExplosionType:C}),(t,n)=>{const f=i("el-icon"),I=i("t-button");return s(),o("div",{class:"explosion-diagram-body",style:g({paddingTop:(_.value,D.COMMENCE,0)+"rem"})},[r("div",{class:"explosion-all",style:g(a.explosionStyle)},[(s(!0),o(M,null,T(a.data,((t,i)=>(s(),o(M,null,[v.value===i||_.value===D.COMMENCE||!v.value&&0!==v.value&&_.value===D.INCORPORATION?(s(),o("div",{class:c(["explosion-item",{selected:_.value===D.COMMENCE&&l.value===i}]),key:t.uuid,onClick:e=>(e=>new Promise((t=>{_.value===D.COMMENCE&&l.value!==e?(k.value=null,null!==l.value&&(y.value=l.value),b.value=e,setTimeout((()=>{l.value=b.value,b.value=null})),setTimeout((()=>{y.value=null,t()}),200)):t()})))(i),style:g(S(i))},[_.value===D.COMMENCE||null!==v.value?(s(),o("div",{key:0,class:c(["explosion-diagram-handle-area",Object.assign(A(i),{nomal:null!==v.value})])},[e.widthPrompt?(s(),o("div",Io)):w("",!0),e.widthPrompt?(s(),o("div",{key:1,class:"explosion-line-2",style:g({width:1.5*(_.value===D.COMMENCE||null===v.value?a.data.length-i:1)+"rem"})},null,4)):w("",!0),e.widthPrompt?(s(),o("div",{key:2,class:"explosion-prompt-area",style:g({left:1.5*(_.value===D.COMMENCE||null===v.value?a.data.length-i:1)+1+"rem"})},[r("div",_o,[r("div",Co,[h(m(t.name)+" ",1),r("div",To,[d(f,{class:"explosion-prompt-edit-item",onClick:p((e=>(e=>{x.value=a.data[e].prompt,k.value=e})(i)),["stop"])},{default:u((()=>[d(E(F))])),_:2},1032,["onClick"])])]),k.value!==i?(s(),o("div",Eo,m(t.prompt),1)):w("",!0),k.value===i?(s(),o("div",Mo,[W(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=e=>x.value=e)},null,512),[[X,x.value]])])):w("",!0),r("div",{class:"explosion-prompt-save-handle-area",style:g({height:k.value===i?"0.8rem":"0rem"})},[d(I,{type:"info",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"},onClick:n[1]||(n[1]=e=>k.value=null)},{default:u((()=>[h("取消")])),_:1}),d(I,{type:"success",size:"min",style:{margin:"0",padding:"0.2rem 0.4rem"}},{default:u((()=>[h("生成")])),_:1})],4)])],4)):w("",!0)],2)):w("",!0),r("div",So,[_.value===D.COMMENCE?(s(),o("div",Ao,m(t.name),1)):w("",!0),null!==v.value||_.value===D.COMMENCE?(s(),o("div",{key:1,class:"show-explosion-item-handle-btn",onClick:p((e=>(e=>{null===v.value&&_.value===D.COMMENCE?(C("INCORPORATION"),v.value=e):null!==v.value&&(C("COMMENCE"),v.value=null),l.value=e})(i)),["stop"]),style:g({top:(_.value===D.COMMENCE?"1.2":"0.2")+"rem"})},m(null!==v.value?"隐藏":"展示"),13,Lo)):w("",!0),r("div",Ro,[r("img",{src:t.image},null,8,Oo)])])],14,Do)):w("",!0)],64)))),256))],4)],4)}}},[["__scopeId","data-v-ae7efb16"]]);const Po={class:"model-draw-board"},Uo={key:0,class:"model-draw-area"},Go={class:"model-handle-area"};var No=de({__name:"modelDrawBoard",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]},templateId:{type:Number,default:null},info:{type:Object,default:()=>({template_filter:"normal",template_level:"normal",points:1})},layerData:{},editorType:{}},emits:["setTypeList","setGroupList","setSelectedElement","layerData"],setup(e,{expose:t,emit:a}){const l=e,i=a,u=n(null),c=n(null),h=n(null),m=n(null),v=n(null),p=n(null),g=n(null),y=n(null),b=n(null),k=n(null);n("editor");const x=n([]),D=n({width:0,height:0}),I=n(null),_=n(da),C=n(ra),T=n(oa);n(Object.assign({name:l.setting.name},l.setting.canvasData));const M=n(null),S=()=>{k.value.show()},A=async()=>{_.value.viewType===va?(_.value.setViewType(pa),await L()):(m.value.changeExplosionType("INCORPORATION"),_.value.setViewType(va),await L()),D.value={width:_.value.realWidth*_.value.zoomRatio*.8+"px",height:_.value.realHeight*_.value.zoomRatio*.8+"px"}},L=async()=>{x.value=await T.value.getLayerImage()},R=e=>{M.value=I.value.changeHandleType(e)},O=()=>{c.value.show()},z=()=>{I.value.exportImage()},P=(e,t)=>{switch(t){case"text":g.value.init(e);break;case"color":y.value.init(e)}},U=async()=>{const e=["groups","layers","elements"];for(let t of e)for(let e in l.layerData[t]){const a=l.layerData[t][e];if(a.image){const l=await bt(a.image);if(a.image=l,"elements"===t){let t=null,l=new na(e,a.image,Boolean(a.edgeFeather));a.hue&&Array.isArray(a.hue)&&(t=await l.grayToColor(a.hue)),a.edgeFeather&&(t=await l.edgeFeather(a.edgeFeather/100)),l=null,a.handleImage=t}}if("texts"===a.type&&a.fontSetting&&a.fontSetting.font){const e=await Zt(a.fontSetting.font);a.fontSetting.fontFamily=e}C.value.add(t.slice(0,-1),a.parentUuid,a.name,a,e,a.zIndex),C.value.reDraw()}},G=(e=null)=>{e=e||I.value.setTypeList();const t=Object.keys(e).map((t=>({uuid:t,name:e[t].name,image:e[t].image,loraInfo:e[t].loraInfo,layerInfo:e[t].layerInfo})));i("setTypeList",t)},N=e=>{i("setGroupList",e)},j=(...e)=>{v.value.init(...e)},V=(e,t,a)=>{const l=$t();bt(e).then((e=>{I.value.elementsList[t].setImage(e),I.value.reDraw(),l.close()}))},H=e=>{const{uuid:t}=e;delete e.uuid,t||I.value.addType({name:e.name,prompts:e.prompts,statics:e.statics,image:e.image}).then((e=>{G(e)}))},Y=()=>{C.value.clearAllData(),T.value.toTextEditView=P,T.value.toImageGenerateView=j,T.value.toElementSetting=B,T.value.generationController.setName(l.setting.name),_.value.init(u.value,l.setting,l.editorType,l.templateId,l.info).then((()=>{U().then((()=>{T.value.reDraw(),ba.setTaskResult()}))}))},B=(...e)=>{b.value.show(...e)};return f((()=>{Y()})),t({toSettingLayer:(...e)=>{h.value.show(...e)},setSelectedLayer:(...e)=>{I.value.setTypeUuid(...e)},deleteGroup:e=>{I.value.deleteGroup(e)},deleteLayer:e=>{I.value.deleteType(e).then((({typeList:e,groups:t})=>{N(t),G(e)}))},deleteElement:e=>{I.value.deleteElement(e),G(typeList)},setGroup:e=>{const{layerUuids:t,groupUuid:a}=e;if(a){if(1===t.length&&a){const e=I.value.getGroupItem(a).layers.concat(t),l=I.value.updateGroup(a,{layers:[...new Set(e)]});N(l)}}else p.value.show(null,"group",e)},hideLayer:e=>{I.value.setHideLayer(e),new Promise((e=>{I.value.getAllLayerImage().then((t=>{x.value=Object.keys(t).map((e=>Object.assign({uuid:e,imageSrc:t[e].imageBase64},t[e]))).reverse(),e()}))}))},setDiagramImage:L}),(e,t)=>(s(),o("div",Po,[W(r("div",{class:"model-draw-area",ref_key:"modelEditorDom",ref:u,tabindex:"0"},null,512),[[$,"editor"===E(da).viewType]]),"explosion"===E(da).viewType?(s(),o("div",Uo,[d(zo,{explosionStyle:D.value,data:x.value,ref_key:"explosionDiagramDom",ref:m},null,8,["explosionStyle","data"])])):w("",!0),r("div",Go,[d(Bn,{handleType:M.value,onToCanvasSetting:O,onChangeHandleType:R,onExportImage:z,onChangeViewType:A,onToAdvancedSettingDom:S,onToGenrateGroup:e.toGenrateGroup,editorType:l.editorType},null,8,["handleType","onToGenrateGroup","editorType"])]),d(pi,{ref_key:"editorDrawBoardSettingDom",ref:c,editorType:l.editorType,onSave:e.canvasResize},null,8,["editorType","onSave"]),d(Hi,{ref_key:"editorLayerSettingDom",ref:h,staticsList:l.staticsList,promptsList:l.promptsList,colorsList:l.colorsList,textsList:l.textsList,onSave:H,onSaveGroup:e.saveGroup},null,8,["staticsList","promptsList","colorsList","textsList","onSaveGroup"]),d(ss,{onReplaceImage:V,ref_key:"imageGenerateDom",ref:v},null,512),d(ks,{ref_key:"editorTextSettingDom",ref:g},null,512),d(Ss,{ref_key:"editorColorSettingDom",ref:y},null,512),d(ro,{ref_key:"editorElementSettingDom",ref:b},null,512),d(xo,{ref_key:"editorAdvancedSettingDom",ref:k},null,512)]))}},[["__scopeId","data-v-4075ec7d"]]);const jo={class:"model-editor"};var Vo={tButton:vn,tTag:pn,tMask:Fa,modelCard:wn,modelEditor:de({__name:"index",props:{setting:{},staticsList:{type:Array,default:()=>[]},promptsList:{type:Array,default:()=>[]},colorsList:{type:Array,default:()=>[]},textsList:{type:Array,default:()=>[]},templateId:{type:Number,default:null},info:{type:Object,default:()=>({template_filter:"normal",template_level:"normal",points:1})},layerData:{},editorType:{}},setup(e){n(ra);const t=e,a=n(null),l=n(null),i=n([]),r=n([]),u=e=>{i.value=e},c=(...e)=>{a.value.setSelectedLayer(...e)},h=e=>{r.value=e},m=(...e)=>{a.value.toSettingLayer(...e)},v=e=>{a.value.deleteGroup(e)},p=e=>{a.value.deleteLayer(e)},g=e=>{a.value.deleteElement(e)},y=e=>{a.value.setGroup(e)},f=e=>{a.value.hideLayer(e)},w=(...e)=>{a.value.reGenerateGroup(...e)},b=(...e)=>{a.value.reGenerateLayer(...e)},k=(...e)=>{a.value.reGenerateElement(...e)},x=(...e)=>{l.value.setSelectedElement(...e)},D=()=>{a.value.setDiagramImage()};return(n,I)=>(s(),o("div",jo,[d(No,{staticsList:t.staticsList,promptsList:t.promptsList,colorsList:t.colorsList,textsList:t.textsList,ref_key:"modelDrawBoardDom",ref:a,onSetTypeList:u,onSetGroupList:h,onSetSelectedElement:x,setting:t.setting,editorType:t.editorType,layerData:t.layerData,templateId:e.templateId},null,8,["staticsList","promptsList","colorsList","textsList","setting","editorType","layerData","templateId"]),d(Pn,{ref_key:"editorLayersDom",ref:l,typeList:i.value,groupList:r.value,onToLayerInfo:m,onSetSelectedLayer:c,onDeleteGroup:v,onDeleteLayer:p,onDeleteElement:g,onSetGroup:y,onHideLayer:f,onReGenerateGroup:w,onReGenerateLayer:b,onReGenerateElement:k,onSetDiagramImage:D,editorType:t.editorType},null,8,["typeList","groupList","editorType"])]))}},[["__scopeId","data-v-f09c45e6"]])};const Ho=Z(cn);Ho.use(H()),Ho.use(en),Ho.use(J,{locale:Q}),Ho.use(q,{Options:{url:"data-source",inline:!0,button:!0,transition:!0}}),Object.keys(Vo).forEach((e=>{Ho.component(e,Vo[e])})),Ho.mount("#app");export{$t as T,de as _,Pt as a,Dt as b,xl as c,Nt as d,jt as e,Ht as f,zt as g,Vt as h,la as i,re as l,Xe as p,xt as r,Ut as s,Gt as u};
