import{r as e,o as t,c as a,u as l,a as i,b as s,d as n,e as o,f as r,g as d,h,w as c,F as u,i as m,j as g,t as v,k as p,p as f,l as w,m as y,E as b,n as x,q as A,s as D,v as k,x as C,y as I,z as L,A as _,B as M,C as V,D as S,G as E,H as P,I as R,J as Y,K as T,L as U,M as X,N as F,O,P as W,Q as Z,R as j,S as N,T as z,U as H,V as G,W as Q,X as B}from"./lib.4952c72f.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var q=(e,t)=>{const a=e.__vccOpts||e;for(const[l,i]of t)a[l]=i;return a};var $=q({},[["render",function(l,i){const s=e("RouterView");return t(),a(s,{id:"main-view"})}]]);const J=e=>(f("data-v-89262296"),e=e(),w(),e),K={class:"nav-bar-body"},ee={class:"logo-area"},te=["src"],ae={class:"router-link-area"},le={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ie=[J((()=>r("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),J((()=>r("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],se={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ne=[J((()=>r("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),J((()=>r("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],oe={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},re=[J((()=>r("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),J((()=>r("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],de=J((()=>r("div",{class:"user-phone-no"},"188 8888 8888",-1))),he=J((()=>r("div",{class:"line"},null,-1))),ce=J((()=>r("div",{class:"logout-btn"},[r("span",null,"退出")],-1)));var ue=q({__name:"navBar",setup(f){const w=l(),y=i(),b=[{name:"图生图",path:"ImageGenerationImage"},{name:"Ai换脸",path:"swapFace"},{name:"局部修改",path:"partialModifications"},{name:"识图",path:"imageSearch",children:[{name:"AI识图",path:"imageSearch"},{name:"图库",path:"gallery"},{name:"超级识图",path:"superImageSearch"},{name:"激活码管理",path:"activationKeys"}]},{name:"模型训练",path:"trainModel"}];let x=s("1");const A=e=>{w.push(e)};return n((()=>{x.value=String(b.findIndex((e=>e.path===y.name)))})),(l,i)=>{const s=e("el-menu-item"),n=e("el-sub-menu"),f=e("el-menu");return t(),o("div",K,[r("div",ee,[r("img",{src:d("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVQAAABSCAYAAAALvCwcAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ4IDc5LjE2NDAzNiwgMjAxOS8wOC8xMy0wMTowNjo1NyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjM3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxOEFGNERGMTdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOEFGNERGMjdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgnCosYAAA7KSURBVHja7F3t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")},null,8,te)]),r("div",ae,[h(f,{"background-color":"#22335D","text-color":"#ffffff","default-active":d(x),class:"el-menu-demo",mode:"horizontal",onSelect:A},{default:c((()=>[(t(),o(u,null,m(b,((e,l)=>(t(),o(u,{key:l},[e.children?p("",!0):(t(),a(s,{key:0,index:e.path},{default:c((()=>[(t(),o("svg",le,ie)),g(" "+v(e.name),1)])),_:2},1032,["index"])),e.children?(t(),a(n,{key:1,index:String(l)},{title:c((()=>[(t(),o("svg",se,ne)),g(" "+v(e.name),1)])),default:c((()=>[(t(!0),o(u,null,m(e.children,(e=>(t(),a(s,{index:e.path,key:e.path},{default:c((()=>[(t(),o("svg",oe,re)),g(" "+v(e.name),1)])),_:2},1032,["index"])))),128))])),_:2},1032,["index"])):p("",!0)],64)))),64))])),_:1},8,["default-active"])]),r("div",{class:"handle-area"},[de,he,r("div",{class:"user-profile-image"},[r("img",{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})]),ce])])}}},[["__scopeId","data-v-89262296"]]);const me={class:"home-body"},ge={class:"home-child-view"};var ve=q({__name:"index",setup:a=>(a,l)=>{const i=e("router-view");return t(),o("div",me,[h(ue),r("div",ge,[h(i)])])}},[["__scopeId","data-v-f24c8a92"]]);const pe=e=>(f("data-v-12f4ca72"),e=e(),w(),e),fe={class:"main-body"},we={class:"image-area"},ye=pe((()=>r("div",{class:"main-title"},"参考图",-1))),be={class:"image-all"},xe={class:"image-item upload-image-area"},Ae={class:"upload-text-tips"},De=pe((()=>r("div",{class:"upload-text"},"点击上传",-1))),ke={class:"other-images"},Ce={class:"other-images-view-box"},Ie={class:"del-btn"},Le={class:"image-handl-area"},_e=pe((()=>r("label",null,"权重",-1))),Me=pe((()=>r("div",{class:"main-title"},null,-1))),Ve={class:"bottom-area"},Se={class:"handle-area"},Ee=pe((()=>r("div",{class:"main-title"},"正向提示词",-1))),Pe={class:"handle-item"},Re=pe((()=>r("div",{class:"main-title"},"负向提示词",-1))),Ye={class:"handle-item"},Te={class:"handle-item"},Ue={class:"handle-min"},Xe=pe((()=>r("div",{class:"main-title"},"风格",-1))),Fe={class:"handle-min"},Oe=pe((()=>r("div",{class:"main-title"},"相似度",-1))),We={class:"handle-min-slider"},Ze={class:"handle-min"},je=pe((()=>r("div",{class:"main-title"},"宽度",-1))),Ne={class:"handle-min"},ze=pe((()=>r("div",{class:"main-title"},"高度",-1))),He=pe((()=>r("div",{class:"main-title"},"线稿参考图",-1))),Ge={class:"handle-item bg"},Qe={class:"line-draft-image-area"},Be={class:"upload-image-area-other"},qe=["src"],$e={key:1,class:"upload-text-tips"},Je=pe((()=>r("div",{class:"upload-text"},"点击上传",-1))),Ke={class:"image-handl-area"},et=pe((()=>r("label",null,"权重",-1))),tt={class:"generate-btn"},at={class:"review-area"},lt="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var it=q({__name:"index",setup(l){const i=s([]),v=s(null),f=s(null),w=s([]),I=s(null),L=s(70),_=s(""),M=s(""),V=s(1024),S=s(1024),E=s(70),P=s(""),R=e=>{const t=new FileReader;return t.onload=({target:t})=>{i.value.length>=5||i.value.push({file:e,url:t.result,weight:100})},t.readAsDataURL(e),!1},Y=e=>{v.value=e;const t=new FileReader;return t.onload=({target:e})=>{f.value=e.result},t.readAsDataURL(e),!1},T=()=>{v.value=null,f.value=null},U=()=>{if(!i.value.length)return b.error("请至少上传一张参考图"),!1;if(!I.value)return b.error("请选择风格后操作"),!1;const e=(()=>{const e=new FormData;return e.append("base_model",I.value),v.value&&(e.append("lineart",v.value||""),e.append("lineart_weight",L.value/100)),e.append("positive_prompt",_.value),e.append("negative_prompt",M.value),e.append("ref",E.value/100),e.append("width",V.value),e.append("reheight",S.value),i.value.forEach((({weight:t,file:a})=>{e.append("weights",t/100),e.append("files",a)})),e})(),t=x.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${lt}/img2img/gen`,e).then((e=>{t.close(),P.value=`${lt}/img2img/${e.data}`})).catch((e=>{t.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{y.get(`${lt}/img2img/base_models`).then((e=>{Object.keys(e.data).forEach((t=>{w.value.push({name:t,value:e.data[t]})}))}))})),(l,s)=>{const n=e("el-icon"),v=e("el-upload"),y=e("el-image"),b=e("el-slider"),x=e("el-scrollbar"),X=e("el-input"),F=e("el-option"),O=e("el-select"),W=e("el-input-number"),Z=e("el-button");return t(),o("div",fe,[r("div",we,[ye,r("div",be,[r("div",xe,[h(v,{class:"avatar-uploader",drag:"",multiple:"",limit:5,disabled:i.value.length>=5,action:"","show-file-list":!1,"before-upload":R},{default:c((()=>[r("div",Ae,[h(n,{class:"avatar-uploader-icon"},{default:c((()=>[h(d(D))])),_:1}),De])])),_:1},8,["disabled"])]),r("div",ke,[h(x,null,{default:c((()=>[r("div",Ce,[(t(!0),o(u,null,m(i.value,((e,a)=>(t(),o("div",{class:"image-item",key:a},[h(y,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),r("div",Ie,[h(n,{style:{color:"red"},onClick:e=>(e=>{i.value.splice(e,1)})(a)},{default:c((()=>[h(d(k))])),_:2},1032,["onClick"])]),r("div",Le,[_e,h(b,{modelValue:e.weight,"onUpdate:modelValue":t=>e.weight=t,style:{width:"calc(100% - 50px)"},min:0,max:100,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])])),_:1})])])]),Me,r("div",Ve,[r("div",Se,[h(x,null,{default:c((()=>[Ee,r("div",Pe,[h(X,{type:"textarea",modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),maxlength:"255"},null,8,["modelValue"])]),Re,r("div",Ye,[h(X,{type:"textarea",modelValue:M.value,"onUpdate:modelValue":s[1]||(s[1]=e=>M.value=e),maxlength:"255"},null,8,["modelValue"])]),r("div",Te,[r("div",Ue,[Xe,h(O,{modelValue:I.value,"onUpdate:modelValue":s[2]||(s[2]=e=>I.value=e)},{default:c((()=>[(t(!0),o(u,null,m(w.value,(e=>(t(),a(F,{key:e.name,value:e.value,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),r("div",Fe,[Oe,r("div",We,[h(b,{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=e=>E.value=e)},null,8,["modelValue"])])]),r("div",Ze,[je,h(W,{style:{width:"100%"},modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=e=>V.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])]),r("div",Ne,[ze,h(W,{style:{width:"100%"},modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=e=>S.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])])]),He,r("div",Ge,[r("div",Qe,[r("div",Be,[h(v,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":Y},{default:c((()=>[f.value?(t(),o("div",{key:0,class:"upload-image-del-area",onClick:s[7]||(s[7]=A((()=>{}),["stop"]))},[r("img",{src:f.value,class:"avatar"},null,8,qe),r("div",{class:"upload-image-del-btn-area",onClick:s[6]||(s[6]=A((()=>{}),["stop"]))},[r("div",{class:"upload-image-del-btn",onClick:A(T,["stop"])},[h(n,null,{default:c((()=>[h(d(C))])),_:1})])])])):(t(),o("div",$e,[h(n,{class:"avatar-uploader-icon"},{default:c((()=>[h(d(D))])),_:1}),Je]))])),_:1})]),r("div",Ke,[et,h(b,{style:{width:"calc(100% - 50px)"},disabled:!f.value,modelValue:L.value,"onUpdate:modelValue":s[8]||(s[8]=e=>L.value=e),min:0,max:100,size:"small"},null,8,["disabled","modelValue"])])])])])),_:1}),r("div",tt,[h(Z,{style:{width:"100%"},type:"primary",onClick:s[9]||(s[9]=e=>U())},{default:c((()=>[g("生成")])),_:1})])]),r("div",at,[P.value?(t(),a(y,{key:0,fit:"scale-down",src:P.value,"preview-src-list":[P.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):p("",!0)])])])}}},[["__scopeId","data-v-12f4ca72"]]);function st(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:a})}class nt{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,t){const{canvasDom:a}=this;switch(this.clearHandle(),e){case"selectionArea":a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(a,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"clearArea":a.style.cursor="none",this.addListener(a,"mousedown",(e=>{this.clearAreaStart(e,t)})),this.addListener(a,"mouseup",(e=>{this.clearAreaFinish(e,t)})),this.addListener(a,"mousemove",(e=>{this.clearAreaMoving(e,t)}));break;default:this.clearHandle()}}clearAreaStart(e,t){const{offsetX:a,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:s,handleX:a,handleY:l,type:"clearArea",clearType:t,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:t,offsetY:a}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.arc(t,a,s,0,2*Math.PI),l.stroke(),l.closePath()}clearAreaMoving(e){const{offsetX:t,offsetY:a}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:t,offsetY:a,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:t,canvasDom:a}=this,{width:l,height:i}=a;this.handleList=[],t.beginPath(),t.clearRect(0,0,l,i),t.closePath();const s=new Image;s.src=e,s.onload=()=>{this.initImageData(s),this.drawImage()}}initImageData(e){const{canvasDom:t}=this,{width:a,height:l}=t,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>a)if(s/l>i/a){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=a/2-n.width/2}else{const e=a/i;n.width=a,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/a;n.height=l,n.width=l/e,n.y=0,n.x=a/2-n.width/2}else{const e=a/l;n.width=a,n.height=a/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:t,y:a,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,t,a,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:t,imageData:a}=this,{image:l}=a,{width:i,height:s}=t;e.beginPath(),e.clearRect(0,0,i,s),e.closePath(),l&&(this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((t=>{let{type:a}=t;if("selectionArea"===a){let{handleX:a,handleY:l,offsetX:i,offsetY:s,status:n}=t;e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const o=a>i?i:a,r=l>s?s:l,d=a>i?a-i:i-a,h=l>s?l-s:s-l;if((!d||!h)&&n)return;e.rect(o,r,d,h),e.stroke(),e.closePath()}if("clearArea"===a){let{clearType:a,dataList:l,offsetX:i,offsetY:s,radius:n}=t;"arc"==a&&(e.beginPath(),e.globalCompositeOperation="destination-out",e.moveTo(i+n,s+n),e.arc(i,s,n,0,2*Math.PI),l.forEach((t=>{e.moveTo(t.offsetX+t.radius,t.offsetY+t.radius),e.arc(t.offsetX,t.offsetY,t.radius,0,2*Math.PI)})),e.fill(),e.globalCompositeOperation="source-over",e.closePath())}})))}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((t,a)=>{let{type:l}=t;if("selectionArea"===l){const{handleX:l,handleY:i,offsetX:s,offsetY:n,status:o,imageData:r}=t,d=this.canvasDom.width,h=this.canvasDom.height,c=this.imageData.width;this.imageData.height;const u=d===c?h/e.height:d/e.width;if(o&&!r){const o=document.createElement("canvas");o.width=d/u,o.height=h/u;const r=o.getContext("2d"),c=l>s?s:l,m=i>n?n:i,g=l>s?l-s:s-l,v=i>n?i-n:n-i;if(r.beginPath(),r.drawImage(e,this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),r.clearRect(Math.round(c/u),Math.round(m/u),Math.round(g/u),Math.round(v/u)),r.closePath(),!g||!v)return;const p=r.getImageData(this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/u),f.height=Math.round(this.imageData.height/u);f.getContext("2d").putImageData(p,0,0);const w=st(f.toDataURL("image/png"));t.imageData=new File([w],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}if("clearArea"===l){const{clearType:l,dataList:i,offsetX:s,offsetY:n,radius:o,status:r,imageData:d}=t,h=this.canvasDom.width,c=this.canvasDom.height,u=this.imageData.width;this.imageData.height;const m=h===u?c/e.height:h/e.width;if(r&&!d&&"arc"==l){const l=document.createElement("canvas");l.width=h/m,l.height=c/m;const r=l.getContext("2d");r.beginPath(),r.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),r.closePath(),r.beginPath(),r.globalCompositeOperation="destination-out",r.moveTo((s+o)/m,(n+o)/m),r.arc(s,n,o,0,2*Math.PI),i.forEach((e=>{r.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),r.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),r.fill(),r.globalCompositeOperation="source-over",r.closePath();const d=r.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),u=document.createElement("canvas");u.width=Math.round(this.imageData.width/m),u.height=Math.round(this.imageData.height/m);u.getContext("2d").putImageData(d,0,0);const g=st(u.toDataURL("image/png"));t.imageData=new File([g],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}}))}addListener(e,t,a){e.addEventListener(t,a);var l=t+"_"+a.toString();this.listeners[l]={element:e,eventType:t,listener:a}}removeAllListeners(){for(var e in this.listeners){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:t}=this,{width:a,height:l}=t;e.beginPath(),e.clearRect(0,0,a,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const ot=e=>(f("data-v-061b6b3e"),e=e(),w(),e),rt={class:"main-body"},dt={class:"image-area"},ht=ot((()=>r("div",{class:"main-title"},"模特照片",-1))),ct={class:"image-all"},ut={class:"image-item upload-image-area"},mt={class:"upload-text-tips"},gt=ot((()=>r("div",{class:"upload-text"},"点击上传",-1))),vt={class:"other-images"},pt={class:"other-images-view-box"},ft={class:"del-btn"},wt=ot((()=>r("div",{class:"main-title"},null,-1))),yt={class:"bottom-area"},bt={class:"handle-area"},xt=ot((()=>r("div",{class:"main-title"},"正向提示词",-1))),At={class:"handle-item"},Dt=ot((()=>r("div",{class:"main-title"},"负向提示词",-1))),kt={class:"handle-item"},Ct=ot((()=>r("div",{class:"main-title"},"待换脸人像",-1))),It={class:"handle-item bg"},Lt={class:"line-draft-image-area"},_t={class:"upload-image-area-other"},Mt=["src"],Vt={key:1,class:"upload-text-tips"},St=ot((()=>r("div",{class:"upload-text"},"点击上传",-1))),Et={class:"image-handl-area"},Pt=ot((()=>r("label",null,"笔刷半径",-1))),Rt={class:"image-handl-area"},Yt=ot((()=>r("div",{class:"main-title"},"相似度",-1))),Tt={class:"handle-item"},Ut={class:"handle-min-slider"},Xt={class:"generate-btn"},Ft={class:"review-area"},Ot="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var Wt=q({__name:"index",setup(l){const i=s([]),v=s(null),f=s(null);s([]),s(null),s(70);const w=s(""),I=s("");s(1024),s(1024);const L=s(70),_=s(""),M=s(0),V=s(null),S=s(10),E=e=>{const t=new FileReader;return t.onload=({target:t})=>{i.value.length>=15||i.value.push({file:e,url:t.result,weight:100})},t.readAsDataURL(e),!1},P=e=>{v.value=e;const t=new FileReader;return t.onload=({target:e})=>{f.value=e.result,V.value.initImage(f.value)},t.readAsDataURL(e),!1},R=()=>{v.value=null,f.value=null},Y=()=>{if(!i.value.length)return b.error("请至少上传一张模特照片"),!1;if(!v.value)return b.error("请上传待换脸人像后操作"),!1;if(!V.value.handleList.length)return b.error("款选人脸区域后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",w.value),e.append("negative_prompt",I.value),e.append("mask_strength",L.value/100),i.value.forEach((({weight:t,file:a})=>{e.append("ref_faces",a)})),e.append("face",v.value),V.value.handleList.forEach((({imageData:t})=>{e.append("face_mask",t)})),e})(),t=x.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${Ot}/img2img/swap_face`,e).then((e=>{if(t.close(),"未检测到人脸，请扩大人脸选区区域！"===e.data)return b.error(e.data),!1;_.value=`${Ot}/img2img/${e.data}`})).catch((e=>{t.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))},T=()=>{V.value.clearSelectionArea()},U=()=>{V.value.setClearAreaRadius(S.value)};return n((()=>{V.value=new nt(M.value),V.value.handleChange("clearArea","arc")})),(l,s)=>{const n=e("el-icon"),v=e("el-upload"),y=e("el-image"),b=e("el-scrollbar"),x=e("el-input"),V=e("el-slider"),X=e("el-button");return t(),o("div",rt,[r("div",dt,[ht,r("div",ct,[r("div",ut,[h(v,{class:"avatar-uploader",drag:"",multiple:"",limit:15,disabled:i.value.length>=15,action:"","show-file-list":!1,"before-upload":E},{default:c((()=>[r("div",mt,[h(n,{class:"avatar-uploader-icon"},{default:c((()=>[h(d(D))])),_:1}),gt])])),_:1},8,["disabled"])]),r("div",vt,[h(b,null,{default:c((()=>[r("div",pt,[(t(!0),o(u,null,m(i.value,((e,a)=>(t(),o("div",{class:"image-item",key:a},[h(y,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),r("div",ft,[h(n,{style:{color:"red"},onClick:e=>(e=>{i.value.splice(e,1)})(a)},{default:c((()=>[h(d(k))])),_:2},1032,["onClick"])])])))),128))])])),_:1})])])]),wt,r("div",yt,[r("div",bt,[h(b,null,{default:c((()=>[xt,r("div",At,[h(x,{type:"textarea",modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),maxlength:"255"},null,8,["modelValue"])]),Dt,r("div",kt,[h(x,{type:"textarea",modelValue:I.value,"onUpdate:modelValue":s[1]||(s[1]=e=>I.value=e),maxlength:"255"},null,8,["modelValue"])]),Ct,r("div",It,[r("div",Lt,[r("div",_t,[h(v,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":P},{default:c((()=>[f.value?(t(),o("div",{key:0,class:"upload-image-del-area",onClick:s[3]||(s[3]=A((()=>{}),["stop"]))},[r("img",{src:f.value,class:"avatar"},null,8,Mt),r("div",{class:"upload-image-del-btn-area",onClick:s[2]||(s[2]=A((()=>{}),["stop"]))},[r("div",{class:"upload-image-del-btn",onClick:A(R,["stop"])},[h(n,null,{default:c((()=>[h(d(C))])),_:1})])])])):(t(),o("div",Vt,[h(n,{class:"avatar-uploader-icon"},{default:c((()=>[h(d(D))])),_:1}),St]))])),_:1}),r("div",Et,[Pt,h(V,{style:{width:"calc(100% - 50px)"},modelValue:S.value,"onUpdate:modelValue":s[4]||(s[4]=e=>S.value=e),onChange:U,min:1,max:100,size:"small"},null,8,["modelValue"])])]),r("div",Rt,[r("div",{class:"main-title"},[g(" 框选人脸区域 "),r("div",{class:"title-handle-area",onClick:T}," 重置 ")]),r("canvas",{ref_key:"canvasDom",ref:M},null,512)])])]),Yt,r("div",Tt,[r("div",Ut,[h(V,{modelValue:L.value,"onUpdate:modelValue":s[5]||(s[5]=e=>L.value=e)},null,8,["modelValue"])])])])),_:1}),r("div",Xt,[h(X,{style:{width:"100%"},type:"primary",onClick:s[6]||(s[6]=e=>Y())},{default:c((()=>[g("生成")])),_:1})])]),r("div",Ft,[_.value?(t(),a(y,{key:0,fit:"scale-down",src:_.value,"preview-src-list":[_.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):p("",!0)])])])}}},[["__scopeId","data-v-061b6b3e"]]);const Zt={class:"layout-body"},jt={class:"layout-right"};var Nt=q({__name:"layout",props:{leftStyle:{}},setup:e=>(a,l)=>(t(),o("div",Zt,[r("div",{class:"layout-left",style:L(e.leftStyle)},[I(a.$slots,"left",{},void 0,!0)],4),I(a.$slots,"center",{},void 0,!0),r("div",jt,[I(a.$slots,"right",{},void 0,!0)])]))},[["__scopeId","data-v-2be9378c"]]);function zt(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:a})}class Ht{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.finishImage=null,this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,t){const{canvasDom:a}=this;switch(this.clearHandle(),e){case"selectionArea":a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionAreaFinish(e),this.getFinishImage()})),this.addListener(a,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"selectionArcArea":a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionArcAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionArcAreaFinish(e),this.getFinishImage()})),this.addListener(a,"mousemove",(e=>{this.selectionArcAreaMoving(e)}));break;case"clearArea":a.style.cursor="none",this.addListener(a,"mousedown",(e=>{this.clearAreaStart(e,t)})),this.addListener(a,"mouseup",(e=>{this.clearAreaFinish(e,t),this.getFinishImage()})),this.addListener(a,"mousemove",(e=>{this.clearAreaMoving(e,t)}));break;default:this.clearHandle()}}selectionArcAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,type:"selectionArcArea",status:0,imageData:null})}selectionArcAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionArcAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearAreaStart(e,t){const{offsetX:a,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:s,handleX:a,handleY:l,type:"clearArea",clearType:t,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:t,offsetY:a}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.arc(t,a,s,0,2*Math.PI),l.stroke(),l.closePath()}clearAreaMoving(e){const{offsetX:t,offsetY:a}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:t,offsetY:a,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:t,canvasDom:a}=this,{width:l,height:i}=a;this.handleList=[],t.beginPath(),t.clearRect(0,0,l,i),t.closePath(),e.includes("http")&&y({method:"get",url:e,responseType:"blob"}).then((e=>{this.finishImage=new File([e.data],`${(new Date).getTime()}.png`,{type:"image/png"})}));const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{this.initImageData(s),this.drawImage()},s.src=e}initImageData(e){const{canvasDom:t}=this,{width:a,height:l}=t,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>a)if(s/l>i/a){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=a/2-n.width/2}else{const e=a/i;n.width=a,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/a;n.height=l,n.width=l/e,n.y=0,n.x=a/2-n.width/2}else{const e=a/l;n.width=a,n.height=a/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:t,y:a,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,t,a,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:t,imageData:a}=this,{image:l}=a,{width:i,height:s}=t;e.beginPath(),e.clearRect(0,0,i,s),e.closePath(),l&&(this.drawImage(),this.getSelecttionAreaImages(),e.beginPath(),this.handleList.forEach((t=>{e.globalCompositeOperation="destination-out";let{type:a}=t;if("selectionArea"===a){let{handleX:a,handleY:l,offsetX:i,offsetY:s,status:n}=t;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const o=a>i?i:a,r=l>s?s:l,d=a>i?a-i:i-a,h=l>s?l-s:s-l;if((!d||!h)&&n)return;e.rect(o,r,d,h)}if("selectionArcArea"===a){let{handleX:a,handleY:l,offsetX:i,offsetY:s,status:n}=t;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const o=a>i?i:a,r=l>s?s:l,d=a>i?a-i:i-a,h=l>s?l-s:s-l,c=Math.sqrt(d*d+h*h)/2;if((!d||!h)&&n)return;e.moveTo(o+d/2-c,r+h/2-c),e.arc(o+d/2,r+h/2,c,0,2*Math.PI)}if("clearArea"===a){let{clearType:a,dataList:l,offsetX:i,offsetY:s,radius:n}=t;e.moveTo(i+n,s+n),e.arc(i,s,n,0,2*Math.PI),l.forEach((t=>{e.moveTo(t.offsetX+t.radius,t.offsetY+t.radius),e.arc(t.offsetX,t.offsetY,t.radius,0,2*Math.PI)}))}})),e.fill(),e.globalCompositeOperation="source-over",e.closePath())}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((t,a)=>{let{type:l}=t;if("selectionArea"===l){const{handleX:l,handleY:i,offsetX:s,offsetY:n,status:o,imageData:r}=t,d=this.canvasDom.width,h=this.canvasDom.height,c=this.imageData.width;this.imageData.height;const u=d===c?h/e.height:d/e.width;if(o&&!r){const o=document.createElement("canvas");o.width=d/u,o.height=h/u;const r=o.getContext("2d"),c=l>s?s:l,m=i>n?n:i,g=l>s?l-s:s-l,v=i>n?i-n:n-i;if(r.beginPath(),r.drawImage(e,this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),r.clearRect(Math.round(c/u),Math.round(m/u),Math.round(g/u),Math.round(v/u)),r.closePath(),!g||!v)return;const p=r.getImageData(this.imageData.x/u,this.imageData.y/u,this.imageData.width/u,this.imageData.height/u),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/u),f.height=Math.round(this.imageData.height/u);f.getContext("2d").putImageData(p,0,0);const w=zt(f.toDataURL("image/png"));t.imageData=new File([w],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}if("clearArea"===l){const{clearType:l,dataList:i,offsetX:s,offsetY:n,radius:o,status:r,imageData:d}=t,h=this.canvasDom.width,c=this.canvasDom.height,u=this.imageData.width;this.imageData.height;const m=h===u?c/e.height:h/e.width;if(r&&!d&&"arc"==l){const l=document.createElement("canvas");l.width=h/m,l.height=c/m;const r=l.getContext("2d");r.beginPath(),r.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),r.closePath(),r.beginPath(),r.globalCompositeOperation="destination-out",r.moveTo((s+o)/m,(n+o)/m),r.arc(s,n,o,0,2*Math.PI),i.forEach((e=>{r.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),r.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),r.fill(),ctx.globalCompositeOperation="source-over",r.closePath();const d=r.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),u=document.createElement("canvas");u.width=Math.round(this.imageData.width/m),u.height=Math.round(this.imageData.height/m);u.getContext("2d").putImageData(d,0,0);const g=zt(u.toDataURL("image/png"));t.imageData=new File([g],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}}))}getFinishImage(){const{image:e}=this.imageData,t=this.canvasDom.width,a=this.canvasDom.height,l=this.imageData.width;this.imageData.height;const i=t===l?a/e.height:t/e.width,s=document.createElement("canvas");s.width=t/i,s.height=a/i;const n=s.getContext("2d");n.beginPath(),n.drawImage(e,this.imageData.x/i,this.imageData.y/i,this.imageData.width/i,this.imageData.height/i),n.closePath(),n.globalCompositeOperation="destination-out",n.beginPath(),this.handleList.forEach(((e,t)=>{const{type:a}=e;if("selectionArea"===a){let{handleX:t,handleY:a,offsetX:l,offsetY:s,status:o}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const r=t>l?l:t,d=a>s?s:a,h=t>l?t-l:l-t,c=a>s?a-s:s-a;if((!h||!c)&&o)return;n.rect(r/i,d/i,h/i,c/i)}if("clearArea"===a){let{clearType:t,dataList:a,offsetX:l,offsetY:s,radius:o}=e;n.moveTo((l+o)/i,(s+o)/i),n.arc(l/i,s/i,o/i,0,2*Math.PI),a.forEach((e=>{n.moveTo((e.offsetX+e.radius)/i,(e.offsetY+e.radius)/i),n.arc(e.offsetX/i,e.offsetY/i,e.radius/i,0,2*Math.PI)}))}if("selectionArcArea"===a){let{handleX:t,handleY:a,offsetX:l,offsetY:s,status:o}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const r=t>l?l:t,d=a>s?s:a,h=t>l?t-l:l-t,c=a>s?a-s:s-a,u=Math.sqrt(h*h+c*c)/2;if((!h||!c)&&o)return;n.moveTo((r+h/2-u)/i,(d+c/2-u)/i),n.arc((r+h/2)/i,(d+c/2)/i,u/i,0,2*Math.PI)}})),n.fill(),n.globalCompositeOperation="source-over",n.closePath();const o=n.getImageData(this.imageData.x/i,this.imageData.y/i,this.imageData.width/i,this.imageData.height/i),r=document.createElement("canvas");r.width=Math.round(this.imageData.width/i),r.height=Math.round(this.imageData.height/i);r.getContext("2d").putImageData(o,0,0);const d=zt(r.toDataURL("image/png"));this.finishImage=new File([d],`${(new Date).getTime()}_finish.png`,{type:"image/png"})}addListener(e,t,a){e.addEventListener(t,a);var l=t+"_"+a.toString();this.listeners[l]={element:e,eventType:t,listener:a}}removeAllListeners(){for(var e in this.listeners){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.finishImage=null,this.reDraw()}clearAll(){const{ctx:e,canvasDom:t}=this,{width:a,height:l}=t;e.beginPath(),e.clearRect(0,0,a,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const Gt=e=>(f("data-v-35679002"),e=e(),w(),e),Qt={class:"super-image-search-body"},Bt={class:"image-search-title"},qt={key:8,class:"image-handle-setting"},$t=Gt((()=>r("label",null," 笔刷半径 ",-1))),Jt={class:"image-search-title-handle"},Kt={class:"content"},ea={class:"search-btn-area"},ta=Gt((()=>r("div",{class:"image-search-title",style:{height:"30px"}},[r("div",null,"提示词")],-1))),aa={class:"prompt-area"},la={class:"prompt-item"},ia=Gt((()=>r("div",{class:"prompt-item-label"},"正向提示词",-1))),sa={class:"prompt-item-input"},na={class:"prompt-item"},oa=Gt((()=>r("div",{class:"prompt-item-label"},"负向提示词",-1))),ra={class:"prompt-item-input"},da={class:"prompt-btn"},ha=Gt((()=>r("div",{class:"image-search-title",style:{height:"30px"}},[r("div",null,"生成图片")],-1))),ca={class:"content",style:{height:"calc(100% - 40px)"}},ua="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var ma=q({__name:"index",setup(l){const i=s(null),u=s(null),m=s(null),v=s(0);s(0);const f=s(10),w=s(""),A=s(""),D=s(""),C=s(""),I=e=>{u.value?(w.value=e,m.value.handleChange(e)):b.error("请在上传图片后操作")},L=()=>{m.value.setClearAreaRadius(f.value)},E=e=>{i.value=e;const t=new FileReader;return t.onload=({target:e})=>{u.value=e.result,m.value.initImage(u.value)},t.readAsDataURL(e),!1};const P=()=>{if(!i.value)return b.error("请上传图片后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",D.value),e.append("negative_prompt",C.value),e.append("image",i.value),m.value.finishImage?(e.append("image_with_mask",m.value.finishImage),e):(e.append("image_with_mask",i.value),e)})(),t=x.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${ua}/img2img/inpaint`,e).then((e=>{t.close(),A.value=`${ua}/img2img/${e.data}`})).catch((e=>{t.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{m.value=new Ht(v.value)})),(l,s)=>{const n=e("el-icon"),R=e("el-button"),Y=e("el-slider"),T=e("el-upload"),U=e("el-input"),X=e("el-image");return t(),o("div",Qt,[h(Nt,{leftStyle:{width:"calc(50% - 180px)"}},{left:c((()=>[r("div",Bt,[r("div",null,["selectionArea"!==w.value&&u.value?(t(),a(R,{key:0,type:"primary",class:"title-handle-btn",onClick:s[0]||(s[0]=e=>I("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(M))])),_:1}),g(" 矩形 ")])),_:1})):p("",!0),"selectionArea"===w.value&&u.value?(t(),a(R,{key:1,class:"title-handle-btn",type:"warning",onClick:s[1]||(s[1]=e=>I("")),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(M))])),_:1}),g(" 矩形 ")])),_:1})):p("",!0),"selectionArcArea"!==w.value&&u.value?(t(),a(R,{key:2,type:"primary",class:"title-handle-btn",onClick:s[2]||(s[2]=e=>I("selectionArcArea")),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(V))])),_:1}),g(" 圆形 ")])),_:1})):p("",!0),"selectionArcArea"===w.value&&u.value?(t(),a(R,{key:3,class:"title-handle-btn",type:"warning",onClick:s[3]||(s[3]=e=>I("")),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(V))])),_:1}),g(" 圆形 ")])),_:1})):p("",!0),"clearArea"!==w.value&&u.value?(t(),a(R,{key:4,type:"primary",class:"title-handle-btn",onClick:s[4]||(s[4]=e=>I("clearArea")),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(S))])),_:1}),g(" 笔刷 ")])),_:1})):p("",!0),"clearArea"===w.value&&u.value?(t(),a(R,{key:5,class:"title-handle-btn",type:"warning",onClick:s[5]||(s[5]=e=>I("")),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(S))])),_:1}),g(" 笔刷 ")])),_:1})):p("",!0),u.value?(t(),a(R,{key:6,class:"title-handle-btn",type:"primary",onClick:s[6]||(s[6]=e=>{m.value.initImage(u.value)}),style:{"font-size":"12px"}},{default:c((()=>[h(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(k))])),_:1}),g(" 重置 ")])),_:1})):p("",!0),u.value?(t(),a(R,{key:7,class:"title-handle-btn",type:"primary",onClick:s[7]||(s[7]=e=>{_.prompt("请输入要识别的物品类别,例如: 床, 被单, 人物(英文)等,多种类别之间请使用逗号分割","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:e})=>{if(!e)return void b.error("请输入prompt后操作");e=(e+=",").replaceAll("，",",");const t=x.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),a=new FormData;a.append("prompt",e),a.append("image",i.value),y.post(`${ua}/img2img/segment`,a).then((e=>{t.close(),"没有识别到任何物体，需要给定更加详细的物体类别prompt!"!==e.data?(m.value.clearSelectionArea(),m.value.initImage(`${ua}/img2img/${e.data}`)):b.error(e.data)})).catch((e=>{t.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))})).catch((()=>{b({type:"info",message:"取消操作"})}))}),style:{"font-size":"12px"}},{default:c((()=>[g(" Ai识别 ")])),_:1})):p("",!0),u.value?(t(),o("div",qt,[$t,h(Y,{style:{width:"100px","margin-left":"20px",display:"inline-block","padding-top":"9px"},modelValue:f.value,"onUpdate:modelValue":s[8]||(s[8]=e=>f.value=e),onChange:L,min:1,max:100},null,8,["modelValue"])])):p("",!0)]),r("div",Jt,[h(T,{class:"upload-demo","before-upload":E,"show-file-list":!1,action:""},{default:c((()=>[h(R,{type:"text"},{default:c((()=>[g("上传图片")])),_:1})])),_:1})])]),r("div",Kt,[r("canvas",{ref_key:"canvasDom",ref:v},null,512)])])),center:c((()=>[r("div",ea,[ta,r("div",aa,[r("div",la,[ia,r("div",sa,[h(U,{type:"textarea",modelValue:D.value,"onUpdate:modelValue":s[9]||(s[9]=e=>D.value=e)},null,8,["modelValue"])])]),r("div",na,[oa,r("div",ra,[h(U,{type:"textarea",modelValue:C.value,"onUpdate:modelValue":s[10]||(s[10]=e=>C.value=e)},null,8,["modelValue"])])]),r("div",da,[h(R,{type:"primary",style:{width:"100%"},onClick:P},{default:c((()=>[g(" 生成 ")])),_:1})])])])])),right:c((()=>[ha,r("div",ca,[h(X,{src:A.value,fit:"scale-down","preview-src-list":[A.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])])])),_:1},8,["leftStyle"])])}}},[["__scopeId","data-v-35679002"]]);const ga=e=>(f("data-v-7720ba97"),e=e(),w(),e),va={class:"m-spin"},pa={class:"m-spin-box"},fa={key:0,class:"m-spin-dot"},wa=[ga((()=>r("span",{class:"u-dot-item"},null,-1))),ga((()=>r("span",{class:"u-dot-item"},null,-1))),ga((()=>r("span",{class:"u-dot-item"},null,-1))),ga((()=>r("span",{class:"u-dot-item"},null,-1)))],ya={key:1,class:"u-quarter-circle"},ba={key:2,class:"u-three-quarters-circle"},xa={key:3,class:"m-dynamic-circle"},Aa=[ga((()=>r("svg",{class:"circular",viewBox:"0 0 50 50"},[r("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)))];var Da=q(E({__name:"Spin",props:{spinning:{type:Boolean,default:!0},size:{default:"default"},tip:{default:""},indicator:{default:"dot"},color:{default:"#1677FF"}},setup:e=>(e,a)=>(t(),o("div",{class:Y(`m-spin-wrap ${e.size}`),style:L(`--color: ${e.color};`)},[P(r("div",va,[r("div",pa,["dot"===e.indicator?(t(),o("div",fa,wa)):p("",!0),"quarter-circle"===e.indicator?(t(),o("div",ya)):p("",!0),"three-quarters-circle"===e.indicator?(t(),o("div",ba)):p("",!0),"dynamic-circle"===e.indicator?(t(),o("div",xa,Aa)):p("",!0),P(r("p",{class:"u-tip"},v(e.tip),513),[[R,e.tip]])])],512),[[R,e.spinning]]),r("div",{class:Y(["m-spin-content",{"m-spin-mask":e.spinning}])},[I(e.$slots,"default",{},void 0,!0)],2)],6))}),[["__scopeId","data-v-7720ba97"]]);const ka=e=>(f("data-v-bd6aed36"),e=e(),w(),e),Ca=["onMouseenter"],Ia=["src","alt","onLoad"],La=["onClick"],_a={style:{color:"#fff","margin-bottom":"5px"}},Ma={style:{color:"#fff","margin-bottom":"5px"}},Va={style:{color:"#fff",width:"100%",display:"-webkit-box","word-break":"break-all","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",overflow:"hidden","text-overflow":"ellipsis"}},Sa={style:{position:"absolute",right:"10px",bottom:"5px"}},Ea=["onClick"],Pa=[ka((()=>r("rect",{stroke:"null",id:"svg_1",fill:"white",rx:"18",height:"36",width:"36"},null,-1))),ka((()=>r("path",{stroke:"#F3745D",id:"svg_2","stroke-width":"2",d:"m9.699395,11l16.60121,0l0,16.532009l-16.60121,0l0,-16.532009z"},null,-1))),ka((()=>r("path",{stroke:"#F3745D",id:"svg_3","stroke-width":"2",d:"m14.553074,6l6.893853,0l0,4.173591l-6.893853,0l0,-4.173591z"},null,-1))),ka((()=>r("path",{stroke:"#F3745D",id:"svg_4","stroke-width":"2",d:"m6.932526,10l22.134948,0"},null,-1))),ka((()=>r("path",{stroke:"#F3745D",id:"svg_5","stroke-width":"1.6",d:"m20.62999,14.8l0,7.240074"},null,-1))),ka((()=>r("path",{stroke:"#F3745D",id:"svg_6","stroke-width":"1.6",d:"m15.649886,14.8l0,7.170871"},null,-1)))],Ra=["onClick"],Ya=[ka((()=>r("rect",{width:"36",height:"36",rx:"18",fill:"white"},null,-1))),ka((()=>r("path",{d:"M9.8125 9.81836H17.9943L19.4819 11.8638H26.1761V26.182H9.8125V9.81836Z",stroke:"#4075E5","stroke-width":"2"},null,-1))),ka((()=>r("path",{d:"M9.8125 15.9547H26.1761",stroke:"#4075E5","stroke-width":"2"},null,-1)))],Ta=["onClick"],Ua=[ka((()=>r("rect",{width:"36",height:"36",rx:"18",fill:"white"},null,-1))),ka((()=>r("path",{d:"M17.2504 24.6942C21.3583 24.6942 24.6884 21.3642 24.6884 17.2563C24.6884 13.1484 21.3583 9.81836 17.2504 9.81836C13.1426 9.81836 9.8125 13.1484 9.8125 17.2563C9.8125 21.3642 13.1426 24.6942 17.2504 24.6942Z",stroke:"#4075E5","stroke-width":"2"},null,-1))),ka((()=>r("path",{d:"M26.1721 26.182L22.4531 22.46",stroke:"#4075E5","stroke-width":"2"},null,-1)))],Xa=["onMouseenter"],Fa=["src","alt","onLoad"],Oa={class:"overlay"},Wa={style:{color:"#fff"}};var Za=q(E({__name:"Index",props:{images:{default:()=>[]},columnCount:{default:3},columnGap:{default:20},width:{default:"100%"},backgroundColor:{default:"#fff"},mode:{default:"JS"}},emits:["handleShowInfoModal","handleDelete"],setup(l,{emit:i}){const g=l,f=T((()=>"number"==typeof g.width?g.width+"px":g.width)),w=i,y=s([]),b=s([]),x=s(),D=s(),k=T((()=>Math.max(...b.value)+g.columnGap)),C=T((()=>g.images.length)),I=s(Array(C.value).fill(!1));function _(e){I.value[e]=!0}function M(e,t){if(e<g.columnCount)return b.value[e]=g.columnGap+t,{top:g.columnGap,left:(D.value+g.columnGap)*e+g.columnGap};{const e=Math.min(...b.value);var a=0;for(let t=0;t<b.value.length;t++)if(b.value[t]===e){a=t;break}return b.value[a]=e+g.columnGap+t,{top:e+g.columnGap,left:(D.value+g.columnGap)*a+g.columnGap}}}function V(e,t){return new Promise((a=>{const l=new Image;l.src=e,l.onload=function(){var e=l.height/(l.width/D.value);y.value[t]={width:D.value,height:e,...M(t,e)},a("load")}}))}async function S(){var e;D.value=(x.value.offsetWidth-(g.columnCount+1)*g.columnGap)/g.columnCount;const t=g.images.length;for(let a=null==(e=y.value)?void 0:e.length;a<t;a++)await V(g.images[a].src,a)}U((()=>g.images),(e=>{e.length&&"JS"===g.mode&&S()})),n((()=>{g.images.length&&"JS"===g.mode&&S()}));let E=s(null);return(l,i)=>{const s=e("svg-icon"),n=e("a-space");return t(),o(u,null,["JS"===l.mode?(t(),o("div",X({key:0},l.$attrs,{class:"m-waterfall-js",ref_key:"waterfall",ref:x,style:`background-color: ${l.backgroundColor}; width: ${f.value}; height: ${k.value}px;`}),[(t(!0),o(u,null,m(y.value,((e,s)=>(t(),a(Da,{class:"m-img",style:L(`border:solid 1px #d9d9d9; border-radius: 16px; width: ${e.width}px; height: ${e.height}px; top: ${e&&e.top}px; left: ${e&&e.left}px;`),spinning:!I.value[s],size:"small",indicator:"dynamic-circle",key:s},{default:c((()=>{var e,a;return[r("div",{class:"relative flex justify-center align-center",onMouseenter:e=>F(E)?E.value=s:E=s,onMouseleave:i[0]||(i[0]=e=>F(E)?E.value=null:E=null)},[r("img",{class:"u-img",src:l.images[s].src,alt:l.images[s].title,onLoad:e=>_(s)},null,40,Ia),P(r("div",{class:"overlay",onClick:e=>w("showHandle",l.images[s])},[r("div",null,[r("div",_a,v(l.images[s].title),1),r("div",Ma,"尺寸："+v((null==(e=l.images[s].width)?void 0:e.toFixed(2))+" * "+(null==(a=l.images[s].height)?void 0:a.toFixed(2))),1),r("div",Va,"文件位置："+v(l.images[s].fileAddress),1)]),r("div",Sa,[(t(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"10px"},onClick:A((e=>w("handleDel",l.images[s])),["stop"])},Pa,8,Ea)),(t(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"10px"},onClick:A((e=>w("handleOpenDir",l.images[s])),["stop"])},Ya,8,Ra)),(t(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:A((e=>w("handleshowImage",l.images[s])),["stop"])},Ua,8,Ta))])],8,La),[[R,d(E)===s]])],40,Ca)]})),_:2},1032,["style","spinning"])))),128))],16)):p("",!0),"CSS"===l.mode?(t(),o("div",X({key:1},l.$attrs,{class:"m-waterfall-css",style:`background: ${l.backgroundColor}; width: ${f.value}; padding: ${l.columnGap}px; column-count: ${l.columnCount}; column-gap: ${l.columnGap}px;`}),[(t(!0),o(u,null,m(l.images,((e,o)=>(t(),a(Da,{style:L(`border:solid 1px #E6EAEE;border-radius: 10px;margin-bottom: ${l.columnGap}px;`),spinning:!I.value[o],size:"small",indicator:"dynamic-circle",key:o},{default:c((()=>[r("div",{style:{position:"relative"},onMouseenter:e=>F(E)?E.value=o:E=o,onMouseleave:i[1]||(i[1]=e=>F(E)?E.value=null:E=null)},[r("img",{class:"u-img",src:e.src,alt:e.title,onLoad:e=>_(o)},null,40,Fa),P(r("div",Oa,[h(n,{size:20},{default:c((()=>[h(s,{"icon-class":"del_active",onClick:e=>w("handleDelete",l.images[o])},null,8,["onClick"]),h(s,{"icon-class":"edit2",onClick:e=>w("handleShowInfoModal",l.images[o])},null,8,["onClick"])])),_:2},1024),r("div",Wa,v(e.title),1)],512),[[R,d(E)===o]])],40,Xa)])),_:2},1032,["style","spinning"])))),128))],16)):p("",!0)],64)}}}),[["__scopeId","data-v-bd6aed36"]]);const ja={class:"my-header"},Na={class:"dialog-header"},za=["id"],Ha={class:"image-area"},Ga={class:"image-item"},Qa=["src"],Ba={class:"image-msg-area"},qa={class:"image-msg-item"},$a={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000","margin-bottom":"10px"}},Ja={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000","margin-bottom":"10px"}},Ka={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000",width:"100%",display:"-webkit-box","word-break":"break-all","margin-bottom":"10px","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","text-overflow":"ellipsis"}},el=(e=>(f("data-v-0b61c804"),e=e(),w(),e))((()=>r("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("rect",{width:"36",height:"36",rx:"18",fill:"white"}),r("path",{d:"M9.8125 9.81836H17.9943L19.4819 11.8638H26.1761V26.182H9.8125V9.81836Z",stroke:"#4075E5","stroke-width":"2"}),r("path",{d:"M9.8125 15.9547H26.1761",stroke:"#4075E5","stroke-width":"2"})],-1)));var tl=q({__name:"imageDialog",setup(l,{expose:i}){const n=s(!1),o=s({});return i({init:e=>{o.value=e,n.value=!0}}),(l,i)=>{const s=e("el-button"),d=e("el-dialog");return t(),a(d,{"align-center":"",modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=e=>n.value=e),"show-close":!1,width:"600","before-close":l.handleClose},{header:c((({close:e,titleId:t})=>[r("div",ja,[r("div",Na,[r("div",{id:t,class:"dialog-title",style:{"text-align":"center"}},"预览",8,za),h(s,{size:"small",type:"text",onClick:e,class:"dialog-close-btn"},{default:c((()=>[g(" 关闭 ")])),_:2},1032,["onClick"])])])])),default:c((()=>[r("div",Ha,[r("div",Ga,[r("img",{src:o.value.src},null,8,Qa)]),r("div",Ba,[r("div",qa,[r("div",$a,v(o.value.title),1),r("div",Ja," 尺寸："+v(o.value.width.toFixed(2)+" * "+o.value.height.toFixed(2)),1),r("div",Ka," 文件位置："+v(o.value.fileAddress),1),h(s,{type:"text",style:{padding:"0"},onClick:i[0]||(i[0]=e=>(({fileAddress:e})=>{window.open(e)})(o.value))},{default:c((()=>[el,g(" 打开所在文件夹 ")])),_:1})])])])])),_:1},8,["modelValue","before-close"])}}},[["__scopeId","data-v-0b61c804"]]);function al(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:a})}function ll(e,t){return"left"===t?(e=>new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{const e=a.width,l=a.height,i=document.createElement("canvas");i.width=e>l?e:l,i.height=e>l?e:l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(n,o),s.rotate(-Math.PI/2),s.translate(-n,-o),s.drawImage(a,n-a.width/2,o-a.height/2),s.closePath();const r=s.getImageData(o-a.height/2,n-a.width/2,l,e),d=document.createElement("canvas");d.width=l,d.height=e,d.getContext("2d").putImageData(r,0,0);const h=al(d.toDataURL("image/png")),c=new File([h],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),u=new FileReader;u.onload=({target:e})=>{t({file:c,url:e.result})},u.readAsDataURL(c)}})))(e):"right"===t?(e=>new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{const e=a.width,l=a.height,i=document.createElement("canvas");i.width=e>l?e:l,i.height=e>l?e:l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(n,o),s.rotate(Math.PI/2),s.translate(-n,-o),s.drawImage(a,n-a.width/2,o-a.height/2),s.closePath();const r=s.getImageData(o-a.height/2,n-a.width/2,l,e),d=document.createElement("canvas");d.width=l,d.height=e,d.getContext("2d").putImageData(r,0,0);const h=al(d.toDataURL("image/png")),c=new File([h],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),u=new FileReader;u.onload=({target:e})=>{t({file:c,url:e.result})},u.readAsDataURL(c)}})))(e):"horizontal"===t?(e=>new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{const e=a.width,l=a.height,i=document.createElement("canvas");i.width=e,i.height=l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(2*n,0),s.scale(-1,1),s.drawImage(a,n-a.width/2,o-a.height/2),s.closePath();const r=s.getImageData(0,0,e,l),d=document.createElement("canvas");d.width=e,d.height=l,d.getContext("2d").putImageData(r,0,0);const h=al(d.toDataURL("image/png")),c=new File([h],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),u=new FileReader;u.onload=({target:e})=>{t({file:c,url:e.result})},u.readAsDataURL(c)}})))(e):"vertical"===t?(e=>new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{const e=a.width,l=a.height,i=document.createElement("canvas");i.width=e,i.height=l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(0,2*o),s.scale(1,-1),s.drawImage(a,n-a.width/2,o-a.height/2),s.closePath();const r=s.getImageData(0,0,e,l),d=document.createElement("canvas");d.width=e,d.height=l,d.getContext("2d").putImageData(r,0,0);const h=al(d.toDataURL("image/png")),c=new File([h],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),u=new FileReader;u.onload=({target:e})=>{t({file:c,url:e.result})},u.readAsDataURL(c)}})))(e):void 0}const il={class:"image-search-body"},sl={class:"upload-image-title"},nl={key:0,class:"clear-result"},ol={class:"upload-image-area"},rl=["src"],dl={key:1,class:"upload-text-tips"},hl=(e=>(f("data-v-a1e4df1a"),e=e(),w(),e))((()=>r("div",{class:"upload-text"},"点击上传",-1))),cl={key:0,class:"image-handle-area"},ul={class:"image-handle-item"},ml={class:"image-handle-item"},gl={key:1,class:"search-btn-area"},vl={class:"search-result-area"},pl={class:"search-result-title"},fl={key:0,class:"result-num"},wl={key:0,class:"search-result-images-area"},yl="https://u248120-bf23-b1506178.westc.gpuhub.com:8443";var bl=q({__name:"index",setup(a){const l=s(null),i=s(null),n=s([]),u=s(0),m=s([]),f=s(!1),w=e=>{ll(i.value,e).then((({file:e,url:t})=>{l.value=e,i.value=t}))},b=e=>{l.value=e;const t=new FileReader;return t.onload=({target:e})=>{i.value=e.result},t.readAsDataURL(e),!1},x=()=>{l.value=null,i.value=null},k=()=>{const e=new FormData;e.append("file",l.value),f.value=!0,y.post(`${yl}/search`,e).then((e=>{const{data:t}=e;m.value=t.result.map((e=>({title:e,fileAddress:`${yl}/static/${e}`,width:1920,height:1080,src:`${yl}/static/${e}`}))),f.value=!1}))},I=e=>{u.value.init(e)},L=({fileAddress:e})=>{window.open(e)},_=()=>{n.value=[],m.value=[],i.value=null,l.value=null};return(a,l)=>{const s=e("el-button"),n=e("el-icon"),y=e("el-upload"),M=e("el-scrollbar"),V=O("loading");return t(),o("div",il,[h(Nt,null,{left:c((()=>[r("div",sl,[g(" 上传识别图 "),m.value.length?(t(),o("div",nl,[h(s,{style:{padding:"0",height:"20px","line-height":"20px"},type:"text",onClick:_},{default:c((()=>[g("清空")])),_:1})])):p("",!0)]),r("div",ol,[h(y,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":b},{default:c((()=>[i.value?(t(),o("div",{key:0,class:"upload-image-del-area",onClick:l[1]||(l[1]=A((()=>{}),["stop"]))},[r("img",{src:i.value,class:"avatar"},null,8,rl),r("div",{class:"upload-image-del-btn-area",onClick:l[0]||(l[0]=A((()=>{}),["stop"]))},[r("div",{class:"upload-image-del-btn",onClick:A(x,["stop"])},[h(n,null,{default:c((()=>[h(d(C))])),_:1})])])])):(t(),o("div",dl,[h(n,{class:"avatar-uploader-icon"},{default:c((()=>[h(d(D))])),_:1}),hl]))])),_:1})]),i.value?(t(),o("div",cl,[r("div",ul,[h(s,{onClick:l[2]||(l[2]=e=>w("left")),size:"small"},{default:c((()=>[g(" 左旋90° ")])),_:1}),h(s,{onClick:l[3]||(l[3]=e=>w("horizontal")),size:"small"},{default:c((()=>[g(" 水平镜像 ")])),_:1})]),r("div",ml,[h(s,{onClick:l[4]||(l[4]=e=>w("right")),size:"small"},{default:c((()=>[g(" 右旋90° ")])),_:1}),h(s,{onClick:l[5]||(l[5]=e=>w("vertical")),size:"small"},{default:c((()=>[g(" 垂直镜像 ")])),_:1})])])):p("",!0),i.value?(t(),o("div",gl,[h(s,{round:"",type:"primary",onClick:k},{default:c((()=>[g("开始识别")])),_:1})])):p("",!0)])),right:c((()=>[r("div",vl,[r("div",pl,[g(" 搜索结果 "),m.value.length?(t(),o("div",fl," 共 "+v(m.value.length)+" 张 ",1)):p("",!0)]),P((t(),o("div",{class:"search-result-images","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[h(M,null,{default:c((()=>[m.value.length?(t(),o("div",wl,[h(Za,{onHandleshowImage:I,onHandleOpenDir:L,columnCount:5,images:m.value},null,8,["images"])])):p("",!0)])),_:1})])),[[V,f.value]])])])),_:1}),h(tl,{ref_key:"imageDialogDom",ref:u},null,512)])}}},[["__scopeId","data-v-a1e4df1a"]]);const xl=e=>(f("data-v-3f469acd"),e=e(),w(),e),Al={class:"dir-area"},Dl=xl((()=>r("div",{class:"dir-list-title"},[g(" 链接本地图库 "),r("div",{class:"add-gallery-btn"})],-1))),kl={key:0,class:"dir-list"},Cl={class:"dir-path"},Il={class:"dir-handle"},Ll={class:"images-all-area"},_l={class:"images-all-title"},Ml=xl((()=>r("div",null,null,-1))),Vl={class:"images-num"},Sl=xl((()=>r("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("rect",{x:"3.5",y:"3.5",width:"13",height:"13",stroke:"#79bbff","stroke-width":"1.5"}),r("path",{d:"M5 10H15",stroke:"#79bbff","stroke-width":"1.5"}),r("path",{d:"M10 5V15",stroke:"#79bbff","stroke-width":"1.5"})],-1))),El={key:0,style:{"margin-left":"20px"}},Pl={key:0,class:"images-all-images-area"},Rl={class:"dir-list-content"},Yl={class:"dir-info-icon"},Tl=["onClick"],Ul="https://u248120-bf23-b1506178.westc.gpuhub.com:8443",Xl='<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n';var Fl=q({__name:"index",setup(l){s([]);const i=s(0),d=s([]),f=s([]),w=s(!1),x=s(!1),D=s(!1),k=s([]),C=()=>{w.value=!0,y.get(`${Ul}/images`).then((e=>{const{data:t}=e;w.value=!1,f.value=d.value=t.images.map((e=>({title:e,fileAddress:`${Ul}/static/${e}`,width:1920,height:1080,src:`${Ul}/static/${e}`})))}))},I=()=>{x.value=!0,setTimeout((()=>{x.value=!1,k.value=["线上图库"]}),1e3),C()},L=e=>{k.value.push(e),D.value=!1},_=()=>{b("演示版本暂无此功能，请于正式版本使用")};return n((()=>{I(),window.onFolderSelected=L})),(l,s)=>{const n=e("el-button"),y=e("el-empty"),b=e("el-scrollbar"),I=e("el-upload"),L=e("el-image"),M=O("loading");return P((t(),o("div",{class:"gallery-body","element-loading-spinner":Xl,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[h(Nt,null,{left:c((()=>[r("div",Al,[Dl,P((t(),o("div",{class:"dir-all-area","element-loading-spinner":Xl,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[h(b,null,{default:c((()=>[k.value.length?(t(),o("div",kl,[(t(!0),o(u,null,m(k.value,((e,a)=>(t(),o("div",{class:"dir-list-item",key:a},[r("div",Cl,v(e),1),r("div",Il,[h(n,{type:"text",onClick:e=>{},style:{color:"#f3745d",padding:"0",height:"20px","vertical-align":"top"}},{default:c((()=>[g("删除")])),_:2},1032,["onClick"])])])))),128))])):(t(),a(y,{key:1,description:"暂未连接本地图库",style:{"padding-top":"200px",color:"rgba(0, 0, 0, 1)"}},{default:c((()=>[h(n,{type:"primary",round:"",onClick:_},{default:c((()=>[g("选择")])),_:1})])),_:1}))])),_:1})])),[[M,x.value]])])])),right:c((()=>[r("div",Ll,[r("div",_l,[g(" 图库预览 "),Ml,r("div",Vl,[h(I,{class:"upload-demo","show-file-list":!1,"on-success":C,action:`${Ul}/upload`},{default:c((()=>[h(n,{type:"text",size:"small",style:{padding:"0"}},{default:c((()=>[Sl,g(" 上传图片 ")])),_:1})])),_:1},8,["action"]),f.value.length?(t(),o("div",El," 共 "+v(d.value.length)+" 张 ",1)):p("",!0)])]),P((t(),o("div",{class:"images-all-images","element-loading-spinner":Xl,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[h(b,null,{default:c((()=>[f.value.length?(t(),o("div",Pl,[r("div",Rl,[(t(!0),o(u,null,m(f.value,((e,a)=>(t(),o("div",{class:"dir-list-info",type:"image",key:a},[r("div",Yl,[h(L,{style:{width:"100%",height:"100px"},"preview-src-list":[e.src],src:e.src,fit:"cover",lazy:""},null,8,["preview-src-list","src"])]),r("div",{class:"dir-name",onClick:A((t=>{return a=e,void i.value.init(a);var a}),["stop"])},v(e.title),9,Tl)])))),128))])])):(t(),a(y,{key:1,description:"暂无内容",style:{"padding-top":"200px",color:"rgba(0, 0, 0, 1)"}}))])),_:1})])),[[M,w.value]])])])),_:1}),h(tl,{ref_key:"imageDialogDom",ref:i},null,512)])),[[M,D.value]])}}},[["__scopeId","data-v-3f469acd"]]);class Ol{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e){const{canvasDom:t}=this;if("selectionArea"===e)t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(t,"mousemove",(e=>{this.selectionAreaMoving(e)}));else this.clearHandle()}selectionAreaStart(e){const{offsetX:t,offsetY:a}=e;this.handleList.push({handleX:t,handleY:a,status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:t,offsetY:a}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=t,this.handleList[this.handleList.length-1].offsetY=a,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:t,canvasDom:a}=this,{width:l,height:i}=a;this.handleList=[],t.beginPath(),t.clearRect(0,0,l,i),t.closePath();const s=new Image;s.src=e,s.onload=()=>{this.initImageData(s),this.drawImage()}}initImageData(e){const{canvasDom:t}=this,{width:a,height:l}=t,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>a)if(s/l>i/a){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=a/2-n.width/2}else{const e=a/i;n.width=a,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/a;n.height=l,n.width=l/e,n.y=0,n.x=a/2-n.width/2}else{const e=a/l;n.width=a,n.height=a/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:t,y:a,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,t,a,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:t}=this,{width:a,height:l}=t;e.beginPath(),e.clearRect(0,0,a,l),e.closePath(),this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((({handleX:t,handleY:a,offsetX:l,offsetY:i,status:s})=>{e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const n=t>l?l:t,o=a>i?i:a,r=t>l?t-l:l-t,d=a>i?a-i:i-a;(r&&d||!s)&&(e.rect(n,o,r,d),e.stroke(),e.closePath())}))}getSelecttionAreaImages(){this.handleList.forEach(((e,t)=>{const{handleX:a,handleY:l,offsetX:i,offsetY:s,status:n,imageData:o}=e,{ctx:r}=this;if(n&&!o){const n=a>i?i:a,o=l>s?s:l,d=a>i?a-i:i-a,h=l>s?l-s:s-l;if(!d||!h)return;const c=r.getImageData(Math.round(n),Math.round(o),Math.round(d),Math.round(h)),u=document.createElement("canvas");u.width=d,u.height=h;u.getContext("2d").putImageData(c,0,0);const m=function(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:a})}(u.toDataURL("image/png"));e.imageData=new File([m],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}))}addListener(e,t,a){e.addEventListener(t,a);var l=t+"_"+a.toString();this.listeners[l]={element:e,eventType:t,listener:a}}removeAllListeners(){for(var e in this.listeners){var t=this.listeners[e];t.element.removeEventListener(t.eventType,t.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:t}=this,{width:a,height:l}=t;e.beginPath(),e.clearRect(0,0,a,l),e.closePath()}}const Wl=e=>(f("data-v-6401445c"),e=e(),w(),e),Zl={class:"super-image-search-body"},jl={class:"image-search-title"},Nl={key:3,class:"image-handle-area"},zl={class:"image-handle-item"},Hl=Wl((()=>r("div",{class:"image-handle-item"},null,-1))),Gl={class:"image-search-title-handle"},Ql={class:"content"},Bl={class:"search-btn-area"},ql=Wl((()=>r("br",null,null,-1))),$l={class:"image-search-title",style:{height:"30px"}},Jl=Wl((()=>r("div",null,"搜索结果",-1))),Kl={class:"image-search-title-handle"},ei={class:"content",style:{height:"calc(100% - 40px)"}},ti="https://u248120-bf23-b1506178.westc.gpuhub.com:8443";var ai=q({__name:"index",setup(l){const i=s(null),u=s(null),m=s(null),f=s(0),w=s(0),x=s(""),A=s([]),D=s(!1),C=s("图片搜索"),I=s(""),L=s(10),_=s(!1),V=e=>{ll(u.value,e).then((({file:e,url:t})=>{i.value=e,u.value=t,m.value.initImage(u.value)}))},S=e=>{u.value?(x.value=e,m.value.handleChange(e)):b.error("请在上传图片后操作")};const E=e=>{i.value=e;const t=new FileReader;return t.onload=({target:e})=>{u.value=e.result,m.value.initImage(u.value)},t.readAsDataURL(e),!1},Y=()=>{if(D.value=!0,"图片搜索"===C.value){let e=m.value.handleList;e.length?(e=>{let t=new FormData;e.forEach((({imageData:e})=>{t.append("files",e)})),_.value&&A.value.forEach((e=>{t.append("img_list",e.title)})),y.post(`${ti}/super_search?search_num=${L.value}`,t).then((e=>{const{data:t}=e;A.value=t.result.map((e=>({title:e,fileAddress:`${ti}/static/${e}`,width:1920,height:1080,src:`${ti}/static/${e}`}))),D.value=!1}))})(e):(()=>{const e=new FormData;e.append("file",i.value),_.value&&A.value.forEach((t=>{e.append("img_list",t.title)})),y.post(`${ti}/search?search_num=${L.value}`,e).then((e=>{const{data:t}=e;A.value=t.result.map((e=>({title:e,fileAddress:`${ti}/static/${e}`,width:1920,height:1080,src:`${ti}/static/${e}`}))),D.value=!1}))})()}else"描述搜索"===C.value&&(_.value&&JSON.parse(JSON.stringify(A.value)).map((e=>e.title)),y.post(`${ti}/text_search?text=${I.value}&search_num=${L.value}`).then((e=>{const{data:t}=e;A.value=t.result.map((e=>({title:e,fileAddress:`${ti}/static/${e}`,width:1920,height:1080,src:`${ti}/static/${e}`}))),D.value=!1})))},T=e=>{i.value=null,u.value=null,x.value="",I.value="",C.value=e,m.value.handleChange(""),m.value.clearAll()},U=e=>{w.value.init(e)},X=({fileAddress:e})=>{window.open(e)};return n((()=>{m.value=new Ol(f.value)})),(l,i)=>{const s=e("el-icon"),n=e("el-button"),y=e("el-dropdown-item"),b=e("el-dropdown-menu"),F=e("el-dropdown"),O=e("el-upload"),Z=e("el-input"),j=e("el-checkbox"),N=e("el-input-number"),z=e("el-form-item"),H=e("el-form"),G=e("el-scrollbar");return t(),o("div",Zl,[h(Nt,{leftStyle:{width:"calc(50% - 55px)"}},{left:c((()=>[r("div",jl,[r("div",null,[h(F,null,{dropdown:c((()=>[h(b,null,{default:c((()=>[h(y,{onClick:i[0]||(i[0]=e=>T("图片搜索"))},{default:c((()=>[g("图片搜索")])),_:1}),h(y,{onClick:i[1]||(i[1]=e=>T("描述搜索"))},{default:c((()=>[g("描述搜索")])),_:1})])),_:1})])),default:c((()=>[h(n,{type:"primary"},{default:c((()=>[g(v(C.value)+" ",1),h(s,{class:"el-icon--right"},{default:c((()=>[h(d(W))])),_:1})])),_:1})])),_:1}),""===x.value&&u.value?(t(),a(n,{key:0,type:"primary",class:"title-handle-btn",onClick:i[2]||(i[2]=e=>S("selectionArea")),style:{"font-size":"12px"}},{default:c((()=>[h(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(M))])),_:1}),g(" 框选区域 ")])),_:1})):p("",!0),"selectionArea"===x.value&&u.value?(t(),a(n,{key:1,class:"title-handle-btn",type:"warning",onClick:i[3]||(i[3]=e=>S("")),style:{"font-size":"12px"}},{default:c((()=>[h(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(M))])),_:1}),g(" 框选区域 ")])),_:1})):p("",!0),u.value?(t(),a(n,{key:2,class:"title-handle-btn",type:"primary",onClick:i[4]||(i[4]=e=>{m.value.clearSelectionArea()}),style:{"font-size":"12px"}},{default:c((()=>[h(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:c((()=>[h(d(k))])),_:1}),g(" 清空框选区域 ")])),_:1})):p("",!0),u.value?(t(),o("div",Nl,[r("div",zl,[h(n,{onClick:i[5]||(i[5]=e=>V("left")),size:"small"},{default:c((()=>[g(" 左旋90° ")])),_:1}),h(n,{onClick:i[6]||(i[6]=e=>V("right")),size:"small"},{default:c((()=>[g(" 右旋90° ")])),_:1}),h(n,{onClick:i[7]||(i[7]=e=>V("horizontal")),size:"small"},{default:c((()=>[g(" 水平镜像 ")])),_:1}),h(n,{onClick:i[8]||(i[8]=e=>V("vertical")),size:"small"},{default:c((()=>[g(" 垂直镜像 ")])),_:1})]),Hl])):p("",!0)]),r("div",Gl,["图片搜索"===C.value?(t(),a(O,{key:0,class:"upload-demo","before-upload":E,"show-file-list":!1,action:""},{default:c((()=>[h(n,{type:"text"},{default:c((()=>[g("上传图片")])),_:1})])),_:1})):p("",!0)])]),r("div",Ql,[P(r("canvas",{ref_key:"canvasDom",ref:f},null,512),[[R,"图片搜索"===C.value]]),P(h(Z,{style:{height:"100%"},type:"textarea",modelValue:I.value,"onUpdate:modelValue":i[9]||(i[9]=e=>I.value=e),placeholder:"请输入图片描述"},null,8,["modelValue"]),[[R,"描述搜索"===C.value]])])])),center:c((()=>[r("div",Bl,[r("div",null,[h(j,{modelValue:_.value,"onUpdate:modelValue":i[10]||(i[10]=e=>_.value=e),style:{"margin-bottom":"10px"}},{default:c((()=>[g("基于上次"),ql,g("结果搜索")])),_:1},8,["modelValue"]),h(n,{type:"primary",class:"title-handle-btn",onClick:i[11]||(i[11]=e=>Y()),disabled:!u.value&&!I.value,loading:D.value},{default:c((()=>[g("搜索")])),_:1},8,["disabled","loading"])])])])),right:c((()=>[r("div",$l,[Jl,r("div",Kl,[h(H,null,{default:c((()=>[h(z,{label:"搜索数量"},{default:c((()=>[h(N,{modelValue:L.value,"onUpdate:modelValue":i[12]||(i[12]=e=>L.value=e),min:1,controls:!1},null,8,["modelValue"])])),_:1})])),_:1})])]),r("div",ei,[h(G,null,{default:c((()=>[D.value?p("",!0):(t(),a(Za,{key:0,onHandleshowImage:U,onHandleOpenDir:X,columnCount:3,images:A.value},null,8,["images"]))])),_:1})])])),_:1},8,["leftStyle"]),h(tl,{ref_key:"imageDialogDom",ref:w},null,512)])}}},[["__scopeId","data-v-6401445c"]]);const li={__name:"addOrUpdate",emits:["review"],setup(l,{expose:i,emit:n}){s([]);const d=s(!1),v=s({}),p=s("add"),f=s(["普通会员","超级会员"]),w=s(!1),b=n;return i({init:(e="add",t={name:"",valid_days:0,account_type:"普通会员",available_images:0})=>{v.value=t,p.value=e,d.value=!0}}),(l,i)=>{const s=e("el-input"),n=e("el-form-item"),p=e("el-input-number"),x=e("el-option"),A=e("el-select"),D=e("el-form"),k=e("el-button"),C=e("el-dialog");return t(),a(C,{title:"激活码",modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=e=>d.value=e),"show-close":!1,width:"400","before-close":l.handleClose},{footer:c((()=>[r("div",null,[h(k,{onClick:i[4]||(i[4]=e=>(w.value=!0,void y.post("https://u248120-bf23-b1506178.westc.gpuhub.com:8443/add_account",v.value).then((()=>{b("review"),w.value=!1,d.value=!1})).catch((e=>{e.includes("Network Error")?ElMessage.error("网络错误"):ElMessage.error("未知错误")})))),loading:w.value},{default:c((()=>[g("保存")])),_:1},8,["loading"])])])),default:c((()=>[h(D,{"label-width":"100px"},{default:c((()=>[h(n,{label:"用户名"},{default:c((()=>[h(s,{modelValue:v.value.username,"onUpdate:modelValue":i[0]||(i[0]=e=>v.value.username=e)},null,8,["modelValue"])])),_:1}),h(n,{label:"有效时长"},{default:c((()=>[h(p,{modelValue:v.value.valid_days,"onUpdate:modelValue":i[1]||(i[1]=e=>v.value.valid_days=e),controls:!1,precision:0,step:1,min:0},null,8,["modelValue"]),g("  天 ")])),_:1}),h(n,{label:"会员类型"},{default:c((()=>[h(A,{style:{width:"100%","text-align":"left"},modelValue:v.value.account_type,"onUpdate:modelValue":i[2]||(i[2]=e=>v.value.account_type=e)},{default:c((()=>[(t(!0),o(u,null,m(f.value,(e=>(t(),a(x,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(n,{label:"可用图片数量"},{default:c((()=>[h(p,{modelValue:v.value.available_images,"onUpdate:modelValue":i[3]||(i[3]=e=>v.value.available_images=e),controls:!1,precision:0,step:1,min:0},null,8,["modelValue"]),g("  张 ")])),_:1})])),_:1})])),_:1},8,["modelValue","before-close"])}}};const ii=e=>(f("data-v-8349d3ee"),e=e(),w(),e),si={class:"table-handle-area"},ni={class:"table-handle-info-area"},oi={class:"table-area"},ri={class:"table-area-info"},di={class:"table-area"},hi=ii((()=>r("br",null,null,-1))),ci=ii((()=>r("br",null,null,-1))),ui={class:"pagination-body"},mi="https://u248120-bf23-b1506178.westc.gpuhub.com:8443";var gi=q({__name:"index",setup(l){const i=s([]),d=s(1),u=s(10),m=s(!1),f=s(0),w=s([]);s(["普通会员","超级会员"]);const x=()=>{y.get(`${mi}/get_accounts`).then((({data:e})=>{w.value=e,A()})).catch((e=>{}))},A=()=>{const e=JSON.parse(JSON.stringify(w.value)).filter((({"用户名称":e})=>!k.value||e.includes(k.value)));i.value=e.splice((d.value-1)*u.value,(d.value-1)*u.value+u.value)},D=()=>{d.value=1,A()},k=s(null);return n((()=>{x()})),(l,s)=>{const n=e("el-input"),u=e("el-col"),C=e("el-button"),I=e("el-row"),L=e("el-table-column"),M=e("el-switch"),V=e("el-table"),S=e("el-pagination"),E=O("loading");return P((t(),o("div",{class:"main-body","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[r("div",si,[r("div",ni,[h(I,{gutter:20},{default:c((()=>[h(u,{span:4},{default:c((()=>[h(n,{onInput:D,placeholder:"用户名称",modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e),clearable:""},null,8,["modelValue"])])),_:1}),h(u,{span:12},{default:c((()=>[g("   ")])),_:1}),h(u,{span:8,style:{"text-align":"right"}},{default:c((()=>[h(C,{type:"primary",onClick:s[1]||(s[1]=e=>{f.value.init()})},{default:c((()=>[g("添加激活码")])),_:1})])),_:1})])),_:1})])]),r("div",oi,[r("div",ri,[r("div",di,[h(V,{data:i.value,border:"",height:"100%"},{default:c((()=>[h(L,{label:"用户名称",prop:"用户名称",align:"center"}),h(L,{label:"激活码",prop:"API",align:"center"},{default:c((({row:e})=>[g(v(e.API)+" ",1),h(C,{type:"text",size:"small",onClick:t=>{return a=e.API,(l=document.createElement("textarea")).style.position="fixed",l.style.opacity=0,l.value=a,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),void b.success("复制成功");var a,l}},{default:c((()=>[g(" 复制 ")])),_:2},1032,["onClick"])])),_:1}),h(L,{label:"注册时间",prop:"注册时间",align:"center"}),h(L,{label:"到期时间",prop:"到期时间",align:"center"}),h(L,{label:"会员类型",prop:"会员类型",align:"center"},{default:c((({row:e})=>[g(v(e.会员类型)+" ",1),"普通会员"===e.会员类型?(t(),a(C,{key:0,type:"text",size:"small",onClick:t=>{return a=e.用户名称,m.value=!0,void y.post(`${mi}/upgrade_account`,{username:a}).then((()=>{x(),m.value=!1})).catch((e=>{}));var a}},{default:c((()=>[g("升级")])),_:2},1032,["onClick"])):p("",!0)])),_:1}),h(L,{label:"注册图片数目",prop:"注册图片数目",align:"center"}),h(L,{label:"可用图片数目",prop:"可用图片数目",align:"center"}),h(L,{label:"是否停用",align:"center",fixed:"right"},{default:c((({row:e})=>[h(M,{size:"small",modelValue:e.是否停用,"onUpdate:modelValue":t=>e.是否停用=t,onChange:t=>{return a=e.用户名称,m.value=!0,void y.post(`${mi}/ban_account`,{username:a}).then((()=>{m.value=!1})).catch((e=>{}));var a}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),h(L,{label:"操作",align:"center",fixed:"right"},{default:c((({row:e})=>[h(C,{size:"small",style:{"margin-bottom":"5px"},onClick:t=>{return a=e.用户名称,void _.prompt("请输入延长时间","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/[0-9]?/,inputErrorMessage:"请输入数字"}).then((({value:e})=>{m.value=!0,y.post(`${mi}/span_account`,{username:a,days:e}).then((()=>{m.value=!1,x(),b.success("修改成功")})).catch((e=>{}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var a}},{default:c((()=>[g("延长时间")])),_:2},1032,["onClick"]),hi,h(C,{size:"small",style:{"margin-bottom":"5px"},onClick:t=>{return a=e.用户名称,void _.prompt("请输入增加数量","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/[0-9]?/,inputErrorMessage:"请输入数字"}).then((({value:e})=>{m.value=!0,y.post(`${mi}/addImg_account`,{username:a,available_images:e}).then((()=>{m.value=!1,x(),b.success("修改成功")})).catch((e=>{}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var a}},{default:c((()=>[g("增加次数")])),_:2},1032,["onClick"]),ci,h(C,{type:"danger",size:"small",onClick:t=>{return a=e.用户名称,m.value=!0,void y.post(`${mi}/delete_account`,{username:a}).then((()=>{m.value=!1,x()})).catch((e=>{}));var a}},{default:c((()=>[g("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r("div",ui,[h(S,{small:"",modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=e=>d.value=e),onCurrentChange:s[3]||(s[3]=e=>A()),background:"",layout:"prev, pager, next",total:w.value.length},null,8,["modelValue","total"])])])])]),h(li,{ref_key:"addOrUpdateDom",ref:f,onReview:x},null,512)])),[[E,m.value]])}}},[["__scopeId","data-v-8349d3ee"]]);const vi={},pi={class:"main-body"},fi=[(e=>(f("data-v-7883bf73"),e=e(),w(),e))((()=>r("iframe",{src:"http://47.88.56.24:5006/"},null,-1)))];var wi=q(vi,[["render",function(e,a){return t(),o("div",pi,fi)}],["__scopeId","data-v-7883bf73"]]);const yi="_AICLOTH_CONSOLE_",bi="_AICLOTH_CONSOLE__token";function xi(e){localStorage.setItem(yi+"USER",JSON.stringify(e))}function Ai(){const e=Z.get(bi);return""!==e||void 0!==e||null!==e?e:null}function Di(e,t){localStorage.setItem(yi+e,JSON.stringify(t))}const ki=y.create({baseURL:"http://www.weishih-ai.com:10010/dev-api",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function Ci(e){if(!e.response)return b.error({message:"请求超时",description:`${e.toString()}`}),Promise.reject(e);Ai();const t=e.response.status,a=e.response.data,{userStore:l}=Mi;return 401===t?(b.error({message:"登录失效, 请重新登陆"}),l.handleLogout().then((()=>{setTimeout((()=>{Vi.replace("/login")}),1500)}))):400!==t&&500!==t||b.error({message:a.message}),Promise.reject(e)}ki.interceptors.request.use((e=>{const t=Ai()||"22";return t&&e.headers&&(e.headers["X-Auth-Token"]=t),e}),Ci),ki.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),Ci);const Ii=j({id:"users",state:()=>({user:null,permissions:null,token:"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((t,a)=>{var l;(l=e,ki.post("/sso/api/v1/session/login",l)).then((e=>{const a=e.token;var l;this.token=a.token,this.user=a.user,this.workingTenant=a.working_tenant,Di("workingTenant",a.working_tenant),xi(a.user),l=a.token,Z.set(bi,l,{expires:1}),t({...a.user,needPasswd:e.need_passwd}),ki.get("/sso/api/v1/roles").then((e=>{Di("roles",e.roles||[])}))})).catch((e=>{a(e)}))}))},handleLogout(e=""){return new Promise(((e,t)=>{Z.remove(bi),localStorage.removeItem(yi+"USER"),this.user=null,this.permissions=null,this.token="",xi(null),e(null)}))},getUserInfo(){return new Promise(((e,t)=>{ki.get("/sso/api/v1/accounts/get").then((t=>{const a=function(){const e=localStorage.getItem(yi+"USER");return e&&"undefined"!==e?JSON.parse(e):null}()||{};Object.assign(a,t),this.user=a,xi(a);const l=[].concat([a.sys_role]);window.localStorage.setItem("ROLE_PERMISSIONS_LIST",JSON.stringify(l)),this.permissions=l,e(a)})).catch((e=>{t(e)}))}))}}});const Li={"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:Ii,setupStore:function(e){return Ii(e)}},Symbol.toStringTag,{value:"Module"}))},_i=N(),Mi={};Object.keys(Li).forEach((e=>{const t=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];Mi[`${t}Store`]=Li[e].setupStore(_i)}));var Vi=z({history:H("/"),routes:[{path:"/",name:"home",component:ve,redirect:"/ImageGenerationImage",children:[{path:"imageSearch",name:"imageSearch",component:bl},{path:"gallery",name:"gallery",component:Fl},{path:"superImageSearch",name:"superImageSearch",component:ai},{path:"activationKeys",name:"activationKeys",component:gi},{path:"ImageGenerationImage",name:"ImageGenerationImage",component:it},{path:"swapFace",name:"swapFace",component:Wt},{path:"partialModifications",name:"partialModifications",component:ma},{path:"trainModel",name:"trainModel",component:wi}]}]});if("undefined"!=typeof window){let e=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML="",e.insertBefore(t,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const Si=G($);Si.use(N()),Si.use(Vi),Si.use(Q,{locale:B}),Si.mount("#app");
