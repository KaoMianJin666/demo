import{r as e,o as a,c as t,u as l,a as i,b as s,d as n,e as o,f as r,g as d,h as c,w as u,F as h,i as m,j as g,t as v,k as p,p as f,l as w,m as y,E as b,n as k,q as x,s as D,v as C,x as A,y as _,z as I,A as L,B as V,C as M,D as S,G as E,H as P,I as R,J as T,K as Y,L as F,M as U,N as X,O,P as Z,Q as W,R as z,S as N,T as j,U as H,V as $,W as G,X as B,Y as Q,Z as q}from"./lib.fd02c427.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?a.credentials="include":"anonymous"===e.crossorigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();var J=(e,a)=>{const t=e.__vccOpts||e;for(const[l,i]of a)t[l]=i;return t};var K=J({},[["render",function(l,i){const s=e("RouterView");return a(),t(s,{id:"main-view"})}]]);const ee=e=>(f("data-v-df5e462e"),e=e(),w(),e),ae={class:"nav-bar-body"},te={class:"logo-area"},le=["src"],ie={class:"router-link-area"},se={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ne=[ee((()=>r("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),ee((()=>r("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],oe={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},re=[ee((()=>r("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),ee((()=>r("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],de={width:"14",style:{"margin-right":"10px"},height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ce=[ee((()=>r("path",{d:"M1 6.36368L7 1.45459L13 6.36368V14H1V6.36368Z",stroke:"white","stroke-width":"1.2"},null,-1))),ee((()=>r("path",{d:"M4.82031 10.7272C4.82031 9.52224 5.79715 8.54541 7.00213 8.54541V8.54541C8.20712 8.54541 9.18395 9.52224 9.18395 10.7272V14H4.82031V10.7272Z",stroke:"white","stroke-width":"1.2"},null,-1)))],ue=ee((()=>r("div",{class:"user-phone-no"},"188 8888 8888",-1))),he=ee((()=>r("div",{class:"line"},null,-1))),me=ee((()=>r("div",{class:"logout-btn"},[r("span",null,"退出")],-1)));var ge=J({__name:"navBar",setup(f){const w=l(),y=i(),b=[{name:"图生图",path:"ImageGenerationImage"},{name:"AI换脸",path:"swapFace"},{name:"AI换背景",path:"partialModifications"},{name:"识图",path:"imageSearch",children:[{name:"AI识图",path:"imageSearch"},{name:"图库",path:"gallery"},{name:"超级识图",path:"superImageSearch"},{name:"激活码管理",path:"activationKeys"}]},{name:"识图训练",path:"imageSearchTrain",children:[{name:"数据集",path:"imageSearchTrainDataset"},{name:"训练",path:"imageSearchTrain"},{name:"测试",path:"imageSearchTrainCheck"}]},{name:"模型训练",path:"trainModel"}];let k=s("ImageGenerationImage");const x=e=>{w.push(e)};return n((()=>{k.value=y.name})),(l,i)=>{const s=e("el-menu-item"),n=e("el-sub-menu"),f=e("el-menu");return a(),o("div",ae,[r("div",te,[r("img",{src:d("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVQAAABSCAYAAAALvCwcAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ4IDc5LjE2NDAzNiwgMjAxOS8wOC8xMy0wMTowNjo1NyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MThBRjRERjM3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MThBRjRERjQ3Q0I5MTFFRTlDQ0FEMTY4RDhCNTg0RkYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxOEFGNERGMTdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOEFGNERGMjdDQjkxMUVFOUNDQUQxNjhEOEI1ODRGRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgnCosYAAA7KSURBVHja7F3tUeM6FBUM/zdbwYYKllcBpgJCBZgKgAowFRAqIFQAVJBsBWQriF8FZCvg+cI1T/HakmxLsmyfM+OBIcGW9XF0vyXe399FfoWArB1Rdi3fP/GaXecCAAAgcHxwaCiEmj1/KhFpEQ/0OYYMAAAQqroRk+y6eTfDHYgVAAAQankDLrPr7b0eNjADAAAAQv3/wZFCva9DrEcYRgAARkmobCd9ercL2FcBABgPoUp20rd3d7jBkAIAMGhCze4bs3ruA7CvAgAwPEJlqXT53g1eYQYAAMA3oe47vH+cXVFH70bOqg3sqwAA+IRLQj0N4P2I1JewrwIA0HdCDQUkoSawrwIAAEK1S6wLDtuCGQAAABCqBcwE7KsAAIRAqJwu+sQe/FmP3z0Wn/ZVmAEAALCCPTlcam9vT0WkUfbjTnx60GWcZP+3Kvn+UnTn5a+LNLuusvd4GcrA8mZXlZq7yd71EdO/tN+eWIspw0vWb7NcsCjp38eytVDz+ZFi3aza3r+H4zHJfkyUJLa3lwbSVn0cqqas3kfqZ8X/LS3HlS49JAgEZQbgWN5Xfu+yK1L870LxnktQZ6N+20jfm5d8nlh4vmqORxgPM/7R3HOpWFOnbQj1QLMz0C58pdshHOM224ESqU3UHldhUGQGiHlhPHa982XP32ZtSRUSE/19JQCbWGdXlRloUtBqivhhQTpVbejnDU1UX5IzCwwuNtSz7BlrB1qW7n1vG9x6qujn763F1KKEyumipnn3LiXUZ4XUvBhDGitX5qrCG28ykFDt9XesmRcTxfdeHUtjTREX1o4LRA7GYmNbOjW4b1zjPlOuUTLPuXS/TL3Pfn3oWCqVpYVSm0l20YufVEgKNkA72II7vzMzAEsWK4XEFIMG3c+5wryo+t6kBXlMDaSxUW1sGml921A6tSXkEE+SCYi02W/5Z0WVn4g0JDvNsQHZHHLn32gGoA2xPjB5d4UXxbjQIpxjCVrDVvP5EZNpqiDbJojQ9TvQmfXuSbBis0CV3XNly/lqagI9CHxQaScg7/tcQ6wkSa74ZS9dtKPjfljwBCsbyCPaMcfm/XWoEaSaQkET/h7Zt2/LFh595oBAxiSd6oSjNPer8AYYK4ShxxbtmLDAMjPlgIMe9C+dI0WS6rXKScSfXbE9IxmS+sSL91GxWVyKATinAoqwSBUL+qfUzkUZ4RIh1yFVA2fUmMh0yoKRCon0+5pJdVIhkNXd4CYcEmdMon0jVMEvNyOjvfj0+uuINWaJ9WZAE/VZQahRC8kopIW06UFTY6G3W9Pcq2MionG70HznXLHAaW68aNrTFyRCbYtOZTWehY21om9mFRtfpQDXpvEHPVt3MZNHorONkBlAfDqVcjNAr4mVVHreJKIKNfSqsHMD/RnbtdA4wzRe9N88321I5icasnGWHWnomLsu+ZvKx3Bck1BboY+5/FPxv/f93GCyznmSDCEzSCWFXAoAaE/uadWVffzHg3SqwiJrx3OFhK7Sbl1hy2R964NQXaufObFqs5ukMKtD0W9b40LRr5MxZtIMASbxpxrJ7cYgTjQJ9N0jvm4MpNNf0ve/LuYCn+siD9k6zHjlQjZBulT5XxzvDrIZwCi7iT87cRxm5VJ6IHvRoai2MW1BT0DPUCfJ5KHhMyJLghTd41YVUWNDQp1WLP4dUdgDiFCXhmYAUh0OuX29IiEiVYVaBkIFgL9x3EISJfIk/8T3bH2d6MITbUioR4rFn7BnPhF+wphyMwA9T5tb3EH7TNWgpctxEZ+xqy7STy9CqfwDALKEWiMKZs3aNRHnuq6QYoNQyUZxXuV17yiMiZ7xWjPMKmH1o6x9vkkicnz/iQgsiYMD6g8DU0Wr5qpv7QtoD9Pwqfs2ERO2bKhUyuyXhrgWwn8YU5yTZfb8W92CFtVprNeYj35INSAtIVXNUUjivVT7F64fYotQSeJZGsaHzrmKlE81O2GiNIpf5fbRjkZFD34jrXOU+Ffx2ZHlZ80Viz3PIddpFClLzani87FLqBcG3zvWpB5XgThju1f453cLDdeq2ZIUQBKA74IsZCM5C1nCeG84ogHgcCiSG5uAqvLryTH43UMbyrQlHakqhQZNRtpWo42psrVOmggedcrlWcAzR8psHGjIFOu+2qmHark+4p1pbjbXlnRdjT/o6vxFQu0ppmIgMK2L6uC5E66xuWlby7dsPPpUD9Xh2LrgmkhZsd8CyFY6q5kmmrB646MWK+2M1AkLnX0V6IbQRPNwlyYoalU67+5EWAq5Y+I7FQ0LcpRgmpsQ2Bn8kesPu697uFD5q1SRCxOVgCdXIvyGMWlVpQ7UzTbI7W5VoHH45eC+1lR+jtDwOQd2VFaDYi0zW4c6NnjXR0kFr7NhJA6L0Jw09TVwCJ9L7Waete1ellBdqfy+iqNQ45cWw5hctG/BxWqvAzhLKmm5QKca4vvV5BkG9x0SdNLn947aJZ+xth3IeEwdr3NvY+W7OAqpcRvO29WRSsrZTBfCn4dyxu176Lk9UNf2VwHo5t9WM++OPDdpy5t9IrWRzGowVwWEgxJVMPLw3CZhTC5POy0jfqMygYFCt9j/xdRvLaV+89gOWpelWWhStp/T0noDw9qBkLYtI9SLDtRs2nFPNGaALZMwTRz6/nlI7QsQ55pNao01ZYTfis3JtYSa55Hf62yTPDfP2NMea8Y/Lznn20QSkvZx5uK+f3n5pWyhnLR8Eeumpn2VvvvgsX1dH9JXZ1Anun6piHP9juIqtUhi4uh5K74e645HfkIur18i11P+OSkIJxdjHlQ+frpqjczbOBt3vPzZjeSHToV/b/uWX+jWsGNi4ak+wJ7cOWFPlkjUK4mW41bnqDLwENv08kc1xvVOQXC3hurdqth2nl+qknFWNiF+V0oWWDuy3R/x2kodrY205furvO73htLvqUJr2Jnbmudd1M3lpzH7OtxRDuyv+nJ2vXoOEDeqxi+1b+66QT3afZ8avuKbYV8HF9ivCdSOWtx3pnnfI8/vEiQcv/PU8B4L0+LamufFppqglJD0kKv8+ya7T3b9I/x626kTF0wOU4P2kcOKIgKGcMxJW0ln1lSFRcX/v6CzNR+hi0a3xiYcpbQRJWZH47CpQlFmXzAOY5KOOfFJ/KFBt7s+a0gVZ8P/rcpuQaidYsqakfISjqMuOLX0iYk0qTIx7TeYZEkH0iARRd1q/NdjIlbDEyMf2SZVhchVjnqPkWo0KcAtlkxiumvmYE1FXFfhjdsxExpnZKPAfkka/KcDMwBJrKcGbRzSaacm0J23k7IXeK6Ruq6whnfwW/HZT3TP4PAzL07DJJqIGhEd+2WSTnZdchqmjrTWHWQzEbE+NzjtdLDSKtt0Is3XEu6TPDSnCjiOehdrjToKiX5YuOK10kj72C8szBmLzyTFPJl62znMgKRBn/ZVIsoN7yZaYuX2DY5U+d11UmVayPhSqf1wTu1ipfncZ0UsCunxDtGTGOwQUJRQ7yrU7KWhNJgI//ZVeqbWvsqkOqi8Zx6TpYFKkhT6YqUhCjinpM1I8znIZrzYMqd8FeU+KCHQMkSifjbTSvg9lM/ktNNnoQ4C7xuZPhn0b1pRj+BFYSaoc0rkoMEV3mk+VXn0fdpRjzsKif4R8Ib2pVl5XNf5yajzv9ZIg4r9Gz5oz3Thd1GN/07Rnte+B/bXTLaYVtyDVPs302Bo6bmjCeyX7q9LHJl4ehcE9lffw1Zgf2XiC/ttIkUbGnn56QXvGthXfZoBrhRt67XUJan5JjGQldoE76yqMbmEw2VHIlEB8ajDVemJv8jpTmnV2iL5bQpM52p2JOoVjfZVZiwSAwuZYqfhnaEZZW1QRJomyzfNGKMy1aepSBWWRuOyQjcNZvMkdX7V5AQCGxX7YyZLigy4NyDWM59FTQZCpFNR73TYj3420B7WApWHpoUN5OOnXCDDwI5KcdGI33WDpaFVwZY2dV+3OIptQv1Ss0XYh/L1dcHf8aZl2kekppwM8UC2CvLTOSNupBMiyv5fJb3L+KUgVLItR03PVAK0mnBvcODg5XOivDAojOu7aHRfiCM/DO+q5mbTazIt1Kk0JUwdIkvNexbqpIfIg9p/ze3wjUjoM/EAB4QqE2vIh/KFTipxg3/NybTPNs8o1PEn4YAPxasi93NRiPd1gG0Xm2X23umIluC0YWQIrbut61NPY4ks71VxjYXTAsYcWN6ETNM2kqmjY3WHiEeFlOpD7Z90FJo2JpPcTUP+KT1GeiXcHNKX5MRqYF8lM8Cx8HNYYJ3dJ1TQmF0M0WYaIHRqv2tv/534O5sRCAjFOFSXRU5oZ82rRel22ZBO5aT+OAt0/OhY4ROQqT+1X6jjmM8Ru2sdJPkdGlzPITR2v6h2eygiTWSqKxr9I4C+yfN0/wmQsFbcrjnWm5NxV433vUY1jtGFdgUa5iXllX3vTwiNPVCo3Qvh1vtOE4/CrHYO5TMsRedDtbsOkEipPVqzycjIb1v4Xf7bH+n3tNCPO3+rMdY0N1Q2NopJxUY3Uhwo1BuaYHnAvkkRjiagHT3hQP+UnzH1sAhVkt9tgPGE1DdEovOBFyy55zlhi/xcqP1rLvxTtelHiEkFoSonkPj0vsfCXXaTDyLNQQHaszL1PkAVOlSCd0VWfZHsbjVa1I1o7pxKBeBDQOmGUKXJvuCdORY9DmuiRcuOg3OWhu4Dk/xWTPo+23Qt7ITGjKLcH8ekKlN2m5Y/JCfjCAlONf9M+3Ch2MTWPvr4I0VWLt9X4x+nmnJZIQCZHQAAeEPT8n3yWU1nUFEAAAA+sd/mnzNSfe7gkD4AAIDhEapErGS/GNORzQAAAG4ItWAGCCVrYYXhBQDAK5o4pQzvG3d4Ps6mq/ONAAAYL5c6I1TpIYnmMDibeOPnIZ8aAIDhESo/yEeY1QOIFACAwRNqgVhtmwGWNo4KBgAA6BWhSg+2YV81OsYaAABg0IQqNSCBnRQAABCqXTOAqX31Cd57AABAqPrGRAozAOykAACAUBs0Sravknp/haECAACE2tIUgCECAKBPhPqfAAMAs4iqNjzWgLIAAAAASUVORK5CYII=")},null,8,le)]),r("div",ie,[c(f,{"background-color":"#22335D","text-color":"#ffffff","default-active":d(k),class:"el-menu-demo",mode:"horizontal",onSelect:x},{default:u((()=>[(a(),o(h,null,m(b,((e,l)=>(a(),o(h,{key:l},[e.children?p("",!0):(a(),t(s,{key:0,index:e.path},{default:u((()=>[(a(),o("svg",se,ne)),g(" "+v(e.name),1)])),_:2},1032,["index"])),e.children?(a(),t(n,{key:1,index:String(l)},{title:u((()=>[(a(),o("svg",oe,re)),g(" "+v(e.name),1)])),default:u((()=>[(a(!0),o(h,null,m(e.children,(e=>(a(),t(s,{index:e.path,key:e.path},{default:u((()=>[(a(),o("svg",de,ce)),g(" "+v(e.name),1)])),_:2},1032,["index"])))),128))])),_:2},1032,["index"])):p("",!0)],64)))),64))])),_:1},8,["default-active"])]),r("div",{class:"handle-area"},[ue,he,r("div",{class:"user-profile-image"},[r("img",{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"})]),me])])}}},[["__scopeId","data-v-df5e462e"]]);const ve={class:"home-body"},pe={class:"home-child-view"};var fe=J({__name:"index",setup:t=>(t,l)=>{const i=e("router-view");return a(),o("div",ve,[c(ge),r("div",pe,[c(i)])])}},[["__scopeId","data-v-f24c8a92"]]);const we=e=>(f("data-v-12f4ca72"),e=e(),w(),e),ye={class:"main-body"},be={class:"image-area"},ke=we((()=>r("div",{class:"main-title"},"参考图",-1))),xe={class:"image-all"},De={class:"image-item upload-image-area"},Ce={class:"upload-text-tips"},Ae=we((()=>r("div",{class:"upload-text"},"点击上传",-1))),_e={class:"other-images"},Ie={class:"other-images-view-box"},Le={class:"del-btn"},Ve={class:"image-handl-area"},Me=we((()=>r("label",null,"权重",-1))),Se=we((()=>r("div",{class:"main-title"},null,-1))),Ee={class:"bottom-area"},Pe={class:"handle-area"},Re=we((()=>r("div",{class:"main-title"},"正向提示词",-1))),Te={class:"handle-item"},Ye=we((()=>r("div",{class:"main-title"},"负向提示词",-1))),Fe={class:"handle-item"},Ue={class:"handle-item"},Xe={class:"handle-min"},Oe=we((()=>r("div",{class:"main-title"},"风格",-1))),Ze={class:"handle-min"},We=we((()=>r("div",{class:"main-title"},"相似度",-1))),ze={class:"handle-min-slider"},Ne={class:"handle-min"},je=we((()=>r("div",{class:"main-title"},"宽度",-1))),He={class:"handle-min"},$e=we((()=>r("div",{class:"main-title"},"高度",-1))),Ge=we((()=>r("div",{class:"main-title"},"线稿参考图",-1))),Be={class:"handle-item bg"},Qe={class:"line-draft-image-area"},qe={class:"upload-image-area-other"},Je=["src"],Ke={key:1,class:"upload-text-tips"},ea=we((()=>r("div",{class:"upload-text"},"点击上传",-1))),aa={class:"image-handl-area"},ta=we((()=>r("label",null,"权重",-1))),la={class:"generate-btn"},ia={class:"review-area"},sa="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var na=J({__name:"index",setup(l){const i=s([]),v=s(null),f=s(null),w=s([]),_=s(null),I=s(70),L=s(""),V=s(""),M=s(1024),S=s(1024),E=s(70),P=s(""),R=e=>{const a=new FileReader;return a.onload=({target:a})=>{i.value.length>=5||i.value.push({file:e,url:a.result,weight:100})},a.readAsDataURL(e),!1},T=e=>{v.value=e;const a=new FileReader;return a.onload=({target:e})=>{f.value=e.result},a.readAsDataURL(e),!1},Y=()=>{v.value=null,f.value=null},F=()=>{if(!i.value.length)return b.error("请至少上传一张参考图"),!1;if(!_.value)return b.error("请选择风格后操作"),!1;const e=(()=>{const e=new FormData;return e.append("base_model",_.value),v.value&&(e.append("lineart",v.value||""),e.append("lineart_weight",I.value/100)),e.append("positive_prompt",L.value),e.append("negative_prompt",V.value),e.append("ref",E.value/100),e.append("width",M.value),e.append("reheight",S.value),i.value.forEach((({weight:a,file:t})=>{e.append("weights",a/100),e.append("files",t)})),e})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${sa}/img2img/gen`,e).then((e=>{a.close(),P.value=`${sa}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{y.get(`${sa}/img2img/base_models`).then((e=>{Object.keys(e.data).forEach((a=>{w.value.push({name:a,value:e.data[a]})}))}))})),(l,s)=>{const n=e("el-icon"),v=e("el-upload"),y=e("el-image"),b=e("el-slider"),k=e("el-scrollbar"),U=e("el-input"),X=e("el-option"),O=e("el-select"),Z=e("el-input-number"),W=e("el-button");return a(),o("div",ye,[r("div",be,[ke,r("div",xe,[r("div",De,[c(v,{class:"avatar-uploader",drag:"",multiple:"",limit:5,disabled:i.value.length>=5,action:"","show-file-list":!1,"before-upload":R},{default:u((()=>[r("div",Ce,[c(n,{class:"avatar-uploader-icon"},{default:u((()=>[c(d(D))])),_:1}),Ae])])),_:1},8,["disabled"])]),r("div",_e,[c(k,null,{default:u((()=>[r("div",Ie,[(a(!0),o(h,null,m(i.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[c(y,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),r("div",Le,[c(n,{style:{color:"red"},onClick:e=>(e=>{i.value.splice(e,1)})(t)},{default:u((()=>[c(d(C))])),_:2},1032,["onClick"])]),r("div",Ve,[Me,c(b,{modelValue:e.weight,"onUpdate:modelValue":a=>e.weight=a,style:{width:"calc(100% - 50px)"},min:0,max:100,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])])),_:1})])])]),Se,r("div",Ee,[r("div",Pe,[c(k,null,{default:u((()=>[Re,r("div",Te,[c(U,{type:"textarea",modelValue:L.value,"onUpdate:modelValue":s[0]||(s[0]=e=>L.value=e),maxlength:"255"},null,8,["modelValue"])]),Ye,r("div",Fe,[c(U,{type:"textarea",modelValue:V.value,"onUpdate:modelValue":s[1]||(s[1]=e=>V.value=e),maxlength:"255"},null,8,["modelValue"])]),r("div",Ue,[r("div",Xe,[Oe,c(O,{modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e)},{default:u((()=>[(a(!0),o(h,null,m(w.value,(e=>(a(),t(X,{key:e.name,value:e.value,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),r("div",Ze,[We,r("div",ze,[c(b,{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=e=>E.value=e)},null,8,["modelValue"])])]),r("div",Ne,[je,c(Z,{style:{width:"100%"},modelValue:M.value,"onUpdate:modelValue":s[4]||(s[4]=e=>M.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])]),r("div",He,[$e,c(Z,{style:{width:"100%"},modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=e=>S.value=e),controls:!1,min:1,max:2048},null,8,["modelValue"])])]),Ge,r("div",Be,[r("div",Qe,[r("div",qe,[c(v,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":T},{default:u((()=>[f.value?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:s[7]||(s[7]=x((()=>{}),["stop"]))},[r("img",{src:f.value,class:"avatar"},null,8,Je),r("div",{class:"upload-image-del-btn-area",onClick:s[6]||(s[6]=x((()=>{}),["stop"]))},[r("div",{class:"upload-image-del-btn",onClick:x(Y,["stop"])},[c(n,null,{default:u((()=>[c(d(A))])),_:1})])])])):(a(),o("div",Ke,[c(n,{class:"avatar-uploader-icon"},{default:u((()=>[c(d(D))])),_:1}),ea]))])),_:1})]),r("div",aa,[ta,c(b,{style:{width:"calc(100% - 50px)"},disabled:!f.value,modelValue:I.value,"onUpdate:modelValue":s[8]||(s[8]=e=>I.value=e),min:0,max:100,size:"small"},null,8,["disabled","modelValue"])])])])])),_:1}),r("div",la,[c(W,{style:{width:"100%"},type:"primary",onClick:s[9]||(s[9]=e=>F())},{default:u((()=>[g("生成")])),_:1})])]),r("div",ia,[P.value?(a(),t(y,{key:0,fit:"scale-down",src:P.value,"preview-src-list":[P.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):p("",!0)])])])}}},[["__scopeId","data-v-12f4ca72"]]);function oa(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}class ra{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,a){const{canvasDom:t}=this;switch(this.clearHandle(),e){case"selectionArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(t,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"clearArea":t.style.cursor="none",this.addListener(t,"mousedown",(e=>{this.clearAreaStart(e,a)})),this.addListener(t,"mouseup",(e=>{this.clearAreaFinish(e,a)})),this.addListener(t,"mousemove",(e=>{this.clearAreaMoving(e,a)}));break;default:this.clearHandle()}}clearAreaStart(e,a){const{offsetX:t,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:s,handleX:t,handleY:l,type:"clearArea",clearType:a,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:a,offsetY:t}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.arc(a,t,s,0,2*Math.PI),l.stroke(),l.closePath()}clearAreaMoving(e){const{offsetX:a,offsetY:t}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:a,offsetY:t,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t;this.handleList=[],a.beginPath(),a.clearRect(0,0,l,i),a.closePath();const s=new Image;s.src=e,s.onload=()=>{this.initImageData(s),this.drawImage()}}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a,imageData:t}=this,{image:l}=t,{width:i,height:s}=a;e.beginPath(),e.clearRect(0,0,i,s),e.closePath(),l&&(this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((a=>{let{type:t}=a;if("selectionArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n}=a;e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const o=t>i?i:t,r=l>s?s:l,d=t>i?t-i:i-t,c=l>s?l-s:s-l;if((!d||!c)&&n)return;e.rect(o,r,d,c),e.stroke(),e.closePath()}if("clearArea"===t){let{clearType:t,dataList:l,offsetX:i,offsetY:s,radius:n}=a;"arc"==t&&(e.beginPath(),e.globalCompositeOperation="destination-out",e.moveTo(i+n,s+n),e.arc(i,s,n,0,2*Math.PI),l.forEach((a=>{e.moveTo(a.offsetX+a.radius,a.offsetY+a.radius),e.arc(a.offsetX,a.offsetY,a.radius,0,2*Math.PI)})),e.fill(),e.globalCompositeOperation="source-over",e.closePath())}})))}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((a,t)=>{let{type:l}=a;if("selectionArea"===l){const{handleX:l,handleY:i,offsetX:s,offsetY:n,status:o,imageData:r}=a,d=this.canvasDom.width,c=this.canvasDom.height,u=this.imageData.width;this.imageData.height;const h=d===u?c/e.height:d/e.width;if(o&&!r){const o=document.createElement("canvas");o.width=d/h,o.height=c/h;const r=o.getContext("2d"),u=l>s?s:l,m=i>n?n:i,g=l>s?l-s:s-l,v=i>n?i-n:n-i;if(r.beginPath(),r.drawImage(e,this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),r.clearRect(Math.round(u/h),Math.round(m/h),Math.round(g/h),Math.round(v/h)),r.closePath(),!g||!v)return;const p=r.getImageData(this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/h),f.height=Math.round(this.imageData.height/h);f.getContext("2d").putImageData(p,0,0);const w=oa(f.toDataURL("image/png"));a.imageData=new File([w],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}if("clearArea"===l){const{clearType:l,dataList:i,offsetX:s,offsetY:n,radius:o,status:r,imageData:d}=a,c=this.canvasDom.width,u=this.canvasDom.height,h=this.imageData.width;this.imageData.height;const m=c===h?u/e.height:c/e.width;if(r&&!d&&"arc"==l){const l=document.createElement("canvas");l.width=c/m,l.height=u/m;const r=l.getContext("2d");r.beginPath(),r.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),r.closePath(),r.beginPath(),r.globalCompositeOperation="destination-out",r.moveTo((s+o)/m,(n+o)/m),r.arc(s,n,o,0,2*Math.PI),i.forEach((e=>{r.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),r.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),r.fill(),r.globalCompositeOperation="source-over",r.closePath();const d=r.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),h=document.createElement("canvas");h.width=Math.round(this.imageData.width/m),h.height=Math.round(this.imageData.height/m);h.getContext("2d").putImageData(d,0,0);const g=oa(h.toDataURL("image/png"));a.imageData=new File([g],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}}))}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const da=e=>(f("data-v-061b6b3e"),e=e(),w(),e),ca={class:"main-body"},ua={class:"image-area"},ha=da((()=>r("div",{class:"main-title"},"模特照片",-1))),ma={class:"image-all"},ga={class:"image-item upload-image-area"},va={class:"upload-text-tips"},pa=da((()=>r("div",{class:"upload-text"},"点击上传",-1))),fa={class:"other-images"},wa={class:"other-images-view-box"},ya={class:"del-btn"},ba=da((()=>r("div",{class:"main-title"},null,-1))),ka={class:"bottom-area"},xa={class:"handle-area"},Da=da((()=>r("div",{class:"main-title"},"正向提示词",-1))),Ca={class:"handle-item"},Aa=da((()=>r("div",{class:"main-title"},"负向提示词",-1))),_a={class:"handle-item"},Ia=da((()=>r("div",{class:"main-title"},"待换脸人像",-1))),La={class:"handle-item bg"},Va={class:"line-draft-image-area"},Ma={class:"upload-image-area-other"},Sa=["src"],Ea={key:1,class:"upload-text-tips"},Pa=da((()=>r("div",{class:"upload-text"},"点击上传",-1))),Ra={class:"image-handl-area"},Ta=da((()=>r("label",null,"笔刷半径",-1))),Ya={class:"image-handl-area"},Fa=da((()=>r("div",{class:"main-title"},"相似度",-1))),Ua={class:"handle-item"},Xa={class:"handle-min-slider"},Oa={class:"generate-btn"},Za={class:"review-area"},Wa="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var za=J({__name:"index",setup(l){const i=s([]),v=s(null),f=s(null);s([]),s(null),s(70);const w=s(""),_=s("");s(1024),s(1024);const I=s(70),L=s(""),V=s(0),M=s(null),S=s(10),E=e=>{const a=new FileReader;return a.onload=({target:a})=>{i.value.length>=15||i.value.push({file:e,url:a.result,weight:100})},a.readAsDataURL(e),!1},P=e=>{v.value=e;const a=new FileReader;return a.onload=({target:e})=>{f.value=e.result,M.value.initImage(f.value)},a.readAsDataURL(e),!1},R=()=>{v.value=null,f.value=null},T=()=>{if(!i.value.length)return b.error("请至少上传一张模特照片"),!1;if(!v.value)return b.error("请上传待换脸人像后操作"),!1;if(!M.value.handleList.length)return b.error("款选人脸区域后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",w.value),e.append("negative_prompt",_.value),e.append("mask_strength",I.value/100),i.value.forEach((({weight:a,file:t})=>{e.append("ref_faces",t)})),e.append("face",v.value),M.value.handleList.forEach((({imageData:a})=>{e.append("face_mask",a)})),e})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${Wa}/img2img/swap_face`,e).then((e=>{if(a.close(),"未检测到人脸，请扩大人脸选区区域！"===e.data)return b.error(e.data),!1;L.value=`${Wa}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))},Y=()=>{M.value.clearSelectionArea()},F=()=>{M.value.setClearAreaRadius(S.value)};return n((()=>{M.value=new ra(V.value),M.value.handleChange("clearArea","arc")})),(l,s)=>{const n=e("el-icon"),v=e("el-upload"),y=e("el-image"),b=e("el-scrollbar"),k=e("el-input"),M=e("el-slider"),U=e("el-button");return a(),o("div",ca,[r("div",ua,[ha,r("div",ma,[r("div",ga,[c(v,{class:"avatar-uploader",drag:"",multiple:"",limit:15,disabled:i.value.length>=15,action:"","show-file-list":!1,"before-upload":E},{default:u((()=>[r("div",va,[c(n,{class:"avatar-uploader-icon"},{default:u((()=>[c(d(D))])),_:1}),pa])])),_:1},8,["disabled"])]),r("div",fa,[c(b,null,{default:u((()=>[r("div",wa,[(a(!0),o(h,null,m(i.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[c(y,{style:{width:"150px",height:"150px"},src:e.url},null,8,["src"]),r("div",ya,[c(n,{style:{color:"red"},onClick:e=>(e=>{i.value.splice(e,1)})(t)},{default:u((()=>[c(d(C))])),_:2},1032,["onClick"])])])))),128))])])),_:1})])])]),ba,r("div",ka,[r("div",xa,[c(b,null,{default:u((()=>[Da,r("div",Ca,[c(k,{type:"textarea",modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),maxlength:"255"},null,8,["modelValue"])]),Aa,r("div",_a,[c(k,{type:"textarea",modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=e=>_.value=e),maxlength:"255"},null,8,["modelValue"])]),Ia,r("div",La,[r("div",Va,[r("div",Ma,[c(v,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":P},{default:u((()=>[f.value?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:s[3]||(s[3]=x((()=>{}),["stop"]))},[r("img",{src:f.value,class:"avatar"},null,8,Sa),r("div",{class:"upload-image-del-btn-area",onClick:s[2]||(s[2]=x((()=>{}),["stop"]))},[r("div",{class:"upload-image-del-btn",onClick:x(R,["stop"])},[c(n,null,{default:u((()=>[c(d(A))])),_:1})])])])):(a(),o("div",Ea,[c(n,{class:"avatar-uploader-icon"},{default:u((()=>[c(d(D))])),_:1}),Pa]))])),_:1}),r("div",Ra,[Ta,c(M,{style:{width:"calc(100% - 50px)"},modelValue:S.value,"onUpdate:modelValue":s[4]||(s[4]=e=>S.value=e),onChange:F,min:1,max:100,size:"small"},null,8,["modelValue"])])]),r("div",Ya,[r("div",{class:"main-title"},[g(" 框选人脸区域 "),r("div",{class:"title-handle-area",onClick:Y}," 重置 ")]),r("canvas",{ref_key:"canvasDom",ref:V},null,512)])])]),Fa,r("div",Ua,[r("div",Xa,[c(M,{modelValue:I.value,"onUpdate:modelValue":s[5]||(s[5]=e=>I.value=e)},null,8,["modelValue"])])])])),_:1}),r("div",Oa,[c(U,{style:{width:"100%"},type:"primary",onClick:s[6]||(s[6]=e=>T())},{default:u((()=>[g("生成")])),_:1})])]),r("div",Za,[L.value?(a(),t(y,{key:0,fit:"scale-down",src:L.value,"preview-src-list":[L.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])):p("",!0)])])])}}},[["__scopeId","data-v-061b6b3e"]]);const Na={class:"layout-body"},ja={class:"layout-right"};var Ha=J({__name:"layout",props:{leftStyle:{}},setup:e=>(t,l)=>(a(),o("div",Na,[r("div",{class:"layout-left",style:I(e.leftStyle)},[_(t.$slots,"left",{},void 0,!0)],4),_(t.$slots,"center",{},void 0,!0),r("div",ja,[_(t.$slots,"right",{},void 0,!0)])]))},[["__scopeId","data-v-2be9378c"]]);function $a(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}class Ga{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.isMoving=!1,this.clearSetting={radius:10},this.finishImage=null,this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e,a){const{canvasDom:t}=this;switch(this.clearHandle(),e){case"selectionArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionAreaFinish(e),this.getFinishImage()})),this.addListener(t,"mousemove",(e=>{this.selectionAreaMoving(e)}));break;case"selectionArcArea":t.style.cursor="crosshair",this.addListener(t,"mousedown",(e=>{this.selectionArcAreaStart(e)})),this.addListener(t,"mouseup",(e=>{this.selectionArcAreaFinish(e),this.getFinishImage()})),this.addListener(t,"mousemove",(e=>{this.selectionArcAreaMoving(e)}));break;case"clearArea":t.style.cursor="none",this.addListener(t,"mousedown",(e=>{this.clearAreaStart(e,a)})),this.addListener(t,"mouseup",(e=>{this.clearAreaFinish(e,a),this.getFinishImage()})),this.addListener(t,"mousemove",(e=>{this.clearAreaMoving(e,a)}));break;default:this.clearHandle()}}selectionArcAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArcArea",status:0,imageData:null})}selectionArcAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionArcAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearAreaStart(e,a){const{offsetX:t,offsetY:l}=e,{clearSetting:i}=this,{radius:s}=i;this.handleList.find((e=>"clearArea"===e.type))?(this.handleList.find((e=>"clearArea"===e.type)).status=0,this.handleList.find((e=>"clearArea"===e.type)).imageData=null):this.handleList.push({dataList:[],radius:s,handleX:t,handleY:l,type:"clearArea",clearType:a,status:0,imageData:null})}clearAreaMouseStyle(e){const{offsetX:a,offsetY:t}=e,{ctx:l,clearSetting:i}=this,{radius:s}=i;l.beginPath(),l.arc(a,t,s,0,2*Math.PI),l.stroke(),l.closePath()}clearAreaMoving(e){const{offsetX:a,offsetY:t}=e,{clearSetting:l}=this,{radius:i}=l;this.handleList.find((e=>"clearArea"===e.type))&&0===this.handleList.find((e=>"clearArea"===e.type)).status&&this.handleList.find((e=>"clearArea"===e.type)).dataList.push({offsetX:a,offsetY:t,radius:i}),this.reDraw(),this.clearAreaMouseStyle(e)}clearAreaFinish(e){this.handleList.find((e=>"clearArea"===e.type))&&(this.handleList.find((e=>"clearArea"===e.type)).status=1),this.reDraw()}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,type:"selectionArea",status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t;this.handleList=[],a.beginPath(),a.clearRect(0,0,l,i),a.closePath(),e.includes("http")&&y({method:"get",url:e,responseType:"blob"}).then((e=>{this.finishImage=new File([e.data],`${(new Date).getTime()}.png`,{type:"image/png"})}));const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{this.initImageData(s),this.drawImage()},s.src=e}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a,imageData:t}=this,{image:l}=t,{width:i,height:s}=a;e.beginPath(),e.clearRect(0,0,i,s),e.closePath(),l&&(this.drawImage(),this.getSelecttionAreaImages(),e.beginPath(),this.handleList.forEach((a=>{e.globalCompositeOperation="destination-out";let{type:t}=a;if("selectionArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n}=a;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const o=t>i?i:t,r=l>s?s:l,d=t>i?t-i:i-t,c=l>s?l-s:s-l;if((!d||!c)&&n)return;e.rect(o,r,d,c)}if("selectionArcArea"===t){let{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n}=a;e.strokeStyle="rgba(255, 255, 255, 1)",e.lineWidth=2;const o=t>i?i:t,r=l>s?s:l,d=t>i?t-i:i-t,c=l>s?l-s:s-l,u=Math.sqrt(d*d+c*c)/2;if((!d||!c)&&n)return;e.moveTo(o+d/2-u,r+c/2-u),e.arc(o+d/2,r+c/2,u,0,2*Math.PI)}if("clearArea"===t){let{clearType:t,dataList:l,offsetX:i,offsetY:s,radius:n}=a;e.moveTo(i+n,s+n),e.arc(i,s,n,0,2*Math.PI),l.forEach((a=>{e.moveTo(a.offsetX+a.radius,a.offsetY+a.radius),e.arc(a.offsetX,a.offsetY,a.radius,0,2*Math.PI)}))}})),e.fill(),e.globalCompositeOperation="source-over",e.closePath())}getSelecttionAreaImages(){const{image:e}=this.imageData;this.handleList.forEach(((a,t)=>{let{type:l}=a;if("selectionArea"===l){const{handleX:l,handleY:i,offsetX:s,offsetY:n,status:o,imageData:r}=a,d=this.canvasDom.width,c=this.canvasDom.height,u=this.imageData.width;this.imageData.height;const h=d===u?c/e.height:d/e.width;if(o&&!r){const o=document.createElement("canvas");o.width=d/h,o.height=c/h;const r=o.getContext("2d"),u=l>s?s:l,m=i>n?n:i,g=l>s?l-s:s-l,v=i>n?i-n:n-i;if(r.beginPath(),r.drawImage(e,this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),r.clearRect(Math.round(u/h),Math.round(m/h),Math.round(g/h),Math.round(v/h)),r.closePath(),!g||!v)return;const p=r.getImageData(this.imageData.x/h,this.imageData.y/h,this.imageData.width/h,this.imageData.height/h),f=document.createElement("canvas");f.width=Math.round(this.imageData.width/h),f.height=Math.round(this.imageData.height/h);f.getContext("2d").putImageData(p,0,0);const w=$a(f.toDataURL("image/png"));a.imageData=new File([w],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}if("clearArea"===l){const{clearType:l,dataList:i,offsetX:s,offsetY:n,radius:o,status:r,imageData:d}=a,c=this.canvasDom.width,u=this.canvasDom.height,h=this.imageData.width;this.imageData.height;const m=c===h?u/e.height:c/e.width;if(r&&!d&&"arc"==l){const l=document.createElement("canvas");l.width=c/m,l.height=u/m;const r=l.getContext("2d");r.beginPath(),r.drawImage(e,this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),r.closePath(),r.beginPath(),r.globalCompositeOperation="destination-out",r.moveTo((s+o)/m,(n+o)/m),r.arc(s,n,o,0,2*Math.PI),i.forEach((e=>{r.moveTo((e.offsetX+e.radius)/m,(e.offsetY+e.radius)/m),r.arc(e.offsetX/m,e.offsetY/m,e.radius/m,0,2*Math.PI)})),r.fill(),ctx.globalCompositeOperation="source-over",r.closePath();const d=r.getImageData(this.imageData.x/m,this.imageData.y/m,this.imageData.width/m,this.imageData.height/m),h=document.createElement("canvas");h.width=Math.round(this.imageData.width/m),h.height=Math.round(this.imageData.height/m);h.getContext("2d").putImageData(d,0,0);const g=$a(h.toDataURL("image/png"));a.imageData=new File([g],`${(new Date).getTime()}_${t}.png`,{type:"image/png"})}}}))}getFinishImage(){const{image:e}=this.imageData,a=this.canvasDom.width,t=this.canvasDom.height,l=this.imageData.width;this.imageData.height;const i=a===l?t/e.height:a/e.width,s=document.createElement("canvas");s.width=a/i,s.height=t/i;const n=s.getContext("2d");n.beginPath(),n.drawImage(e,this.imageData.x/i,this.imageData.y/i,this.imageData.width/i,this.imageData.height/i),n.closePath(),n.globalCompositeOperation="destination-out",n.beginPath(),this.handleList.forEach(((e,a)=>{const{type:t}=e;if("selectionArea"===t){let{handleX:a,handleY:t,offsetX:l,offsetY:s,status:o}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const r=a>l?l:a,d=t>s?s:t,c=a>l?a-l:l-a,u=t>s?t-s:s-t;if((!c||!u)&&o)return;n.rect(r/i,d/i,c/i,u/i)}if("clearArea"===t){let{clearType:a,dataList:t,offsetX:l,offsetY:s,radius:o}=e;n.moveTo((l+o)/i,(s+o)/i),n.arc(l/i,s/i,o/i,0,2*Math.PI),t.forEach((e=>{n.moveTo((e.offsetX+e.radius)/i,(e.offsetY+e.radius)/i),n.arc(e.offsetX/i,e.offsetY/i,e.radius/i,0,2*Math.PI)}))}if("selectionArcArea"===t){let{handleX:a,handleY:t,offsetX:l,offsetY:s,status:o}=e;n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=2;const r=a>l?l:a,d=t>s?s:t,c=a>l?a-l:l-a,u=t>s?t-s:s-t,h=Math.sqrt(c*c+u*u)/2;if((!c||!u)&&o)return;n.moveTo((r+c/2-h)/i,(d+u/2-h)/i),n.arc((r+c/2)/i,(d+u/2)/i,h/i,0,2*Math.PI)}})),n.fill(),n.globalCompositeOperation="source-over",n.closePath();const o=n.getImageData(this.imageData.x/i,this.imageData.y/i,this.imageData.width/i,this.imageData.height/i),r=document.createElement("canvas");r.width=Math.round(this.imageData.width/i),r.height=Math.round(this.imageData.height/i);r.getContext("2d").putImageData(o,0,0);const d=$a(r.toDataURL("image/png"));this.finishImage=new File([d],`${(new Date).getTime()}_finish.png`,{type:"image/png"})}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.finishImage=null,this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}setClearAreaRadius(e=10){this.clearSetting.radius=e}}const Ba=e=>(f("data-v-35679002"),e=e(),w(),e),Qa={class:"super-image-search-body"},qa={class:"image-search-title"},Ja={key:8,class:"image-handle-setting"},Ka=Ba((()=>r("label",null," 笔刷半径 ",-1))),et={class:"image-search-title-handle"},at={class:"content"},tt={class:"search-btn-area"},lt=Ba((()=>r("div",{class:"image-search-title",style:{height:"30px"}},[r("div",null,"提示词")],-1))),it={class:"prompt-area"},st={class:"prompt-item"},nt=Ba((()=>r("div",{class:"prompt-item-label"},"正向提示词",-1))),ot={class:"prompt-item-input"},rt={class:"prompt-item"},dt=Ba((()=>r("div",{class:"prompt-item-label"},"负向提示词",-1))),ct={class:"prompt-item-input"},ut={class:"prompt-btn"},ht=Ba((()=>r("div",{class:"image-search-title",style:{height:"30px"}},[r("div",null,"生成图片")],-1))),mt={class:"content",style:{height:"calc(100% - 40px)"}},gt="https://u248120-87de-6175a03c.westc.gpuhub.com:8443";var vt=J({__name:"index",setup(l){const i=s(null),h=s(null),m=s(null),v=s(0);s(0);const f=s(10),w=s(""),x=s(""),D=s(""),A=s(""),_=e=>{h.value?(w.value=e,m.value.handleChange(e)):b.error("请在上传图片后操作")},I=()=>{m.value.setClearAreaRadius(f.value)},E=e=>{i.value=e;const a=new FileReader;return a.onload=({target:e})=>{h.value=e.result,m.value.initImage(h.value)},a.readAsDataURL(e),!1};const P=()=>{if(!i.value)return b.error("请上传图片后操作"),!1;const e=(()=>{const e=new FormData;return e.append("positive_prompt",D.value),e.append("negative_prompt",A.value),e.append("image",i.value),m.value.finishImage?(e.append("image_with_mask",m.value.finishImage),e):(e.append("image_with_mask",i.value),e)})(),a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${gt}/img2img/inpaint`,e).then((e=>{a.close(),x.value=`${gt}/img2img/${e.data}`})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))};return n((()=>{m.value=new Ga(v.value)})),(l,s)=>{const n=e("el-icon"),R=e("el-button"),T=e("el-slider"),Y=e("el-upload"),F=e("el-input"),U=e("el-image");return a(),o("div",Qa,[c(Ha,{leftStyle:{width:"calc(50% - 180px)"}},{left:u((()=>[r("div",qa,[r("div",null,["selectionArea"!==w.value&&h.value?(a(),t(R,{key:0,type:"primary",class:"title-handle-btn",onClick:s[0]||(s[0]=e=>_("selectionArea")),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(V))])),_:1}),g(" 矩形 ")])),_:1})):p("",!0),"selectionArea"===w.value&&h.value?(a(),t(R,{key:1,class:"title-handle-btn",type:"warning",onClick:s[1]||(s[1]=e=>_("")),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(V))])),_:1}),g(" 矩形 ")])),_:1})):p("",!0),"selectionArcArea"!==w.value&&h.value?(a(),t(R,{key:2,type:"primary",class:"title-handle-btn",onClick:s[2]||(s[2]=e=>_("selectionArcArea")),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(M))])),_:1}),g(" 圆形 ")])),_:1})):p("",!0),"selectionArcArea"===w.value&&h.value?(a(),t(R,{key:3,class:"title-handle-btn",type:"warning",onClick:s[3]||(s[3]=e=>_("")),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(M))])),_:1}),g(" 圆形 ")])),_:1})):p("",!0),"clearArea"!==w.value&&h.value?(a(),t(R,{key:4,type:"primary",class:"title-handle-btn",onClick:s[4]||(s[4]=e=>_("clearArea")),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(S))])),_:1}),g(" 笔刷 ")])),_:1})):p("",!0),"clearArea"===w.value&&h.value?(a(),t(R,{key:5,class:"title-handle-btn",type:"warning",onClick:s[5]||(s[5]=e=>_("")),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(S))])),_:1}),g(" 笔刷 ")])),_:1})):p("",!0),h.value?(a(),t(R,{key:6,class:"title-handle-btn",type:"primary",onClick:s[6]||(s[6]=e=>{m.value.initImage(h.value)}),style:{"font-size":"12px"}},{default:u((()=>[c(n,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(C))])),_:1}),g(" 重置 ")])),_:1})):p("",!0),h.value?(a(),t(R,{key:7,class:"title-handle-btn",type:"primary",onClick:s[7]||(s[7]=e=>{L.prompt("请输入要识别的物品类别,例如: 床, 被单, 人物(英文)等,多种类别之间请使用逗号分割","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:e})=>{if(!e)return void b.error("请输入prompt后操作");e=(e+=",").replaceAll("，",",");const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("prompt",e),t.append("image",i.value),y.post(`${gt}/img2img/segment`,t).then((e=>{a.close(),"没有识别到任何物体，需要给定更加详细的物体类别prompt!"!==e.data?(m.value.clearSelectionArea(),m.value.initImage(`${gt}/img2img/${e.data}`)):b.error(e.data)})).catch((e=>{a.close(),e.response&&413===e.response.status&&b.error("上传图片过大, 请减少图片数量或者大小")}))})).catch((()=>{b({type:"info",message:"取消操作"})}))}),style:{"font-size":"12px"}},{default:u((()=>[g(" Ai识别 ")])),_:1})):p("",!0),h.value?(a(),o("div",Ja,[Ka,c(T,{style:{width:"100px","margin-left":"20px",display:"inline-block","padding-top":"9px"},modelValue:f.value,"onUpdate:modelValue":s[8]||(s[8]=e=>f.value=e),onChange:I,min:1,max:100},null,8,["modelValue"])])):p("",!0)]),r("div",et,[c(Y,{class:"upload-demo","before-upload":E,"show-file-list":!1,action:""},{default:u((()=>[c(R,{type:"text"},{default:u((()=>[g("上传图片")])),_:1})])),_:1})])]),r("div",at,[r("canvas",{ref_key:"canvasDom",ref:v},null,512)])])),center:u((()=>[r("div",tt,[lt,r("div",it,[r("div",st,[nt,r("div",ot,[c(F,{type:"textarea",modelValue:D.value,"onUpdate:modelValue":s[9]||(s[9]=e=>D.value=e)},null,8,["modelValue"])])]),r("div",rt,[dt,r("div",ct,[c(F,{type:"textarea",modelValue:A.value,"onUpdate:modelValue":s[10]||(s[10]=e=>A.value=e)},null,8,["modelValue"])])]),r("div",ut,[c(R,{type:"primary",style:{width:"100%"},onClick:P},{default:u((()=>[g(" 生成 ")])),_:1})])])])])),right:u((()=>[ht,r("div",mt,[c(U,{src:x.value,fit:"scale-down","preview-src-list":[x.value],style:{width:"100%",height:"100%"}},null,8,["src","preview-src-list"])])])),_:1},8,["leftStyle"])])}}},[["__scopeId","data-v-35679002"]]);const pt=e=>(f("data-v-7720ba97"),e=e(),w(),e),ft={class:"m-spin"},wt={class:"m-spin-box"},yt={key:0,class:"m-spin-dot"},bt=[pt((()=>r("span",{class:"u-dot-item"},null,-1))),pt((()=>r("span",{class:"u-dot-item"},null,-1))),pt((()=>r("span",{class:"u-dot-item"},null,-1))),pt((()=>r("span",{class:"u-dot-item"},null,-1)))],kt={key:1,class:"u-quarter-circle"},xt={key:2,class:"u-three-quarters-circle"},Dt={key:3,class:"m-dynamic-circle"},Ct=[pt((()=>r("svg",{class:"circular",viewBox:"0 0 50 50"},[r("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)))];var At=J(E({__name:"Spin",props:{spinning:{type:Boolean,default:!0},size:{default:"default"},tip:{default:""},indicator:{default:"dot"},color:{default:"#1677FF"}},setup:e=>(e,t)=>(a(),o("div",{class:T(`m-spin-wrap ${e.size}`),style:I(`--color: ${e.color};`)},[P(r("div",ft,[r("div",wt,["dot"===e.indicator?(a(),o("div",yt,bt)):p("",!0),"quarter-circle"===e.indicator?(a(),o("div",kt)):p("",!0),"three-quarters-circle"===e.indicator?(a(),o("div",xt)):p("",!0),"dynamic-circle"===e.indicator?(a(),o("div",Dt,Ct)):p("",!0),P(r("p",{class:"u-tip"},v(e.tip),513),[[R,e.tip]])])],512),[[R,e.spinning]]),r("div",{class:T(["m-spin-content",{"m-spin-mask":e.spinning}])},[_(e.$slots,"default",{},void 0,!0)],2)],6))}),[["__scopeId","data-v-7720ba97"]]);const _t=e=>(f("data-v-bd6aed36"),e=e(),w(),e),It=["onMouseenter"],Lt=["src","alt","onLoad"],Vt=["onClick"],Mt={style:{color:"#fff","margin-bottom":"5px"}},St={style:{color:"#fff","margin-bottom":"5px"}},Et={style:{color:"#fff",width:"100%",display:"-webkit-box","word-break":"break-all","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",overflow:"hidden","text-overflow":"ellipsis"}},Pt={style:{position:"absolute",right:"10px",bottom:"5px"}},Rt=["onClick"],Tt=[_t((()=>r("rect",{stroke:"null",id:"svg_1",fill:"white",rx:"18",height:"36",width:"36"},null,-1))),_t((()=>r("path",{stroke:"#F3745D",id:"svg_2","stroke-width":"2",d:"m9.699395,11l16.60121,0l0,16.532009l-16.60121,0l0,-16.532009z"},null,-1))),_t((()=>r("path",{stroke:"#F3745D",id:"svg_3","stroke-width":"2",d:"m14.553074,6l6.893853,0l0,4.173591l-6.893853,0l0,-4.173591z"},null,-1))),_t((()=>r("path",{stroke:"#F3745D",id:"svg_4","stroke-width":"2",d:"m6.932526,10l22.134948,0"},null,-1))),_t((()=>r("path",{stroke:"#F3745D",id:"svg_5","stroke-width":"1.6",d:"m20.62999,14.8l0,7.240074"},null,-1))),_t((()=>r("path",{stroke:"#F3745D",id:"svg_6","stroke-width":"1.6",d:"m15.649886,14.8l0,7.170871"},null,-1)))],Yt=["onClick"],Ft=[_t((()=>r("rect",{width:"36",height:"36",rx:"18",fill:"white"},null,-1))),_t((()=>r("path",{d:"M9.8125 9.81836H17.9943L19.4819 11.8638H26.1761V26.182H9.8125V9.81836Z",stroke:"#4075E5","stroke-width":"2"},null,-1))),_t((()=>r("path",{d:"M9.8125 15.9547H26.1761",stroke:"#4075E5","stroke-width":"2"},null,-1)))],Ut=["onClick"],Xt=[_t((()=>r("rect",{width:"36",height:"36",rx:"18",fill:"white"},null,-1))),_t((()=>r("path",{d:"M17.2504 24.6942C21.3583 24.6942 24.6884 21.3642 24.6884 17.2563C24.6884 13.1484 21.3583 9.81836 17.2504 9.81836C13.1426 9.81836 9.8125 13.1484 9.8125 17.2563C9.8125 21.3642 13.1426 24.6942 17.2504 24.6942Z",stroke:"#4075E5","stroke-width":"2"},null,-1))),_t((()=>r("path",{d:"M26.1721 26.182L22.4531 22.46",stroke:"#4075E5","stroke-width":"2"},null,-1)))],Ot=["onMouseenter"],Zt=["src","alt","onLoad"],Wt={class:"overlay"},zt={style:{color:"#fff"}};var Nt=J(E({__name:"Index",props:{images:{default:()=>[]},columnCount:{default:3},columnGap:{default:20},width:{default:"100%"},backgroundColor:{default:"#fff"},mode:{default:"JS"}},emits:["handleShowInfoModal","handleDelete"],setup(l,{emit:i}){const g=l,f=Y((()=>"number"==typeof g.width?g.width+"px":g.width)),w=i,y=s([]),b=s([]),k=s(),D=s(),C=Y((()=>Math.max(...b.value)+g.columnGap)),A=Y((()=>g.images.length)),_=s(Array(A.value).fill(!1));function L(e){_.value[e]=!0}function V(e,a){if(e<g.columnCount)return b.value[e]=g.columnGap+a,{top:g.columnGap,left:(D.value+g.columnGap)*e+g.columnGap};{const e=Math.min(...b.value);var t=0;for(let a=0;a<b.value.length;a++)if(b.value[a]===e){t=a;break}return b.value[t]=e+g.columnGap+a,{top:e+g.columnGap,left:(D.value+g.columnGap)*t+g.columnGap}}}function M(e,a){return new Promise((t=>{const l=new Image;l.src=e,l.onload=function(){var e=l.height/(l.width/D.value);y.value[a]={width:D.value,height:e,...V(a,e)},t("load")}}))}async function S(){var e;D.value=(k.value.offsetWidth-(g.columnCount+1)*g.columnGap)/g.columnCount;const a=g.images.length;for(let t=null==(e=y.value)?void 0:e.length;t<a;t++)await M(g.images[t].src,t)}F((()=>g.images),(e=>{e.length&&"JS"===g.mode&&S()})),n((()=>{g.images.length&&"JS"===g.mode&&S()}));let E=s(null);return(l,i)=>{const s=e("svg-icon"),n=e("a-space");return a(),o(h,null,["JS"===l.mode?(a(),o("div",U({key:0},l.$attrs,{class:"m-waterfall-js",ref_key:"waterfall",ref:k,style:`background-color: ${l.backgroundColor}; width: ${f.value}; height: ${C.value}px;`}),[(a(!0),o(h,null,m(y.value,((e,s)=>(a(),t(At,{class:"m-img",style:I(`border:solid 1px #d9d9d9; border-radius: 16px; width: ${e.width}px; height: ${e.height}px; top: ${e&&e.top}px; left: ${e&&e.left}px;`),spinning:!_.value[s],size:"small",indicator:"dynamic-circle",key:s},{default:u((()=>{var e,t;return[r("div",{class:"relative flex justify-center align-center",onMouseenter:e=>X(E)?E.value=s:E=s,onMouseleave:i[0]||(i[0]=e=>X(E)?E.value=null:E=null)},[r("img",{class:"u-img",src:l.images[s].src,alt:l.images[s].title,onLoad:e=>L(s)},null,40,Lt),P(r("div",{class:"overlay",onClick:e=>w("showHandle",l.images[s])},[r("div",null,[r("div",Mt,v(l.images[s].title),1),r("div",St,"尺寸："+v((null==(e=l.images[s].width)?void 0:e.toFixed(2))+" * "+(null==(t=l.images[s].height)?void 0:t.toFixed(2))),1),r("div",Et,"文件位置："+v(l.images[s].fileAddress),1)]),r("div",Pt,[(a(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"10px"},onClick:x((e=>w("handleDel",l.images[s])),["stop"])},Tt,8,Rt)),(a(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"10px"},onClick:x((e=>w("handleOpenDir",l.images[s])),["stop"])},Ft,8,Yt)),(a(),o("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:x((e=>w("handleshowImage",l.images[s])),["stop"])},Xt,8,Ut))])],8,Vt),[[R,d(E)===s]])],40,It)]})),_:2},1032,["style","spinning"])))),128))],16)):p("",!0),"CSS"===l.mode?(a(),o("div",U({key:1},l.$attrs,{class:"m-waterfall-css",style:`background: ${l.backgroundColor}; width: ${f.value}; padding: ${l.columnGap}px; column-count: ${l.columnCount}; column-gap: ${l.columnGap}px;`}),[(a(!0),o(h,null,m(l.images,((e,o)=>(a(),t(At,{style:I(`border:solid 1px #E6EAEE;border-radius: 10px;margin-bottom: ${l.columnGap}px;`),spinning:!_.value[o],size:"small",indicator:"dynamic-circle",key:o},{default:u((()=>[r("div",{style:{position:"relative"},onMouseenter:e=>X(E)?E.value=o:E=o,onMouseleave:i[1]||(i[1]=e=>X(E)?E.value=null:E=null)},[r("img",{class:"u-img",src:e.src,alt:e.title,onLoad:e=>L(o)},null,40,Zt),P(r("div",Wt,[c(n,{size:20},{default:u((()=>[c(s,{"icon-class":"del_active",onClick:e=>w("handleDelete",l.images[o])},null,8,["onClick"]),c(s,{"icon-class":"edit2",onClick:e=>w("handleShowInfoModal",l.images[o])},null,8,["onClick"])])),_:2},1024),r("div",zt,v(e.title),1)],512),[[R,d(E)===o]])],40,Ot)])),_:2},1032,["style","spinning"])))),128))],16)):p("",!0)],64)}}}),[["__scopeId","data-v-bd6aed36"]]);const jt={class:"my-header"},Ht={class:"dialog-header"},$t=["id"],Gt={class:"image-area"},Bt={class:"image-item"},Qt=["src"],qt={class:"image-msg-area"},Jt={class:"image-msg-item"},Kt={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000","margin-bottom":"10px"}},el={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000","margin-bottom":"10px"}},al={style:{"padding-left":"10px","box-sizing":"border-box",color:"#000",width:"100%",display:"-webkit-box","word-break":"break-all","margin-bottom":"10px","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","text-overflow":"ellipsis"}},tl=(e=>(f("data-v-0b61c804"),e=e(),w(),e))((()=>r("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("rect",{width:"36",height:"36",rx:"18",fill:"white"}),r("path",{d:"M9.8125 9.81836H17.9943L19.4819 11.8638H26.1761V26.182H9.8125V9.81836Z",stroke:"#4075E5","stroke-width":"2"}),r("path",{d:"M9.8125 15.9547H26.1761",stroke:"#4075E5","stroke-width":"2"})],-1)));var ll=J({__name:"imageDialog",setup(l,{expose:i}){const n=s(!1),o=s({});return i({init:e=>{o.value=e,n.value=!0}}),(l,i)=>{const s=e("el-button"),d=e("el-dialog");return a(),t(d,{"align-center":"",modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=e=>n.value=e),"show-close":!1,width:"600","before-close":l.handleClose},{header:u((({close:e,titleId:a})=>[r("div",jt,[r("div",Ht,[r("div",{id:a,class:"dialog-title",style:{"text-align":"center"}},"预览",8,$t),c(s,{size:"small",type:"text",onClick:e,class:"dialog-close-btn"},{default:u((()=>[g(" 关闭 ")])),_:2},1032,["onClick"])])])])),default:u((()=>[r("div",Gt,[r("div",Bt,[r("img",{src:o.value.src},null,8,Qt)]),r("div",qt,[r("div",Jt,[r("div",Kt,v(o.value.title),1),r("div",el," 尺寸："+v(o.value.width.toFixed(2)+" * "+o.value.height.toFixed(2)),1),r("div",al," 文件位置："+v(o.value.fileAddress),1),c(s,{type:"text",style:{padding:"0"},onClick:i[0]||(i[0]=e=>(({fileAddress:e})=>{window.open(e)})(o.value))},{default:u((()=>[tl,g(" 打开所在文件夹 ")])),_:1})])])])])),_:1},8,["modelValue","before-close"])}}},[["__scopeId","data-v-0b61c804"]]);function il(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}function sl(e,a){return"left"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e>l?e:l,i.height=e>l?e:l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(n,o),s.rotate(-Math.PI/2),s.translate(-n,-o),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const r=s.getImageData(o-t.height/2,n-t.width/2,l,e),d=document.createElement("canvas");d.width=l,d.height=e,d.getContext("2d").putImageData(r,0,0);const c=il(d.toDataURL("image/png")),u=new File([c],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:u,url:e.result})},h.readAsDataURL(u)}})))(e):"right"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e>l?e:l,i.height=e>l?e:l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(n,o),s.rotate(Math.PI/2),s.translate(-n,-o),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const r=s.getImageData(o-t.height/2,n-t.width/2,l,e),d=document.createElement("canvas");d.width=l,d.height=e,d.getContext("2d").putImageData(r,0,0);const c=il(d.toDataURL("image/png")),u=new File([c],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:u,url:e.result})},h.readAsDataURL(u)}})))(e):"horizontal"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e,i.height=l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(2*n,0),s.scale(-1,1),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const r=s.getImageData(0,0,e,l),d=document.createElement("canvas");d.width=e,d.height=l,d.getContext("2d").putImageData(r,0,0);const c=il(d.toDataURL("image/png")),u=new File([c],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:u,url:e.result})},h.readAsDataURL(u)}})))(e):"vertical"===a?(e=>new Promise((a=>{const t=new Image;t.src=e,t.onload=()=>{const e=t.width,l=t.height,i=document.createElement("canvas");i.width=e,i.height=l;const s=i.getContext("2d"),n=i.width/2,o=i.height/2;s.beginPath(),s.translate(0,2*o),s.scale(1,-1),s.drawImage(t,n-t.width/2,o-t.height/2),s.closePath();const r=s.getImageData(0,0,e,l),d=document.createElement("canvas");d.width=e,d.height=l,d.getContext("2d").putImageData(r,0,0);const c=il(d.toDataURL("image/png")),u=new File([c],`${(new Date).getTime()}_${Math.round(1e3*Math.random())}.png`,{type:"image/png"}),h=new FileReader;h.onload=({target:e})=>{a({file:u,url:e.result})},h.readAsDataURL(u)}})))(e):void 0}const nl={class:"image-search-body"},ol={class:"upload-image-title"},rl={key:0,class:"clear-result"},dl={class:"upload-image-area"},cl=["src"],ul={key:1,class:"upload-text-tips"},hl=(e=>(f("data-v-216c4056"),e=e(),w(),e))((()=>r("div",{class:"upload-text"},"点击上传",-1))),ml={key:0,class:"image-handle-area"},gl={class:"image-handle-item"},vl={class:"image-handle-item"},pl={key:1,class:"search-btn-area"},fl={class:"search-result-area"},wl={class:"search-result-title"},yl={key:0,class:"result-num"},bl={key:0,class:"search-result-images-area"},kl="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo";var xl=J({__name:"index",setup(t){const l=s(null),i=s(null),n=s([]),h=s(0),m=s([]),f=s(!1),w=e=>{sl(i.value,e).then((({file:e,url:a})=>{l.value=e,i.value=a}))},b=e=>{l.value=e;const a=new FileReader;return a.onload=({target:e})=>{i.value=e.result},a.readAsDataURL(e),!1},k=()=>{l.value=null,i.value=null},C=()=>{const e=new FormData;e.append("file",l.value),f.value=!0,y.post(`${kl}/search`,e).then((e=>{const{data:a}=e;m.value=a.result.map((e=>({title:e,fileAddress:`${kl}/static/${e}`,width:1920,height:1080,src:`${kl}/static/${e}`}))),f.value=!1}))},_=e=>{h.value.init(e)},I=({fileAddress:e})=>{window.open(e)},L=()=>{n.value=[],m.value=[],i.value=null,l.value=null};return(t,l)=>{const s=e("el-button"),n=e("el-icon"),y=e("el-upload"),V=e("el-scrollbar"),M=O("loading");return a(),o("div",nl,[c(Ha,null,{left:u((()=>[r("div",ol,[g(" 上传识别图 "),m.value.length?(a(),o("div",rl,[c(s,{style:{padding:"0",height:"20px","line-height":"20px"},type:"text",onClick:L},{default:u((()=>[g("清空")])),_:1})])):p("",!0)]),r("div",dl,[c(y,{class:"avatar-uploader",drag:"",action:"","show-file-list":!1,"before-upload":b},{default:u((()=>[i.value?(a(),o("div",{key:0,class:"upload-image-del-area",onClick:l[1]||(l[1]=x((()=>{}),["stop"]))},[r("img",{src:i.value,class:"avatar"},null,8,cl),r("div",{class:"upload-image-del-btn-area",onClick:l[0]||(l[0]=x((()=>{}),["stop"]))},[r("div",{class:"upload-image-del-btn",onClick:x(k,["stop"])},[c(n,null,{default:u((()=>[c(d(A))])),_:1})])])])):(a(),o("div",ul,[c(n,{class:"avatar-uploader-icon"},{default:u((()=>[c(d(D))])),_:1}),hl]))])),_:1})]),i.value?(a(),o("div",ml,[r("div",gl,[c(s,{onClick:l[2]||(l[2]=e=>w("left")),size:"small"},{default:u((()=>[g(" 左旋90° ")])),_:1}),c(s,{onClick:l[3]||(l[3]=e=>w("horizontal")),size:"small"},{default:u((()=>[g(" 水平镜像 ")])),_:1})]),r("div",vl,[c(s,{onClick:l[4]||(l[4]=e=>w("right")),size:"small"},{default:u((()=>[g(" 右旋90° ")])),_:1}),c(s,{onClick:l[5]||(l[5]=e=>w("vertical")),size:"small"},{default:u((()=>[g(" 垂直镜像 ")])),_:1})])])):p("",!0),i.value?(a(),o("div",pl,[c(s,{round:"",type:"primary",onClick:C},{default:u((()=>[g("开始识别")])),_:1})])):p("",!0)])),right:u((()=>[r("div",fl,[r("div",wl,[g(" 搜索结果 "),m.value.length?(a(),o("div",yl," 共 "+v(m.value.length)+" 张 ",1)):p("",!0)]),P((a(),o("div",{class:"search-result-images","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[c(V,null,{default:u((()=>[m.value.length?(a(),o("div",bl,[c(Nt,{onHandleshowImage:_,onHandleOpenDir:I,columnCount:5,images:m.value},null,8,["images"])])):p("",!0)])),_:1})])),[[M,f.value]])])])),_:1}),c(ll,{ref_key:"imageDialogDom",ref:h},null,512)])}}},[["__scopeId","data-v-216c4056"]]);const Dl=e=>(f("data-v-6e71c3e2"),e=e(),w(),e),Cl={class:"dir-area"},Al=Dl((()=>r("div",{class:"dir-list-title"},[g(" 链接本地图库 "),r("div",{class:"add-gallery-btn"})],-1))),_l={key:0,class:"dir-list"},Il={class:"dir-path"},Ll={class:"dir-handle"},Vl={class:"images-all-area"},Ml={class:"images-all-title"},Sl=Dl((()=>r("div",null,null,-1))),El={class:"images-num"},Pl=Dl((()=>r("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("rect",{x:"3.5",y:"3.5",width:"13",height:"13",stroke:"#79bbff","stroke-width":"1.5"}),r("path",{d:"M5 10H15",stroke:"#79bbff","stroke-width":"1.5"}),r("path",{d:"M10 5V15",stroke:"#79bbff","stroke-width":"1.5"})],-1))),Rl={key:0,style:{"margin-left":"20px"}},Tl={key:0,class:"images-all-images-area"},Yl={class:"dir-list-content"},Fl={class:"dir-info-icon"},Ul=["onClick"],Xl="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo",Ol='<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n';var Zl=J({__name:"index",setup(l){s([]);const i=s(0),d=s([]),f=s([]),w=s(!1),k=s(!1),D=s(!1),C=s([]),A=()=>{w.value=!0,y.get(`${Xl}/images`).then((e=>{const{data:a}=e;w.value=!1,f.value=d.value=a.images.map((e=>({title:e,fileAddress:`${Xl}/static/${e}`,width:1920,height:1080,src:`${Xl}/static/${e}`})))}))},_=()=>{k.value=!0,setTimeout((()=>{k.value=!1,C.value=["线上图库"]}),1e3),A()},I=e=>{C.value.push(e),D.value=!1},L=()=>{b("演示版本暂无此功能，请于正式版本使用")};return n((()=>{_(),window.onFolderSelected=I})),(l,s)=>{const n=e("el-button"),y=e("el-empty"),b=e("el-scrollbar"),_=e("el-upload"),I=e("el-image"),V=O("loading");return P((a(),o("div",{class:"gallery-body","element-loading-spinner":Ol,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[c(Ha,null,{left:u((()=>[r("div",Cl,[Al,P((a(),o("div",{class:"dir-all-area","element-loading-spinner":Ol,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[c(b,null,{default:u((()=>[C.value.length?(a(),o("div",_l,[(a(!0),o(h,null,m(C.value,((e,t)=>(a(),o("div",{class:"dir-list-item",key:t},[r("div",Il,v(e),1),r("div",Ll,[c(n,{type:"text",onClick:e=>{},style:{color:"#f3745d",padding:"0",height:"20px","vertical-align":"top"}},{default:u((()=>[g("删除")])),_:2},1032,["onClick"])])])))),128))])):(a(),t(y,{key:1,description:"暂未连接本地图库",style:{"padding-top":"200px",color:"rgba(0, 0, 0, 1)"}},{default:u((()=>[c(n,{type:"primary",round:"",onClick:L},{default:u((()=>[g("选择")])),_:1})])),_:1}))])),_:1})])),[[V,k.value]])])])),right:u((()=>[r("div",Vl,[r("div",Ml,[g(" 图库预览 "),Sl,r("div",El,[c(_,{class:"upload-demo","show-file-list":!1,"on-success":A,action:`${Xl}/upload`},{default:u((()=>[c(n,{type:"text",size:"small",style:{padding:"0"}},{default:u((()=>[Pl,g(" 上传图片 ")])),_:1})])),_:1},8,["action"]),f.value.length?(a(),o("div",Rl," 共 "+v(d.value.length)+" 张 ",1)):p("",!0)])]),P((a(),o("div",{class:"images-all-images","element-loading-spinner":Ol,"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[c(b,null,{default:u((()=>[f.value.length?(a(),o("div",Tl,[r("div",Yl,[(a(!0),o(h,null,m(f.value,((e,t)=>(a(),o("div",{class:"dir-list-info",type:"image",key:t},[r("div",Fl,[c(I,{style:{width:"100%",height:"100px"},"preview-src-list":[e.src],src:e.src,fit:"cover",lazy:""},null,8,["preview-src-list","src"])]),r("div",{class:"dir-name",onClick:x((a=>{return t=e,void i.value.init(t);var t}),["stop"])},v(e.title),9,Ul)])))),128))])])):(a(),t(y,{key:1,description:"暂无内容",style:{"padding-top":"200px",color:"rgba(0, 0, 0, 1)"}}))])),_:1})])),[[V,w.value]])])])),_:1}),c(ll,{ref_key:"imageDialogDom",ref:i},null,512)])),[[V,D.value]])}}},[["__scopeId","data-v-6e71c3e2"]]);class Wl{constructor(e){this.canvasDom=e,this.ctx=e.getContext("2d"),this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.handleList=[],this.imageData={image:null,x:0,y:0,height:0,width:0},this.listeners={},window.addEventListener("resize",(()=>{this.canvasDom.width=this.canvasDom.offsetWidth,this.canvasDom.height=this.canvasDom.offsetHeight,this.clearSelectionArea(),this.initImage(this.imageData.image.src)}))}handleChange(e){const{canvasDom:a}=this;if("selectionArea"===e)a.style.cursor="crosshair",this.addListener(a,"mousedown",(e=>{this.selectionAreaStart(e)})),this.addListener(a,"mouseup",(e=>{this.selectionAreaFinish(e)})),this.addListener(a,"mousemove",(e=>{this.selectionAreaMoving(e)}));else this.clearHandle()}selectionAreaStart(e){const{offsetX:a,offsetY:t}=e;this.handleList.push({handleX:a,handleY:t,status:0,imageData:null})}selectionAreaMoving(e){const{offsetX:a,offsetY:t}=e;this.handleList.length&&0===this.handleList[this.handleList.length-1].status&&(this.handleList[this.handleList.length-1].offsetX=a,this.handleList[this.handleList.length-1].offsetY=t,this.reDraw())}selectionAreaFinish(){this.handleList[this.handleList.length-1].status=1,this.reDraw()}clearHandle(){this.canvasDom.style.cursor="auto",this.removeAllListeners()}initImage(e){const{ctx:a,canvasDom:t}=this,{width:l,height:i}=t;this.handleList=[],a.beginPath(),a.clearRect(0,0,l,i),a.closePath();const s=new Image;s.src=e,s.onload=()=>{this.initImageData(s),this.drawImage()}}initImageData(e){const{canvasDom:a}=this,{width:t,height:l}=a,i=e.width,s=e.height,n={image:e,x:0,y:0,height:0,width:0};if(s>l||i>t)if(s/l>i/t){const e=l/s;n.height=l,n.width=e*i,n.y=0,n.x=t/2-n.width/2}else{const e=t/i;n.width=t,n.height=e*s,n.x=0,n.y=l/2-n.height/2}else if(s>i){const e=l/t;n.height=l,n.width=l/e,n.y=0,n.x=t/2-n.width/2}else{const e=t/l;n.width=t,n.height=t/e,n.y=l/2-n.width/2,n.x=0}this.imageData=n}drawImage(){const{image:e,x:a,y:t,width:l,height:i}=this.imageData,{ctx:s}=this;e&&(s.beginPath(),s.drawImage(e,a,t,l,i),s.closePath())}reDraw(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath(),this.drawImage(),this.getSelecttionAreaImages(),this.handleList.forEach((({handleX:a,handleY:t,offsetX:l,offsetY:i,status:s})=>{e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 1)",e.lineWidth=2;const n=a>l?l:a,o=t>i?i:t,r=a>l?a-l:l-a,d=t>i?t-i:i-t;(r&&d||!s)&&(e.rect(n,o,r,d),e.stroke(),e.closePath())}))}getSelecttionAreaImages(){this.handleList.forEach(((e,a)=>{const{handleX:t,handleY:l,offsetX:i,offsetY:s,status:n,imageData:o}=e,{ctx:r}=this;if(n&&!o){const n=t>i?i:t,o=l>s?s:l,d=t>i?t-i:i-t,c=l>s?l-s:s-l;if(!d||!c)return;const u=r.getImageData(Math.round(n),Math.round(o),Math.round(d),Math.round(c)),h=document.createElement("canvas");h.width=d,h.height=c;h.getContext("2d").putImageData(u,0,0);const m=function(e){const a=e.split(","),t=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const s=new Uint8Array(i);for(;i--;)s[i]=l.charCodeAt(i);return new Blob([s],{type:t})}(h.toDataURL("image/png"));e.imageData=new File([m],`${(new Date).getTime()}_${a}.png`,{type:"image/png"})}}))}addListener(e,a,t){e.addEventListener(a,t);var l=a+"_"+t.toString();this.listeners[l]={element:e,eventType:a,listener:t}}removeAllListeners(){for(var e in this.listeners){var a=this.listeners[e];a.element.removeEventListener(a.eventType,a.listener)}this.listeners={}}clearSelectionArea(){this.handleList=[],this.reDraw()}clearAll(){const{ctx:e,canvasDom:a}=this,{width:t,height:l}=a;e.beginPath(),e.clearRect(0,0,t,l),e.closePath()}}const zl=e=>(f("data-v-589b370f"),e=e(),w(),e),Nl={class:"super-image-search-body"},jl={class:"image-search-title"},Hl={key:3,class:"image-handle-area"},$l={class:"image-handle-item"},Gl=zl((()=>r("div",{class:"image-handle-item"},null,-1))),Bl={class:"image-search-title-handle"},Ql={class:"content"},ql={class:"search-btn-area"},Jl=zl((()=>r("br",null,null,-1))),Kl={class:"image-search-title",style:{height:"30px"}},ei=zl((()=>r("div",null,"搜索结果",-1))),ai={class:"image-search-title-handle"},ti={class:"content",style:{height:"calc(100% - 40px)"}},li="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo";var ii=J({__name:"index",setup(l){const i=s(null),h=s(null),m=s(null),f=s(0),w=s(0),k=s(""),x=s([]),D=s(!1),A=s("图片搜索"),_=s(""),I=s(10),L=s(!1),M=e=>{sl(h.value,e).then((({file:e,url:a})=>{i.value=e,h.value=a,m.value.initImage(h.value)}))},S=e=>{h.value?(k.value=e,m.value.handleChange(e)):b.error("请在上传图片后操作")};const E=e=>{i.value=e;const a=new FileReader;return a.onload=({target:e})=>{h.value=e.result,m.value.initImage(h.value)},a.readAsDataURL(e),!1},T=()=>{if(D.value=!0,"图片搜索"===A.value){let e=m.value.handleList;e.length?(e=>{let a=new FormData;e.forEach((({imageData:e})=>{a.append("files",e)})),L.value&&x.value.forEach((e=>{a.append("img_list",e.title)})),y.post(`${li}/super_search?search_num=${I.value}`,a).then((e=>{const{data:a}=e;x.value=a.result.map((e=>({title:e,fileAddress:`${li}/static/${e}`,width:1920,height:1080,src:`${li}/static/${e}`}))),D.value=!1}))})(e):(()=>{const e=new FormData;e.append("file",i.value),L.value&&x.value.forEach((a=>{e.append("img_list",a.title)})),y.post(`${li}/search?search_num=${I.value}`,e).then((e=>{const{data:a}=e;x.value=a.result.map((e=>({title:e,fileAddress:`${li}/static/${e}`,width:1920,height:1080,src:`${li}/static/${e}`}))),D.value=!1}))})()}else"描述搜索"===A.value&&(L.value&&JSON.parse(JSON.stringify(x.value)).map((e=>e.title)),y.post(`${li}/text_search?text=${_.value}&search_num=${I.value}`).then((e=>{const{data:a}=e;x.value=a.result.map((e=>({title:e,fileAddress:`${li}/static/${e}`,width:1920,height:1080,src:`${li}/static/${e}`}))),D.value=!1})))},Y=e=>{i.value=null,h.value=null,k.value="",_.value="",A.value=e,m.value.handleChange(""),m.value.clearAll()},F=e=>{w.value.init(e)},U=({fileAddress:e})=>{window.open(e)};return n((()=>{m.value=new Wl(f.value)})),(l,i)=>{const s=e("el-icon"),n=e("el-button"),y=e("el-dropdown-item"),b=e("el-dropdown-menu"),X=e("el-dropdown"),O=e("el-upload"),W=e("el-input"),z=e("el-checkbox"),N=e("el-input-number"),j=e("el-form-item"),H=e("el-form"),$=e("el-scrollbar");return a(),o("div",Nl,[c(Ha,{leftStyle:{width:"calc(50% - 55px)"}},{left:u((()=>[r("div",jl,[r("div",null,[c(X,null,{dropdown:u((()=>[c(b,null,{default:u((()=>[c(y,{onClick:i[0]||(i[0]=e=>Y("图片搜索"))},{default:u((()=>[g("图片搜索")])),_:1}),c(y,{onClick:i[1]||(i[1]=e=>Y("描述搜索"))},{default:u((()=>[g("描述搜索")])),_:1})])),_:1})])),default:u((()=>[c(n,{type:"primary"},{default:u((()=>[g(v(A.value)+" ",1),c(s,{class:"el-icon--right"},{default:u((()=>[c(d(Z))])),_:1})])),_:1})])),_:1}),""===k.value&&h.value?(a(),t(n,{key:0,type:"primary",class:"title-handle-btn",onClick:i[2]||(i[2]=e=>S("selectionArea")),style:{"font-size":"12px"}},{default:u((()=>[c(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(V))])),_:1}),g(" 框选区域 ")])),_:1})):p("",!0),"selectionArea"===k.value&&h.value?(a(),t(n,{key:1,class:"title-handle-btn",type:"warning",onClick:i[3]||(i[3]=e=>S("")),style:{"font-size":"12px"}},{default:u((()=>[c(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(V))])),_:1}),g(" 框选区域 ")])),_:1})):p("",!0),h.value?(a(),t(n,{key:2,class:"title-handle-btn",type:"primary",onClick:i[4]||(i[4]=e=>{m.value.clearSelectionArea()}),style:{"font-size":"12px"}},{default:u((()=>[c(s,{style:{"vertical-align":"middle","margin-right":"10px"}},{default:u((()=>[c(d(C))])),_:1}),g(" 清空框选区域 ")])),_:1})):p("",!0),h.value?(a(),o("div",Hl,[r("div",$l,[c(n,{onClick:i[5]||(i[5]=e=>M("left")),size:"small"},{default:u((()=>[g(" 左旋90° ")])),_:1}),c(n,{onClick:i[6]||(i[6]=e=>M("right")),size:"small"},{default:u((()=>[g(" 右旋90° ")])),_:1}),c(n,{onClick:i[7]||(i[7]=e=>M("horizontal")),size:"small"},{default:u((()=>[g(" 水平镜像 ")])),_:1}),c(n,{onClick:i[8]||(i[8]=e=>M("vertical")),size:"small"},{default:u((()=>[g(" 垂直镜像 ")])),_:1})]),Gl])):p("",!0)]),r("div",Bl,["图片搜索"===A.value?(a(),t(O,{key:0,class:"upload-demo","before-upload":E,"show-file-list":!1,action:""},{default:u((()=>[c(n,{type:"text"},{default:u((()=>[g("上传图片")])),_:1})])),_:1})):p("",!0)])]),r("div",Ql,[P(r("canvas",{ref_key:"canvasDom",ref:f},null,512),[[R,"图片搜索"===A.value]]),P(c(W,{style:{height:"100%"},type:"textarea",modelValue:_.value,"onUpdate:modelValue":i[9]||(i[9]=e=>_.value=e),placeholder:"请输入图片描述"},null,8,["modelValue"]),[[R,"描述搜索"===A.value]])])])),center:u((()=>[r("div",ql,[r("div",null,[c(z,{modelValue:L.value,"onUpdate:modelValue":i[10]||(i[10]=e=>L.value=e),style:{"margin-bottom":"10px"}},{default:u((()=>[g("基于上次"),Jl,g("结果搜索")])),_:1},8,["modelValue"]),c(n,{type:"primary",class:"title-handle-btn",onClick:i[11]||(i[11]=e=>T()),disabled:!h.value&&!_.value,loading:D.value},{default:u((()=>[g("搜索")])),_:1},8,["disabled","loading"])])])])),right:u((()=>[r("div",Kl,[ei,r("div",ai,[c(H,null,{default:u((()=>[c(j,{label:"搜索数量"},{default:u((()=>[c(N,{modelValue:I.value,"onUpdate:modelValue":i[12]||(i[12]=e=>I.value=e),min:1,controls:!1},null,8,["modelValue"])])),_:1})])),_:1})])]),r("div",ti,[c($,null,{default:u((()=>[D.value?p("",!0):(a(),t(Nt,{key:0,onHandleshowImage:F,onHandleOpenDir:U,columnCount:3,images:x.value},null,8,["images"]))])),_:1})])])),_:1},8,["leftStyle"]),c(ll,{ref_key:"imageDialogDom",ref:w},null,512)])}}},[["__scopeId","data-v-589b370f"]]);const si={__name:"addOrUpdate",emits:["review"],setup(l,{expose:i,emit:n}){s([]);const d=s(!1),v=s({}),p=s("add"),f=s(["普通会员","超级会员"]),w=s(!1),b=n;return i({init:(e="add",a={name:"",valid_days:0,account_type:"普通会员",available_images:0})=>{v.value=a,p.value=e,d.value=!0}}),(l,i)=>{const s=e("el-input"),n=e("el-form-item"),p=e("el-input-number"),k=e("el-option"),x=e("el-select"),D=e("el-form"),C=e("el-button"),A=e("el-dialog");return a(),t(A,{title:"激活码",modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=e=>d.value=e),"show-close":!1,width:"400","before-close":l.handleClose},{footer:u((()=>[r("div",null,[c(C,{onClick:i[4]||(i[4]=e=>(w.value=!0,void y.post("https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo/add_account",v.value).then((()=>{b("review"),w.value=!1,d.value=!1})).catch((e=>{e.includes("Network Error")?ElMessage.error("网络错误"):ElMessage.error("未知错误")})))),loading:w.value},{default:u((()=>[g("保存")])),_:1},8,["loading"])])])),default:u((()=>[c(D,{"label-width":"100px"},{default:u((()=>[c(n,{label:"用户名"},{default:u((()=>[c(s,{modelValue:v.value.username,"onUpdate:modelValue":i[0]||(i[0]=e=>v.value.username=e)},null,8,["modelValue"])])),_:1}),c(n,{label:"有效时长"},{default:u((()=>[c(p,{modelValue:v.value.valid_days,"onUpdate:modelValue":i[1]||(i[1]=e=>v.value.valid_days=e),controls:!1,precision:0,step:1,min:0},null,8,["modelValue"]),g("  天 ")])),_:1}),c(n,{label:"会员类型"},{default:u((()=>[c(x,{style:{width:"100%","text-align":"left"},modelValue:v.value.account_type,"onUpdate:modelValue":i[2]||(i[2]=e=>v.value.account_type=e)},{default:u((()=>[(a(!0),o(h,null,m(f.value,(e=>(a(),t(k,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(n,{label:"可用图片数量"},{default:u((()=>[c(p,{modelValue:v.value.available_images,"onUpdate:modelValue":i[3]||(i[3]=e=>v.value.available_images=e),controls:!1,precision:0,step:1,min:0},null,8,["modelValue"]),g("  张 ")])),_:1})])),_:1})])),_:1},8,["modelValue","before-close"])}}};const ni=e=>(f("data-v-52ff9cb6"),e=e(),w(),e),oi={class:"table-handle-area"},ri={class:"table-handle-info-area"},di={class:"table-area"},ci={class:"table-area-info"},ui={class:"table-area"},hi=ni((()=>r("br",null,null,-1))),mi=ni((()=>r("br",null,null,-1))),gi={class:"pagination-body"},vi="https://u248120-ac90-72cbfad9.westb.seetacloud.com:8443/demo";var pi=J({__name:"index",setup(l){const i=s([]),d=s(1),h=s(10),m=s(!1),f=s(0),w=s([]);s(["普通会员","超级会员"]);const k=()=>{y.get(`${vi}/get_accounts`).then((({data:e})=>{w.value=e,x()})).catch((e=>{}))},x=()=>{const e=JSON.parse(JSON.stringify(w.value)).filter((({"用户名称":e})=>!C.value||e.includes(C.value)));i.value=e.splice((d.value-1)*h.value,(d.value-1)*h.value+h.value)},D=()=>{d.value=1,x()},C=s(null);return n((()=>{k()})),(l,s)=>{const n=e("el-input"),h=e("el-col"),A=e("el-button"),_=e("el-row"),I=e("el-table-column"),V=e("el-switch"),M=e("el-table"),S=e("el-pagination"),E=O("loading");return P((a(),o("div",{class:"main-body","element-loading-spinner":'<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M60 30C60 46.5685 46.5685 60 30 60C13.4315 60 0 46.5685 0 30C0 13.4315 13.4315 0 30 0C46.5685 0 60 13.4315 60 30ZM9 30C9 41.598 18.402 51 30 51C41.598 51 51 41.598 51 30C51 18.402 41.598 9 30 9C18.402 9 9 18.402 9 30Z" fill="#E6EAEE"/>\n<path d="M45.6207 55.6124C39.8677 59.1211 33.1009 60.5907 26.4108 59.7845C19.7206 58.9783 13.4967 55.9432 8.74189 51.1682C3.98711 46.3932 0.978394 40.1565 0.200542 33.463C-0.577311 26.7695 0.921008 20.009 4.45407 14.2709C7.98712 8.53278 13.3492 4.15125 19.6761 1.83232C26.0031 -0.48661 32.9266 -0.607895 39.3309 1.48801C45.7353 3.58392 51.2475 7.77495 54.9793 13.3858C58.7112 18.9966 60.4454 25.7005 59.9025 32.4171L50.9317 31.692C51.3118 26.9903 50.0979 22.2976 47.4855 18.37C44.8732 14.4425 41.0147 11.5087 36.5317 10.0416C32.0486 8.57447 27.2022 8.65937 22.7733 10.2826C18.3444 11.9059 14.591 14.9729 12.1178 18.9896C9.64471 23.0063 8.59588 27.7386 9.14038 32.4241C9.68488 37.1096 11.791 41.4753 15.1193 44.8177C18.4477 48.1602 22.8044 50.2848 27.4875 50.8492C32.1706 51.4135 36.9074 50.3848 40.9345 47.9287L45.6207 55.6124Z" fill="#4075E5"/>\n</svg>\n',"element-loading-svg-view-box":"0, 0, 60, 60","element-loading-text":"加载中...","element-loading-background":"#ffffff"},[r("div",oi,[r("div",ri,[c(_,{gutter:20},{default:u((()=>[c(h,{span:4},{default:u((()=>[c(n,{onInput:D,placeholder:"用户名称",modelValue:C.value,"onUpdate:modelValue":s[0]||(s[0]=e=>C.value=e),clearable:""},null,8,["modelValue"])])),_:1}),c(h,{span:12},{default:u((()=>[g("   ")])),_:1}),c(h,{span:8,style:{"text-align":"right"}},{default:u((()=>[c(A,{type:"primary",onClick:s[1]||(s[1]=e=>{f.value.init()})},{default:u((()=>[g("添加激活码")])),_:1})])),_:1})])),_:1})])]),r("div",di,[r("div",ci,[r("div",ui,[c(M,{data:i.value,border:"",height:"100%"},{default:u((()=>[c(I,{label:"用户名称",prop:"用户名称",align:"center"}),c(I,{label:"激活码",prop:"API",align:"center"},{default:u((({row:e})=>[g(v(e.API)+" ",1),c(A,{type:"text",size:"small",onClick:a=>{return t=e.API,(l=document.createElement("textarea")).style.position="fixed",l.style.opacity=0,l.value=t,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),void b.success("复制成功");var t,l}},{default:u((()=>[g(" 复制 ")])),_:2},1032,["onClick"])])),_:1}),c(I,{label:"注册时间",prop:"注册时间",align:"center"}),c(I,{label:"到期时间",prop:"到期时间",align:"center"}),c(I,{label:"会员类型",prop:"会员类型",align:"center"},{default:u((({row:e})=>[g(v(e.会员类型)+" ",1),"普通会员"===e.会员类型?(a(),t(A,{key:0,type:"text",size:"small",onClick:a=>{return t=e.用户名称,m.value=!0,void y.post(`${vi}/upgrade_account`,{username:t}).then((()=>{k(),m.value=!1})).catch((e=>{}));var t}},{default:u((()=>[g("升级")])),_:2},1032,["onClick"])):p("",!0)])),_:1}),c(I,{label:"注册图片数目",prop:"注册图片数目",align:"center"}),c(I,{label:"可用图片数目",prop:"可用图片数目",align:"center"}),c(I,{label:"是否停用",align:"center",fixed:"right"},{default:u((({row:e})=>[c(V,{size:"small",modelValue:e.是否停用,"onUpdate:modelValue":a=>e.是否停用=a,onChange:a=>{return t=e.用户名称,m.value=!0,void y.post(`${vi}/ban_account`,{username:t}).then((()=>{m.value=!1})).catch((e=>{}));var t}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),c(I,{label:"操作",align:"center",fixed:"right"},{default:u((({row:e})=>[c(A,{size:"small",style:{"margin-bottom":"5px"},onClick:a=>{return t=e.用户名称,void L.prompt("请输入延长时间","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/[0-9]?/,inputErrorMessage:"请输入数字"}).then((({value:e})=>{m.value=!0,y.post(`${vi}/span_account`,{username:t,days:e}).then((()=>{m.value=!1,k(),b.success("修改成功")})).catch((e=>{}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var t}},{default:u((()=>[g("延长时间")])),_:2},1032,["onClick"]),hi,c(A,{size:"small",style:{"margin-bottom":"5px"},onClick:a=>{return t=e.用户名称,void L.prompt("请输入增加数量","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/[0-9]?/,inputErrorMessage:"请输入数字"}).then((({value:e})=>{m.value=!0,y.post(`${vi}/addImg_account`,{username:t,available_images:e}).then((()=>{m.value=!1,k(),b.success("修改成功")})).catch((e=>{}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var t}},{default:u((()=>[g("增加次数")])),_:2},1032,["onClick"]),mi,c(A,{type:"danger",size:"small",onClick:a=>{return t=e.用户名称,m.value=!0,void y.post(`${vi}/delete_account`,{username:t}).then((()=>{m.value=!1,k()})).catch((e=>{}));var t}},{default:u((()=>[g("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r("div",gi,[c(S,{small:"",modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=e=>d.value=e),onCurrentChange:s[3]||(s[3]=e=>x()),background:"",layout:"prev, pager, next",total:w.value.length},null,8,["modelValue","total"])])])])]),c(si,{ref_key:"addOrUpdateDom",ref:f,onReview:k},null,512)])),[[E,m.value]])}}},[["__scopeId","data-v-52ff9cb6"]]);const fi={},wi={class:"main-body"},yi=[(e=>(f("data-v-7883bf73"),e=e(),w(),e))((()=>r("iframe",{src:"http://47.88.56.24:5006/"},null,-1)))];var bi=J(fi,[["render",function(e,t){return a(),o("div",wi,yi)}],["__scopeId","data-v-7883bf73"]]);const ki={class:"image-list"},xi=["onClick"],Di="https://u248120-bf23-b1506178.westc.gpuhub.com:8443";var Ci=J({__name:"addImageset",emits:["reviewImageset","reviewImage"],setup(l,{expose:i,emit:n}){const v=n,p=s(!1),f=s(null),w=s(null),D=s([]),C=s([]),_=e=>{const a=new FileReader;return a.onload=({target:a})=>{D.value.push(e),C.value.push(a.result)},a.readAsDataURL(e),!1},I=()=>{if(!D.value.length)return b.error("请上传图片后操作"),!1;(w.value?L:V)().then((()=>{w.value?v("reviewImage"):v("reviewImageset"),p.value=!1}))},L=()=>{const e=new FormData;e.append("dataset",f.value),e.append("imageset",w.value),D.value.forEach((a=>{e.append("images",a)}));const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});return new Promise((t=>{y.post(`${Di}/datasets/upload_image`,e).then((()=>{a.close(),b({type:"success",message:"操作成功"}),t()}))}))},V=()=>{const e=new FormData;e.append("dataset",f.value),D.value.forEach((a=>{e.append("images",a)}));const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});return new Promise((t=>{y.post(`${Di}/datasets/add_imageset`,e).then((()=>{a.close(),b({type:"success",message:"操作成功"}),t()}))}))};return i({init:(e,a=null)=>{f.value=e,w.value=a,p.value=!0,C.value=[],D.value=[]}}),(l,i)=>{const s=e("el-button"),n=e("el-upload"),v=e("el-form-item"),f=e("el-image"),y=e("el-icon"),b=e("el-scrollbar"),k=e("el-form"),L=e("el-dialog");return a(),t(L,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=e=>p.value=e),width:"800",title:w.value?"上传图片":"新建图片集"},{footer:u((()=>[c(s,{onClick:I},{default:u((()=>[g("保存")])),_:1})])),default:u((()=>[c(k,{"label-width":"100px"},{default:u((()=>[c(v,{label:"上传图片"},{default:u((()=>[c(n,{class:"upload-demo","show-file-list":!1,accept:"image/*",action:"''",multiple:"","before-upload":_},{default:u((()=>[c(s,{size:"small"},{default:u((()=>[g(" 上传图片 ")])),_:1})])),_:1})])),_:1}),c(v,{label:"图片预览"},{default:u((()=>[r("div",ki,[c(b,{height:"300px"},{default:u((()=>[(a(!0),o(h,null,m(C.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[c(f,{style:{width:"100%",height:"130px"},src:e,fit:"cover",lazy:""},null,8,["src"]),r("div",{class:"image-icon del",onClick:x((e=>(e=>{D.value.splice(e,1),C.value.splice(e,1)})(t)),["stop"])},[c(y,null,{default:u((()=>[c(d(A))])),_:1})],8,xi)])))),128))])),_:1})])])),_:1})])),_:1})])),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-7985c7ca"]]);const Ai={key:1,class:"image-item"},_i={class:"file-name"};var Ii=J({__name:"addMockup",emits:["review"],setup(l,{expose:i,emit:n}){const h=s(!1),m=s(null),p=s(null),f=s(null),w=s(null),D=n,C=e=>{const a=new FileReader;return a.onload=({target:a})=>{m.value=e,p.value=a.result},a.readAsDataURL(e),!1},_=e=>(f.value=e,!1),I=()=>{if(!w.value)return void b.error("请输入样机名后操作");if(!m.value)return void b.error("请上传封面图后操作");if(!f.value)return void b.error("请上传样机psd后操作");const e=new FormData;e.append("psd_file",f.value),e.append("preview_file",m.value),e.append("mockup_name",w.value);const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post("https://u248120-bf23-b1506178.westc.gpuhub.com:8443/datasets/upload_mockup",e).then((({data:e})=>{a.close(),"错误的psd文件"!==e?(D("review"),h.value=!1,b({type:"success",message:"添加成功"})):b.error("请上传正确的psd文件")}))};return i({init:()=>{m.value=null,p.value=null,f.value=null,h.value=!0}}),(l,i)=>{const s=e("el-input"),n=e("el-form-item"),y=e("el-button"),b=e("el-upload"),k=e("el-image"),D=e("el-icon"),L=e("el-form"),V=e("el-dialog");return a(),t(V,{modelValue:h.value,"onUpdate:modelValue":i[2]||(i[2]=e=>h.value=e),width:"500",title:"添加样机"},{footer:u((()=>[c(y,{onClick:I},{default:u((()=>[g("保存")])),_:1})])),default:u((()=>[c(L,{"label-width":"100px"},{default:u((()=>[c(n,{label:"样机名称"},{default:u((()=>[c(s,{modelValue:w.value,"onUpdate:modelValue":i[0]||(i[0]=e=>w.value=e),clearable:""},null,8,["modelValue"])])),_:1}),c(n,{label:"上传封面图片"},{default:u((()=>[null===p.value?(a(),t(b,{key:0,class:"upload-demo","show-file-list":!1,accept:"image/*",action:"''","before-upload":C},{default:u((()=>[c(y,{size:"small"},{default:u((()=>[g(" 上传图片 ")])),_:1})])),_:1})):(a(),o("div",Ai,[c(k,{style:{width:"100%",height:"130px"},src:p.value,fit:"cover",lazy:""},null,8,["src"]),r("div",{class:"image-icon del",onClick:i[1]||(i[1]=x((e=>(m.value=null,void(p.value=null))),["stop"]))},[c(D,null,{default:u((()=>[c(d(A))])),_:1})])]))])),_:1}),c(n,{label:"上传样机psd"},{default:u((()=>[r("div",_i,v(null===f.value?"暂未上传":f.value.name),1),c(b,{class:"upload-demo","show-file-list":!1,accept:"image/vnd.adobe.photoshop,.psd",action:"''","before-upload":_},{default:u((()=>[c(y,{size:"small"},{default:u((()=>[g(" 上传样机 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-464ac084"]]);const Li=e=>(f("data-v-539e4397"),e=e(),w(),e),Vi={class:"handle-area"},Mi={class:"selected-all-area"},Si={class:"select-all-item"},Ei=Li((()=>r("div",{class:"select-all-name"},"样机",-1))),Pi={class:"select-all-item"},Ri=Li((()=>r("div",{class:"select-all-name"},"数据集",-1))),Ti={class:"other-select-area"},Yi={class:"select-list"},Fi=["onClick"],Ui={class:"selected-name"},Xi={class:"select-list"},Oi=["onClick"],Zi={class:"selected-name"},Wi={key:0,class:"progress-area"},zi={class:"progress-item"},Ni={class:"btn-area"},ji="https://u248120-bf23-b1506178.westc.gpuhub.com:8443";var Hi=J({__name:"updateMockupImage",emits:["review"],setup(l,{expose:i,emit:n}){const d=s(!1),f=s([]),w=s([]),k=s(!1),D=s([]),C=s([]),A=s(!1),_=s(!0),L=s(1),V=s(1),M=s(!1),S=n,E=()=>{if(!w.value.length)return void b.error("请选择样机后操作");if(!C.value.length)return void b.error("请选择数据集后操作");const e=[];w.value.forEach((a=>{C.value.forEach((t=>{e.push({mockup:a,dataset:t})}))})),L.value=e.length+1,V.value=1,M.value=!0,e.forEach((({mockup:e,dataset:a})=>{const t=new FormData;t.append("mockup",e),t.append("dataset",a),y.post(`${ji}/datasets/update_mockup_image`,t).then((()=>{V.value+=1,V.value===L.value&&(M.value=!1)})).catch((()=>{V.value+=1,V.value===L.value&&(M.value=!1)}))}))},P=()=>{d.value=!1,S("review")};return F(k,(e=>{_.value&&(w.value=e?JSON.parse(JSON.stringify(f.value)):[])})),F(A,(e=>{_.value&&(C.value=e?JSON.parse(JSON.stringify(D.value)):[])})),i({init:(e,a)=>{d.value=!0,f.value=e,D.value=a,L.value=1,V.value=1,w.value=[],C.value=[],k.value=!1,A.value=!1}}),(l,i)=>{const s=e("el-checkbox"),n=e("el-image"),y=e("el-scrollbar"),b=e("el-button"),S=e("el-dialog");return a(),t(S,{modelValue:d.value,"onUpdate:modelValue":i[3]||(i[3]=e=>d.value=e),width:"800",title:"更新样机图片","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:u((()=>[r("div",Vi,[r("div",Mi,[r("div",Si,[Ei,c(s,{modelValue:k.value,"onUpdate:modelValue":i[0]||(i[0]=e=>k.value=e),value:!0},{default:u((()=>[g("全选")])),_:1},8,["modelValue"])]),r("div",Pi,[Ri,c(s,{modelValue:A.value,"onUpdate:modelValue":i[1]||(i[1]=e=>A.value=e),value:!0},{default:u((()=>[g("全选")])),_:1},8,["modelValue"])])]),r("div",Ti,[r("div",Yi,[c(y,null,{default:u((()=>[(a(!0),o(h,null,m(f.value,((e,t)=>{return a(),o("div",{class:T(["selected-item",{selected:(l=e,-1!==w.value.findIndex((e=>e===l)))}]),onClick:a=>(e=>{const a=w.value.findIndex((a=>a===e));a>=0?(1!==w.value.length&&(_.value=!1),k.value=!1,w.value.splice(a,1),W((()=>{_.value=!0}))):w.value.length+1===f.value.length?k.value=!0:w.value.push(e)})(e),key:t},[c(n,{style:{width:"50px",height:"50px","margin-right":"10px"},onClick:i[2]||(i[2]=x((()=>{}),["stop"])),previewSrcList:[`${ji}/datasets/mockups/${e}`],src:`${ji}/datasets/mockups/${e}`},null,8,["previewSrcList","src"]),r("div",Ui,v(e),1)],10,Fi);var l})),128))])),_:1})]),r("div",Xi,[c(y,null,{default:u((()=>[(a(!0),o(h,null,m(D.value,((e,t)=>{return a(),o("div",{class:T(["selected-item",{selected:(l=e,-1!==C.value.findIndex((e=>e===l)))}]),onClick:a=>(e=>{const a=C.value.findIndex((a=>a===e));a>=0?(1!==C.value.length&&(_.value=!1),A.value=!1,C.value.splice(a,1),W((()=>{_.value=!0}))):C.value.length+1===D.value.length?A.value=!0:C.value.push(e)})(e),key:t},[r("div",Zi,v(e),1)],10,Oi);var l})),128))])),_:1})])])]),L.value!==V.value?(a(),o("div",Wi,[r("div",zi,[r("div",{class:"progress-info",style:I({width:V.value/L.value*100+"%"})},null,4)])])):p("",!0),r("div",Ni,[M.value?p("",!0):(a(),t(b,{key:0,type:"primary",onClick:P},{default:u((()=>[g("关闭")])),_:1})),c(b,{type:"primary",disabled:M.value,onClick:E},{default:u((()=>[g("开始")])),_:1},8,["disabled"])])])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-539e4397"]]);const $i={class:"main-body"},Gi={class:"dataset"},Bi=(e=>(f("data-v-60759a44"),e=e(),w(),e))((()=>r("div",{class:"dataset-title"},"图像数据集",-1))),Qi={class:"dataset-list"},qi=["onClick"],Ji={class:"dataset-handle"},Ki={class:"add-dataset-btn"},es={class:"handle-area"},as={class:"image-area"},ts={class:"image-name"},ls=["onClick"],is={key:3,class:"image-icon"},ss={class:"image-name"},ns="https://u248120-bf23-b1506178.westc.gpuhub.com:8443";var os=J({__name:"index",setup(l){const i=s([]),f=s(0),w=s([]),D=s([]),C=s([]),_=s(null),I=s(null),V=s("addImagesetDom"),M=s("addMockupDom"),S=s("updateMockupImageDom"),E=()=>{w.value=[],y.get(`${ns}/datasets/datasets`).then((e=>{const{data:a}=e;i.value=a}))},P=()=>{f.value=0,w.value=[],_.value=null,I.value=null,y.get(`${ns}/datasets/mockups`).then((e=>{const{data:a}=e;D.value=a}))},R=e=>{e=e||_.value,f.value=1,w.value=[];const a=new FormData;a.append("dataset",e),_.value=e,y.post(`${ns}/datasets/get_imagesets`,a).then((e=>{const{data:a}=e;w.value=a}))},T=e=>{const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("dataset",_.value),t.append("imageset",e),y.post(`${ns}/datasets/delete_imageset`,t).then((()=>{a.close(),R(),b({type:"success",message:"删除成功"})}))},Y=e=>{const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData;t.append("dataset",_.value),t.append("imageset",I.value),t.append("image_name",e),y.post(`${ns}/datasets/delete_image`,t).then((()=>{a.close(),O(),b({type:"success",message:"删除成功"})}))},F=()=>{V.value.init(_.value)},U=()=>{V.value.init(_.value,I.value)},X=()=>{S.value.init(D.value,i.value)},O=e=>{e=e||I.value,I.value=e;const a=new FormData;a.append("dataset",_.value),a.append("imageset",e),y.post(`${ns}/datasets/get_images`,a).then((e=>{const{data:a}=e;C.value=a}))},Z=()=>{M.value.init()},W=()=>{f.value=0,I.value=null,_.value=null,C.value=[],D.value=[],w.value=[],E(),P()};return n((()=>{W()})),(l,s)=>{const n=e("el-button"),N=e("el-scrollbar"),j=e("el-image"),H=e("el-icon");return a(),o("div",$i,[c(Ha,null,{left:u((()=>[r("div",Gi,[r("label",{class:"dataset-name",onClick:s[0]||(s[0]=e=>P())},"样机数据集")]),Bi,r("div",Qi,[c(N,null,{default:u((()=>[(a(!0),o(h,null,m(i.value,((e,t)=>(a(),o("div",{class:"dataset",key:t},[r("label",{class:"dataset-name",onClick:a=>R(e)},v(e),9,qi),r("label",Ji,[c(n,{type:"text",class:"text-btn",onClick:a=>{return t=e,void L.prompt("请输入数据集名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputValue:t}).then((({value:e})=>{if(i.value.find((a=>a===e)))return void b.error("数据集名称不可重复");const a=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),l=new FormData;l.append("dataset_name",t),l.append("new_name",e),y.post(`${ns}/datasets/rename_dataset`,l).then((()=>{a.close(),E(),b({type:"success",message:"修改成功"})}))})).catch((()=>{b({type:"info",message:"取消操作"})}));var t}},{default:u((()=>[g("重命名")])),_:2},1032,["onClick"]),c(n,{type:"text",class:"text-btn danger",onClick:a=>{return t=e,void L.confirm("此操作不可逆是否继续?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),a=new FormData;a.append("dataset_name",t),y.post(`${ns}/datasets/delete_dataset`,a).then((()=>{e.close(),E(),b({type:"success",message:"删除成功"})}))})).catch((()=>{b({type:"info",message:"取消删除"})}));var t}},{default:u((()=>[g("删除")])),_:2},1032,["onClick"])])])))),128))])),_:1})]),r("div",Ki,[c(n,{style:{width:"100%"},type:"primary",onClick:s[1]||(s[1]=e=>{L.prompt("请输入数据集名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((({value:e})=>{if(!e)return void b.error("请输入数据集名称");if(i.value.find((a=>a===e)))return void b.error("数据集名称不可重复");const a=new FormData;a.append("dataset_name",e);const t=k.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});y.post(`${ns}/datasets/add_dataset`,a).then((()=>{t.close(),E(),b({type:"success",message:"添加成功"})}))})).catch((()=>{b({type:"info",message:"取消操作"})}))})},{default:u((()=>[g(" 添加图像数据集 ")])),_:1})])])),right:u((()=>[r("div",es,[r("div",null,[I.value?(a(),t(n,{key:0,type:"text",onClick:s[2]||(s[2]=e=>(I.value=null,void(C.value=[])))},{default:u((()=>[g("返回")])),_:1})):p("",!0)]),r("div",null,[0===f.value?(a(),t(n,{key:0,type:"primary",onClick:Z},{default:u((()=>[g("新增样机数据")])),_:1})):p("",!0),c(n,{type:"primary",onClick:X},{default:u((()=>[g("更新样机图片")])),_:1}),1!==f.value||I.value?p("",!0):(a(),t(n,{key:1,onClick:F},{default:u((()=>[g("新增图片集")])),_:1})),1===f.value&&I.value?(a(),t(n,{key:2,onClick:U},{default:u((()=>[g("上传图片")])),_:1})):p("",!0)])]),r("div",as,[c(N,null,{default:u((()=>[0===f.value?(a(!0),o(h,{key:0},m(D.value,((e,t)=>(a(),o("div",{class:"image-item",key:t},[c(j,{style:{width:"100%",height:"190px"},previewSrcList:[`${ns}/datasets/mockups/${e}`],src:`${ns}/datasets/mockups/${e}`,fit:"cover",lazy:""},null,8,["previewSrcList","src"]),r("div",ts,v(e),1)])))),128)):p("",!0),1===f.value?(a(!0),o(h,{key:1},m(I.value?C.value:w.value,((e,l)=>(a(),o("div",{class:"image-item",key:l},[I.value?(a(),t(j,{key:0,style:{width:"100%",height:"190px"},previewSrcList:[`${ns}/datasets/datasets/${_.value}/${I.value}/${e}`],src:`${ns}/datasets/datasets/${_.value}/${I.value}/${e}`,fit:"cover",lazy:""},null,8,["previewSrcList","src"])):(a(),t(j,{key:1,style:{width:"100%",height:"190px"},fit:"cover",onClick:a=>O(e),lazy:"",src:`${ns}/datasets/datasets/${_.value}/${e}/${e}`},null,8,["onClick","src"])),!I.value||I.value&&l?(a(),o("div",{key:2,class:"image-icon del",onClick:x((a=>(e=>{L.confirm("此操作不可逆是否继续?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{I.value?Y(e):T(e)})).catch((()=>{b({type:"info",message:"取消操作"})}))})(e)),["stop"])},[c(H,null,{default:u((()=>[c(d(A))])),_:1})],8,ls)):p("",!0),I.value?p("",!0):(a(),o("div",is,[c(H,null,{default:u((()=>[c(d(z))])),_:1})])),r("div",ss,v(e),1)])))),128)):p("",!0)])),_:1})])])),_:1}),c(Ci,{ref_key:"addImagesetDom",ref:V,onReviewImageset:R,onReviewImage:O},null,512),c(Ii,{ref_key:"addMockupDom",ref:M,onReview:P},null,512),c(Hi,{ref_key:"updateMockupImageDom",ref:S,onReview:W},null,512)])}}},[["__scopeId","data-v-60759a44"]]);const rs="_AICLOTH_CONSOLE_",ds="_AICLOTH_CONSOLE__token";function cs(e){localStorage.setItem(rs+"USER",JSON.stringify(e))}function us(){const e=N.get(ds);return""!==e||void 0!==e||null!==e?e:null}function hs(e,a){localStorage.setItem(rs+e,JSON.stringify(a))}const ms=y.create({baseURL:"http://www.weishih-ai.com:10010/dev-api",timeout:6e4,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});function gs(e){if(!e.response)return b.error({message:"请求超时",description:`${e.toString()}`}),Promise.reject(e);us();const a=e.response.status,t=e.response.data,{userStore:l}=ws;return 401===a?(b.error({message:"登录失效, 请重新登陆"}),l.handleLogout().then((()=>{setTimeout((()=>{ys.replace("/login")}),1500)}))):400!==a&&500!==a||b.error({message:t.message}),Promise.reject(e)}ms.interceptors.request.use((e=>{const a=us()||"22";return a&&e.headers&&(e.headers["X-Auth-Token"]=a),e}),gs),ms.interceptors.response.use((e=>200===e.status?e.data||{}:Promise.reject("")),gs);const vs=j({id:"users",state:()=>({user:null,permissions:null,token:"",workingTenant:null}),getters:{getUser(){return this.user},getPermissions(){return this.permissions}},actions:{handleLogin(e){return new Promise(((a,t)=>{var l;(l=e,ms.post("/sso/api/v1/session/login",l)).then((e=>{const t=e.token;var l;this.token=t.token,this.user=t.user,this.workingTenant=t.working_tenant,hs("workingTenant",t.working_tenant),cs(t.user),l=t.token,N.set(ds,l,{expires:1}),a({...t.user,needPasswd:e.need_passwd}),ms.get("/sso/api/v1/roles").then((e=>{hs("roles",e.roles||[])}))})).catch((e=>{t(e)}))}))},handleLogout(e=""){return new Promise(((e,a)=>{N.remove(ds),localStorage.removeItem(rs+"USER"),this.user=null,this.permissions=null,this.token="",cs(null),e(null)}))},getUserInfo(){return new Promise(((e,a)=>{ms.get("/sso/api/v1/accounts/get").then((a=>{const t=function(){const e=localStorage.getItem(rs+"USER");return e&&"undefined"!==e?JSON.parse(e):null}()||{};Object.assign(t,a),this.user=t,cs(t);const l=[].concat([t.sys_role]);window.localStorage.setItem("ROLE_PERMISSIONS_LIST",JSON.stringify(l)),this.permissions=l,e(t)})).catch((e=>{a(e)}))}))}}});const ps={"./modules/user.js":Object.freeze(Object.defineProperty({__proto__:null,useUserStore:vs,setupStore:function(e){return vs(e)}},Symbol.toStringTag,{value:"Module"}))},fs=H(),ws={};Object.keys(ps).forEach((e=>{const a=e.match(/([a-zA-Z]*)\.js$/)[0].split(".")[0];ws[`${a}Store`]=ps[e].setupStore(fs)}));var ys=$({history:G("/"),routes:[{path:"/",name:"home",component:fe,redirect:"/ImageGenerationImage",children:[{path:"imageSearch",name:"imageSearch",component:xl},{path:"gallery",name:"gallery",component:Zl},{path:"superImageSearch",name:"superImageSearch",component:ii},{path:"activationKeys",name:"activationKeys",component:pi},{path:"ImageGenerationImage",name:"ImageGenerationImage",component:na},{path:"swapFace",name:"swapFace",component:za},{path:"partialModifications",name:"partialModifications",component:vt},{path:"trainModel",name:"trainModel",component:bi},{path:"imageSearchTrainDataset",name:"imageSearchTrainDataset",component:os}]}]});if("undefined"!=typeof window){let e=function(){var e=document.body,a=document.getElementById("__svg__icons__dom__");a||((a=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",a.style.width="0",a.style.height="0",a.id="__svg__icons__dom__",a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),a.innerHTML="",e.insertBefore(a,e.lastChild)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}const bs=B(K);bs.use(H()),bs.use(ys),bs.use(Q,{locale:q}),bs.mount("#app");
