import{r as e,o as a,c as l,g as i,j as t,w as s,S as n,T as u,f as o,b as d,x as r,y as v,z as m,e as c,q as g,A as h,F as y,B as p,h as f,i as k,I as _,u as w,s as b,t as x,U as C,V as j,W as D}from"./lib.078cc1de.js";import{M as T,e as O}from"./explosionDiagram.4caebe97.js";import{r as S,_ as L,T as I,a as E}from"./index.51a089e0.js";const q={class:"model-editor"},A={class:"handle-area"},H={class:"handle-btn-area"},N={class:"model-editor-area"},U={class:"group-list"},$=(e=>(b("data-v-15a1cd0a"),e=e(),x(),e))((()=>i("div",{class:"group-list-title"},"图层",-1))),B={class:"group-list-info"},J=["onClick"],P=["onClick"],z={key:0,class:"layer-item-image"},F=["src"],G={class:"layer-item-name"};var M=L({__name:"index",setup(b){const x=r(),L=v(),M=e("explosionDiagramDom"),V=e("modelEditorDom"),W=e(null),K=e(190),Q=e(220),R=e(1),X=e([]),Y=e(null),Z=e(null),ee=e([]),ae=e("editor"),le=e([]),ie=e([]),te=e(""),se=e({}),ne="editor",ue="explosion",oe=e({width:0,height:0}),de=()=>{window.loading=I(),setTimeout((()=>{x.replace("main")}),300)},re=(e=null)=>{e=e||W.value.getTypeList(),X.value=Object.keys(e).map((a=>(X.value.length||(W.value.setTypeUuid(a),Z.value=a),{uuid:a,name:e[a].name,image:e[a].image})))},ve=()=>{M.value.changeExplosionType("CHANGE")},me=()=>{le.value=ie.value.filter((({uuid:e})=>!ee.value.find((a=>a===e))))},ce=()=>{const e=I();let a=0;Object.keys(se.value).forEach((l=>{ge(l).then((i=>{i?W.value.changeImage(l,i).then((()=>{a++,a===Object.keys(se.value).length&&(re(),e.close())})):(a++,a===Object.keys(se.value).length&&(re(),e.close()))}))}))},ge=e=>new Promise(((a,l)=>{(function(e,a){return S.post(`/teai/generate?layout_name=${e}&layer_name=${a}`)})(te.value,e).then((e=>{he(e).then((e=>{a(e)}))}))})),he=(e,a=0)=>new Promise(((l,i)=>{(function(e){return S.post(`/teai/query_task?task_id=${e}`)})(e).then((i=>{"error"===i?l(null):"processing"===i?++a>=30?l(null):setTimeout((()=>{l(he(e,a))}),2e3):l(i)}))})),ye=()=>{ae.value===ne?(W.value.removeListener(),W.value.getAllLayerImage().then((e=>{ie.value=Object.keys(e).map((a=>Object.assign({uuid:a,imageSrc:e[a].imageBase64},e[a]))).reverse(),me(),ae.value=ue}))):(ae.value=ne,C((()=>{W.value.addListener()})))},pe=()=>{W.value.exportImage()};return a((()=>{te.value=L.query.file_name,W.value=new T(V.value,{width:K.value*R.value,height:Q.value*R.value}),Y.value=W.value.getHandleType(),ee.value=W.value.hideLayerList,oe.value=W.value.getCanvasStyle(),window.loading||(window.loading=I()),E("layouts",te.value).then((e=>{const a=JSON.parse(JSON.stringify(e));delete a.preview,delete a.viewData,se.value=a,W.value.setData(e.viewData).then((({typeList:e})=>{re(e),oe.value=W.value.getCanvasStyle(),window.loading.close(),window.loading=null}))}))})),(e,a)=>{const r=m("t-button"),v=m("el-form-item"),b=m("el-form"),x=m("el-icon"),C=m("el-scrollbar");return c(),l("div",q,[i("div",A,[i("div",H,[t(b,{inline:""},{default:s((()=>[t(v,{label:"","label-width":"0"},{default:s((()=>[t(r,{style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},type:"text-info",onClick:de},{default:s((()=>[g("返回")])),_:1})])),_:1}),t(v,{label:"","label-width":"0"},{default:s((()=>[t(r,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:ye},{default:s((()=>[g(h("explosion"===ae.value?"编辑器展示":"爆炸图展示"),1)])),_:1})])),_:1}),"explosion"===ae.value?(c(),o(v,{key:0,label:"","label-width":"0"},{default:s((()=>[t(r,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:ve},{default:s((()=>[g("切换爆炸图展示模式")])),_:1})])),_:1})):d("",!0),"editor"===ae.value?(c(),o(v,{key:1,label:"","label-width":"0"},{default:s((()=>[t(r,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:ce},{default:s((()=>[g("生成图片")])),_:1})])),_:1})):d("",!0),"editor"===ae.value?(c(),o(v,{key:2,label:"","label-width":"0"},{default:s((()=>[t(r,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:pe},{default:s((()=>[g("保存图片")])),_:1})])),_:1})):d("",!0)])),_:1})]),i("div",N,[n(i("div",{class:"model-editor-info",ref_key:"modelEditorDom",ref:V},null,512),[[u,"editor"===ae.value]]),"explosion"===ae.value?(c(),o(O,{key:0,explosionStyle:oe.value,data:le.value,ref_key:"explosionDiagramDom",ref:M},null,8,["explosionStyle","data"])):d("",!0)])]),i("div",U,[$,i("div",B,[t(C,null,{default:s((()=>[(c(!0),l(y,null,p(X.value,(e=>(c(),l("div",{class:f(["layer-item",{selected:Z.value===e.uuid}]),key:e.uuid,onClick:a=>{return l=e.uuid,Z.value=l,void W.value.setTypeUuid(l);var l}},[i("div",{class:"layer-select-area",onClick:k((a=>(e=>{const a=I();ge(e).then((l=>{l?W.value.changeImage(e,l).then((()=>{re(),a.close()})):a.close()}))})(e.uuid)),["stop"])},"生成",8,P),e.image?(c(),l("div",z,[i("img",{src:e.image.src},null,8,F)])):d("",!0),i("div",G,h(e.name),1),i("div",{class:"layer-item-handle",onClick:a[0]||(a[0]=k((()=>{}),["stop"]))},[t(x,{onClick:a=>{return l=e.uuid,ee.value=W.value.hideHandle(l),void me();var l}},{default:s((()=>[(c(),o(_(ee.value.find((a=>a===e.uuid))===e.uuid?w(j):w(D))))])),_:2},1032,["onClick"])])],10,J)))),128))])),_:1})])])])}}},[["__scopeId","data-v-15a1cd0a"]]);export{M as default};
