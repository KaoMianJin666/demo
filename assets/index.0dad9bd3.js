import{_ as e,s as a,a as t,g as l,d as n,T as s}from"./index.8c6e66d9.js";import{r as u,z as o,e as i,c as d,f as c,w as v,g as r,q as m,A as p,j as _,b as f,V as y,s as k,t as b,a as g,o as h,F as w,B as V,u as x,_ as C,Z as U,$ as O,n as j,H as D}from"./lib.5034c038.js";const $=e=>(k("data-v-01111be8"),e=e(),b(),e),S={class:"add-or-update"},I={class:"add-or-update-box"},N={class:"title"},J=$((()=>r("div",{class:"close-btn"},null,-1))),L={class:"content"},A={class:"content-item"},F=$((()=>r("div",{class:"content-name"},"名称",-1))),E={class:"content-input"},T={class:"content-item"},B=$((()=>r("div",{class:"content-name"},"静态文件地址",-1))),M={class:"content-input"},z={class:"content-item"},R=$((()=>r("div",{class:"content-name"},"透明度",-1))),q={class:"content-input"},H={class:"content-item"},P=$((()=>r("div",{class:"content-name"},"预览图地址",-1))),Z={class:"content-input"},G={key:0,class:"content-item"},K=$((()=>r("div",{class:"content-name"},"预览图预览",-1))),Q={class:"content-input"},W=["src"],X={class:"footer"};var Y=e({__name:"staticsSettingAddOrUpdate",emits:["review"],setup(e,{expose:t,emit:l}){const n=u("maskDom"),s=u(!1),k=u("add"),b=u(""),g=u(0),h=u(""),w=u(""),V=l,x=()=>{n.value.hide(),setTimeout((()=>{s.value=!1}),200)};return t({init:(e="add",a={})=>{s.value||(s.value=!0,b.value=a.folder||"",h.value=a.name||"",k.value=e,g.value=a.fusion_params?a.fusion_params.transparency:0,w.value=a.preview||"",y((()=>{n.value.show()})))}}),(e,t)=>{const l=o("el-input"),u=o("el-input-number"),y=o("el-scrollbar"),C=o("t-button"),U=o("t-mask");return i(),d("div",S,[s.value?(i(),c(U,{key:0,ref_key:"maskDom",ref:n},{default:v((()=>[r("div",I,[r("div",N,[m(p("add"===k.value?"添加":"编辑")+"静态层 ",1),J]),r("div",L,[_(y,null,{default:v((()=>[r("div",A,[F,r("div",E,[_(l,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),disabled:"update"===k.value},null,8,["modelValue","disabled"])])]),r("div",T,[B,r("div",M,[_(l,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=e=>b.value=e)},null,8,["modelValue"])])]),r("div",z,[R,r("div",q,[_(u,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=e=>g.value=e),controls:!1,min:0,max:1},null,8,["modelValue"])])]),r("div",H,[P,r("div",Z,[_(l,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e)},null,8,["modelValue"])])]),w.value?(i(),d("div",G,[K,r("div",Q,[r("img",{src:w.value},null,8,W)])])):f("",!0)])),_:1})]),r("div",X,[_(C,{class:"footer-button",onClick:t[4]||(t[4]=e=>x())},{default:v((()=>[m("关闭")])),_:1}),_(C,{class:"footer-button",type:"success",onClick:t[5]||(t[5]=e=>(()=>{const e={folder:b.value,fusion_params:{transparency:g.value}},t=JSON.stringify(e),l=new Blob([t],{type:"application/json"}),n=new File([l],`${h.value}.json`,{type:"application/json",lastModified:Date.now()}),s=new FormData;s.append("file",n),a(s,"statics",h.value,w.value).then((e=>{x(),V("review")}))})())},{default:v((()=>[m("保存")])),_:1})])])])),_:1},512)):f("",!0)])}}},[["__scopeId","data-v-01111be8"]]);const ee={class:"setting-card"},ae={key:0,class:"setting-image"},te=["src"],le={class:"setting-name"},ne={class:"setting-name-area"};var se=e({__name:"settingCard",props:{data:{type:Object,default:()=>({preview:null,name:null})}},setup(e){const a=e;return(e,t)=>(i(),d("div",ee,[a.data.preview?(i(),d("div",ae,[r("img",{src:a.data.preview},null,8,te)])):f("",!0),r("div",le,[r("div",ne,p(a.data.name),1),g(e.$slots,"default",{},void 0,!0)])]))}},[["__scopeId","data-v-eee601f2"]]);const ue={class:"statics-setting"},oe={class:"statics-setting-info"},ie={class:"handle-area"};var de=e({__name:"staticsSetting",setup(e,{expose:a}){const s=u({}),p=u("addOrUpdateDom"),f=()=>{t("statics").then((e=>{s.value=e.templates}))},y=(...e)=>{p.value.init(...e)};return h((()=>{f()})),a({addOrUpdate:y}),(e,a)=>{const t=o("t-button"),u=o("el-scrollbar");return i(),d("div",ue,[_(u,null,{default:v((()=>[r("div",oe,[(i(!0),d(w,null,V(Object.keys(s.value),(e=>(i(),c(se,{key:e,data:{name:e,preview:s.value[e].preview}},{default:v((()=>[r("div",ie,[_(t,{type:"text-success",style:{"margin-bottom":"0"},onClick:a=>(({name:e,preview:a})=>{l("statics",e).then((t=>{y("update",Object.assign({name:e,preview:a},t))}))})({name:e,preview:s.value[e].preview})},{default:v((()=>[m("编辑")])),_:2},1032,["onClick"]),_(t,{type:"text-error",style:{"margin-bottom":"0","margin-right":"0"},onClick:a=>(({name:e})=>{n("statics",e).then((e=>{f()}))})({name:e})},{default:v((()=>[m("删除")])),_:2},1032,["onClick"])])])),_:2},1032,["data"])))),128))])])),_:1}),_(Y,{ref_key:"addOrUpdateDom",ref:p,onReview:f},null,512)])}}},[["__scopeId","data-v-6171eb62"]]);const ce=e=>(k("data-v-54814b44"),e=e(),b(),e),ve={class:"add-or-update"},re={class:"add-or-update-box"},me={class:"title"},pe=ce((()=>r("div",{class:"close-btn"},null,-1))),_e={class:"content"},fe={class:"content-item"},ye=ce((()=>r("div",{class:"content-name"},"名称",-1))),ke={class:"content-input"},be={class:"content-item"},ge=ce((()=>r("div",{class:"content-name"},"lora",-1))),he={class:"content-input"},we={class:"content-item"},Ve=ce((()=>r("div",{class:"content-name"},"预览图地址",-1))),xe={class:"content-input"},Ce={key:0,class:"content-item"},Ue=ce((()=>r("div",{class:"content-name"},"预览图预览",-1))),Oe={class:"content-input"},je=["src"],De={class:"content-item"},$e=ce((()=>r("div",{class:"content-name"},"是否需要背景",-1))),Se={class:"content-input"},Ie={class:"content-input"},Ne={key:1,class:"content-item"},Je=ce((()=>r("div",{class:"content-name"},"参考图文件夹",-1))),Le={class:"content-input"},Ae={key:2,class:"content-item"},Fe=ce((()=>r("div",{class:"content-name"},"参考图权重",-1))),Ee={class:"content-input"},Te={class:"content-input"},Be={key:3,class:"content-item"},Me=ce((()=>r("div",{class:"content-name"},"参考图文件夹",-1))),ze={class:"content-input"},Re={key:4,class:"content-item"},qe=ce((()=>r("div",{class:"content-name"},"参考图权重",-1))),He={class:"content-input"},Pe={class:"content-input"},Ze={key:5,class:"prompts-list"},Ge=["onClick"],Ke={class:"content-input"},Qe={class:"content-handle"},We={class:"prompts-list"},Xe={key:0,class:"content-item"},Ye=ce((()=>r("div",{class:"content-name"},"内容",-1))),ea={class:"content-input"},aa=["onClick"],ta={class:"content-input"},la={class:"content-handle"},na={class:"content-item"},sa={key:0,class:"content-input"},ua={key:2,class:"content-item card center"},oa=["onClick"],ia={class:"content-item card center"},da={class:"footer"};var ca=e({__name:"promptSettingAddOrUpdate",emits:["review"],setup(e,{expose:t,emit:l}){const n=u("maskDom"),s=u(!1),k=u("add"),b=l,g=u(!1),h=u(!1),j=u(!1),D=u(new Set([])),$=u(new Set([])),S=u(""),I=u(""),N=u(!0),J=u(""),L=u({probability:20,value:""}),A=u({probability:20,value:""}),F=u([]),E=()=>{n.value.hide(),setTimeout((()=>{s.value=!1}),200)};return t({init:(e="add",a={})=>{if(s.value)return;s.value=!0,g.value=!1,h.value=!1,j.value=!1,S.value=a.name||"",J.value=a.preview||"",a.extra_params?(a.extra_params.ref_style.probability*=100,a.extra_params.ref_struct.probability*=100,I.value=a.extra_params.lora.value,L.value=a.extra_params.ref_style,A.value=a.extra_params.ref_struct,N.value=a.extra_params.remove_bg.value):(I.value=a.extra_params?a.extra_params.lora:"",L.value={probability:20,value:""},A.value={probability:20,value:""},N.value=!0);const t=a.contents||[],l=[];t.forEach((e=>{const a={uuid:O(),content:e.content,maxLength:0,elements:[]},t=[0,0];Object.keys(e).forEach((l=>{l.includes("elements")&&(t.push(Number(l.replaceAll("elements_",""))),a.elements.push({name:l,value:e[l].join(",")}))})),a.maxLength=Math.max(...t),l.push(a)})),F.value=l,k.value=e,y((()=>{n.value.show()}))}}),(e,t)=>{const l=o("el-input"),u=o("el-option"),y=o("el-select"),T=o("el-icon"),B=o("el-input-number"),M=o("t-button"),z=o("el-scrollbar"),R=o("t-mask");return i(),d("div",ve,[s.value?(i(),c(R,{key:0,ref_key:"maskDom",ref:n},{default:v((()=>[r("div",re,[r("div",me,[m(p("add"===k.value?"添加":"编辑")+"Prompt ",1),pe]),r("div",_e,[_(z,null,{default:v((()=>[r("div",fe,[ye,r("div",ke,[_(l,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e),disabled:"update"===k.value},null,8,["modelValue","disabled"])])]),r("div",be,[ge,r("div",he,[_(l,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=e=>I.value=e)},null,8,["modelValue"])])]),r("div",we,[Ve,r("div",xe,[_(l,{modelValue:J.value,"onUpdate:modelValue":t[2]||(t[2]=e=>J.value=e)},null,8,["modelValue"])])]),J.value?(i(),d("div",Ce,[Ue,r("div",Oe,[r("img",{src:J.value},null,8,je)])])):f("",!0),r("div",De,[$e,r("div",Se,[_(y,{modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=e=>N.value=e)},{default:v((()=>[_(u,{value:!0,label:"是"}),_(u,{value:!1,label:"否"})])),_:1},8,["modelValue"])])]),r("div",{class:"content-item card",onClick:t[4]||(t[4]=e=>g.value=!g.value)},[r("div",Ie,[g.value?(i(),c(T,{key:1},{default:v((()=>[_(x(U))])),_:1})):(i(),c(T,{key:0},{default:v((()=>[_(x(C))])),_:1})),m(" 风格参考 ")])]),g.value?(i(),d("div",Ne,[Je,r("div",Le,[_(l,{modelValue:L.value.value,"onUpdate:modelValue":t[5]||(t[5]=e=>L.value.value=e)},null,8,["modelValue"])])])):f("",!0),g.value?(i(),d("div",Ae,[Fe,r("div",Ee,[_(B,{controls:!1,modelValue:L.value.probability,"onUpdate:modelValue":t[6]||(t[6]=e=>L.value.probability=e)},null,8,["modelValue"]),m(" % ")])])):f("",!0),r("div",{class:"content-item card",onClick:t[7]||(t[7]=e=>h.value=!h.value)},[r("div",Te,[h.value?(i(),c(T,{key:1},{default:v((()=>[_(x(U))])),_:1})):(i(),c(T,{key:0},{default:v((()=>[_(x(C))])),_:1})),m(" 结构参考 ")])]),h.value?(i(),d("div",Be,[Me,r("div",ze,[_(l,{modelValue:A.value.value,"onUpdate:modelValue":t[8]||(t[8]=e=>A.value.value=e)},null,8,["modelValue"])])])):f("",!0),h.value?(i(),d("div",Re,[qe,r("div",He,[_(B,{controls:!1,modelValue:A.value.probability,"onUpdate:modelValue":t[9]||(t[9]=e=>A.value.probability=e)},null,8,["modelValue"]),m(" % ")])])):f("",!0),r("div",{class:"content-item card",onClick:t[10]||(t[10]=e=>j.value=!j.value)},[r("div",Pe,[j.value?(i(),c(T,{key:1},{default:v((()=>[_(x(U))])),_:1})):(i(),c(T,{key:0},{default:v((()=>[_(x(C))])),_:1})),m(" 提示词 ")])]),j.value?(i(),d("div",Ze,[(i(!0),d(w,null,V(F.value,((e,a)=>(i(),d("div",{class:"prompt-item",key:e.uuid},[r("div",{class:"content-item card",onClick:a=>{return t=e.uuid,void(D.value.has(t)?D.value.delete(t):D.value.add(t));var t}},[r("div",Ke,[D.value.has(e.uuid)?(i(),c(T,{key:1},{default:v((()=>[_(x(U))])),_:1})):(i(),c(T,{key:0},{default:v((()=>[_(x(C))])),_:1})),m(" 提示词"+p(a+1),1)]),r("div",Qe,[_(M,{type:"text-error",style:{"line-height":"0.4rem"},onClick:a=>(e=>{const a=F.value.findIndex((a=>a.uuid===e));F.value.splice(a,1)})(e.uuid)},{default:v((()=>[m("删除")])),_:2},1032,["onClick"])])],8,Ge),r("div",We,[D.value.has(e.uuid)?(i(),d("div",Xe,[Ye,r("div",ea,[_(l,{type:"textarea",resize:"none",modelValue:e.content,"onUpdate:modelValue":a=>e.content=a},null,8,["modelValue","onUpdate:modelValue"])])])):f("",!0),D.value.has(e.uuid)?(i(!0),d(w,{key:1},V(e.elements,(a=>(i(),d("div",{key:a.name},[r("div",{class:"content-item card",onClick:t=>{return l=`${e.uuid}_${a.name}`,void($.value.has(l)?$.value.delete(l):$.value.add(l));var l}},[r("div",ta,[$.value.has(`${e.uuid}_${a.name}`)?(i(),c(T,{key:1},{default:v((()=>[_(x(U))])),_:1})):(i(),c(T,{key:0},{default:v((()=>[_(x(C))])),_:1})),m(" "+p(a.name.replace("elements_","参数")),1)]),r("div",la,[_(M,{type:"text-error",style:{"line-height":"0.4rem"},onClick:t=>((e,a)=>{const t=F.value.findIndex((a=>a.uuid===e)),l=F.value[t].elements.findIndex((e=>e.name===a));F.value[t].content=F.value[t].content.replaceAll(`{${a}}`,""),F.value[t].elements.splice(l,1)})(e.uuid,a.name)},{default:v((()=>[m("删除")])),_:2},1032,["onClick"])])],8,aa),r("div",na,[$.value.has(`${e.uuid}_${a.name}`)?(i(),d("div",sa,[_(l,{placeholder:"请以英文逗号分隔",modelValue:a.value,"onUpdate:modelValue":e=>a.value=e},null,8,["modelValue","onUpdate:modelValue"])])):f("",!0)])])))),128)):f("",!0),D.value.has(e.uuid)?(i(),d("div",ua,[r("div",{class:"content-input",onClick:a=>((e,a)=>{const t=F.value.findIndex((a=>a.uuid===e));F.value[t].maxLength+=1,F.value[t].content+=`{elements_${F.value[t].maxLength}}`,F.value[t].elements.push({name:`elements_${F.value[t].maxLength}`,values:[""]})})(e.uuid)},"添加参数",8,oa)])):f("",!0)])])))),128)),r("div",ia,[r("div",{class:"content-input",onClick:t[11]||(t[11]=e=>(()=>{const e=O();F.value.push({uuid:e,content:"",maxLength:0,elements:[]})})())},"添加提示词")])])):f("",!0)])),_:1})]),r("div",da,[_(M,{class:"footer-button",onClick:t[12]||(t[12]=e=>E())},{default:v((()=>[m("关闭")])),_:1}),_(M,{class:"footer-button",type:"success",onClick:t[13]||(t[13]=e=>(()=>{const e=JSON.parse(JSON.stringify(A.value));e.probability/=100;const t=JSON.parse(JSON.stringify(L.value));t.probability/=100;const l={contents:[],extra_params:{lora:{value:I.value},ref_struct:e,ref_style:t,remove_bg:{value:N.value}}};F.value.forEach((e=>{const a={content:e.content};e.elements.forEach((e=>{a[e.name]=e.value.split(",")})),l.contents.push(a)}));const n=JSON.stringify(l),s=new Blob([n],{type:"application/json"}),u=new File([s],`${S.value}.json`,{type:"application/json",lastModified:Date.now()}),o=new FormData;o.append("file",u),a(o,"prompts",S.value,J.value).then((e=>{E(),b("review")}))})())},{default:v((()=>[m("保存")])),_:1})])])])),_:1},512)):f("",!0)])}}},[["__scopeId","data-v-54814b44"]]);const va={class:"prompt-setting"},ra={class:"prompt-setting-info"},ma={class:"handle-area"};var pa=e({__name:"promptSetting",setup(e,{expose:a}){const s=u({}),p=u("addOrUpdateDom"),f=()=>{t("prompts").then((e=>{s.value=e.templates}))},y=(...e)=>{p.value.init(...e)};return h((()=>{f()})),a({addOrUpdate:y}),(e,a)=>{const t=o("t-button"),u=o("el-scrollbar");return i(),d("div",va,[_(u,null,{default:v((()=>[r("div",ra,[(i(!0),d(w,null,V(Object.keys(s.value),(e=>(i(),c(se,{key:e,data:{name:e,preview:s.value[e].preview}},{default:v((()=>[r("div",ma,[_(t,{type:"text-success",style:{"margin-bottom":"0"},onClick:a=>(({name:e,preview:a})=>{l("prompts",e).then((t=>{y("update",Object.assign({name:e,preview:a},t))}))})({name:e,preview:s.value[e].preview})},{default:v((()=>[m("编辑")])),_:2},1032,["onClick"]),_(t,{type:"text-error",style:{"margin-bottom":"0","margin-right":"0"},onClick:a=>(({name:e})=>{n("prompts",e).then((e=>{f()}))})({name:e})},{default:v((()=>[m("删除")])),_:2},1032,["onClick"])])])),_:2},1032,["data"])))),128))])])),_:1}),_(ca,{ref_key:"addOrUpdateDom",ref:p,onReview:f},null,512)])}}},[["__scopeId","data-v-74c54836"]]);const _a={class:"prompt-setting"},fa={class:"prompt-setting-handle-area"},ya={class:"change-setting-type-area"},ka=["onClick"],ba={class:"prompt-setting-component-area"};var ga=e({__name:"index",setup(e){const a=[{name:"静态层配置",component:de},{name:"prompt配置",component:pa}],t=u(0),l=u("componentDom");return h((()=>{window.loading||(window.loading=s()),setTimeout((()=>{window.loading.close(),window.loading=null}),300)})),(e,n)=>{const s=o("t-button");return i(),d("div",_a,[r("div",fa,[r("div",ya,[r("div",{class:"component-selected",style:j({left:3.2*t.value+.05+"rem"})},null,4),(i(),d(w,null,V(a,((e,a)=>r("div",{class:"component-item",onClick:e=>t.value=a,key:e.name},p(e.name),9,ka))),64))]),_(s,{style:{margin:"0",width:"2.5rem","text-align":"center"},type:"warn",onClick:n[0]||(n[0]=e=>{l.value.addOrUpdate()})},{default:v((()=>[m("新增")])),_:1})]),r("div",ba,[(i(),c(D(a[t.value].component),{ref_key:"componentDom",ref:l},null,512))])])}}},[["__scopeId","data-v-7054c2d2"]]);export{ga as default};
