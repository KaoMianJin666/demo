import{r as e,o as a,c as l,g as i,j as t,w as s,T as n,U as o,f as u,b as r,x as d,y as v,z as c,e as m,q as h,A as g,F as y,B as p,i as f,H as k,u as w,s as _,t as b,V as C,X as x,Y as D,Z as S,_ as E}from"./lib.5034c038.js";import{M as j,e as L}from"./explosionDiagram.86f65b93.js";import{r as T,_ as I,T as O,g as $}from"./index.8c6e66d9.js";function H(e,a){return a.every((a=>new Set(e).has(a)))}const P={class:"model-editor"},q={class:"handle-area"},A={class:"handle-btn-area"},N={class:"model-editor-area"},B={class:"group-list"},J=(e=>(_("data-v-59be3780"),e=e(),b(),e))((()=>i("div",{class:"group-list-title"},"组/图层",-1))),z={class:"group-list-info"},F=["onClick"],G=["onClick"],M={class:"layer-item-name"},U={class:"layer-item-handle"},V={key:0,class:"layer-area"},X=["onClick"],Y={key:0,class:"layer-item-image"},Z=["src"],K={class:"layer-item-name"};var Q=I({__name:"index",setup(_){const b=d(),I=v(),Q=e("explosionDiagramDom"),R=e("modelEditorDom"),W=e(null),ee=e(190),ae=e(220),le=e(1),ie=e([]),te=e(null);e(null);const se=e([]),ne=e("editor"),oe=e([]),ue=e([]),re=e(""),de=e({}),ve="editor",ce="explosion",me=e({width:0,height:0}),he=e(new Set),ge=e([]),ye=()=>{window.loading=O(),setTimeout((()=>{b.replace("main")}),300)},pe=e=>{se.value=W.value.hideHandle(e),ke()},fe=()=>{Q.value.changeExplosionType("CHANGE")},ke=()=>{oe.value=ue.value.filter((({uuid:e})=>!se.value.find((a=>a===e))))},we=()=>{const e=O();_e().then((()=>{e.close()}))},_e=(e=[],a=0)=>(e=e.length?e:ge.value,new Promise((l=>{be(e[a]).then((()=>{(a+=1)===e.length?l():l(_e(e,a))}))}))),be=e=>{const{layers:a,uuid:l}=e;return new Promise((e=>{Ce(l,a.length).then((l=>{xe(l).then((l=>{l.length?l.length===a.length?(a.forEach(((e,a)=>{l[a]&&W.value.changeImage(e,l[a])})),e()):l.forEach(((e,l)=>{e&&W.value.changeImage(a[l],e)})):e()}))}))}))},Ce=(e,a)=>new Promise((l=>{(function(e,a,l=1){return T.post(`/teai/generate?layout_name=${e}&layer_name=${a}&num_images=${l}`)})(re.value,e,a).then((e=>{l(e)}))})),xe=(e,a=0,l=0,i=[])=>{const t=e[a];return new Promise((s=>{var n;(n=t,T.post(`/teai/query_task?task_id=${n}`)).then((t=>{"error"===t?(l=0,a+=1,i.push("")):"processing"===t?++l>=30&&(l=0,a+=1,i.push("")):(l=0,a+=1,i.push(t)),a===e.length?s(i):setTimeout((()=>{s(xe(e,a,l,i))}),2e3)}))}))},De=()=>{ne.value===ve?(W.value.removeListener(),W.value.getAllLayerImage().then((e=>{ue.value=Object.keys(e).map((a=>Object.assign({uuid:a,imageSrc:e[a].imageBase64},e[a]))).reverse(),ke(),ne.value=ce}))):(ne.value=ve,C((()=>{W.value.addListener()})))},Se=()=>{window.loading||(window.loading=O()),$("layouts",re.value).then((e=>{const a=JSON.parse(JSON.stringify(e));delete a.preview,delete a.viewData,de.value=a,W.value.setData(e.viewData).then((({typeList:e,groups:a})=>{((e=null)=>{e=e||W.value.getTypeList(),ie.value={},Object.keys(e).forEach((a=>{ie.value[a]={name:e[a].name,image:e[a].image}}))})(e),ge.value=a,me.value=W.value.getCanvasStyle(),window.loading.close(),window.loading=null}))}))},Ee=()=>{W.value.exportImage()};return a((()=>{re.value=I.query.file_name,W.value=new j(R.value,{width:ee.value*le.value,height:ae.value*le.value}),te.value=W.value.getHandleType(),se.value=W.value.hideLayerList,me.value=W.value.getCanvasStyle(),Se()})),(e,a)=>{const d=c("t-button"),v=c("el-form-item"),_=c("el-form"),b=c("el-icon"),C=c("el-scrollbar");return m(),l("div",P,[i("div",q,[i("div",A,[t(_,{inline:""},{default:s((()=>[t(v,{label:"","label-width":"0"},{default:s((()=>[t(d,{style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},type:"text-info",onClick:ye},{default:s((()=>[h("返回")])),_:1})])),_:1}),t(v,{label:"","label-width":"0"},{default:s((()=>[t(d,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:De},{default:s((()=>[h(g("explosion"===ne.value?"编辑器展示":"爆炸图展示"),1)])),_:1})])),_:1}),"explosion"===ne.value?(m(),u(v,{key:0,label:"","label-width":"0"},{default:s((()=>[t(d,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:fe},{default:s((()=>[h("切换爆炸图展示模式")])),_:1})])),_:1})):r("",!0),"editor"===ne.value?(m(),u(v,{key:1,label:"","label-width":"0"},{default:s((()=>[t(d,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:we},{default:s((()=>[h("生成图片")])),_:1})])),_:1})):r("",!0),"editor"===ne.value?(m(),u(v,{key:2,label:"","label-width":"0"},{default:s((()=>[t(d,{type:"info",style:{height:"1rem",padding:"0.1rem","line-height":"1rem"},onClick:Ee},{default:s((()=>[h("保存图片")])),_:1})])),_:1})):r("",!0)])),_:1})]),i("div",N,[n(i("div",{class:"model-editor-info",ref_key:"modelEditorDom",ref:R},null,512),[[o,"editor"===ne.value]]),"explosion"===ne.value?(m(),u(L,{key:0,explosionStyle:me.value,data:oe.value,ref_key:"explosionDiagramDom",ref:Q},null,8,["explosionStyle","data"])):r("",!0)])]),i("div",B,[J,i("div",z,[t(C,null,{default:s((()=>[(m(!0),l(y,null,p(ge.value,((e,n)=>(m(),l("div",{key:e.uuid},[i("div",{class:"layer-item",onClick:a=>{return l=e.uuid,void(he.value.has(l)?he.value.delete(l):he.value.add(l));var l}},[i("div",{class:"layer-select-area",onClick:f((a=>(e=>{const a=O();be(e).then((()=>{a.close()}))})(e)),["stop"])},"生成",8,G),i("div",M,g(`组${n}`),1),i("div",{class:"layer-item-handle",onClick:a[0]||(a[0]=f((()=>{}),["stop"]))},[t(b,{onClick:a=>{return l=e.uuid,void ge.value.find((({uuid:e})=>e===l)).layers.forEach((e=>{pe(e)}));var l}},{default:s((()=>[(m(),u(k(w(H)(se.value,e.layers)?w(x):w(D))))])),_:2},1032,["onClick"])]),i("div",U,[(m(),u(k(he.value.has(e.uuid)?w(S):w(E))))])],8,F),he.value.has(e.uuid)?(m(),l("div",V,[(m(!0),l(y,null,p(e.layers,(e=>(m(),l("div",{class:"layer-item",key:e},[i("div",{class:"layer-select-area",onClick:f((a=>(e=>{const a=O();Ce(e,1).then((l=>{xe(l).then((([l])=>{l?W.value.changeImage(e,l).then((()=>{a.close()})):a.close()}))}))})(e)),["stop"])},"生成",8,X),ie.value[e].image?(m(),l("div",Y,[i("img",{src:ie.value[e].image.src},null,8,Z)])):r("",!0),i("div",K,g(ie.value[e].name),1),i("div",{class:"layer-item-handle",onClick:a[1]||(a[1]=f((()=>{}),["stop"]))},[t(b,{onClick:a=>pe(e)},{default:s((()=>[(m(),u(k(new Set(se.value).has(e)?w(x):w(D))))])),_:2},1032,["onClick"])])])))),128))])):r("",!0)])))),128))])),_:1})])])])}}},[["__scopeId","data-v-59be3780"]]);export{Q as default};
